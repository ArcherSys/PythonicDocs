

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>distutils.command.bdist_msi &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>distutils.command.bdist_msi</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for distutils.command.bdist_msi</h1><div class="highlight"><pre>
<span class="c"># Copyright (C) 2005, 2006 Martin von LÃ¶wis</span>
<span class="c"># Licensed to PSF under a Contributor Agreement.</span>
<span class="c"># The bdist_wininst command proper</span>
<span class="c"># based on bdist_wininst</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Implements the bdist_msi command.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">remove_tree</span>
<span class="kn">from</span> <span class="nn">distutils.sysconfig</span> <span class="kn">import</span> <span class="n">get_python_version</span>
<span class="kn">from</span> <span class="nn">distutils.version</span> <span class="kn">import</span> <span class="n">StrictVersion</span>
<span class="kn">from</span> <span class="nn">distutils.errors</span> <span class="kn">import</span> <span class="n">DistutilsOptionError</span>
<span class="kn">from</span> <span class="nn">distutils.util</span> <span class="kn">import</span> <span class="n">get_platform</span>
<span class="kn">from</span> <span class="nn">distutils</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">import</span> <span class="nn">msilib</span>
<span class="kn">from</span> <span class="nn">msilib</span> <span class="kn">import</span> <span class="n">schema</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">text</span>
<span class="kn">from</span> <span class="nn">msilib</span> <span class="kn">import</span> <span class="n">Directory</span><span class="p">,</span> <span class="n">Feature</span><span class="p">,</span> <span class="n">Dialog</span><span class="p">,</span> <span class="n">add_data</span>

<div class="viewcode-block" id="PyDialog"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.PyDialog">[docs]</a><span class="k">class</span> <span class="nc">PyDialog</span><span class="p">(</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dialog class with a fixed layout: controls at the top, then a ruler,</span>
<span class="sd">    then a list of buttons: back, next, cancel. Optionally a bitmap at the</span>
<span class="sd">    left.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dialog(database, name, x, y, w, h, attributes, title, first,</span>
<span class="sd">        default, cancel, bitmap=true)&quot;&quot;&quot;</span>
        <span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">ruler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">36</span>
        <span class="n">bmwidth</span> <span class="o">=</span> <span class="mi">152</span><span class="o">*</span><span class="n">ruler</span><span class="o">/</span><span class="mi">328</span>
        <span class="c">#if kw.get(&quot;bitmap&quot;, True):</span>
        <span class="c">#    self.bitmap(&quot;Bitmap&quot;, 0, 0, bmwidth, ruler, &quot;PythonWin&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s">&quot;BottomLine&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ruler</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="PyDialog.title"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.PyDialog.title">[docs]</a>    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="s">&quot;Set the title text of the dialog at the top.&quot;</span>
        <span class="c"># name, x, y, w, h, flags=Visible|Enabled|Transparent|NoPrefix,</span>
        <span class="c"># text, in VerdanaBold10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Title&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                  <span class="s">r&quot;{\VerdanaBold10}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">title</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyDialog.back"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.PyDialog.back">[docs]</a>    <span class="k">def</span> <span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Back&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a back button with a given title, the tab-next button,</span>
<span class="sd">        its name in the Control table, possibly initially disabled.</span>

<span class="sd">        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># Visible|Enabled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># Visible</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">-</span><span class="mi">27</span> <span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyDialog.cancel"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.PyDialog.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a cancel button with a given title, the tab-next button,</span>
<span class="sd">        its name in the Control table, possibly initially disabled.</span>

<span class="sd">        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># Visible|Enabled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># Visible</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyDialog.next"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.PyDialog.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a Next button with a given title, the tab-next button,</span>
<span class="sd">        its name in the Control table, possibly initially disabled.</span>

<span class="sd">        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># Visible|Enabled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># Visible</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyDialog.xbutton"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.PyDialog.xbutton">[docs]</a>    <span class="k">def</span> <span class="nf">xbutton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">xpos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a button with a given title, the tab-next button,</span>
<span class="sd">        its name in the Control table, giving its x position; the</span>
<span class="sd">        y-position is aligned with the other buttons.</span>

<span class="sd">        Return the button, so that events can be associated&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">*</span><span class="n">xpos</span> <span class="o">-</span> <span class="mi">28</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="bdist_msi"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi">[docs]</a><span class="k">class</span> <span class="nc">bdist_msi</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;create a Microsoft Installer (.msi) binary distribution&quot;</span>

    <span class="n">user_options</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;bdist-dir=&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&quot;temporary directory for creating the distribution&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;plat-name=&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">,</span>
                     <span class="s">&quot;platform name to embed in generated filenames &quot;</span>
                     <span class="s">&quot;(default: </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">get_platform</span><span class="p">()),</span>
                    <span class="p">(</span><span class="s">&#39;keep-temp&#39;</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">,</span>
                     <span class="s">&quot;keep the pseudo-installation tree around after &quot;</span> <span class="o">+</span>
                     <span class="s">&quot;creating the distribution archive&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;target-version=&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&quot;require a specific python version&quot;</span> <span class="o">+</span>
                     <span class="s">&quot; on the target system&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;no-target-compile&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span>
                     <span class="s">&quot;do not compile .py to .pyc on the target system&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;no-target-optimize&#39;</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span>
                     <span class="s">&quot;do not compile .py to .pyo (optimized)&quot;</span>
                     <span class="s">&quot;on the target system&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;dist-dir=&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                     <span class="s">&quot;directory to put final built distributions in&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;skip-build&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&quot;skip rebuilding everything (for testing/debugging)&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;install-script=&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&quot;basename of installation script to be run after&quot;</span>
                     <span class="s">&quot;installation or before deinstallation&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;pre-install-script=&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&quot;Fully qualified filename of a script to be run before &quot;</span>
                     <span class="s">&quot;any files are installed.  This script need not be in the &quot;</span>
                     <span class="s">&quot;distribution&quot;</span><span class="p">),</span>
                   <span class="p">]</span>

    <span class="n">boolean_options</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;keep-temp&#39;</span><span class="p">,</span> <span class="s">&#39;no-target-compile&#39;</span><span class="p">,</span> <span class="s">&#39;no-target-optimize&#39;</span><span class="p">,</span>
                       <span class="s">&#39;skip-build&#39;</span><span class="p">]</span>

    <span class="n">all_versions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;2.0&#39;</span><span class="p">,</span> <span class="s">&#39;2.1&#39;</span><span class="p">,</span> <span class="s">&#39;2.2&#39;</span><span class="p">,</span> <span class="s">&#39;2.3&#39;</span><span class="p">,</span> <span class="s">&#39;2.4&#39;</span><span class="p">,</span>
                    <span class="s">&#39;2.5&#39;</span><span class="p">,</span> <span class="s">&#39;2.6&#39;</span><span class="p">,</span> <span class="s">&#39;2.7&#39;</span><span class="p">,</span> <span class="s">&#39;2.8&#39;</span><span class="p">,</span> <span class="s">&#39;2.9&#39;</span><span class="p">,</span>
                    <span class="s">&#39;3.0&#39;</span><span class="p">,</span> <span class="s">&#39;3.1&#39;</span><span class="p">,</span> <span class="s">&#39;3.2&#39;</span><span class="p">,</span> <span class="s">&#39;3.3&#39;</span><span class="p">,</span> <span class="s">&#39;3.4&#39;</span><span class="p">,</span>
                    <span class="s">&#39;3.5&#39;</span><span class="p">,</span> <span class="s">&#39;3.6&#39;</span><span class="p">,</span> <span class="s">&#39;3.7&#39;</span><span class="p">,</span> <span class="s">&#39;3.8&#39;</span><span class="p">,</span> <span class="s">&#39;3.9&#39;</span><span class="p">]</span>
    <span class="n">other_version</span> <span class="o">=</span> <span class="s">&#39;X&#39;</span>

<div class="viewcode-block" id="bdist_msi.initialize_options"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.initialize_options">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plat_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_target_compile</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_target_optimize</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_build</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_install_script</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="bdist_msi.finalize_options"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.finalize_options">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_undefined_options</span><span class="p">(</span><span class="s">&#39;bdist&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;skip_build&#39;</span><span class="p">,</span> <span class="s">&#39;skip_build&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bdist_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_finalized_command</span><span class="p">(</span><span class="s">&#39;bdist&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bdist_base</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bdist_base</span><span class="p">,</span> <span class="s">&#39;msi&#39;</span><span class="p">)</span>

        <span class="n">short_version</span> <span class="o">=</span> <span class="n">get_python_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">has_ext_modules</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span> <span class="o">=</span> <span class="n">short_version</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_build</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">has_ext_modules</span><span class="p">()</span>\
               <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span> <span class="o">!=</span> <span class="n">short_version</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DistutilsOptionError</span><span class="p">(</span>
                      <span class="s">&quot;target version can only be </span><span class="si">%s</span><span class="s">, or the &#39;--skip-build&#39;&quot;</span>
                      <span class="s">&quot; option must be specified&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">short_version</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_versions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_undefined_options</span><span class="p">(</span><span class="s">&#39;bdist&#39;</span><span class="p">,</span>
                                   <span class="p">(</span><span class="s">&#39;dist_dir&#39;</span><span class="p">,</span> <span class="s">&#39;dist_dir&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s">&#39;plat_name&#39;</span><span class="p">,</span> <span class="s">&#39;plat_name&#39;</span><span class="p">),</span>
                                   <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_install_script</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DistutilsOptionError</span><span class="p">(</span>
                  <span class="s">&quot;the pre-install-script feature is not yet implemented&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">scripts</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DistutilsOptionError</span><span class="p">(</span>
                      <span class="s">&quot;install_script &#39;</span><span class="si">%s</span><span class="s">&#39; not found in scripts&quot;</span>
                      <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_script_key</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="bdist_msi.run"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_build</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&#39;build&#39;</span><span class="p">)</span>

        <span class="n">install</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reinitialize_command</span><span class="p">(</span><span class="s">&#39;install&#39;</span><span class="p">,</span> <span class="n">reinit_subcommands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">install</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span>
        <span class="n">install</span><span class="o">.</span><span class="n">skip_build</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_build</span>
        <span class="n">install</span><span class="o">.</span><span class="n">warn_dir</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">install_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reinitialize_command</span><span class="p">(</span><span class="s">&#39;install_lib&#39;</span><span class="p">)</span>
        <span class="c"># we do not want to include pyc or pyo files</span>
        <span class="n">install_lib</span><span class="o">.</span><span class="n">compile</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">install_lib</span><span class="o">.</span><span class="n">optimize</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">has_ext_modules</span><span class="p">():</span>
            <span class="c"># If we are building an installer for a Python version other</span>
            <span class="c"># than the one we are currently running, then we need to ensure</span>
            <span class="c"># our build_lib reflects the other Python version rather than ours.</span>
            <span class="c"># Note that for target_version!=sys.version, we must have skipped the</span>
            <span class="c"># build step, so there is no issue with enforcing the build of this</span>
            <span class="c"># version.</span>
            <span class="n">target_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">target_version</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_build</span><span class="p">,</span> <span class="s">&quot;Should have already checked this&quot;</span>
                <span class="n">target_version</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">plat_specifier</span> <span class="o">=</span> <span class="s">&quot;.</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plat_name</span><span class="p">,</span> <span class="n">target_version</span><span class="p">)</span>
            <span class="n">build</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_finalized_command</span><span class="p">(</span><span class="s">&#39;build&#39;</span><span class="p">)</span>
            <span class="n">build</span><span class="o">.</span><span class="n">build_lib</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build</span><span class="o">.</span><span class="n">build_base</span><span class="p">,</span>
                                           <span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">plat_specifier</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;installing to </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span><span class="p">)</span>
        <span class="n">install</span><span class="o">.</span><span class="n">ensure_finalized</span><span class="p">()</span>

        <span class="c"># avoid warning of &#39;install_lib&#39; about installing</span>
        <span class="c"># into a directory not in sys.path</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span><span class="p">,</span> <span class="s">&#39;PURELIB&#39;</span><span class="p">))</span>

        <span class="n">install</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mkpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span><span class="p">)</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">get_fullname</span><span class="p">()</span>
        <span class="n">installer_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_installer_filename</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="n">installer_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">installer_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">installer_name</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">installer_name</span><span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">author</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">author</span><span class="p">:</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">maintainer</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">author</span><span class="p">:</span>
            <span class="n">author</span> <span class="o">=</span> <span class="s">&quot;UNKNOWN&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="c"># ProductVersion must be strictly numeric</span>
        <span class="c"># XXX need to deal with prerelease versions</span>
        <span class="n">sversion</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">StrictVersion</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
        <span class="c"># Prefix ProductName with Python x.y, so that</span>
        <span class="c"># it sorts together with the other Python packages</span>
        <span class="c"># in Add-Remove-Programs (APR)</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">get_fullname</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">:</span>
            <span class="n">product_name</span> <span class="o">=</span> <span class="s">&quot;Python </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">product_name</span> <span class="o">=</span> <span class="s">&quot;Python </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">msilib</span><span class="o">.</span><span class="n">init_database</span><span class="p">(</span><span class="n">installer_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span>
                <span class="n">product_name</span><span class="p">,</span> <span class="n">msilib</span><span class="o">.</span><span class="n">gen_uuid</span><span class="p">(),</span>
                <span class="n">sversion</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>
        <span class="n">msilib</span><span class="o">.</span><span class="n">add_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;DistVersion&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">)]</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">author_email</span> <span class="ow">or</span> <span class="n">metadata</span><span class="o">.</span><span class="n">maintainer_email</span>
        <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&quot;ARPCONTACT&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">props</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&quot;ARPURLINFOABOUT&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">props</span><span class="p">:</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&#39;Property&#39;</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_find_python</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_files</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_scripts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_ui</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="p">,</span> <span class="s">&#39;dist_files&#39;</span><span class="p">):</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="s">&#39;bdist_msi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span> <span class="ow">or</span> <span class="s">&#39;any&#39;</span><span class="p">,</span> <span class="n">fullname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">dist_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_temp</span><span class="p">:</span>
            <span class="n">remove_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dry_run</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bdist_msi.add_files"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.add_files">[docs]</a>    <span class="k">def</span> <span class="nf">add_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span>
        <span class="n">cab</span> <span class="o">=</span> <span class="n">msilib</span><span class="o">.</span><span class="n">CAB</span><span class="p">(</span><span class="s">&quot;distfiles&quot;</span><span class="p">)</span>
        <span class="n">rootdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span><span class="p">)</span>

        <span class="n">root</span> <span class="o">=</span> <span class="n">Directory</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cab</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">,</span> <span class="s">&quot;TARGETDIR&quot;</span><span class="p">,</span> <span class="s">&quot;SourceDir&quot;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Python&quot;</span><span class="p">,</span> <span class="s">&quot;Python&quot;</span><span class="p">,</span> <span class="s">&quot;Everything&quot;</span><span class="p">,</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;TARGETDIR&quot;</span><span class="p">)</span>

        <span class="n">items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">other_version</span><span class="p">]:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="s">&quot;TARGETDIR&quot;</span> <span class="o">+</span> <span class="n">version</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&quot;Python&quot;</span> <span class="o">+</span> <span class="n">version</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s">&quot;Everything&quot;</span>
            <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_version</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Python from another location&quot;</span>
                <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Python </span><span class="si">%s</span><span class="s"> from registry&quot;</span> <span class="o">%</span> <span class="n">version</span>
                <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="n">Directory</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cab</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">rootdir</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>

        <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">todo</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dir</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">todo</span><span class="p">:</span>
                <span class="nb">dir</span> <span class="o">=</span> <span class="n">todo</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">absolute</span><span class="p">):</span>
                    <span class="n">afile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">afile</span><span class="p">):</span>
                        <span class="n">short</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">|</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">make_short</span><span class="p">(</span><span class="nb">file</span><span class="p">),</span> <span class="nb">file</span><span class="p">)</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="nb">file</span> <span class="o">+</span> <span class="n">version</span>
                        <span class="n">newdir</span> <span class="o">=</span> <span class="n">Directory</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cab</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">short</span><span class="p">)</span>
                        <span class="n">todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newdir</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span><span class="o">.</span><span class="n">component</span><span class="p">:</span>
                            <span class="nb">dir</span><span class="o">.</span><span class="n">start_component</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">afile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                            <span class="n">key</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="n">afile</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">file</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">install_script</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_script_key</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">DistutilsOptionError</span><span class="p">(</span>
                                          <span class="s">&quot;Multiple files with name </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">file</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">install_script_key</span> <span class="o">=</span> <span class="s">&#39;[#</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">key</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">key</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="n">afile</span><span class="p">]</span>
                            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;DuplicateFile&quot;</span><span class="p">,</span>
                                <span class="p">[(</span><span class="n">key</span> <span class="o">+</span> <span class="n">version</span><span class="p">,</span> <span class="nb">dir</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">dir</span><span class="o">.</span><span class="n">logical</span><span class="p">)])</span>
            <span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>
        <span class="n">cab</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bdist_msi.add_find_python"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.add_find_python">[docs]</a>    <span class="k">def</span> <span class="nf">add_find_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds code to the installer to compute the location of Python.</span>

<span class="sd">        Properties PYTHON.MACHINE.X.Y and PYTHON.USER.X.Y will be set from the</span>
<span class="sd">        registry for each version of Python.</span>

<span class="sd">        Properties TARGETDIRX.Y will be set from PYTHON.USER.X.Y if defined,</span>
<span class="sd">        else from PYTHON.MACHINE.X.Y.</span>

<span class="sd">        Properties PYTHONX.Y will be set to TARGETDIRX.Y\\python.exe&quot;&quot;&quot;</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">402</span>
        <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">:</span>
            <span class="n">install_path</span> <span class="o">=</span> <span class="s">r&quot;SOFTWARE\Python\PythonCore\</span><span class="si">%s</span><span class="s">\InstallPath&quot;</span> <span class="o">%</span> <span class="n">ver</span>
            <span class="n">machine_reg</span> <span class="o">=</span> <span class="s">&quot;python.machine.&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">user_reg</span> <span class="o">=</span> <span class="s">&quot;python.user.&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">machine_prop</span> <span class="o">=</span> <span class="s">&quot;PYTHON.MACHINE.&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">user_prop</span> <span class="o">=</span> <span class="s">&quot;PYTHON.USER.&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">machine_action</span> <span class="o">=</span> <span class="s">&quot;PythonFromMachine&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">user_action</span> <span class="o">=</span> <span class="s">&quot;PythonFromUser&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">exe_action</span> <span class="o">=</span> <span class="s">&quot;PythonExe&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">target_dir_prop</span> <span class="o">=</span> <span class="s">&quot;TARGETDIR&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="n">exe_prop</span> <span class="o">=</span> <span class="s">&quot;PYTHON&quot;</span> <span class="o">+</span> <span class="n">ver</span>
            <span class="k">if</span> <span class="n">msilib</span><span class="o">.</span><span class="n">Win64</span><span class="p">:</span>
                <span class="c"># type: msidbLocatorTypeRawValue + msidbLocatorType64bit</span>
                <span class="n">Type</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">16</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Type</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;RegLocator&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="n">machine_reg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">install_path</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Type</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">user_reg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">install_path</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Type</span><span class="p">)])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;AppSearch&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="n">machine_prop</span><span class="p">,</span> <span class="n">machine_reg</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">user_prop</span><span class="p">,</span> <span class="n">user_reg</span><span class="p">)])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;CustomAction&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="n">machine_action</span><span class="p">,</span> <span class="mi">51</span><span class="o">+</span><span class="mi">256</span><span class="p">,</span> <span class="n">target_dir_prop</span><span class="p">,</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">machine_prop</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">user_action</span><span class="p">,</span> <span class="mi">51</span><span class="o">+</span><span class="mi">256</span><span class="p">,</span> <span class="n">target_dir_prop</span><span class="p">,</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">user_prop</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">exe_action</span><span class="p">,</span> <span class="mi">51</span><span class="o">+</span><span class="mi">256</span><span class="p">,</span> <span class="n">exe_prop</span><span class="p">,</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">target_dir_prop</span> <span class="o">+</span> <span class="s">&quot;]</span><span class="se">\\</span><span class="s">python.exe&quot;</span><span class="p">),</span>
                    <span class="p">])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;InstallExecuteSequence&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="n">machine_action</span><span class="p">,</span> <span class="n">machine_prop</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">user_action</span><span class="p">,</span> <span class="n">user_prop</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">exe_action</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="p">])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;InstallUISequence&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="n">machine_action</span><span class="p">,</span> <span class="n">machine_prop</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">user_action</span><span class="p">,</span> <span class="n">user_prop</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">exe_action</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="p">])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Condition&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="s">&quot;Python&quot;</span> <span class="o">+</span> <span class="n">ver</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;NOT TARGETDIR&quot;</span> <span class="o">+</span> <span class="n">ver</span><span class="p">)])</span>
            <span class="n">start</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="k">assert</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">500</span>
</div>
<div class="viewcode-block" id="bdist_msi.add_scripts"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.add_scripts">[docs]</a>    <span class="k">def</span> <span class="nf">add_scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_script</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">6800</span>
            <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">other_version</span><span class="p">]:</span>
                <span class="n">install_action</span> <span class="o">=</span> <span class="s">&quot;install_script.&quot;</span> <span class="o">+</span> <span class="n">ver</span>
                <span class="n">exe_prop</span> <span class="o">=</span> <span class="s">&quot;PYTHON&quot;</span> <span class="o">+</span> <span class="n">ver</span>
                <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;CustomAction&quot;</span><span class="p">,</span>
                        <span class="p">[(</span><span class="n">install_action</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">exe_prop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_script_key</span><span class="p">)])</span>
                <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;InstallExecuteSequence&quot;</span><span class="p">,</span>
                        <span class="p">[(</span><span class="n">install_action</span><span class="p">,</span> <span class="s">&quot;&amp;Python</span><span class="si">%s</span><span class="s">=3&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">,</span> <span class="n">start</span><span class="p">)])</span>
                <span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># XXX pre-install scripts are currently refused in finalize_options()</span>
        <span class="c">#     but if this feature is completed, it will also need to add</span>
        <span class="c">#     entries for each version as the above code does</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_install_script</span><span class="p">:</span>
            <span class="n">scriptfn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdist_dir</span><span class="p">,</span> <span class="s">&quot;preinstall.bat&quot;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">scriptfn</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="c"># The batch file will be executed with [PYTHON], so that %1</span>
            <span class="c"># is the path to the Python interpreter; %0 will be the path</span>
            <span class="c"># of the batch file.</span>
            <span class="c"># rem =&quot;&quot;&quot;</span>
            <span class="c"># %1 %0</span>
            <span class="c"># exit</span>
            <span class="c"># &quot;&quot;&quot;</span>
            <span class="c"># &lt;actual script&gt;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;rem =&quot;&quot;&quot;</span><span class="se">\n</span><span class="s">%1 %0</span><span class="se">\n</span><span class="s">exit</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_install_script</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Binary&quot;</span><span class="p">,</span>
                <span class="p">[(</span><span class="s">&quot;PreInstall&quot;</span><span class="p">,</span> <span class="n">msilib</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">scriptfn</span><span class="p">))</span>
                <span class="p">])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;CustomAction&quot;</span><span class="p">,</span>
                <span class="p">[(</span><span class="s">&quot;PreInstall&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;PreInstall&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="p">])</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;InstallExecuteSequence&quot;</span><span class="p">,</span>
                    <span class="p">[(</span><span class="s">&quot;PreInstall&quot;</span><span class="p">,</span> <span class="s">&quot;NOT Installed&quot;</span><span class="p">,</span> <span class="mi">450</span><span class="p">)])</span>

</div>
<div class="viewcode-block" id="bdist_msi.add_ui"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.add_ui">[docs]</a>    <span class="k">def</span> <span class="nf">add_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mi">370</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;[ProductName] Setup&quot;</span>

        <span class="c"># see &quot;Dialog Style Bits&quot;</span>
        <span class="n">modal</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c"># visible | modal</span>
        <span class="n">modeless</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c"># visible</span>
        <span class="n">track_disk_space</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="c"># UI customization properties</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Property&quot;</span><span class="p">,</span>
                 <span class="c"># See &quot;DefaultUIFont Property&quot;</span>
                 <span class="p">[(</span><span class="s">&quot;DefaultUIFont&quot;</span><span class="p">,</span> <span class="s">&quot;DlgFont8&quot;</span><span class="p">),</span>
                  <span class="c"># See &quot;ErrorDialog Style Bit&quot;</span>
                  <span class="p">(</span><span class="s">&quot;ErrorDialog&quot;</span><span class="p">,</span> <span class="s">&quot;ErrorDlg&quot;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;Progress1&quot;</span><span class="p">,</span> <span class="s">&quot;Install&quot;</span><span class="p">),</span>   <span class="c"># modified in maintenance type dlg</span>
                  <span class="p">(</span><span class="s">&quot;Progress2&quot;</span><span class="p">,</span> <span class="s">&quot;installs&quot;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;MaintenanceForm_Action&quot;</span><span class="p">,</span> <span class="s">&quot;Repair&quot;</span><span class="p">),</span>
                  <span class="c"># possible values: ALL, JUSTME</span>
                  <span class="p">(</span><span class="s">&quot;WhichUsers&quot;</span><span class="p">,</span> <span class="s">&quot;ALL&quot;</span><span class="p">)</span>
                 <span class="p">])</span>

        <span class="c"># Fonts, see &quot;TextStyle Table&quot;</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;TextStyle&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="s">&quot;DlgFont8&quot;</span><span class="p">,</span> <span class="s">&quot;Tahoma&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;DlgFontBold8&quot;</span><span class="p">,</span> <span class="s">&quot;Tahoma&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c">#bold</span>
                  <span class="p">(</span><span class="s">&quot;VerdanaBold10&quot;</span><span class="p">,</span> <span class="s">&quot;Verdana&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;VerdanaRed9&quot;</span><span class="p">,</span> <span class="s">&quot;Verdana&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                 <span class="p">])</span>

        <span class="c"># UI Sequences, see &quot;InstallUISequence Table&quot;, &quot;Using a Sequence Table&quot;</span>
        <span class="c"># Numbers indicate sequence; see sequence.py for how these action integrate</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;InstallUISequence&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="s">&quot;PrepareDlg&quot;</span><span class="p">,</span> <span class="s">&quot;Not Privileged or Windows9x or Installed&quot;</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;WhichUsersDlg&quot;</span><span class="p">,</span> <span class="s">&quot;Privileged and not Windows9x and not Installed&quot;</span><span class="p">,</span> <span class="mi">141</span><span class="p">),</span>
                  <span class="c"># In the user interface, assume all-users installation if privileged.</span>
                  <span class="p">(</span><span class="s">&quot;SelectFeaturesDlg&quot;</span><span class="p">,</span> <span class="s">&quot;Not Installed&quot;</span><span class="p">,</span> <span class="mi">1230</span><span class="p">),</span>
                  <span class="c"># XXX no support for resume installations yet</span>
                  <span class="c">#(&quot;ResumeDlg&quot;, &quot;Installed AND (RESUME OR Preselected)&quot;, 1240),</span>
                  <span class="p">(</span><span class="s">&quot;MaintenanceTypeDlg&quot;</span><span class="p">,</span> <span class="s">&quot;Installed AND NOT RESUME AND NOT Preselected&quot;</span><span class="p">,</span> <span class="mi">1250</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&quot;ProgressDlg&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1280</span><span class="p">)])</span>

        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&#39;ActionText&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">ActionText</span><span class="p">)</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&#39;UIText&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">UIText</span><span class="p">)</span>
        <span class="c">#####################################################################</span>
        <span class="c"># Standard dialogs: FatalError, UserExit, ExitDialog</span>
        <span class="n">fatal</span><span class="o">=</span><span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;FatalError&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                     <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">)</span>
        <span class="n">fatal</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;[ProductName] Installer ended prematurely&quot;</span><span class="p">)</span>
        <span class="n">fatal</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;&lt; Back&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">fatal</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Back&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">fatal</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description1&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                   <span class="s">&quot;[ProductName] setup ended prematurely because of an error.  Your system has not been modified.  To install this program at a later time, please run the installation again.&quot;</span><span class="p">)</span>
        <span class="n">fatal</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description2&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                   <span class="s">&quot;Click the Finish button to exit the Installer.&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">fatal</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Finish&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Exit&quot;</span><span class="p">)</span>

        <span class="n">user_exit</span><span class="o">=</span><span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;UserExit&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                     <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">)</span>
        <span class="n">user_exit</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;[ProductName] Installer was interrupted&quot;</span><span class="p">)</span>
        <span class="n">user_exit</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;&lt; Back&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">user_exit</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Back&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">user_exit</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description1&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                   <span class="s">&quot;[ProductName] setup was interrupted.  Your system has not been modified.  &quot;</span>
                   <span class="s">&quot;To install this program at a later time, please run the installation again.&quot;</span><span class="p">)</span>
        <span class="n">user_exit</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description2&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                   <span class="s">&quot;Click the Finish button to exit the Installer.&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">user_exit</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Finish&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Exit&quot;</span><span class="p">)</span>

        <span class="n">exit_dialog</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;ExitDialog&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                             <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">)</span>
        <span class="n">exit_dialog</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Completing the [ProductName] Installer&quot;</span><span class="p">)</span>
        <span class="n">exit_dialog</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;&lt; Back&quot;</span><span class="p">,</span> <span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exit_dialog</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Back&quot;</span><span class="p">,</span> <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exit_dialog</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                   <span class="s">&quot;Click the Finish button to exit the Installer.&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">exit_dialog</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Finish&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Required dialog: FilesInUse, ErrorDlg</span>
        <span class="n">inuse</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;FilesInUse&quot;</span><span class="p">,</span>
                         <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                         <span class="mi">19</span><span class="p">,</span>                <span class="c"># KeepModeless|Modal|Visible</span>
                         <span class="n">title</span><span class="p">,</span>
                         <span class="s">&quot;Retry&quot;</span><span class="p">,</span> <span class="s">&quot;Retry&quot;</span><span class="p">,</span> <span class="s">&quot;Retry&quot;</span><span class="p">,</span> <span class="n">bitmap</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">inuse</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Title&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                   <span class="s">r&quot;{\DlgFontBold8}Files in Use&quot;</span><span class="p">)</span>
        <span class="n">inuse</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
               <span class="s">&quot;Some files that need to be updated are currently in use.&quot;</span><span class="p">)</span>
        <span class="n">inuse</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                   <span class="s">&quot;The following applications are using files that need to be updated by this setup. Close these applications and then click Retry to continue the installation or Cancel to exit it.&quot;</span><span class="p">)</span>
        <span class="n">inuse</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="s">&quot;List&quot;</span><span class="p">,</span> <span class="s">&quot;ListBox&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&quot;FileInUseProcess&quot;</span><span class="p">,</span>
                      <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">inuse</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;Exit&quot;</span><span class="p">,</span> <span class="s">&quot;Ignore&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Exit&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Exit&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">inuse</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Ignore&quot;</span><span class="p">,</span> <span class="s">&quot;Retry&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Ignore&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Ignore&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">inuse</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Retry&quot;</span><span class="p">,</span> <span class="s">&quot;Exit&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Retry&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;Retry&quot;</span><span class="p">)</span>

        <span class="c"># See &quot;Error Dialog&quot;. See &quot;ICE20&quot; for the required names of the controls.</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;ErrorDlg&quot;</span><span class="p">,</span>
                       <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span>
                       <span class="mi">65543</span><span class="p">,</span>       <span class="c"># Error|Minimize|Modal|Visible</span>
                       <span class="n">title</span><span class="p">,</span>
                       <span class="s">&quot;ErrorText&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;ErrorText&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="c">#error.control(&quot;ErrorIcon&quot;, &quot;Icon&quot;, 15, 9, 24, 24, 5242881, None, &quot;py.ico&quot;, None, None)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;No&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorNo&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorYes&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Abort&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorAbort&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorCancel&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Ignore&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorIgnore&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;O&quot;</span><span class="p">,</span><span class="mi">159</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorOk&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Retry&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span><span class="s">&quot;ErrorRetry&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Global &quot;Query Cancel&quot; dialog</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;CancelDlg&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                        <span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">)</span>
        <span class="n">cancel</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="s">&quot;Are you sure you want to cancel [ProductName] installation?&quot;</span><span class="p">)</span>
        <span class="c">#cancel.control(&quot;Icon&quot;, &quot;Icon&quot;, 15, 15, 24, 24, 5242881, None,</span>
        <span class="c">#               &quot;py.ico&quot;, None, None)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">cancel</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Exit&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">=</span><span class="n">cancel</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Global &quot;Wait for costing&quot; dialog</span>
        <span class="n">costing</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;WaitForCostingDlg&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                         <span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">)</span>
        <span class="n">costing</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                     <span class="s">&quot;Please wait while the installer finishes determining your disk space requirements.&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">costing</span><span class="o">.</span><span class="n">pushbutton</span><span class="p">(</span><span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Exit&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Preparation dialog: no user input except cancellation</span>
        <span class="n">prep</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;PrepareDlg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modeless</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                        <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">prep</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                  <span class="s">&quot;Please wait while the Installer prepares to guide you through the installation.&quot;</span><span class="p">)</span>
        <span class="n">prep</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Welcome to the [ProductName] Installer&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">prep</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;ActionText&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span> <span class="s">&quot;Pondering...&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="s">&quot;ActionText&quot;</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">prep</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;ActionData&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="s">&quot;ActionData&quot;</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span><span class="p">)</span>
        <span class="n">prep</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;Back&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">prep</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">prep</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;SpawnDialog&quot;</span><span class="p">,</span> <span class="s">&quot;CancelDlg&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Feature (Python directory) selection</span>
        <span class="n">seldlg</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;SelectFeaturesDlg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                        <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">seldlg</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Select Python Installations&quot;</span><span class="p">)</span>

        <span class="n">seldlg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Hint&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="s">&quot;Select the Python locations where </span><span class="si">%s</span><span class="s"> should be installed.&quot;</span>
                    <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">get_fullname</span><span class="p">())</span>

        <span class="n">seldlg</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;&lt; Back&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">seldlg</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Next &gt;&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[TARGETDIR]&quot;</span><span class="p">,</span> <span class="s">&quot;[SourceDir]&quot;</span><span class="p">,</span> <span class="n">ordering</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">other_version</span><span class="p">]:</span>
            <span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[TARGETDIR]&quot;</span><span class="p">,</span> <span class="s">&quot;[TARGETDIR</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">,</span>
                    <span class="s">&quot;FEATURE_SELECTED AND &amp;Python</span><span class="si">%s</span><span class="s">=3&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">,</span>
                    <span class="n">ordering</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;SpawnWaitDialog&quot;</span><span class="p">,</span> <span class="s">&quot;WaitForCostingDlg&quot;</span><span class="p">,</span> <span class="n">ordering</span><span class="o">=</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="n">ordering</span><span class="o">=</span><span class="n">order</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">seldlg</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Features&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;SpawnDialog&quot;</span><span class="p">,</span> <span class="s">&quot;CancelDlg&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">seldlg</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="s">&quot;Features&quot;</span><span class="p">,</span> <span class="s">&quot;SelectionTree&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                           <span class="s">&quot;FEATURE&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;PathEdit&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[FEATURE_SELECTED]&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_version</span>
        <span class="n">install_other_cond</span> <span class="o">=</span> <span class="s">&quot;FEATURE_SELECTED AND &amp;Python</span><span class="si">%s</span><span class="s">=3&quot;</span> <span class="o">%</span> <span class="n">ver</span>
        <span class="n">dont_install_other_cond</span> <span class="o">=</span> <span class="s">&quot;FEATURE_SELECTED AND &amp;Python</span><span class="si">%s</span><span class="s">&lt;&gt;3&quot;</span> <span class="o">%</span> <span class="n">ver</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">seldlg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Other&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                        <span class="s">&quot;Provide an alternate Python location&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Enable&quot;</span><span class="p">,</span> <span class="n">install_other_cond</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Show&quot;</span><span class="p">,</span> <span class="n">install_other_cond</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Disable&quot;</span><span class="p">,</span> <span class="n">dont_install_other_cond</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Hide&quot;</span><span class="p">,</span> <span class="n">dont_install_other_cond</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">seldlg</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="s">&quot;PathEdit&quot;</span><span class="p">,</span> <span class="s">&quot;PathEdit&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                           <span class="s">&quot;TARGETDIR&quot;</span> <span class="o">+</span> <span class="n">ver</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Enable&quot;</span><span class="p">,</span> <span class="n">install_other_cond</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Show&quot;</span><span class="p">,</span> <span class="n">install_other_cond</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Disable&quot;</span><span class="p">,</span> <span class="n">dont_install_other_cond</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="s">&quot;Hide&quot;</span><span class="p">,</span> <span class="n">dont_install_other_cond</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Disk cost</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;DiskCostDlg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                        <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">bitmap</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Title&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                  <span class="s">&quot;{\DlgFontBold8}Disk Space Requirements&quot;</span><span class="p">)</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                  <span class="s">&quot;The disk space required for the installation of the selected features.&quot;</span><span class="p">)</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                  <span class="s">&quot;The highlighted volumes (if any) do not have enough disk space &quot;</span>
              <span class="s">&quot;available for the currently selected features.  You can either &quot;</span>
              <span class="s">&quot;remove some files from the highlighted volumes, or choose to &quot;</span>
              <span class="s">&quot;install less features onto local drive(s), or select different &quot;</span>
              <span class="s">&quot;destination drive(s).&quot;</span><span class="p">)</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="s">&quot;VolumeList&quot;</span><span class="p">,</span> <span class="s">&quot;VolumeCostList&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">393223</span><span class="p">,</span>
                     <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;{120}{70}{70}{70}{70}&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">cost</span><span class="o">.</span><span class="n">xbutton</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;Ok&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># WhichUsers Dialog. Only available on NT, and for privileged users.</span>
        <span class="c"># This must be run before FindRelatedProducts, because that will</span>
        <span class="c"># take into account whether the previous installation was per-user</span>
        <span class="c"># or per-machine. We currently don&#39;t support going back to this</span>
        <span class="c"># dialog after &quot;Next&quot; was selected; to support this, we would need to</span>
        <span class="c"># find how to reset the ALLUSERS property, and how to re-run</span>
        <span class="c"># FindRelatedProducts.</span>
        <span class="c"># On Windows9x, the ALLUSERS property is ignored on the command line</span>
        <span class="c"># and in the Property table, but installer fails according to the documentation</span>
        <span class="c"># if a dialog attempts to set ALLUSERS.</span>
        <span class="n">whichusers</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;WhichUsersDlg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                            <span class="s">&quot;AdminInstall&quot;</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">whichusers</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Select whether to install [ProductName] for all users of this computer.&quot;</span><span class="p">)</span>
        <span class="c"># A radio group with two options: allusers, justme</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">whichusers</span><span class="o">.</span><span class="n">radiogroup</span><span class="p">(</span><span class="s">&quot;AdminInstall&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                  <span class="s">&quot;WhichUsers&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;ALL&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&quot;Install for all users&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;JUSTME&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&quot;Install just for me&quot;</span><span class="p">)</span>

        <span class="n">whichusers</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;Back&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">whichusers</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Next &gt;&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[ALLUSERS]&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&#39;WhichUsers=&quot;ALL&quot;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="n">ordering</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">whichusers</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;AdminInstall&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;SpawnDialog&quot;</span><span class="p">,</span> <span class="s">&quot;CancelDlg&quot;</span><span class="p">)</span>

        <span class="c">#####################################################################</span>
        <span class="c"># Installation Progress dialog (modeless)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;ProgressDlg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modeless</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                            <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">bitmap</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Title&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mh">0x30003</span><span class="p">,</span>
                      <span class="s">&quot;{\DlgFontBold8}[Progress1] [ProductName]&quot;</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                      <span class="s">&quot;Please wait while the Installer [Progress2] [ProductName]. &quot;</span>
                      <span class="s">&quot;This may take several minutes.&quot;</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;StatusLabel&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;Status:&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">=</span><span class="n">progress</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;ActionText&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;Pondering...&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="s">&quot;ActionText&quot;</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span><span class="p">)</span>

        <span class="c">#c=progress.text(&quot;ActionData&quot;, 35, 140, 300, 20, 3, None)</span>
        <span class="c">#c.mapping(&quot;ActionData&quot;, &quot;Text&quot;)</span>

        <span class="n">c</span><span class="o">=</span><span class="n">progress</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="s">&quot;ProgressBar&quot;</span><span class="p">,</span> <span class="s">&quot;ProgressBar&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">65537</span><span class="p">,</span>
                           <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Progress done&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="s">&quot;SetProgress&quot;</span><span class="p">,</span> <span class="s">&quot;Progress&quot;</span><span class="p">)</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;&lt; Back&quot;</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Next &gt;&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;Back&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;SpawnDialog&quot;</span><span class="p">,</span> <span class="s">&quot;CancelDlg&quot;</span><span class="p">)</span>

        <span class="c">###################################################################</span>
        <span class="c"># Maintenance type: repair/uninstall</span>
        <span class="n">maint</span> <span class="o">=</span> <span class="n">PyDialog</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;MaintenanceTypeDlg&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">modal</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                         <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">maint</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Welcome to the [ProductName] Setup Wizard&quot;</span><span class="p">)</span>
        <span class="n">maint</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;BodyText&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                   <span class="s">&quot;Select whether you want to repair or remove [ProductName].&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">=</span><span class="n">maint</span><span class="o">.</span><span class="n">radiogroup</span><span class="p">(</span><span class="s">&quot;RepairRadioGroup&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="s">&quot;MaintenanceForm_Action&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;Next&quot;</span><span class="p">)</span>
        <span class="c">#g.add(&quot;Change&quot;, 0, 0, 200, 17, &quot;&amp;Change [ProductName]&quot;)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Repair&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="s">&quot;&amp;Repair [ProductName]&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Remove&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="s">&quot;Re&amp;move [ProductName]&quot;</span><span class="p">)</span>

        <span class="n">maint</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="s">&quot;&lt; Back&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">maint</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s">&quot;Finish&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="c"># Change installation: Change progress dialog to &quot;Change&quot;, then ask</span>
        <span class="c"># for feature selection</span>
        <span class="c">#c.event(&quot;[Progress1]&quot;, &quot;Change&quot;, &#39;MaintenanceForm_Action=&quot;Change&quot;&#39;, 1)</span>
        <span class="c">#c.event(&quot;[Progress2]&quot;, &quot;changes&quot;, &#39;MaintenanceForm_Action=&quot;Change&quot;&#39;, 2)</span>

        <span class="c"># Reinstall: Change progress dialog to &quot;Repair&quot;, then invoke reinstall</span>
        <span class="c"># Also set list of reinstalled features to &quot;ALL&quot;</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[REINSTALL]&quot;</span><span class="p">,</span> <span class="s">&quot;ALL&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Repair&quot;&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[Progress1]&quot;</span><span class="p">,</span> <span class="s">&quot;Repairing&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Repair&quot;&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[Progress2]&quot;</span><span class="p">,</span> <span class="s">&quot;repairs&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Repair&quot;&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;Reinstall&quot;</span><span class="p">,</span> <span class="s">&quot;ALL&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Repair&quot;&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="c"># Uninstall: Change progress to &quot;Remove&quot;, then invoke uninstall</span>
        <span class="c"># Also set list of removed features to &quot;ALL&quot;</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[REMOVE]&quot;</span><span class="p">,</span> <span class="s">&quot;ALL&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Remove&quot;&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[Progress1]&quot;</span><span class="p">,</span> <span class="s">&quot;Removing&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Remove&quot;&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;[Progress2]&quot;</span><span class="p">,</span> <span class="s">&quot;removes&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Remove&quot;&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;Remove&quot;</span><span class="p">,</span> <span class="s">&quot;ALL&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action=&quot;Remove&quot;&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>

        <span class="c"># Close dialog when maintenance action scheduled</span>
        <span class="n">c</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;EndDialog&quot;</span><span class="p">,</span> <span class="s">&quot;Return&quot;</span><span class="p">,</span> <span class="s">&#39;MaintenanceForm_Action&lt;&gt;&quot;Change&quot;&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="c">#c.event(&quot;NewDialog&quot;, &quot;SelectFeaturesDlg&quot;, &#39;MaintenanceForm_Action=&quot;Change&quot;&#39;, 21)</span>

        <span class="n">maint</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="s">&quot;RepairRadioGroup&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&quot;SpawnDialog&quot;</span><span class="p">,</span> <span class="s">&quot;CancelDlg&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bdist_msi.get_installer_filename"><a class="viewcode-back" href="../../../distutils.command.html#distutils.command.bdist_msi.bdist_msi.get_installer_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_installer_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="c"># Factored out to allow overriding in subclasses</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">:</span>
            <span class="n">base_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">-py</span><span class="si">%s</span><span class="s">.msi&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plat_name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">target_version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">.msi&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plat_name</span><span class="p">)</span>
        <span class="n">installer_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">installer_name</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>