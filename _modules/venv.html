

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>venv &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>venv</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for venv</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Virtual environment (venv) package for Python. Based on PEP 405.</span>

<span class="sd">Copyright (C) 2011-2014 Vinay Sajip.</span>
<span class="sd">Licensed to the PSF under a contributor agreement.</span>

<span class="sd">usage: python -m venv [-h] [--system-site-packages] [--symlinks] [--clear]</span>
<span class="sd">            [--upgrade]</span>
<span class="sd">            ENV_DIR [ENV_DIR ...]</span>

<span class="sd">Creates virtual Python environments in one or more target directories.</span>

<span class="sd">positional arguments:</span>
<span class="sd">  ENV_DIR               A directory to create the environment in.</span>

<span class="sd">optional arguments:</span>
<span class="sd">  -h, --help            show this help message and exit</span>
<span class="sd">  --system-site-packages</span>
<span class="sd">                        Give the virtual environment access to the system</span>
<span class="sd">                        site-packages dir.</span>
<span class="sd">  --symlinks            Attempt to symlink rather than copy.</span>
<span class="sd">  --clear               Delete the environment directory if it already exists.</span>
<span class="sd">                        If not specified and the directory exists, an error is</span>
<span class="sd">                        raised.</span>
<span class="sd">  --upgrade             Upgrade the environment directory to use this version</span>
<span class="sd">                        of Python, assuming Python has been upgraded in-place.</span>
<span class="sd">  --without-pip         Skips installing or upgrading pip in the virtual</span>
<span class="sd">                        environment (pip is bootstrapped by default)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="EnvBuilder"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder">[docs]</a><span class="k">class</span> <span class="nc">EnvBuilder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class exists to allow virtual environment creation to be</span>
<span class="sd">    customized. The constructor parameters determine the builder&#39;s</span>
<span class="sd">    behaviour when called upon to create a virtual environment.</span>

<span class="sd">    By default, the builder makes the system (global) site-packages dir</span>
<span class="sd">    *un*available to the created environment.</span>

<span class="sd">    If invoked using the Python -m option, the default is to use copying</span>
<span class="sd">    on Windows platforms but symlinks elsewhere. If instantiated some</span>
<span class="sd">    other way, the default is to *not* use symlinks.</span>

<span class="sd">    :param system_site_packages: If True, the system (global) site-packages</span>
<span class="sd">                                 dir is available to created environments.</span>
<span class="sd">    :param clear: If True and the target directory exists, it is deleted.</span>
<span class="sd">                  Otherwise, if the target directory exists, an error is</span>
<span class="sd">                  raised.</span>
<span class="sd">    :param symlinks: If True, attempt to symlink rather than copy files into</span>
<span class="sd">                     virtual environment.</span>
<span class="sd">    :param upgrade: If True, upgrade an existing virtual environment.</span>
<span class="sd">    :param with_pip: If True, ensure pip is installed in the virtual</span>
<span class="sd">                     environment</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_site_packages</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">symlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">upgrade</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_pip</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_site_packages</span> <span class="o">=</span> <span class="n">system_site_packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span> <span class="o">=</span> <span class="n">clear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symlinks</span> <span class="o">=</span> <span class="n">symlinks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upgrade</span> <span class="o">=</span> <span class="n">upgrade</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_pip</span> <span class="o">=</span> <span class="n">with_pip</span>

<div class="viewcode-block" id="EnvBuilder.create"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a virtual environment in a directory.</span>

<span class="sd">        :param env_dir: The target directory to create an environment in.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_directories</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_configuration</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_python</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_pip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_pip</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">upgrade</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_scripts</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post_setup</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EnvBuilder.clear_directory"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.clear_directory">[docs]</a>    <span class="k">def</span> <span class="nf">clear_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EnvBuilder.ensure_directories"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.ensure_directories">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the directories for the environment.</span>

<span class="sd">        Returns a context object which holds paths in the environment,</span>
<span class="sd">        for use by subsequent logic.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">create_if_needed</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unable to create directory </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_directory</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">env_dir</span> <span class="o">=</span> <span class="n">env_dir</span>
        <span class="n">context</span><span class="o">.</span><span class="n">env_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">context</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">) &#39;</span> <span class="o">%</span> <span class="n">context</span><span class="o">.</span><span class="n">env_name</span>
        <span class="n">create_if_needed</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span> <span class="ow">and</span> <span class="s">&#39;__PYVENV_LAUNCHER__&#39;</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
            <span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;__PYVENV_LAUNCHER__&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">executable</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
        <span class="n">dirname</span><span class="p">,</span> <span class="n">exename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">executable</span><span class="p">))</span>
        <span class="n">context</span><span class="o">.</span><span class="n">executable</span> <span class="o">=</span> <span class="n">executable</span>
        <span class="n">context</span><span class="o">.</span><span class="n">python_dir</span> <span class="o">=</span> <span class="n">dirname</span>
        <span class="n">context</span><span class="o">.</span><span class="n">python_exe</span> <span class="o">=</span> <span class="n">exename</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">binname</span> <span class="o">=</span> <span class="s">&#39;Scripts&#39;</span>
            <span class="n">incpath</span> <span class="o">=</span> <span class="s">&#39;Include&#39;</span>
            <span class="n">libpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="s">&#39;Lib&#39;</span><span class="p">,</span> <span class="s">&#39;site-packages&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binname</span> <span class="o">=</span> <span class="s">&#39;bin&#39;</span>
            <span class="n">incpath</span> <span class="o">=</span> <span class="s">&#39;include&#39;</span>
            <span class="n">libpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;python</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span>
                                   <span class="s">&#39;site-packages&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">inc_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="n">incpath</span><span class="p">)</span>
        <span class="n">create_if_needed</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">create_if_needed</span><span class="p">(</span><span class="n">libpath</span><span class="p">)</span>
        <span class="c"># Issue 21197: create lib64 as a symlink to lib on 64-bit non-OS X POSIX</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;posix&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&#39;darwin&#39;</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">)</span>
            <span class="n">link_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="s">&#39;lib64&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">link_path</span><span class="p">):</span>   <span class="c"># Issue #21643</span>
                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">link_path</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">bin_path</span> <span class="o">=</span> <span class="n">binpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="n">binname</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">bin_name</span> <span class="o">=</span> <span class="n">binname</span>
        <span class="n">context</span><span class="o">.</span><span class="n">env_exe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binpath</span><span class="p">,</span> <span class="n">exename</span><span class="p">)</span>
        <span class="n">create_if_needed</span><span class="p">(</span><span class="n">binpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span>
</div>
<div class="viewcode-block" id="EnvBuilder.create_configuration"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.create_configuration">[docs]</a>    <span class="k">def</span> <span class="nf">create_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a configuration file indicating where the environment&#39;s Python</span>
<span class="sd">        was copied from, and whether the system site-packages should be made</span>
<span class="sd">        available in the environment.</span>

<span class="sd">        :param context: The information for the environment creation request</span>
<span class="sd">                        being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span><span class="o">.</span><span class="n">cfg_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">env_dir</span><span class="p">,</span> <span class="s">&#39;pyvenv.cfg&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;home = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">context</span><span class="o">.</span><span class="n">python_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_site_packages</span><span class="p">:</span>
                <span class="n">incl</span> <span class="o">=</span> <span class="s">&#39;true&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">incl</span> <span class="o">=</span> <span class="s">&#39;false&#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;include-system-site-packages = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">incl</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;version = </span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</div>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;nt&#39;</span><span class="p">:</span>
<div class="viewcode-block" id="EnvBuilder.include_binary"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.include_binary">[docs]</a>        <span class="k">def</span> <span class="nf">include_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s">&#39;.pyd&#39;</span><span class="p">,</span> <span class="s">&#39;.dll&#39;</span><span class="p">)):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.exe&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="EnvBuilder.symlink_or_copy"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.symlink_or_copy">[docs]</a>    <span class="k">def</span> <span class="nf">symlink_or_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try symlinking a file, and if that fails, fall back to copying.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">force_copy</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">symlinks</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force_copy</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span> <span class="c"># can&#39;t link to itself!</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>   <span class="c"># may need to use a more specific exception</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Unable to symlink </span><span class="si">%r</span><span class="s"> to </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
                <span class="n">force_copy</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">force_copy</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EnvBuilder.setup_python"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.setup_python">[docs]</a>    <span class="k">def</span> <span class="nf">setup_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up a Python executable in the environment.</span>

<span class="sd">        :param context: The information for the environment creation request</span>
<span class="sd">                        being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">binpath</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">bin_path</span>
        <span class="n">exename</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">python_exe</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">env_exe</span>
        <span class="n">copier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symlink_or_copy</span>
        <span class="n">copier</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">python_dir</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&#39;nt&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">,</span> <span class="s">&#39;python3&#39;</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binpath</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="c"># Issue 18807: make copies if</span>
                    <span class="c"># symlinks are not wanted</span>
                    <span class="n">copier</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">env_exe</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subdir</span> <span class="o">=</span> <span class="s">&#39;DLLs&#39;</span>
            <span class="n">include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_binary</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dst</span> <span class="o">!=</span> <span class="n">context</span><span class="o">.</span><span class="n">env_exe</span><span class="p">:</span>  <span class="c"># already done, above</span>
                    <span class="n">copier</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="n">copier</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
            <span class="c"># copy init.tcl over</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">python_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="s">&#39;init.tcl&#39;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">tcldir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                    <span class="n">tcldir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">env_dir</span><span class="p">,</span> <span class="s">&#39;Lib&#39;</span><span class="p">,</span> <span class="n">tcldir</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tcldir</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tcldir</span><span class="p">)</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;init.tcl&#39;</span><span class="p">)</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tcldir</span><span class="p">,</span> <span class="s">&#39;init.tcl&#39;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
                    <span class="k">break</span>
</div>
    <span class="k">def</span> <span class="nf">_setup_pip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Installs or upgrades pip in a virtual environment&quot;&quot;&quot;</span>
        <span class="c"># We run ensurepip in isolated mode to avoid side effects from</span>
        <span class="c"># environment vars, the current directory and anything else</span>
        <span class="c"># intended for the global Python environment</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">env_exe</span><span class="p">,</span> <span class="s">&#39;-Im&#39;</span><span class="p">,</span> <span class="s">&#39;ensurepip&#39;</span><span class="p">,</span> <span class="s">&#39;--upgrade&#39;</span><span class="p">,</span>
                                                    <span class="s">&#39;--default-pip&#39;</span><span class="p">]</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>

<div class="viewcode-block" id="EnvBuilder.setup_scripts"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.setup_scripts">[docs]</a>    <span class="k">def</span> <span class="nf">setup_scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up scripts into the created environment from a directory.</span>

<span class="sd">        This method installs the default scripts into the environment</span>
<span class="sd">        being created. You can prevent the default installation by overriding</span>
<span class="sd">        this method if you really need to, or if you need to specify</span>
<span class="sd">        a different location for the scripts to install. By default, the</span>
<span class="sd">        &#39;scripts&#39; directory in the venv package is used as the source of</span>
<span class="sd">        scripts to install.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;scripts&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_scripts</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EnvBuilder.post_setup"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.post_setup">[docs]</a>    <span class="k">def</span> <span class="nf">post_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hook for post-setup modification of the venv. Subclasses may install</span>
<span class="sd">        additional packages or scripts here, add activation shell scripts, etc.</span>

<span class="sd">        :param context: The information for the environment creation request</span>
<span class="sd">                        being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="EnvBuilder.replace_variables"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.replace_variables">[docs]</a>    <span class="k">def</span> <span class="nf">replace_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace variable placeholders in script text with context-specific</span>
<span class="sd">        variables.</span>

<span class="sd">        Return the text passed in , but with variables replaced.</span>

<span class="sd">        :param text: The text in which to replace placeholder variables.</span>
<span class="sd">        :param context: The information for the environment creation request</span>
<span class="sd">                        being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;__VENV_DIR__&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">env_dir</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;__VENV_NAME__&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">env_name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;__VENV_PROMPT__&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">prompt</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;__VENV_BIN_NAME__&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">bin_name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;__VENV_PYTHON__&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">env_exe</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="EnvBuilder.install_scripts"><a class="viewcode-back" href="../venv.html#venv.EnvBuilder.install_scripts">[docs]</a>    <span class="k">def</span> <span class="nf">install_scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Install scripts into the created environment from a directory.</span>

<span class="sd">        :param context: The information for the environment creation request</span>
<span class="sd">                        being processed.</span>
<span class="sd">        :param path:    Absolute pathname of a directory containing script.</span>
<span class="sd">                        Scripts in the &#39;common&#39; subdirectory of this directory,</span>
<span class="sd">                        and those in the directory named for the platform</span>
<span class="sd">                        being run on, are installed in the created environment.</span>
<span class="sd">                        Placeholder variables are replaced with environment-</span>
<span class="sd">                        specific values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">binpath</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">bin_path</span>
        <span class="n">plen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span> <span class="c"># at top-level, remove irrelevant dirs</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">[:]:</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;common&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">continue</span> <span class="c"># ignore files in top level</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">srcfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">plen</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">suffix</span><span class="p">:</span>
                    <span class="n">dstdir</span> <span class="o">=</span> <span class="n">binpath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dstdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binpath</span><span class="p">,</span> <span class="o">*</span><span class="n">suffix</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dstdir</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dstdir</span><span class="p">)</span>
                <span class="n">dstfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dstdir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">srcfile</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">srcfile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.exe&#39;</span><span class="p">):</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;wb&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_variables</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;unable to copy script </span><span class="si">%r</span><span class="s">, &#39;</span>
                                       <span class="s">&#39;may be binary: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">srcfile</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dstfile</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copymode</span><span class="p">(</span><span class="n">srcfile</span><span class="p">,</span> <span class="n">dstfile</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="create"><a class="viewcode-back" href="../venv.html#venv.create">[docs]</a><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">env_dir</span><span class="p">,</span> <span class="n">system_site_packages</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">symlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_pip</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a virtual environment in a directory.</span>

<span class="sd">    By default, makes the system (global) site-packages dir *un*available to</span>
<span class="sd">    the created environment, and uses copying rather than symlinking for files</span>
<span class="sd">    obtained from the source Python installation.</span>

<span class="sd">    :param env_dir: The target directory to create an environment in.</span>
<span class="sd">    :param system_site_packages: If True, the system (global) site-packages</span>
<span class="sd">                                 dir is available to the environment.</span>
<span class="sd">    :param clear: If True and the target directory exists, it is deleted.</span>
<span class="sd">                  Otherwise, if the target directory exists, an error is</span>
<span class="sd">                  raised.</span>
<span class="sd">    :param symlinks: If True, attempt to symlink rather than copy files into</span>
<span class="sd">                     virtual environment.</span>
<span class="sd">    :param with_pip: If True, ensure pip is installed in the virtual</span>
<span class="sd">                     environment</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">EnvBuilder</span><span class="p">(</span><span class="n">system_site_packages</span><span class="o">=</span><span class="n">system_site_packages</span><span class="p">,</span>
                         <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">,</span> <span class="n">symlinks</span><span class="o">=</span><span class="n">symlinks</span><span class="p">,</span> <span class="n">with_pip</span><span class="o">=</span><span class="n">with_pip</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">env_dir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../venv.html#venv.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">compatible</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">compatible</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;base_prefix&#39;</span><span class="p">):</span>
        <span class="n">compatible</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">compatible</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;This script is only for use with Python &gt;= 3.3&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">argparse</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="n">__name__</span><span class="p">,</span>
                                         <span class="n">description</span><span class="o">=</span><span class="s">&#39;Creates virtual Python &#39;</span>
                                                     <span class="s">&#39;environments in one or &#39;</span>
                                                     <span class="s">&#39;more target &#39;</span>
                                                     <span class="s">&#39;directories.&#39;</span><span class="p">,</span>
                                         <span class="n">epilog</span><span class="o">=</span><span class="s">&#39;Once an environment has been &#39;</span>
                                                <span class="s">&#39;created, you may wish to &#39;</span>
                                                <span class="s">&#39;activate it, e.g. by &#39;</span>
                                                <span class="s">&#39;sourcing an activate script &#39;</span>
                                                <span class="s">&#39;in its bin directory.&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;dirs&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;ENV_DIR&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s">&#39;A directory to create the environment in.&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--system-site-packages&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;system_site&#39;</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Give the virtual environment access to the &#39;</span>
                                 <span class="s">&#39;system site-packages dir.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;nt&#39;</span><span class="p">:</span>
            <span class="n">use_symlinks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_symlinks</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--symlinks&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">use_symlinks</span><span class="p">,</span>
                           <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;symlinks&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s">&#39;Try to use symlinks rather than copies, &#39;</span>
                                <span class="s">&#39;when symlinks are not the default for &#39;</span>
                                <span class="s">&#39;the platform.&#39;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--copies&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="ow">not</span> <span class="n">use_symlinks</span><span class="p">,</span>
                           <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_false&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;symlinks&#39;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s">&#39;Try to use copies rather than symlinks, &#39;</span>
                                <span class="s">&#39;even when symlinks are the default for &#39;</span>
                                <span class="s">&#39;the platform.&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--clear&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                            <span class="n">dest</span><span class="o">=</span><span class="s">&#39;clear&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete the contents of the &#39;</span>
                                               <span class="s">&#39;environment directory if it &#39;</span>
                                               <span class="s">&#39;already exists, before &#39;</span>
                                               <span class="s">&#39;environment creation.&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--upgrade&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                            <span class="n">dest</span><span class="o">=</span><span class="s">&#39;upgrade&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Upgrade the environment &#39;</span>
                                               <span class="s">&#39;directory to use this version &#39;</span>
                                               <span class="s">&#39;of Python, assuming Python &#39;</span>
                                               <span class="s">&#39;has been upgraded in-place.&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--without-pip&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;with_pip&#39;</span><span class="p">,</span>
                            <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_false&#39;</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Skips installing or upgrading pip in the &#39;</span>
                                 <span class="s">&#39;virtual environment (pip is bootstrapped &#39;</span>
                                 <span class="s">&#39;by default)&#39;</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">upgrade</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">clear</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;you cannot supply --upgrade and --clear together.&#39;</span><span class="p">)</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">EnvBuilder</span><span class="p">(</span><span class="n">system_site_packages</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">system_site</span><span class="p">,</span>
                             <span class="n">clear</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">clear</span><span class="p">,</span>
                             <span class="n">symlinks</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">symlinks</span><span class="p">,</span>
                             <span class="n">upgrade</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">upgrade</span><span class="p">,</span>
                             <span class="n">with_pip</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">with_pip</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">dirs</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>