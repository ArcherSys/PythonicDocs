

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>unittest.test.testmock.testpatch &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../../../index.html"/>
        <link rel="up" title="unittest.test.testmock" href="../testmock.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../test.html">unittest.test</a> &raquo;</li>
      
          <li><a href="../testmock.html">unittest.test.testmock</a> &raquo;</li>
      
    <li>unittest.test.testmock.testpatch</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for unittest.test.testmock.testpatch</h1><div class="highlight"><pre>
<span class="c"># Copyright (C) 2007-2012 Michael Foord &amp; the mock team</span>
<span class="c"># E-mail: fuzzyman AT voidspace DOT org DOT uk</span>
<span class="c"># http://www.voidspace.org.uk/python/mock/</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest.test.testmock</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">from</span> <span class="nn">unittest.test.testmock.support</span> <span class="kn">import</span> <span class="n">SomeClass</span><span class="p">,</span> <span class="n">is_instance</span>

<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">NonCallableMock</span><span class="p">,</span> <span class="n">CallableMixin</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">,</span>
    <span class="n">MagicMock</span><span class="p">,</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">NonCallableMagicMock</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">_patch</span><span class="p">,</span>
    <span class="n">DEFAULT</span><span class="p">,</span> <span class="n">call</span><span class="p">,</span> <span class="n">_get_target</span><span class="p">,</span> <span class="n">_patch</span>
<span class="p">)</span>


<span class="n">builtin_string</span> <span class="o">=</span> <span class="s">&#39;builtins&#39;</span>

<span class="n">PTModule</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span>
<span class="n">MODNAME</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.PTModule&#39;</span> <span class="o">%</span> <span class="n">__name__</span>


<span class="k">def</span> <span class="nf">_get_proxy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">get_only</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Proxy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">get_only</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">Proxy</span><span class="o">.</span><span class="n">__setattr__</span> <span class="o">=</span> <span class="n">__setattr__</span>
        <span class="n">Proxy</span><span class="o">.</span><span class="n">__delattr__</span> <span class="o">=</span> <span class="n">__delattr__</span>
    <span class="k">return</span> <span class="n">Proxy</span><span class="p">()</span>


<span class="c"># for use in the test</span>
<span class="n">something</span>  <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something</span>
<span class="n">something_else</span>  <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">SomethingElse</span>


<div class="viewcode-block" id="Foo"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.Foo">[docs]</a><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span>
<div class="viewcode-block" id="Foo.f"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.Foo.f">[docs]</a>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="Foo.g"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.Foo.g">[docs]</a>    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
    <span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;bar&#39;</span>

<div class="viewcode-block" id="Foo.Bar"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.Foo.Bar">[docs]</a>    <span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="Foo.Bar.a"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.Foo.Bar.a">[docs]</a>        <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
</div></div></div>
<span class="n">foo_name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.Foo&#39;</span> <span class="o">%</span> <span class="n">__name__</span>


<div class="viewcode-block" id="function"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.function">[docs]</a><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">Foo</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.Container">[docs]</a><span class="k">class</span> <span class="nc">Container</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="PatchTest"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest">[docs]</a><span class="k">class</span> <span class="nc">PatchTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="PatchTest.assertNotCallable"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.assertNotCallable">[docs]</a>    <span class="k">def</span> <span class="nf">assertNotCallable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">MockClass</span> <span class="o">=</span> <span class="n">NonCallableMagicMock</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">magic</span><span class="p">:</span>
            <span class="n">MockClass</span> <span class="o">=</span> <span class="n">NonCallableMock</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">MockClass</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">CallableMixin</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="PatchTest.test_single_patchobject"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_single_patchobject">[docs]</a>    <span class="k">def</span> <span class="nf">test_single_patchobject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">,</span> <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_with_none"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_with_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_with_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_multiple_patchobject"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_multiple_patchobject">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_patchobject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>
            <span class="n">next_attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original2</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;next_attribute&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">,</span>
                             <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">next_attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched2</span><span class="p">,</span>
                             <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">next_attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original2</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_object_lookup_is_quite_lazy"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_object_lookup_is_quite_lazy">[docs]</a>    <span class="k">def</span> <span class="nf">test_object_lookup_is_quite_lazy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">something</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">something</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.something&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">something</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">replacement_value</span>
            <span class="n">test</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">replacement_value</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">something</span> <span class="o">=</span> <span class="n">original</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.something&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something2</span><span class="p">,</span>
                             <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.something&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something2</span><span class="p">)</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.something_else&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">SomethingElse</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something2</span><span class="p">,</span>
                             <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something_else</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">SomethingElse</span><span class="p">,</span>
                             <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something_else</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">SomethingElse</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

        <span class="c"># Test the patching and restoring works a second time</span>
        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something_else</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">SomethingElse</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

        <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Handle</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.open&#39;</span> <span class="o">%</span> <span class="n">builtin_string</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">),</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Handle</span><span class="p">,</span>
                             <span class="s">&quot;open not patched&quot;</span><span class="p">)</span>
        <span class="n">test</span><span class="p">()</span>
        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="nb">open</span><span class="p">,</span> <span class="n">mock</span><span class="p">,</span> <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_class_attribute"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_class_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_class_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass.class_attribute&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span>
               <span class="n">sentinel</span><span class="o">.</span><span class="n">ClassAttribute</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">,</span>
                             <span class="n">sentinel</span><span class="o">.</span><span class="n">ClassAttribute</span><span class="p">,</span> <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>
        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">,</span>
                          <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_with_default_mock"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_with_default_mock">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_with_default_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">something</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>
            <span class="n">something2</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original2</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span> <span class="s">&#39;something&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">mock</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">something</span><span class="p">,</span>
                             <span class="s">&quot;Mock not passed into test function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">,</span>
                            <span class="s">&quot;patch with two arguments did not create a mock&quot;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span> <span class="s">&#39;something&#39;</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span> <span class="s">&#39;something2&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">this1</span><span class="p">,</span> <span class="n">this2</span><span class="p">,</span> <span class="n">mock1</span><span class="p">,</span> <span class="n">mock2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">this1</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">this1</span><span class="p">,</span>
                             <span class="s">&quot;Patched function didn&#39;t receive initial argument&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">this2</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">this2</span><span class="p">,</span>
                             <span class="s">&quot;Patched function didn&#39;t receive second argument&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock1</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">something2</span><span class="p">,</span>
                             <span class="s">&quot;Mock not passed into test function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock2</span><span class="p">,</span> <span class="n">Test</span><span class="o">.</span><span class="n">something</span><span class="p">,</span>
                             <span class="s">&quot;Second Mock not passed into test function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock2</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">,</span>
                            <span class="s">&quot;patch with two arguments did not create a mock&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock2</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">,</span>
                            <span class="s">&quot;patch with two arguments did not create a mock&quot;</span><span class="p">)</span>

            <span class="c"># A hack to test that new mocks are passed the second time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">outerMock1</span><span class="p">,</span> <span class="n">mock1</span><span class="p">,</span> <span class="s">&quot;unexpected value for mock1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">outerMock2</span><span class="p">,</span> <span class="n">mock2</span><span class="p">,</span> <span class="s">&quot;unexpected value for mock1&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mock1</span><span class="p">,</span> <span class="n">mock2</span>

        <span class="n">outerMock1</span> <span class="o">=</span> <span class="n">outerMock2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">outerMock1</span><span class="p">,</span> <span class="n">outerMock2</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">this1</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">this2</span><span class="p">)</span>

        <span class="c"># Test that executing a second time creates new mocks</span>
        <span class="n">test</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">this1</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">this2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_spec"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">SomeClass</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">MockSomeClass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">wibble</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_with_spec"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_with_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_with_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s">&#39;class_attribute&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">SomeClass</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockAttribute</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">,</span> <span class="n">MockAttribute</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="o">.</span><span class="n">wibble</span><span class="p">,</span>
                                       <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span>
                              <span class="k">lambda</span><span class="p">:</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_spec_as_list"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_spec_as_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_spec_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;wibble&#39;</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">MockSomeClass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">wibble</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_with_spec_as_list"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_with_spec_as_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_with_spec_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s">&#39;class_attribute&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;wibble&#39;</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockAttribute</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">,</span> <span class="n">MockAttribute</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="o">.</span><span class="n">wibble</span><span class="p">,</span>
                                       <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span>
                              <span class="k">lambda</span><span class="p">:</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">class_attribute</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_nested_patch_with_spec_as_list"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_nested_patch_with_spec_as_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested_patch_with_spec_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># regression test for nested decorators</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.open&#39;</span> <span class="o">%</span> <span class="n">builtin_string</span><span class="p">)</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;wibble&#39;</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">,</span> <span class="n">MockOpen</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">MockSomeClass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">wibble</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>
        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_spec_as_boolean"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_spec_as_boolean">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_spec_as_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">MockSomeClass</span><span class="p">)</span>
            <span class="c"># Should not raise attribute error</span>
            <span class="n">MockSomeClass</span><span class="o">.</span><span class="n">wibble</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">MockSomeClass</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_object_with_spec_as_boolean"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_object_with_spec_as_boolean">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_object_with_spec_as_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">PTModule</span><span class="p">,</span> <span class="s">&#39;SomeClass&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">MockSomeClass</span><span class="p">)</span>
            <span class="c"># Should not raise attribute error</span>
            <span class="n">MockSomeClass</span><span class="o">.</span><span class="n">wibble</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">MockSomeClass</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_class_acts_with_spec_is_inherited"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_class_acts_with_spec_is_inherited">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_class_acts_with_spec_is_inherited</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">MockSomeClass</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">MockSomeClass</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotCallable</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="c"># Should not raise attribute error</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">wibble</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">not_wibble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_create_mocks_non_existent_attributes"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_create_mocks_non_existent_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_create_mocks_non_existent_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.frooble&#39;</span> <span class="o">%</span> <span class="n">builtin_string</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">frooble</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">frooble</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_with_create_mocks_non_existent_attributes"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_with_create_mocks_non_existent_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_with_create_mocks_non_existent_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s">&#39;frooble&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">frooble</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s">&#39;frooble&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_wont_create_by_default"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_wont_create_by_default">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_wont_create_by_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.frooble&#39;</span> <span class="o">%</span> <span class="n">builtin_string</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">frooble</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">)</span>

            <span class="n">test</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Patching non existent attributes should fail&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">frooble</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_wont_create_by_default"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_wont_create_by_default">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_wont_create_by_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nd">@patch.object</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s">&#39;frooble&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Frooble</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Patching non existent attributes should fail&#39;</span><span class="p">)</span>

            <span class="n">test</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Patching non existent attributes should fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s">&#39;frooble&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_static_methods"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_static_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_static_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="nd">@staticmethod</span>
            <span class="k">def</span> <span class="nf">woot</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Static</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;woot&#39;</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">anonymous</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">woot</span><span class="p">(),</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">)</span>
        <span class="n">anonymous</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">woot</span><span class="p">(),</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Static</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_local"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_local">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Foo</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">sentinel</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">anonymous</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">)</span>
        <span class="n">anonymous</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">Foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_slots"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_slots">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Foo&#39;</span><span class="p">,)</span>

        <span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
        <span class="n">foo</span><span class="o">.</span><span class="n">Foo</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Foo</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">anonymous</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">)</span>
        <span class="n">anonymous</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">Foo</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Foo</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_class_decorator"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_class_decorator">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_class_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>

        <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="n">other_self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">,</span>
                                 <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">not_test_method</span><span class="p">(</span><span class="n">other_self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                                 <span class="s">&quot;non-test method patched&quot;</span><span class="p">)</span>

        <span class="n">Foo</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">)(</span><span class="n">Foo</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">test_method</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">not_test_method</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_class_decorator"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_class_decorator">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_class_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>

        <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="n">other_self</span><span class="p">,</span> <span class="n">mock_something</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">mock_something</span><span class="p">,</span>
                                 <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">not_test_method</span><span class="p">(</span><span class="n">other_self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something</span><span class="p">,</span>
                                 <span class="s">&quot;non-test method patched&quot;</span><span class="p">)</span>
        <span class="n">Foo</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.something&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">)(</span><span class="n">Foo</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">test_method</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">not_test_method</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">PTModule</span><span class="o">.</span><span class="n">something</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Something</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_twice"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_twice">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_twice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span>
            <span class="n">next_attribute</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original2</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Patched</span><span class="p">,</span> <span class="s">&quot;unpatched&quot;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">Original</span><span class="p">,</span>
                         <span class="s">&quot;patch not restored&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;initial&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">(),</span> <span class="s">&#39;other&#39;</span><span class="p">:</span> <span class="s">&#39;something&#39;</span><span class="p">}</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">del</span> <span class="n">foo</span><span class="p">[</span><span class="s">&#39;initial&#39;</span><span class="p">]</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;something else&#39;</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)])</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_with_container_object"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_with_container_object">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_with_container_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
        <span class="n">foo</span><span class="p">[</span><span class="s">&#39;initial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="n">foo</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s">&#39;something&#39;</span>

        <span class="n">original</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">del</span> <span class="n">foo</span><span class="p">[</span><span class="s">&#39;initial&#39;</span><span class="p">]</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;something else&#39;</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_with_clear"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_with_clear">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_with_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;initial&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">(),</span> <span class="s">&#39;other&#39;</span><span class="p">:</span> <span class="s">&#39;something&#39;</span><span class="p">}</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;something else&#39;</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">},</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)],</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_with_container_object_and_clear"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_with_container_object_and_clear">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_with_container_object_and_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
        <span class="n">foo</span><span class="p">[</span><span class="s">&#39;initial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="n">foo</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s">&#39;something&#39;</span>

        <span class="n">original</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">foo</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;something else&#39;</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">},</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>

        <span class="n">test</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_name_preserved"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_name_preserved">[docs]</a>    <span class="k">def</span> <span class="nf">test_name_preserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="nb">object</span><span class="p">())</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="nb">object</span><span class="p">(),</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="nb">object</span><span class="p">())</span>
        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">some_name</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">some_name</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;some_name&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_exception"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Konrad&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;NameError not raised by test&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="p">{})</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_with_string"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_with_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_with_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch.dict</span><span class="p">(</span><span class="s">&#39;os.environ&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;konrad_delong&#39;</span><span class="p">:</span> <span class="s">&#39;some value&#39;</span><span class="p">})</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;konrad_delong&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_descriptor"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># would be some effort to fix this - we could special case the</span>
        <span class="c"># builtin descriptors: classmethod, property, staticmethod</span>
        <span class="k">return</span>
        <span class="k">class</span> <span class="nc">Nothing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Nothing</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">klass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">Something</span><span class="p">)</span>

            <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Nothing</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nd">@staticmethod</span>
            <span class="k">def</span> <span class="nf">static</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">arg</span>

            <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">klass_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">Something</span><span class="p">)</span>

            <span class="nd">@patch.dict</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
            <span class="nd">@staticmethod</span>
            <span class="k">def</span> <span class="nf">static_dict</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">arg</span>

        <span class="c"># these will raise exceptions if patching descriptors is broken</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s">&#39;f00&#39;</span><span class="p">),</span> <span class="s">&#39;f00&#39;</span><span class="p">)</span>
        <span class="n">Something</span><span class="o">.</span><span class="n">klass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Something</span><span class="o">.</span><span class="n">static_dict</span><span class="p">(</span><span class="s">&#39;f00&#39;</span><span class="p">),</span> <span class="s">&#39;f00&#39;</span><span class="p">)</span>
        <span class="n">Something</span><span class="o">.</span><span class="n">klass_dict</span><span class="p">()</span>

        <span class="n">something</span> <span class="o">=</span> <span class="n">Something</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">something</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s">&#39;f00&#39;</span><span class="p">),</span> <span class="s">&#39;f00&#39;</span><span class="p">)</span>
        <span class="n">something</span><span class="o">.</span><span class="n">klass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">something</span><span class="o">.</span><span class="n">static_dict</span><span class="p">(</span><span class="s">&#39;f00&#39;</span><span class="p">),</span> <span class="s">&#39;f00&#39;</span><span class="p">)</span>
        <span class="n">something</span><span class="o">.</span><span class="n">klass_dict</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_spec_set"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_spec_set">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_spec_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockClass</span><span class="p">):</span>
            <span class="n">MockClass</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">support</span><span class="p">,</span> <span class="s">&#39;SomeClass&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockClass</span><span class="p">):</span>
            <span class="n">MockClass</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockClass</span><span class="p">):</span>
            <span class="n">MockClass</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">support</span><span class="p">,</span> <span class="s">&#39;SomeClass&#39;</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockClass</span><span class="p">):</span>
            <span class="n">MockClass</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_spec_set_inherit"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_spec_set_inherit">[docs]</a>    <span class="k">def</span> <span class="nf">test_spec_set_inherit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">MockClass</span><span class="p">):</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">MockClass</span><span class="p">()</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_start_stop"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_start_stop">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_start_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">something</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.something&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_stop_without_start"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_stop_without_start">[docs]</a>    <span class="k">def</span> <span class="nf">test_stop_without_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c"># calling stop without start used to produce a very obscure error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patchobject_start_stop"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patchobject_start_stop">[docs]</a>    <span class="k">def</span> <span class="nf">test_patchobject_start_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">something</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">PTModule</span><span class="p">,</span> <span class="s">&#39;something&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
        <span class="n">replaced</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">replaced</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">replaced</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">something</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_start_stop"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_start_stop">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_start_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">}</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;spam&#39;</span><span class="p">,</span> <span class="s">&#39;eggs&#39;</span><span class="p">)],</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;spam&#39;</span><span class="p">:</span> <span class="s">&#39;eggs&#39;</span><span class="p">})</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_class_decorator"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_class_decorator">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_class_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">this</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;spam&#39;</span><span class="p">:</span> <span class="s">&#39;eggs&#39;</span><span class="p">}</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">test_first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">this</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">})</span>
            <span class="k">def</span> <span class="nf">test_second</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">this</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">})</span>

        <span class="n">Test</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">},</span> <span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)(</span><span class="n">Test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="n">test</span> <span class="o">=</span> <span class="n">Test</span><span class="p">()</span>

        <span class="n">test</span><span class="o">.</span><span class="n">test_first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="n">test</span><span class="o">.</span><span class="n">test_second</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="n">test</span> <span class="o">=</span> <span class="n">Test</span><span class="p">()</span>

        <span class="n">test</span><span class="o">.</span><span class="n">test_first</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="n">test</span><span class="o">.</span><span class="n">test_second</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_get_only_proxy"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_get_only_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_only_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>
        <span class="k">class</span> <span class="nc">SomethingElse</span><span class="p">:</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">Something</span><span class="p">,</span> <span class="n">SomethingElse</span><span class="p">,</span> <span class="n">Something</span><span class="p">(),</span> <span class="n">SomethingElse</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="n">_get_proxy</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

            <span class="nd">@patch.object</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
            <span class="n">test</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_get_set_delete_proxy"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_get_set_delete_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_set_delete_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>
        <span class="k">class</span> <span class="nc">SomethingElse</span><span class="p">:</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">Something</span><span class="p">,</span> <span class="n">SomethingElse</span><span class="p">,</span> <span class="n">Something</span><span class="p">(),</span> <span class="n">SomethingElse</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="n">_get_proxy</span><span class="p">(</span><span class="n">Something</span><span class="p">,</span> <span class="n">get_only</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="nd">@patch.object</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
            <span class="n">test</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_keyword_args"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_keyword_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_keyword_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;side_effect&#39;</span><span class="p">:</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="s">&#39;foo.bar.return_value&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
                  <span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="n">MagicMock</span><span class="p">()}</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">(),</span> <span class="mi">33</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_object_keyword_args"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_object_keyword_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_object_keyword_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;side_effect&#39;</span><span class="p">:</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="s">&#39;foo.bar.return_value&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
                  <span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="n">MagicMock</span><span class="p">()}</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">(),</span> <span class="mi">33</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_dict_keyword_args"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_keyword_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_keyword_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">}</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Boo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;bar&#39;</span>

            <span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="n">mock</span><span class="p">):</span>
            <span class="n">mock</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_test2</span><span class="p">(</span><span class="n">mock</span><span class="p">):</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>

            <span class="n">mock</span><span class="o">.</span><span class="n">g</span><span class="p">()</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">mock</span><span class="p">,</span> <span class="s">&#39;h&#39;</span><span class="p">)</span>

            <span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">lower</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>

            <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="p">()</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>

            <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="o">.</span><span class="n">a</span><span class="p">()</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="p">()</span><span class="o">.</span><span class="n">a</span><span class="p">()</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="p">()</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="p">()</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">Bar</span><span class="p">(),</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">mock</span><span class="p">):</span>
            <span class="n">_test</span><span class="p">(</span><span class="n">mock</span><span class="p">)</span>
            <span class="n">_test2</span><span class="p">(</span><span class="n">mock</span><span class="p">)</span>
            <span class="n">_test2</span><span class="p">(</span><span class="n">mock</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mock</span>

        <span class="n">test</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)(</span><span class="n">function</span><span class="p">)</span>

        <span class="n">mock</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>
        <span class="c"># test patching a second time works</span>
        <span class="n">test</span><span class="p">()</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)(</span><span class="n">function</span><span class="p">)</span>

        <span class="n">mock</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">mock</span><span class="p">)</span>
        <span class="c"># test patching a second time works</span>
        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec_function"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec_function">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.function&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">mock</span><span class="p">):</span>
            <span class="n">function</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">function</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">function</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">function</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec_keywords"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec_keywords">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.function&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
               <span class="n">return_value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">mock_function</span><span class="p">):</span>
            <span class="c">#self.assertEqual(function.abc, &#39;foo&#39;)</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec_with_new"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec_with_new">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec_with_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.function&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;function&#39;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec_with_object"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec_with_object">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec_with_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="n">Bar</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">extra</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec_inherits"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec_inherits">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec_inherits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FooClass</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">FooClass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">mock</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">FooClass</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_autospec_name"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_autospec_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_autospec_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;Foo&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;Foo.f&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;Foo()&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mock</span><span class="p">(</span><span class="bp">None</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;Foo().f&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mock</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_tracebacks"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_tracebacks">[docs]</a>    <span class="k">def</span> <span class="nf">test_tracebacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestResult</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">traceback</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_exc_info_to_string</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;raise AssertionError&#39;</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_patch"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_patch">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">NonCallableMagicMock</span><span class="p">)</span>

        <span class="n">m1</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mock</span> <span class="ow">in</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotCallable</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_patch_object"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_patch_object">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_patch_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">NonCallableMagicMock</span><span class="p">)</span>

        <span class="n">m1</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mock</span> <span class="ow">in</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotCallable</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_keyword_arguments"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_keyword_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_keyword_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">Bar</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">Bar</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">Bar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Bar</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_spec"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">Bar</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">Bar</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">Bar</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Bar</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">Bar</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">Bar</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="n">Bar</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Bar</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">spec_set</span><span class="o">=</span><span class="n">Bar</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_create"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_create">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">non_existent_attr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.weeeee&#39;</span> <span class="o">%</span> <span class="n">foo_name</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">non_existent_attr</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">NonCallableMock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">non_existent_attr</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">NonCallableMock</span><span class="p">,</span>
                  <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotCallable</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_incompatible_with_new"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_incompatible_with_new">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_incompatible_with_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">foo_name</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="nb">object</span><span class="p">(),</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">MagicMock</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="nb">object</span><span class="p">(),</span>
            <span class="n">new_callable</span><span class="o">=</span><span class="n">MagicMock</span>
        <span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_incompatible_with_autospec"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_incompatible_with_autospec">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_incompatible_with_autospec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">MagicMock</span><span class="p">,</span>
            <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">MagicMock</span><span class="p">,</span>
            <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_inherit_for_mocks"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_inherit_for_mocks">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_inherit_for_mocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MockSub</span><span class="p">(</span><span class="n">Mock</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">MockClasses</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">NonCallableMock</span><span class="p">,</span> <span class="n">NonCallableMagicMock</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">,</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">MockSub</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">Klass</span> <span class="ow">in</span> <span class="n">MockClasses</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;spec_set&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">arg</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">Klass</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">instance</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">return_value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_inherit_non_mock"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_inherit_non_mock">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_inherit_non_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">NotAMock</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">NotAMock</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">NotAMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s">&#39;return_value&#39;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_class_decorating"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_class_decorating">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_class_decorating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="k">class</span> <span class="nc">SomeTest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_foo</span><span class="p">):</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">mock_foo</span><span class="p">)</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">SomeClass</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_foo</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_foo</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">)</span>

        <span class="n">SomeTest</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">SomeClass</span><span class="p">)(</span><span class="n">SomeTest</span><span class="p">)</span>
        <span class="n">SomeTest</span><span class="p">()</span><span class="o">.</span><span class="n">test_one</span><span class="p">()</span>
        <span class="n">SomeTest</span><span class="p">()</span><span class="o">.</span><span class="n">test_two</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="n">patcher1</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">patcher2</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">patcher</span> <span class="ow">in</span> <span class="n">patcher1</span><span class="p">,</span> <span class="n">patcher2</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>


        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_no_kwargs"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_no_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_no_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">,</span> <span class="n">foo_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_create_mocks"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_create_mocks">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_create_mocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_create_mocks_different_order"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_create_mocks_different_order">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_create_mocks_different_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bug revealed by Jython!</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>

        <span class="n">other</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">DEFAULT</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;g&#39;</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">additional_patchers</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>

        <span class="nd">@patcher</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_stacked_decorators"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_stacked_decorators">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_stacked_decorators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="n">foo_name</span> <span class="o">+</span> <span class="s">&#39;.g&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">_test</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="nd">@patch</span><span class="p">(</span><span class="n">foo_name</span> <span class="o">+</span> <span class="s">&#39;.g&#39;</span><span class="p">)</span>
        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test2</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">_test</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="nd">@patch</span><span class="p">(</span><span class="n">foo_name</span> <span class="o">+</span> <span class="s">&#39;.g&#39;</span><span class="p">)</span>
        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test3</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">_test</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">)</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>

        <span class="n">test1</span><span class="p">()</span>
        <span class="n">test2</span><span class="p">()</span>
        <span class="n">test3</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_create_mocks_patcher"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_create_mocks_patcher">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_create_mocks_patcher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">]</span>
            <span class="n">foo</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_decorating_class"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_decorating_class">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_decorating_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="k">class</span> <span class="nc">SomeTest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>
                <span class="n">test</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_instance</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>

        <span class="n">SomeTest</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span>
            <span class="n">foo_name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span>
        <span class="p">)(</span><span class="n">SomeTest</span><span class="p">)</span>

        <span class="n">thing</span> <span class="o">=</span> <span class="n">SomeTest</span><span class="p">()</span>
        <span class="n">thing</span><span class="o">.</span><span class="n">test_one</span><span class="p">()</span>
        <span class="n">thing</span><span class="o">.</span><span class="n">test_two</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_create"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_create">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">blam</span><span class="o">=</span><span class="s">&#39;blam&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">blam</span><span class="o">=</span><span class="s">&#39;blam&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">blam</span><span class="p">,</span> <span class="s">&#39;blam&#39;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;blam&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_spec_set"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_spec_set">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_spec_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># if spec_set works then we can assume that spec and autospec also</span>
        <span class="c"># work as the underlying machinery is the same</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">])</span>
            <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">b</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_new_callable"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_new_callable">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_new_callable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span>
            <span class="n">Foo</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">Thing</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;g&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">Thing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">Thing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_nested_patch_failure"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_nested_patch_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested_patch_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;missing&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">thing1</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;missing&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">thing2</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;missing&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">thing3</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">thing1</span><span class="p">,</span> <span class="n">thing2</span><span class="p">,</span> <span class="n">thing3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_new_callable_failure"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_new_callable_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_callable_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span>

        <span class="k">def</span> <span class="nf">crasher</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;crasher&#39;</span><span class="p">)</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">crasher</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">thing1</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">crasher</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">thing2</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nd">@patch.object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">crasher</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">thing3</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">thing1</span><span class="p">,</span> <span class="n">thing2</span><span class="p">,</span> <span class="n">thing3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_failure"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>

        <span class="n">good</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">good</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;g&#39;</span>

        <span class="n">bad</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;missing&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bad</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;missing&#39;</span>

        <span class="k">for</span> <span class="n">additionals</span> <span class="ow">in</span> <span class="p">[</span><span class="n">good</span><span class="p">,</span> <span class="n">bad</span><span class="p">],</span> <span class="p">[</span><span class="n">bad</span><span class="p">,</span> <span class="n">good</span><span class="p">]:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">additional_patchers</span> <span class="o">=</span> <span class="n">additionals</span>

            <span class="nd">@patcher</span>
            <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_new_callable_failure"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_new_callable_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_new_callable_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">f</span>
        <span class="n">original_g</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">g</span>
        <span class="n">original_foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">foo</span>

        <span class="k">def</span> <span class="nf">crasher</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;crasher&#39;</span><span class="p">)</span>

        <span class="n">patcher</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>

        <span class="n">good</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">good</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;g&#39;</span>

        <span class="n">bad</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">crasher</span><span class="p">)</span>
        <span class="n">bad</span><span class="o">.</span><span class="n">attribute_name</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>

        <span class="k">for</span> <span class="n">additionals</span> <span class="ow">in</span> <span class="p">[</span><span class="n">good</span><span class="p">,</span> <span class="n">bad</span><span class="p">],</span> <span class="p">[</span><span class="n">bad</span><span class="p">,</span> <span class="n">good</span><span class="p">]:</span>
            <span class="n">patcher</span><span class="o">.</span><span class="n">additional_patchers</span> <span class="o">=</span> <span class="n">additionals</span>

            <span class="nd">@patcher</span>
            <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">original_f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">original_g</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">original_foo</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_multiple_string_subclasses"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_multiple_string_subclasses">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_multiple_string_subclasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Foo</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;fish&#39;</span><span class="p">:</span> <span class="s">&#39;tasty&#39;</span><span class="p">})</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
        <span class="nd">@patch.multiple</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">fish</span><span class="o">=</span><span class="s">&#39;nearly gone&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">fish</span><span class="p">,</span> <span class="s">&#39;nearly gone&#39;</span><span class="p">)</span>

        <span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">fish</span><span class="p">,</span> <span class="s">&#39;tasty&#39;</span><span class="p">)</span>

</div>
    <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;unittest.mock.patch.TEST_PREFIX&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PatchTest.test_patch_test_prefix"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_test_prefix">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_test_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="s">&#39;original&#39;</span>

            <span class="k">def</span> <span class="nf">foo_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thing</span>
            <span class="k">def</span> <span class="nf">foo_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thing</span>
            <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thing</span>
            <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thing</span>

        <span class="n">Foo</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="s">&#39;thing&#39;</span><span class="p">,</span> <span class="s">&#39;changed&#39;</span><span class="p">)(</span><span class="n">Foo</span><span class="p">)</span>

        <span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">foo_one</span><span class="p">(),</span> <span class="s">&#39;changed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">foo_two</span><span class="p">(),</span> <span class="s">&#39;changed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">test_one</span><span class="p">(),</span> <span class="s">&#39;original&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">test_two</span><span class="p">(),</span> <span class="s">&#39;original&#39;</span><span class="p">)</span>

</div>
    <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;unittest.mock.patch.TEST_PREFIX&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PatchTest.test_patch_dict_test_prefix"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_dict_test_prefix">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_dict_test_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">bar_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">the_dict</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">bar_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">the_dict</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">the_dict</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">test_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">the_dict</span><span class="p">)</span>

        <span class="n">the_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;original&#39;</span><span class="p">}</span>
        <span class="n">Foo</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">the_dict</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">&#39;changed&#39;</span><span class="p">)(</span><span class="n">Foo</span><span class="p">)</span>

        <span class="n">foo</span> <span class="o">=</span><span class="n">Foo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bar_one</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;changed&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bar_two</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;changed&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">test_one</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;original&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">test_two</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;original&#39;</span><span class="p">})</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_with_spec_mock_repr"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_with_spec_mock_repr">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_with_spec_mock_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">,</span> <span class="s">&#39;spec_set&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">arg</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;SomeClass&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;SomeClass.class_attribute&#39;&quot;</span><span class="p">,</span>
                              <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;SomeClass()&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;SomeClass().class_attribute&#39;&quot;</span><span class="p">,</span>
                              <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="p">()</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">))</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_nested_autospec_repr"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_nested_autospec_repr">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_nested_autospec_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;unittest.test.testmock.support&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;support.SomeClass.wibble()&#39;&quot;</span><span class="p">,</span>
                          <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">wibble</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot; name=&#39;support.SomeClass().wibble()&#39;&quot;</span><span class="p">,</span>
                          <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SomeClass</span><span class="p">()</span><span class="o">.</span><span class="n">wibble</span><span class="p">()))</span>


</div>
<div class="viewcode-block" id="PatchTest.test_mock_calls_with_patch"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_mock_calls_with_patch">[docs]</a>    <span class="k">def</span> <span class="nf">test_mock_calls_with_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">,</span> <span class="s">&#39;spec_set&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.SomeClass&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">arg</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">wibble</span><span class="p">()</span>

                <span class="n">kalls</span> <span class="o">=</span> <span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">wibble</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="n">kalls</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">method_calls</span><span class="p">,</span> <span class="n">kalls</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">wibble</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="p">()])</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">m</span><span class="p">()</span>
                <span class="n">kalls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="n">kalls</span><span class="p">)</span>

                <span class="n">result</span><span class="o">.</span><span class="n">wibble</span><span class="p">()</span>
                <span class="n">kalls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call</span><span class="p">()</span><span class="o">.</span><span class="n">wibble</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="n">kalls</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">wibble</span><span class="p">()])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">wibble</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="p">()])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">method_calls</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">wibble</span><span class="p">()])</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_imports_lazily"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_imports_lazily">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_imports_lazily</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;squizz&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">p1</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;squizz.squozz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="n">squizz</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
        <span class="n">squizz</span><span class="o">.</span><span class="n">squozz</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;squizz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">squizz</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;squizz.squozz&#39;</span><span class="p">)</span>
        <span class="n">squizz</span><span class="o">.</span><span class="n">squozz</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">squizz</span><span class="o">.</span><span class="n">squozz</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_propogrates_exc_on_exit"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_propogrates_exc_on_exit">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_propogrates_exc_on_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">holder</span><span class="p">:</span>
            <span class="n">exc_info</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

        <span class="k">class</span> <span class="nc">custom_patch</span><span class="p">(</span><span class="n">_patch</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="n">_patch</span><span class="o">.</span><span class="n">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
                <span class="n">holder</span><span class="o">.</span><span class="n">exc_info</span> <span class="o">=</span> <span class="n">etype</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">__exit__</span>

        <span class="k">def</span> <span class="nf">with_custom_patch</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">getter</span><span class="p">,</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">_get_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">custom_patch</span><span class="p">(</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">DEFAULT</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">{}</span>
            <span class="p">)</span>

        <span class="nd">@with_custom_patch</span><span class="p">(</span><span class="s">&#39;squizz.squozz&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">mock</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">holder</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="ne">RuntimeError</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">holder</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="s">&#39;exception value not propgated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">holder</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s">&#39;exception traceback not propgated&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_create_and_specs"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_create_and_specs">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_and_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;spec_set&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.doesnotexist&#39;</span> <span class="o">%</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">doesnotexist</span><span class="p">)</span>

            <span class="c"># check that spec with create is innocuous if the original exists</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_multiple_specs"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_multiple_specs">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">PTModule</span>
        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;spec_set&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">PTModule</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">PTModule</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec_set&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">PTModule</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PatchTest.test_specs_false_instead_of_none"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_specs_false_instead_of_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_specs_false_instead_of_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># no spec should have been set, so attribute access should not fail</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">does_not_exist</span>
            <span class="n">mock</span><span class="o">.</span><span class="n">does_not_exist</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_falsey_spec"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_falsey_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_falsey_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">,</span> <span class="s">&#39;spec_set&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s">&#39;doesnotexit&#39;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_spec_set_true"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_spec_set_true">[docs]</a>    <span class="k">def</span> <span class="nf">test_spec_set_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span><span class="p">,</span> <span class="s">&#39;autospec&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">spec_set</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">kwarg</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span>
                                  <span class="s">&#39;doesnotexist&#39;</span><span class="p">,</span> <span class="s">&#39;something&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s">&#39;doesnotexist&#39;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_callable_spec_as_list"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_callable_spec_as_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_callable_spec_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;__call__&#39;</span><span class="p">,)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">callable</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_not_callable_spec_as_list"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_not_callable_spec_as_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_not_callable_spec_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">MODNAME</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">callable</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="PatchTest.test_patch_stopall"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_patch_stopall">[docs]</a>    <span class="k">def</span> <span class="nf">test_patch_stopall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unlink</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span>
        <span class="n">chdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">chdir</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span>
        <span class="n">patch</span><span class="p">(</span><span class="s">&#39;os.unlink&#39;</span><span class="p">,</span> <span class="n">something</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">patch</span><span class="p">(</span><span class="s">&#39;os.chdir&#39;</span><span class="p">,</span> <span class="n">something_else</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="nd">@patch</span><span class="p">(</span><span class="s">&#39;os.path&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">patched</span><span class="p">(</span><span class="n">mock_path</span><span class="p">):</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">stopall</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mock_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">unlink</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">,</span> <span class="n">chdir</span><span class="p">)</span>

        <span class="n">patched</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PatchTest.test_stopall_lifo"><a class="viewcode-back" href="../../../../unittest.test.testmock.html#unittest.test.testmock.testpatch.PatchTest.test_stopall_lifo">[docs]</a>    <span class="k">def</span> <span class="nf">test_stopall_lifo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stopped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">class</span> <span class="nc">thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">two</span> <span class="o">=</span> <span class="n">three</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">get_patch</span><span class="p">(</span><span class="n">attribute</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">mypatch</span><span class="p">(</span><span class="n">_patch</span><span class="p">):</span>
                <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">stopped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
                    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">mypatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mypatch</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">thing</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">[</span><span class="n">get_patch</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">)]</span>
        <span class="n">patch</span><span class="o">.</span><span class="n">stopall</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">stopped</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;three&quot;</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="s">&quot;one&quot;</span><span class="p">])</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>