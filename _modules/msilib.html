

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>msilib &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>msilib</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for msilib</h1><div class="highlight"><pre>
<span class="c"># Copyright (C) 2005 Martin v. LÃ¶wis</span>
<span class="c"># Licensed to PSF under a Contributor Agreement.</span>
<span class="kn">from</span> <span class="nn">_msi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span>

<span class="n">AMD64</span> <span class="o">=</span> <span class="s">&quot;AMD64&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>
<span class="n">Itanium</span> <span class="o">=</span> <span class="s">&quot;Itanium&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>
<span class="n">Win64</span> <span class="o">=</span> <span class="n">AMD64</span> <span class="ow">or</span> <span class="n">Itanium</span>

<span class="c"># Partially taken from Wine</span>
<span class="n">datasizemask</span><span class="o">=</span>      <span class="mh">0x00ff</span>
<span class="n">type_valid</span><span class="o">=</span>        <span class="mh">0x0100</span>
<span class="n">type_localizable</span><span class="o">=</span>  <span class="mh">0x0200</span>

<span class="n">typemask</span><span class="o">=</span>          <span class="mh">0x0c00</span>
<span class="n">type_long</span><span class="o">=</span>         <span class="mh">0x0000</span>
<span class="n">type_short</span><span class="o">=</span>        <span class="mh">0x0400</span>
<span class="n">type_string</span><span class="o">=</span>       <span class="mh">0x0c00</span>
<span class="n">type_binary</span><span class="o">=</span>       <span class="mh">0x0800</span>

<span class="n">type_nullable</span><span class="o">=</span>     <span class="mh">0x1000</span>
<span class="n">type_key</span><span class="o">=</span>          <span class="mh">0x2000</span>
<span class="c"># XXX temporary, localizable?</span>
<span class="n">knownbits</span> <span class="o">=</span> <span class="n">datasizemask</span> <span class="o">|</span> <span class="n">type_valid</span> <span class="o">|</span> <span class="n">type_localizable</span> <span class="o">|</span> \
            <span class="n">typemask</span> <span class="o">|</span> <span class="n">type_nullable</span> <span class="o">|</span> <span class="n">type_key</span>

<div class="viewcode-block" id="Table"><a class="viewcode-back" href="../msilib.html#msilib.Table">[docs]</a><span class="k">class</span> <span class="nc">Table</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Table.add_field"><a class="viewcode-back" href="../msilib.html#msilib.Table.add_field">[docs]</a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Table.sql"><a class="viewcode-back" href="../msilib.html#msilib.Table.sql">[docs]</a>    <span class="k">def</span> <span class="nf">sql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">unk</span> <span class="o">=</span> <span class="nb">type</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">knownbits</span>
            <span class="k">if</span> <span class="n">unk</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> unknown bits </span><span class="si">%x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">unk</span><span class="p">))</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">type</span> <span class="o">&amp;</span> <span class="n">datasizemask</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span> <span class="o">&amp;</span> <span class="n">typemask</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">type_string</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
                    <span class="n">tname</span><span class="o">=</span><span class="s">&quot;CHAR(</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tname</span><span class="o">=</span><span class="s">&quot;CHAR&quot;</span>
            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">type_short</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">size</span><span class="o">==</span><span class="mi">2</span>
                <span class="n">tname</span> <span class="o">=</span> <span class="s">&quot;SHORT&quot;</span>
            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">type_long</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">size</span><span class="o">==</span><span class="mi">4</span>
                <span class="n">tname</span><span class="o">=</span><span class="s">&quot;LONG&quot;</span>
            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">type_binary</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">size</span><span class="o">==</span><span class="mi">0</span>
                <span class="n">tname</span><span class="o">=</span><span class="s">&quot;OBJECT&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tname</span><span class="o">=</span><span class="s">&quot;unknown&quot;</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">unknown integer type </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">&amp;</span> <span class="n">type_nullable</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="s">&quot; NOT NULL&quot;</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">&amp;</span> <span class="n">type_localizable</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">+=</span> <span class="s">&quot; LOCALIZABLE&quot;</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;`</span><span class="si">%s</span><span class="s">` </span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">&amp;</span> <span class="n">type_key</span><span class="p">:</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;`</span><span class="si">%s</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;CREATE TABLE </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s"> PRIMARY KEY </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Table.create"><a class="viewcode-back" href="../msilib.html#msilib.Table.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">OpenView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sql</span><span class="p">())</span>
        <span class="n">v</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">v</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</div></div>
<span class="k">class</span> <span class="nc">_Unspecified</span><span class="p">:</span><span class="k">pass</span>
<div class="viewcode-block" id="change_sequence"><a class="viewcode-back" href="../msilib.html#msilib.change_sequence">[docs]</a><span class="k">def</span> <span class="nf">change_sequence</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">seqno</span><span class="o">=</span><span class="n">_Unspecified</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">_Unspecified</span><span class="p">):</span>
    <span class="s">&quot;Change the sequence number of an action in a sequence list&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">action</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="ow">is</span> <span class="n">_Unspecified</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seqno</span> <span class="ow">is</span> <span class="n">_Unspecified</span><span class="p">:</span>
                <span class="n">seqno</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">seqno</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Action not found in sequence&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="add_data"><a class="viewcode-back" href="../msilib.html#msilib.add_data">[docs]</a><span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">OpenView</span><span class="p">(</span><span class="s">&quot;SELECT * FROM `</span><span class="si">%s</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="n">table</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">GetColumnInfo</span><span class="p">(</span><span class="n">MSICOLINFO_NAMES</span><span class="p">)</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">CreateRecord</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span><span class="p">,</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">r</span><span class="o">.</span><span class="n">SetInteger</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">r</span><span class="o">.</span><span class="n">SetString</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">field</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">Binary</span><span class="p">):</span>
                <span class="n">r</span><span class="o">.</span><span class="n">SetStream</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unsupported type </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">Modify</span><span class="p">(</span><span class="n">MSIMODIFY_INSERT</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MSIError</span><span class="p">(</span><span class="s">&quot;Could not insert &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; into &quot;</span><span class="o">+</span><span class="n">table</span><span class="p">)</span>

        <span class="n">r</span><span class="o">.</span><span class="n">ClearData</span><span class="p">()</span>
    <span class="n">v</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="add_stream"><a class="viewcode-back" href="../msilib.html#msilib.add_stream">[docs]</a><span class="k">def</span> <span class="nf">add_stream</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">OpenView</span><span class="p">(</span><span class="s">&quot;INSERT INTO _Streams (Name, Data) VALUES (&#39;</span><span class="si">%s</span><span class="s">&#39;, ?)&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">CreateRecord</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">SetStream</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="init_database"><a class="viewcode-back" href="../msilib.html#msilib.init_database">[docs]</a><span class="k">def</span> <span class="nf">init_database</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span>
                  <span class="n">ProductName</span><span class="p">,</span> <span class="n">ProductCode</span><span class="p">,</span> <span class="n">ProductVersion</span><span class="p">,</span>
                  <span class="n">Manufacturer</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">ProductCode</span> <span class="o">=</span> <span class="n">ProductCode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="c"># Create the database</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">OpenDatabase</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">MSIDBOPEN_CREATE</span><span class="p">)</span>
    <span class="c"># Create the tables</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="c"># Fill the validation table</span>
    <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;_Validation&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">.</span><span class="n">_Validation_records</span><span class="p">)</span>
    <span class="c"># Initialize the summary information, allowing atmost 20 properties</span>
    <span class="n">si</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">GetSummaryInformation</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_TITLE</span><span class="p">,</span> <span class="s">&quot;Installation Database&quot;</span><span class="p">)</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_SUBJECT</span><span class="p">,</span> <span class="n">ProductName</span><span class="p">)</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_AUTHOR</span><span class="p">,</span> <span class="n">Manufacturer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Itanium</span><span class="p">:</span>
        <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_TEMPLATE</span><span class="p">,</span> <span class="s">&quot;Intel64;1033&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">AMD64</span><span class="p">:</span>
        <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_TEMPLATE</span><span class="p">,</span> <span class="s">&quot;x64;1033&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_TEMPLATE</span><span class="p">,</span> <span class="s">&quot;Intel;1033&quot;</span><span class="p">)</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_REVNUMBER</span><span class="p">,</span> <span class="n">gen_uuid</span><span class="p">())</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_WORDCOUNT</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c"># long file names, compressed, original media</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_PAGECOUNT</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">si</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">PID_APPNAME</span><span class="p">,</span> <span class="s">&quot;Python MSI Library&quot;</span><span class="p">)</span>
    <span class="c"># XXX more properties</span>
    <span class="n">si</span><span class="o">.</span><span class="n">Persist</span><span class="p">()</span>
    <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Property&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">&quot;ProductName&quot;</span><span class="p">,</span> <span class="n">ProductName</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;ProductCode&quot;</span><span class="p">,</span> <span class="n">ProductCode</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;ProductVersion&quot;</span><span class="p">,</span> <span class="n">ProductVersion</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;Manufacturer&quot;</span><span class="p">,</span> <span class="n">Manufacturer</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;ProductLanguage&quot;</span><span class="p">,</span> <span class="s">&quot;1033&quot;</span><span class="p">)])</span>
    <span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">db</span>
</div>
<div class="viewcode-block" id="add_tables"><a class="viewcode-back" href="../msilib.html#msilib.add_tables">[docs]</a><span class="k">def</span> <span class="nf">add_tables</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="make_id"><a class="viewcode-back" href="../msilib.html#msilib.make_id">[docs]</a><span class="k">def</span> <span class="nf">make_id</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">identifier_chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s">&quot;._&quot;</span>
    <span class="nb">str</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">identifier_chars</span> <span class="k">else</span> <span class="s">&quot;_&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">):</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span>
    <span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^[A-Za-z_][A-Za-z0-9_.]*$&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s">&quot;FILE&quot;</span><span class="o">+</span><span class="nb">str</span>
    <span class="k">return</span> <span class="nb">str</span>
</div>
<div class="viewcode-block" id="gen_uuid"><a class="viewcode-back" href="../msilib.html#msilib.gen_uuid">[docs]</a><span class="k">def</span> <span class="nf">gen_uuid</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;{&quot;</span><span class="o">+</span><span class="n">UuidCreate</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;}&quot;</span>
</div>
<div class="viewcode-block" id="CAB"><a class="viewcode-back" href="../msilib.html#msilib.CAB">[docs]</a><span class="k">class</span> <span class="nc">CAB</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filenames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="CAB.gen_id"><a class="viewcode-back" href="../msilib.html#msilib.CAB.gen_id">[docs]</a>    <span class="k">def</span> <span class="nf">gen_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
        <span class="n">logical</span> <span class="o">=</span> <span class="n">_logical</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">logical</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filenames</span><span class="p">:</span>
            <span class="n">logical</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_logical</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filenames</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">logical</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">logical</span>
</div>
<div class="viewcode-block" id="CAB.append"><a class="viewcode-back" href="../msilib.html#msilib.CAB.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">logical</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logical</span><span class="p">:</span>
            <span class="n">logical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_id</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">full</span><span class="p">,</span> <span class="n">logical</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">logical</span>
</div>
<div class="viewcode-block" id="CAB.commit"><a class="viewcode-back" href="../msilib.html#msilib.CAB.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mktemp</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">mktemp</span><span class="p">()</span>
        <span class="n">FCICreate</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Media&quot;</span><span class="p">,</span>
                <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="n">add_stream</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>
</div></div>
<span class="n">_directories</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<div class="viewcode-block" id="Directory"><a class="viewcode-back" href="../msilib.html#msilib.Directory">[docs]</a><span class="k">class</span> <span class="nc">Directory</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">cab</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span> <span class="n">physical</span><span class="p">,</span> <span class="n">_logical</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">componentflags</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new directory in the Directory table. There is a current component</span>
<span class="sd">        at each point in time for the directory, which is either explicitly created</span>
<span class="sd">        through start_component, or implicitly when files are added for the first</span>
<span class="sd">        time. Files are added into the current component, and into the cab file.</span>
<span class="sd">        To create a directory, a base directory object needs to be specified (can be</span>
<span class="sd">        None), the path to the physical directory, and a logical directory name.</span>
<span class="sd">        Default specifies the DefaultDir slot in the directory table. componentflags</span>
<span class="sd">        specifies the default flags that new components get.&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_logical</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">(</span><span class="n">_logical</span><span class="p">)</span>
        <span class="n">logical</span> <span class="o">=</span> <span class="n">_logical</span>
        <span class="k">while</span> <span class="n">logical</span> <span class="ow">in</span> <span class="n">_directories</span><span class="p">:</span>
            <span class="n">logical</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_logical</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">_directories</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">logical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cab</span> <span class="o">=</span> <span class="n">cab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basedir</span> <span class="o">=</span> <span class="n">basedir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical</span> <span class="o">=</span> <span class="n">physical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logical</span> <span class="o">=</span> <span class="n">logical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyfiles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">componentflags</span> <span class="o">=</span> <span class="n">componentflags</span>
        <span class="k">if</span> <span class="n">basedir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">absolute</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span> <span class="n">physical</span><span class="p">)</span>
            <span class="n">blogical</span> <span class="o">=</span> <span class="n">basedir</span><span class="o">.</span><span class="n">logical</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">absolute</span> <span class="o">=</span> <span class="n">physical</span>
            <span class="n">blogical</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Directory&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">logical</span><span class="p">,</span> <span class="n">blogical</span><span class="p">,</span> <span class="n">default</span><span class="p">)])</span>

<div class="viewcode-block" id="Directory.start_component"><a class="viewcode-back" href="../msilib.html#msilib.Directory.start_component">[docs]</a>    <span class="k">def</span> <span class="nf">start_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">feature</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">keyfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an entry to the Component table, and make this component the current for this</span>
<span class="sd">        directory. If no component name is given, the directory name is used. If no feature</span>
<span class="sd">        is given, the current feature is used. If no flags are given, the directory&#39;s default</span>
<span class="sd">        flags are used. If no keyfile is given, the KeyPath is left null in the Component</span>
<span class="sd">        table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">componentflags</span>
        <span class="k">if</span> <span class="n">uuid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="n">gen_uuid</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">component</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">component</span>
        <span class="k">if</span> <span class="n">Win64</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="mi">256</span>
        <span class="k">if</span> <span class="n">keyfile</span><span class="p">:</span>
            <span class="n">keyid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cab</span><span class="o">.</span><span class="n">gen_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span> <span class="n">keyfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyfiles</span><span class="p">[</span><span class="n">keyfile</span><span class="p">]</span> <span class="o">=</span> <span class="n">keyid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keyid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Component&quot;</span><span class="p">,</span>
                        <span class="p">[(</span><span class="n">component</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">keyid</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">feature</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">current_feature</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;FeatureComponents&quot;</span><span class="p">,</span>
                        <span class="p">[(</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">component</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="Directory.make_short"><a class="viewcode-back" href="../msilib.html#msilib.Directory.make_short">[docs]</a>    <span class="k">def</span> <span class="nf">make_short</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
        <span class="n">oldfile</span> <span class="o">=</span> <span class="nb">file</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">file</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&#39; &quot;/\[]:;=,&#39;</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">suffix</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="ow">and</span> <span class="nb">file</span> <span class="o">==</span> <span class="n">oldfile</span> <span class="ow">and</span> <span class="p">(</span>
                                                <span class="ow">not</span> <span class="n">suffix</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="o">+</span><span class="n">suffix</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_names</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
                    <span class="nb">file</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">~</span><span class="si">%d</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">file</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">~</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_names</span><span class="p">:</span> <span class="k">break</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">10000</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;[\?|&gt;&lt;:/*&quot;+,;=\[\]]&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span> <span class="c"># restrictions on short names</span>
        <span class="k">return</span> <span class="nb">file</span>
</div>
<div class="viewcode-block" id="Directory.add_file"><a class="viewcode-back" href="../msilib.html#msilib.Directory.add_file">[docs]</a>    <span class="k">def</span> <span class="nf">add_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a file to the current component of the directory, starting a new one</span>
<span class="sd">        if there is no current component. By default, the file name in the source</span>
<span class="sd">        and the file table will be identical. If the src file is specified, it is</span>
<span class="sd">        interpreted relative to the current directory. Optionally, a version and a</span>
<span class="sd">        language can be specified for the entry in the File table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_component</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="n">current_feature</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">src</span><span class="p">:</span>
            <span class="c"># Allow relative paths for file if src is not specified</span>
            <span class="n">src</span> <span class="o">=</span> <span class="nb">file</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">absolute</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;[\?|&gt;&lt;:/*]&quot;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span> <span class="c"># restrictions on long names</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyfiles</span><span class="p">:</span>
            <span class="n">logical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyfiles</span><span class="p">[</span><span class="nb">file</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logical</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">sequence</span><span class="p">,</span> <span class="n">logical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">absolute</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">logical</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">logical</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">logical</span><span class="p">)</span>
        <span class="n">short</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_short</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">full</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">|</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">short</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="n">filesize</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">absolute</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
        <span class="c"># constants.msidbFileAttributesVital</span>
        <span class="c"># Compressed omitted, since it is the database default</span>
        <span class="c"># could add r/o, system, hidden</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="mi">512</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;File&quot;</span><span class="p">,</span>
                        <span class="p">[(</span><span class="n">logical</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">filesize</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span>
                         <span class="n">language</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)])</span>
        <span class="c">#if not version:</span>
        <span class="c">#    # Add hash if the file is not versioned</span>
        <span class="c">#    filehash = FileHash(absolute, 0)</span>
        <span class="c">#    add_data(self.db, &quot;MsiFileHash&quot;,</span>
        <span class="c">#             [(logical, 0, filehash.IntegerData(1),</span>
        <span class="c">#               filehash.IntegerData(2), filehash.IntegerData(3),</span>
        <span class="c">#               filehash.IntegerData(4))])</span>
        <span class="c"># Automatically remove .pyc/.pyo files on uninstall (2)</span>
        <span class="c"># XXX: adding so many RemoveFile entries makes installer unbelievably</span>
        <span class="c"># slow. So instead, we have to use wildcard remove entries</span>
        <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.py&quot;</span><span class="p">):</span>
            <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;RemoveFile&quot;</span><span class="p">,</span>
                      <span class="p">[(</span><span class="n">logical</span><span class="o">+</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">C|</span><span class="si">%s</span><span class="s">c&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">short</span><span class="p">,</span> <span class="nb">file</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">logical</span><span class="o">+</span><span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">O|</span><span class="si">%s</span><span class="s">o&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">short</span><span class="p">,</span> <span class="nb">file</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">logical</span>
</div>
<div class="viewcode-block" id="Directory.glob"><a class="viewcode-back" href="../msilib.html#msilib.Directory.glob">[docs]</a>    <span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a list of files to the current component as specified in the</span>
<span class="sd">        glob pattern. Individual files can be excluded in the exclude list.&quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exclude</span> <span class="ow">and</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span> <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>
</div>
<div class="viewcode-block" id="Directory.remove_pyc"><a class="viewcode-back" href="../msilib.html#msilib.Directory.remove_pyc">[docs]</a>    <span class="k">def</span> <span class="nf">remove_pyc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Remove .pyc/.pyo files on uninstall&quot;</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;RemoveFile&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">+</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s">&quot;*.pyc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">+</span><span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s">&quot;*.pyo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
</div></div>
<div class="viewcode-block" id="Binary"><a class="viewcode-back" href="../msilib.html#msilib.Binary">[docs]</a><span class="k">class</span> <span class="nc">Binary</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;msilib.Binary(os.path.join(dirname,&quot;</span><span class="si">%s</span><span class="s">&quot;))&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</div>
<div class="viewcode-block" id="Feature"><a class="viewcode-back" href="../msilib.html#msilib.Feature">[docs]</a><span class="k">class</span> <span class="nc">Feature</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">directory</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Feature&quot;</span><span class="p">,</span>
                        <span class="p">[(</span><span class="nb">id</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span>
                          <span class="n">level</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)])</span>
<div class="viewcode-block" id="Feature.set_current"><a class="viewcode-back" href="../msilib.html#msilib.Feature.set_current">[docs]</a>    <span class="k">def</span> <span class="nf">set_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">current_feature</span>
        <span class="n">current_feature</span> <span class="o">=</span> <span class="bp">self</span>
</div></div>
<div class="viewcode-block" id="Control"><a class="viewcode-back" href="../msilib.html#msilib.Control">[docs]</a><span class="k">class</span> <span class="nc">Control</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dlg</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">dlg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="Control.event"><a class="viewcode-back" href="../msilib.html#msilib.Control.event">[docs]</a>    <span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">ordering</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;ControlEvent&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span>
                   <span class="n">condition</span><span class="p">,</span> <span class="n">ordering</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="Control.mapping"><a class="viewcode-back" href="../msilib.html#msilib.Control.mapping">[docs]</a>    <span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;EventMapping&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="Control.condition"><a class="viewcode-back" href="../msilib.html#msilib.Control.condition">[docs]</a>    <span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;ControlCondition&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">condition</span><span class="p">)])</span>
</div></div>
<div class="viewcode-block" id="RadioButtonGroup"><a class="viewcode-back" href="../msilib.html#msilib.RadioButtonGroup">[docs]</a><span class="k">class</span> <span class="nc">RadioButtonGroup</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dlg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">dlg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">=</span> <span class="nb">property</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="RadioButtonGroup.add"><a class="viewcode-back" href="../msilib.html#msilib.RadioButtonGroup.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;RadioButton&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                   <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</div></div>
<div class="viewcode-block" id="Dialog"><a class="viewcode-back" href="../msilib.html#msilib.Dialog">[docs]</a><span class="k">class</span> <span class="nc">Dialog</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">cancel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span>
        <span class="n">add_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Dialog&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">first</span><span class="p">,</span><span class="n">default</span><span class="p">,</span><span class="n">cancel</span><span class="p">)])</span>

<div class="viewcode-block" id="Dialog.control"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.control">[docs]</a>    <span class="k">def</span> <span class="nf">control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">help</span><span class="p">):</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Control&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">help</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">Control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dialog.text"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.text">[docs]</a>    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="n">text</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dialog.bitmap"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.bitmap">[docs]</a>    <span class="k">def</span> <span class="nf">bitmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Bitmap&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dialog.line"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.line">[docs]</a>    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dialog.pushbutton"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.pushbutton">[docs]</a>    <span class="k">def</span> <span class="nf">pushbutton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;PushButton&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dialog.radiogroup"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.radiogroup">[docs]</a>    <span class="k">def</span> <span class="nf">radiogroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="s">&quot;Control&quot;</span><span class="p">,</span>
                 <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;RadioButtonGroup&quot;</span><span class="p">,</span>
                   <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">RadioButtonGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dialog.checkbox"><a class="viewcode-back" href="../msilib.html#msilib.Dialog.checkbox">[docs]</a>    <span class="k">def</span> <span class="nf">checkbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;CheckBox&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>