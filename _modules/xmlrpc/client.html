

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>xmlrpc.client &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>xmlrpc.client</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for xmlrpc.client</h1><div class="highlight"><pre>
<span class="c">#</span>
<span class="c"># XML-RPC CLIENT LIBRARY</span>
<span class="c"># $Id$</span>
<span class="c">#</span>
<span class="c"># an XML-RPC client interface for Python.</span>
<span class="c">#</span>
<span class="c"># the marshalling and response parser code can also be used to</span>
<span class="c"># implement XML-RPC servers.</span>
<span class="c">#</span>
<span class="c"># Notes:</span>
<span class="c"># this version is designed to work with Python 2.1 or newer.</span>
<span class="c">#</span>
<span class="c"># History:</span>
<span class="c"># 1999-01-14 fl  Created</span>
<span class="c"># 1999-01-15 fl  Changed dateTime to use localtime</span>
<span class="c"># 1999-01-16 fl  Added Binary/base64 element, default to RPC2 service</span>
<span class="c"># 1999-01-19 fl  Fixed array data element (from Skip Montanaro)</span>
<span class="c"># 1999-01-21 fl  Fixed dateTime constructor, etc.</span>
<span class="c"># 1999-02-02 fl  Added fault handling, handle empty sequences, etc.</span>
<span class="c"># 1999-02-10 fl  Fixed problem with empty responses (from Skip Montanaro)</span>
<span class="c"># 1999-06-20 fl  Speed improvements, pluggable parsers/transports (0.9.8)</span>
<span class="c"># 2000-11-28 fl  Changed boolean to check the truth value of its argument</span>
<span class="c"># 2001-02-24 fl  Added encoding/Unicode/SafeTransport patches</span>
<span class="c"># 2001-02-26 fl  Added compare support to wrappers (0.9.9/1.0b1)</span>
<span class="c"># 2001-03-28 fl  Make sure response tuple is a singleton</span>
<span class="c"># 2001-03-29 fl  Don&#39;t require empty params element (from Nicholas Riley)</span>
<span class="c"># 2001-06-10 fl  Folded in _xmlrpclib accelerator support (1.0b2)</span>
<span class="c"># 2001-08-20 fl  Base xmlrpclib.Error on built-in Exception (from Paul Prescod)</span>
<span class="c"># 2001-09-03 fl  Allow Transport subclass to override getparser</span>
<span class="c"># 2001-09-10 fl  Lazy import of urllib, cgi, xmllib (20x import speedup)</span>
<span class="c"># 2001-10-01 fl  Remove containers from memo cache when done with them</span>
<span class="c"># 2001-10-01 fl  Use faster escape method (80% dumps speedup)</span>
<span class="c"># 2001-10-02 fl  More dumps microtuning</span>
<span class="c"># 2001-10-04 fl  Make sure import expat gets a parser (from Guido van Rossum)</span>
<span class="c"># 2001-10-10 sm  Allow long ints to be passed as ints if they don&#39;t overflow</span>
<span class="c"># 2001-10-17 sm  Test for int and long overflow (allows use on 64-bit systems)</span>
<span class="c"># 2001-11-12 fl  Use repr() to marshal doubles (from Paul Felix)</span>
<span class="c"># 2002-03-17 fl  Avoid buffered read when possible (from James Rucker)</span>
<span class="c"># 2002-04-07 fl  Added pythondoc comments</span>
<span class="c"># 2002-04-16 fl  Added __str__ methods to datetime/binary wrappers</span>
<span class="c"># 2002-05-15 fl  Added error constants (from Andrew Kuchling)</span>
<span class="c"># 2002-06-27 fl  Merged with Python CVS version</span>
<span class="c"># 2002-10-22 fl  Added basic authentication (based on code from Phillip Eby)</span>
<span class="c"># 2003-01-22 sm  Add support for the bool type</span>
<span class="c"># 2003-02-27 gvr Remove apply calls</span>
<span class="c"># 2003-04-24 sm  Use cStringIO if available</span>
<span class="c"># 2003-04-25 ak  Add support for nil</span>
<span class="c"># 2003-06-15 gn  Add support for time.struct_time</span>
<span class="c"># 2003-07-12 gp  Correct marshalling of Faults</span>
<span class="c"># 2003-10-31 mvl Add multicall support</span>
<span class="c"># 2004-08-20 mvl Bump minimum supported Python version to 2.1</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 1999-2002 by Secret Labs AB.</span>
<span class="c"># Copyright (c) 1999-2002 by Fredrik Lundh.</span>
<span class="c">#</span>
<span class="c"># info@pythonware.com</span>
<span class="c"># http://www.pythonware.com</span>
<span class="c">#</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># The XML-RPC client interface is</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 1999-2002 by Secret Labs AB</span>
<span class="c"># Copyright (c) 1999-2002 by Fredrik Lundh</span>
<span class="c">#</span>
<span class="c"># By obtaining, using, and/or copying this software and/or its</span>
<span class="c"># associated documentation, you agree that you have read, understood,</span>
<span class="c"># and will comply with the following terms and conditions:</span>
<span class="c">#</span>
<span class="c"># Permission to use, copy, modify, and distribute this software and</span>
<span class="c"># its associated documentation for any purpose and without fee is</span>
<span class="c"># hereby granted, provided that the above copyright notice appears in</span>
<span class="c"># all copies, and that both that copyright notice and this permission</span>
<span class="c"># notice appear in supporting documentation, and that the name of</span>
<span class="c"># Secret Labs AB or the author not be used in advertising or publicity</span>
<span class="c"># pertaining to distribution of the software without specific, written</span>
<span class="c"># prior permission.</span>
<span class="c">#</span>
<span class="c"># SECRET LABS AB AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD</span>
<span class="c"># TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANT-</span>
<span class="c"># ABILITY AND FITNESS.  IN NO EVENT SHALL SECRET LABS AB OR THE AUTHOR</span>
<span class="c"># BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY</span>
<span class="c"># DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,</span>
<span class="c"># WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS</span>
<span class="c"># ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE</span>
<span class="c"># OF THIS SOFTWARE.</span>
<span class="c"># --------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">An XML-RPC client interface for Python.</span>

<span class="sd">The marshalling and response parser code can also be used to</span>
<span class="sd">implement XML-RPC servers.</span>

<span class="sd">Exported exceptions:</span>

<span class="sd">  Error          Base class for client errors</span>
<span class="sd">  ProtocolError  Indicates an HTTP protocol error</span>
<span class="sd">  ResponseError  Indicates a broken response package</span>
<span class="sd">  Fault          Indicates an XML-RPC fault package</span>

<span class="sd">Exported classes:</span>

<span class="sd">  ServerProxy    Represents a logical connection to an XML-RPC server</span>

<span class="sd">  MultiCall      Executor of boxcared xmlrpc requests</span>
<span class="sd">  DateTime       dateTime wrapper for an ISO 8601 string or time tuple or</span>
<span class="sd">                 localtime integer value to generate a &quot;dateTime.iso8601&quot;</span>
<span class="sd">                 XML-RPC value</span>
<span class="sd">  Binary         binary data wrapper</span>

<span class="sd">  Marshaller     Generate an XML-RPC params chunk from a Python data structure</span>
<span class="sd">  Unmarshaller   Unmarshal an XML-RPC response from incoming XML event message</span>
<span class="sd">  Transport      Handles an HTTP transaction to an XML-RPC server</span>
<span class="sd">  SafeTransport  Handles an HTTPS transaction to an XML-RPC server</span>

<span class="sd">Exported constants:</span>

<span class="sd">  (none)</span>

<span class="sd">Exported functions:</span>

<span class="sd">  getparser      Create instance of the fastest available parser &amp; attach</span>
<span class="sd">                 to an unmarshalling object</span>
<span class="sd">  dumps          Convert an argument tuple or a Fault instance to an XML-RPC</span>
<span class="sd">                 request (or response, if the methodresponse option is used).</span>
<span class="sd">  loads          Convert an XML-RPC packet to unmarshalled data plus a method</span>
<span class="sd">                 name (None if not present).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">http.client</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">from</span> <span class="nn">xml.parsers</span> <span class="kn">import</span> <span class="n">expat</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gzip</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">gzip</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#python can be built without zlib/gzip support</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Internal stuff</span>

<div class="viewcode-block" id="escape"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.escape">[docs]</a><span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;lt;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;gt;&quot;</span><span class="p">,)</span>

<span class="c"># used in User-Agent header sent</span></div>
<span class="n">__version__</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

<span class="c"># xmlrpc integer limits</span>
<span class="n">MAXINT</span> <span class="o">=</span>  <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span>
<span class="n">MININT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Error constants (from Dan Libby&#39;s specification at</span>
<span class="c"># http://xmlrpc-epi.sourceforge.net/specs/rfc.fault_codes.php)</span>

<span class="c"># Ranges of errors</span>
<span class="n">PARSE_ERROR</span>       <span class="o">=</span> <span class="o">-</span><span class="mi">32700</span>
<span class="n">SERVER_ERROR</span>      <span class="o">=</span> <span class="o">-</span><span class="mi">32600</span>
<span class="n">APPLICATION_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32500</span>
<span class="n">SYSTEM_ERROR</span>      <span class="o">=</span> <span class="o">-</span><span class="mi">32400</span>
<span class="n">TRANSPORT_ERROR</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">32300</span>

<span class="c"># Specific errors</span>
<span class="n">NOT_WELLFORMED_ERROR</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">32700</span>
<span class="n">UNSUPPORTED_ENCODING</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">32701</span>
<span class="n">INVALID_ENCODING_CHAR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32702</span>
<span class="n">INVALID_XMLRPC</span>        <span class="o">=</span> <span class="o">-</span><span class="mi">32600</span>
<span class="n">METHOD_NOT_FOUND</span>      <span class="o">=</span> <span class="o">-</span><span class="mi">32601</span>
<span class="n">INVALID_METHOD_PARAMS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32602</span>
<span class="n">INTERNAL_ERROR</span>        <span class="o">=</span> <span class="o">-</span><span class="mi">32603</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Exceptions</span>

<span class="c">##</span>
<span class="c"># Base class for all kinds of client-side errors.</span>

<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for client errors.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Indicates an HTTP-level protocol error.  This is raised by the HTTP</span>
<span class="c"># transport layer, if the server returns an error code other than 200</span>
<span class="c"># (OK).</span>
<span class="c">#</span>
<span class="c"># @param url The target URL.</span>
<span class="c"># @param errcode The HTTP error code.</span>
<span class="c"># @param errmsg The HTTP error message.</span>
<span class="c"># @param headers The HTTP header dictionary.</span>
</div>
<div class="viewcode-block" id="ProtocolError"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.ProtocolError">[docs]</a><span class="k">class</span> <span class="nc">ProtocolError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicates an HTTP protocol error.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">errcode</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="n">Error</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errcode</span> <span class="o">=</span> <span class="n">errcode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errmsg</span> <span class="o">=</span> <span class="n">errmsg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s">&quot;&lt;ProtocolError for </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errcode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="p">)</span>

<span class="c">##</span>
<span class="c"># Indicates a broken XML-RPC response package.  This exception is</span>
<span class="c"># raised by the unmarshalling layer, if the XML-RPC response is</span>
<span class="c"># malformed.</span>
</div>
<div class="viewcode-block" id="ResponseError"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.ResponseError">[docs]</a><span class="k">class</span> <span class="nc">ResponseError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicates a broken response package.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c">##</span>
<span class="c"># Indicates an XML-RPC fault response package.  This exception is</span>
<span class="c"># raised by the unmarshalling layer, if the XML-RPC response contains</span>
<span class="c"># a fault string.  This exception can also be used as a class, to</span>
<span class="c"># generate a fault XML-RPC message.</span>
<span class="c">#</span>
<span class="c"># @param faultCode The XML-RPC fault code.</span>
<span class="c"># @param faultString The XML-RPC fault string.</span>
</div>
<div class="viewcode-block" id="Fault"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Fault">[docs]</a><span class="k">class</span> <span class="nc">Fault</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicates an XML-RPC fault package.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faultCode</span><span class="p">,</span> <span class="n">faultString</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
        <span class="n">Error</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faultCode</span> <span class="o">=</span> <span class="n">faultCode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faultString</span> <span class="o">=</span> <span class="n">faultString</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;Fault </span><span class="si">%s</span><span class="s">: </span><span class="si">%r</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faultString</span><span class="p">)</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Special values</span>

<span class="c">##</span>
<span class="c"># Backwards compatibility</span>
</div>
<span class="n">boolean</span> <span class="o">=</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="nb">bool</span>

<span class="c">##</span>
<span class="c"># Wrapper for XML-RPC DateTime values.  This converts a time value to</span>
<span class="c"># the format used by XML-RPC.</span>
<span class="c"># &lt;p&gt;</span>
<span class="c"># The value can be given as a datetime object, as a string in the</span>
<span class="c"># format &quot;yyyymmddThh:mm:ss&quot;, as a 9-item time tuple (as returned by</span>
<span class="c"># time.localtime()), or an integer value (as returned by time.time()).</span>
<span class="c"># The wrapper uses time.localtime() to convert an integer to a time</span>
<span class="c"># tuple.</span>
<span class="c">#</span>
<span class="c"># @param value The time, given as a datetime object, an ISO 8601 string,</span>
<span class="c">#              a time tuple, or an integer time value.</span>


<span class="c"># Issue #13305: different format codes across platforms</span>
<span class="n">_day0</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="n">_day0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;0001&#39;</span><span class="p">:</span>      <span class="c"># Mac OS X</span>
    <span class="k">def</span> <span class="nf">_iso8601_format</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">T%H:%M:%S&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">_day0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%4Y&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;0001&#39;</span><span class="p">:</span>   <span class="c"># Linux</span>
    <span class="k">def</span> <span class="nf">_iso8601_format</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%4Y%m</span><span class="si">%d</span><span class="s">T%H:%M:%S&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_iso8601_format</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">T%H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="k">del</span> <span class="n">_day0</span>


<span class="k">def</span> <span class="nf">_strftime</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_iso8601_format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">struct_time</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%04d%02d%02d</span><span class="s">T</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

<div class="viewcode-block" id="DateTime"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.DateTime">[docs]</a><span class="k">class</span> <span class="nc">DateTime</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;DateTime wrapper for an ISO 8601 string or time tuple or</span>
<span class="sd">    localtime integer value to generate &#39;dateTime.iso8601&#39; XML-RPC</span>
<span class="sd">    value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">_strftime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="DateTime.make_comparable"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.DateTime.make_comparable">[docs]</a>    <span class="k">def</span> <span class="nf">make_comparable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">_iso8601_format</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;timetuple&quot;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">otype</span> <span class="o">=</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;__class__&quot;</span><span class="p">)</span>
                     <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
                     <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Can&#39;t compare </span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">otype</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span>
</div>
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_comparable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_comparable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">&lt;=</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_comparable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_comparable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_comparable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">==</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_comparable</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">o</span>

<div class="viewcode-block" id="DateTime.timetuple"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.DateTime.timetuple">[docs]</a>    <span class="k">def</span> <span class="nf">timetuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">T%H:%M:%S&quot;</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Get date/time value.</span>
    <span class="c">#</span>
    <span class="c"># @return Date/time value, as an ISO 8601 string.</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;DateTime </span><span class="si">%r</span><span class="s"> at </span><span class="si">%x</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="DateTime.decode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.DateTime.decode">[docs]</a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DateTime.encode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.DateTime.encode">[docs]</a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;dateTime.iso8601&gt;&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/dateTime.iso8601&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div></div>
<span class="k">def</span> <span class="nf">_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c"># decode xml element contents into a DateTime structure.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">()</span>
    <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_datetime_type</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">T%H:%M:%S&quot;</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Wrapper for binary data.  This can be used to transport any kind</span>
<span class="c"># of binary data over XML-RPC, using BASE64 encoding.</span>
<span class="c">#</span>
<span class="c"># @param data An 8-bit string containing arbitrary data.</span>

<div class="viewcode-block" id="Binary"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Binary">[docs]</a><span class="k">class</span> <span class="nc">Binary</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for binary data.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;expected bytes or bytearray, not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                <span class="n">data</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c"># Make a copy of the bytes!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c">##</span>
    <span class="c"># Get buffer contents.</span>
    <span class="c">#</span>
    <span class="c"># @return Buffer contents, as an 8-bit string.</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;latin-1&quot;</span><span class="p">)</span>  <span class="c"># XXX encoding?!</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Binary</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Binary</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="n">other</span>

<div class="viewcode-block" id="Binary.decode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Binary.decode">[docs]</a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">decodebytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Binary.encode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Binary.encode">[docs]</a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;base64&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">encodebytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encoded</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/base64&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div></div>
<span class="k">def</span> <span class="nf">_binary</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c"># decode xml element contents into a Binary structure</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Binary</span><span class="p">()</span>
    <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">WRAPPERS</span> <span class="o">=</span> <span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">Binary</span><span class="p">)</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># XML parsers</span>

<div class="viewcode-block" id="ExpatParser"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.ExpatParser">[docs]</a><span class="k">class</span> <span class="nc">ExpatParser</span><span class="p">:</span>
    <span class="c"># fast expat parser for Python 2.0 and later.</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">expat</span><span class="o">.</span><span class="n">ParserCreate</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">StartElementHandler</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">start</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">EndElementHandler</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">CharacterDataHandler</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">data</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">target</span><span class="o">.</span><span class="n">xml</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<div class="viewcode-block" id="ExpatParser.feed"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.ExpatParser.feed">[docs]</a>    <span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExpatParser.close"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.ExpatParser.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># end of data</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="c"># get rid of circular references</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># XML-RPC marshalling and unmarshalling code</span>

<span class="c">##</span>
<span class="c"># XML-RPC marshaller.</span>
<span class="c">#</span>
<span class="c"># @param encoding Default encoding for 8-bit strings.  The default</span>
<span class="c">#     value is None (interpreted as UTF-8).</span>
<span class="c"># @see dumps</span>
</div></div>
<div class="viewcode-block" id="Marshaller"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller">[docs]</a><span class="k">class</span> <span class="nc">Marshaller</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Generate an XML-RPC params chunk from a Python data structure.</span>

<span class="sd">    Create a Marshaller instance for each set of parameters, and use</span>
<span class="sd">    the &quot;dumps&quot; method to convert your data (represented as a tuple)</span>
<span class="sd">    to an XML-RPC params chunk.  To write a fault response, pass a</span>
<span class="sd">    Fault instance instead.  You may prefer to use the &quot;dumps&quot; module</span>
<span class="sd">    function for this purpose.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># by the way, if you don&#39;t understand what&#39;s going on in here,</span>
    <span class="c"># that&#39;s perfectly ok.</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>

    <span class="n">dispatch</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Marshaller.dumps"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dumps">[docs]</a>    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">write</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dump</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Fault</span><span class="p">):</span>
            <span class="c"># fault instance</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;fault&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">dump</span><span class="p">({</span><span class="s">&#39;faultCode&#39;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span>
                  <span class="s">&#39;faultString&#39;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">faultString</span><span class="p">},</span>
                 <span class="n">write</span><span class="p">)</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/fault&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># parameter block</span>
            <span class="c"># FIXME: the xml-rpc specification allows us to leave out</span>
            <span class="c"># the entire &lt;params&gt; block if there are no parameters.</span>
            <span class="c"># however, changing this may break older code (including</span>
            <span class="c"># old versions of xmlrpclib.py), so this is better left as</span>
            <span class="c"># is for now.  See @XMLRPC3 for more information. /F</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;params&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;param&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span>
                <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/param&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/params&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
    <span class="k">def</span> <span class="nf">__dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c"># check if this object can be marshalled as a structure</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;__dict__&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;cannot marshal </span><span class="si">%s</span><span class="s"> objects&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="c"># check if this class is a sub-class of a basic type,</span>
            <span class="c"># because we don&#39;t know how to marshal these types</span>
            <span class="c"># (e.g. a string sub-class)</span>
            <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">__mro__</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">type_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;cannot marshal </span><span class="si">%s</span><span class="s"> objects&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="c"># XXX(twouters): using &quot;_arbitrary_instance&quot; as key as a quick-fix</span>
            <span class="c"># for the p3yk merge, this should probably be fixed more neatly.</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;_arbitrary_instance&quot;</span><span class="p">]</span>
        <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span>

<div class="viewcode-block" id="Marshaller.dump_nil"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_nil">[docs]</a>    <span class="k">def</span> <span class="nf">dump_nil</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;cannot marshal None unless allow_none is enabled&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;nil/&gt;&lt;/value&gt;&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dump_nil</span>

<div class="viewcode-block" id="Marshaller.dump_bool"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_bool">[docs]</a>    <span class="k">def</span> <span class="nf">dump_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;boolean&gt;&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">value</span> <span class="ow">and</span> <span class="s">&quot;1&quot;</span> <span class="ow">or</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/boolean&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_bool</span>

<div class="viewcode-block" id="Marshaller.dump_long"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_long">[docs]</a>    <span class="k">def</span> <span class="nf">dump_long</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">MAXINT</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">MININT</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s">&quot;int exceeds XML-RPC limits&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;int&gt;&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/int&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_long</span>

    <span class="c"># backward compatible</span>
    <span class="n">dump_int</span> <span class="o">=</span> <span class="n">dump_long</span>

<div class="viewcode-block" id="Marshaller.dump_double"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_double">[docs]</a>    <span class="k">def</span> <span class="nf">dump_double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;double&gt;&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/double&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_double</span>

<div class="viewcode-block" id="Marshaller.dump_unicode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">dump_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="n">escape</span><span class="p">):</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;string&gt;&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">escape</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/string&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_unicode</span>

<div class="viewcode-block" id="Marshaller.dump_bytes"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">dump_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;base64&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">encoded</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/base64&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_bytes</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">bytearray</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_bytes</span>

<div class="viewcode-block" id="Marshaller.dump_array"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_array">[docs]</a>    <span class="k">def</span> <span class="nf">dump_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;cannot marshal recursive sequences&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dump</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;array&gt;&lt;data&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_array</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_array</span>

<div class="viewcode-block" id="Marshaller.dump_struct"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_struct">[docs]</a>    <span class="k">def</span> <span class="nf">dump_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="n">escape</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;cannot marshal recursive dictionaries&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dump</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;struct&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;member&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;dictionary key must be string&quot;</span><span class="p">)</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;name&gt;</span><span class="si">%s</span><span class="s">&lt;/name&gt;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span>
            <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/member&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/struct&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_struct</span>

<div class="viewcode-block" id="Marshaller.dump_datetime"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">dump_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;value&gt;&lt;dateTime.iso8601&gt;&quot;</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">_strftime</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/dateTime.iso8601&gt;&lt;/value&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_datetime</span>

<div class="viewcode-block" id="Marshaller.dump_instance"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Marshaller.dump_instance">[docs]</a>    <span class="k">def</span> <span class="nf">dump_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">write</span><span class="p">):</span>
        <span class="c"># check for special wrappers</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">in</span> <span class="n">WRAPPERS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write</span>
            <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># store instance attributes as a struct (really?)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_struct</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">write</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="n">DateTime</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_instance</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="n">Binary</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_instance</span>
    <span class="c"># XXX(twouters): using &quot;_arbitrary_instance&quot; as key as a quick-fix</span>
    <span class="c"># for the p3yk merge, this should probably be fixed more neatly.</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;_arbitrary_instance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dump_instance</span>

<span class="c">##</span>
<span class="c"># XML-RPC unmarshaller.</span>
<span class="c">#</span>
<span class="c"># @see loads</span>
</div>
<div class="viewcode-block" id="Unmarshaller"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller">[docs]</a><span class="k">class</span> <span class="nc">Unmarshaller</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unmarshal an XML-RPC response, based on incoming XML event</span>
<span class="sd">    messages (start, data, end).  Call close() to get the resulting</span>
<span class="sd">    data structure.</span>

<span class="sd">    Note that this reader is fairly tolerant, and gladly accepts bogus</span>
<span class="sd">    XML-RPC data without complaining (but not bogus XML).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># and again, if you don&#39;t understand what&#39;s going on in here,</span>
    <span class="c"># that&#39;s perfectly ok.</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_methodname</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="o">.</span><span class="n">append</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_datetime</span> <span class="o">=</span> <span class="n">use_builtin_types</span> <span class="ow">or</span> <span class="n">use_datetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_bytes</span> <span class="o">=</span> <span class="n">use_builtin_types</span>

<div class="viewcode-block" id="Unmarshaller.close"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># return response tuple and target method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s">&quot;fault&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Fault</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Unmarshaller.getmethodname"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.getmethodname">[docs]</a>    <span class="k">def</span> <span class="nf">getmethodname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_methodname</span>

    <span class="c">#</span>
    <span class="c"># event handlers</span>
</div>
<div class="viewcode-block" id="Unmarshaller.xml"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.xml">[docs]</a>    <span class="k">def</span> <span class="nf">xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">standalone</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="c"># FIXME: assert standalone == 1 ???</span>
</div>
<div class="viewcode-block" id="Unmarshaller.start"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="c"># prepare to handle this element</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;array&quot;</span> <span class="ow">or</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;struct&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;value&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Unmarshaller.data"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Unmarshaller.end"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end">[docs]</a>    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="c"># call the appropriate end tag handler</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># unknown tag ?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>

    <span class="c">#</span>
    <span class="c"># accelerator support</span>
</div>
<div class="viewcode-block" id="Unmarshaller.end_dispatch"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_dispatch">[docs]</a>    <span class="k">def</span> <span class="nf">end_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># dispatch data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># unknown tag ?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="c">#</span>
    <span class="c"># element decoders</span>
</div>
    <span class="n">dispatch</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Unmarshaller.end_nil"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_nil">[docs]</a>    <span class="k">def</span> <span class="nf">end_nil</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;nil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_nil</span>

<div class="viewcode-block" id="Unmarshaller.end_boolean"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_boolean">[docs]</a>    <span class="k">def</span> <span class="nf">end_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;bad boolean value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;boolean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_boolean</span>

<div class="viewcode-block" id="Unmarshaller.end_int"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_int">[docs]</a>    <span class="k">def</span> <span class="nf">end_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;i4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_int</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;i8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_int</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;int&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_int</span>

<div class="viewcode-block" id="Unmarshaller.end_double"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_double">[docs]</a>    <span class="k">def</span> <span class="nf">end_double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;double&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_double</span>

<div class="viewcode-block" id="Unmarshaller.end_string"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_string">[docs]</a>    <span class="k">def</span> <span class="nf">end_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_string</span>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_string</span> <span class="c"># struct keys are always strings</span>

<div class="viewcode-block" id="Unmarshaller.end_array"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_array">[docs]</a>    <span class="k">def</span> <span class="nf">end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">mark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c"># map arrays to Python lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">[</span><span class="n">mark</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">[</span><span class="n">mark</span><span class="p">:]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_array</span>

<div class="viewcode-block" id="Unmarshaller.end_struct"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_struct">[docs]</a>    <span class="k">def</span> <span class="nf">end_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">mark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c"># map structs to Python dictionaries</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">[</span><span class="n">mark</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="nb">dict</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stack</span><span class="p">[</span><span class="n">mark</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;struct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_struct</span>

<div class="viewcode-block" id="Unmarshaller.end_base64"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_base64">[docs]</a>    <span class="k">def</span> <span class="nf">end_base64</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">Binary</span><span class="p">()</span>
        <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_bytes</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;base64&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_base64</span>

<div class="viewcode-block" id="Unmarshaller.end_dateTime"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_dateTime">[docs]</a>    <span class="k">def</span> <span class="nf">end_dateTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">()</span>
        <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_datetime</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_datetime_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;dateTime.iso8601&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_dateTime</span>

<div class="viewcode-block" id="Unmarshaller.end_value"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_value">[docs]</a>    <span class="k">def</span> <span class="nf">end_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># if we stumble upon a value element with no internal</span>
        <span class="c"># elements, treat it as a string element</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_value</span>

<div class="viewcode-block" id="Unmarshaller.end_params"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_params">[docs]</a>    <span class="k">def</span> <span class="nf">end_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s">&quot;params&quot;</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_params</span>

<div class="viewcode-block" id="Unmarshaller.end_fault"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_fault">[docs]</a>    <span class="k">def</span> <span class="nf">end_fault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s">&quot;fault&quot;</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_fault</span>

<div class="viewcode-block" id="Unmarshaller.end_methodName"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Unmarshaller.end_methodName">[docs]</a>    <span class="k">def</span> <span class="nf">end_methodName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_methodname</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s">&quot;methodName&quot;</span> <span class="c"># no params</span></div>
    <span class="n">dispatch</span><span class="p">[</span><span class="s">&quot;methodName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_methodName</span>

<span class="c">## Multicall support</span>
<span class="c">#</span>
</div>
<span class="k">class</span> <span class="nc">_MultiCallMethod</span><span class="p">:</span>
    <span class="c"># some lesser magic to store calls made to a MultiCall object</span>
    <span class="c"># for batch execution</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_list</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__call_list</span> <span class="o">=</span> <span class="n">call_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_MultiCallMethod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__call_list</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__call_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>

<div class="viewcode-block" id="MultiCallIterator"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.MultiCallIterator">[docs]</a><span class="k">class</span> <span class="nc">MultiCallIterator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Iterates over the results of a multicall. Exceptions are</span>
<span class="sd">    raised in response to xmlrpc faults.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">({}):</span>
            <span class="k">raise</span> <span class="n">Fault</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">&#39;faultCode&#39;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;faultString&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
            <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unexpected type in multicall result&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MultiCall"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.MultiCall">[docs]</a><span class="k">class</span> <span class="nc">MultiCall</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;server -&gt; a object used to boxcar method calls</span>

<span class="sd">    server should be a ServerProxy object.</span>

<span class="sd">    Methods can be added to the MultiCall using normal</span>
<span class="sd">    method call syntax e.g.:</span>

<span class="sd">    multicall = MultiCall(server_proxy)</span>
<span class="sd">    multicall.add(2,3)</span>
<span class="sd">    multicall.get_address(&quot;Guido&quot;)</span>

<span class="sd">    To execute the multicall, call the MultiCall object e.g.:</span>

<span class="sd">    add_result, address = multicall()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__server</span> <span class="o">=</span> <span class="n">server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__call_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;MultiCall at </span><span class="si">%x</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_MultiCallMethod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__call_list</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">marshalled_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__call_list</span><span class="p">:</span>
            <span class="n">marshalled_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;methodName&#39;</span> <span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">&#39;params&#39;</span> <span class="p">:</span> <span class="n">args</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">MultiCallIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__server</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">multicall</span><span class="p">(</span><span class="n">marshalled_list</span><span class="p">))</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># convenience functions</span>
</div>
<span class="n">FastMarshaller</span> <span class="o">=</span> <span class="n">FastParser</span> <span class="o">=</span> <span class="n">FastUnmarshaller</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c">##</span>
<span class="c"># Create a parser object, and connect it to an unmarshalling instance.</span>
<span class="c"># This function picks the fastest available XML parser.</span>
<span class="c">#</span>
<span class="c"># return A (parser, unmarshaller) tuple.</span>

<div class="viewcode-block" id="getparser"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.getparser">[docs]</a><span class="k">def</span> <span class="nf">getparser</span><span class="p">(</span><span class="n">use_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getparser() -&gt; parser, unmarshaller</span>

<span class="sd">    Create an instance of the fastest available parser, and attach it</span>
<span class="sd">    to an unmarshalling object.  Return both objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">FastParser</span> <span class="ow">and</span> <span class="n">FastUnmarshaller</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">use_builtin_types</span><span class="p">:</span>
            <span class="n">mkdatetime</span> <span class="o">=</span> <span class="n">_datetime_type</span>
            <span class="n">mkbytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">decodebytes</span>
        <span class="k">elif</span> <span class="n">use_datetime</span><span class="p">:</span>
            <span class="n">mkdatetime</span> <span class="o">=</span> <span class="n">_datetime_type</span>
            <span class="n">mkbytes</span> <span class="o">=</span> <span class="n">_binary</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mkdatetime</span> <span class="o">=</span> <span class="n">_datetime</span>
            <span class="n">mkbytes</span> <span class="o">=</span> <span class="n">_binary</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">FastUnmarshaller</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">mkbytes</span><span class="p">,</span> <span class="n">mkdatetime</span><span class="p">,</span> <span class="n">Fault</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">FastParser</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">Unmarshaller</span><span class="p">(</span><span class="n">use_datetime</span><span class="o">=</span><span class="n">use_datetime</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="n">use_builtin_types</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">FastParser</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">FastParser</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ExpatParser</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="p">,</span> <span class="n">target</span>

<span class="c">##</span>
<span class="c"># Convert a Python tuple or a Fault instance to an XML-RPC packet.</span>
<span class="c">#</span>
<span class="c"># @def dumps(params, **options)</span>
<span class="c"># @param params A tuple or Fault instance.</span>
<span class="c"># @keyparam methodname If given, create a methodCall request for</span>
<span class="c">#     this method name.</span>
<span class="c"># @keyparam methodresponse If given, create a methodResponse packet.</span>
<span class="c">#     If used with a tuple, the tuple must be a singleton (that is,</span>
<span class="c">#     it must contain exactly one element).</span>
<span class="c"># @keyparam encoding The packet encoding.</span>
<span class="c"># @return A string containing marshalled data.</span>
</div>
<div class="viewcode-block" id="dumps"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.dumps">[docs]</a><span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">methodname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">methodresponse</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
          <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;data [,options] -&gt; marshalled data</span>

<span class="sd">    Convert an argument tuple or a Fault instance to an XML-RPC</span>
<span class="sd">    request (or response, if the methodresponse option is used).</span>

<span class="sd">    In addition to the data object, the following options can be given</span>
<span class="sd">    as keyword arguments:</span>

<span class="sd">        methodname: the method name for a methodCall packet</span>

<span class="sd">        methodresponse: true to create a methodResponse packet.</span>
<span class="sd">        If this option is used with a tuple, the tuple must be</span>
<span class="sd">        a singleton (i.e. it can contain only one element).</span>

<span class="sd">        encoding: the packet encoding (default is UTF-8)</span>

<span class="sd">    All byte strings in the data structure are assumed to use the</span>
<span class="sd">    packet encoding.  Unicode strings are automatically converted,</span>
<span class="sd">    where necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">Fault</span><span class="p">)),</span> <span class="s">&quot;argument must be tuple or Fault instance&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">Fault</span><span class="p">):</span>
        <span class="n">methodresponse</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">methodresponse</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;response tuple must be a singleton&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">encoding</span><span class="p">:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span>

    <span class="k">if</span> <span class="n">FastMarshaller</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">FastMarshaller</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Marshaller</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">allow_none</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">:</span>
        <span class="n">xmlheader</span> <span class="o">=</span> <span class="s">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;</span><span class="si">%s</span><span class="s">&#39;?&gt;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmlheader</span> <span class="o">=</span> <span class="s">&quot;&lt;?xml version=&#39;1.0&#39;?&gt;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="c"># utf-8 is default</span>

    <span class="c"># standard XML-RPC wrappings</span>
    <span class="k">if</span> <span class="n">methodname</span><span class="p">:</span>
        <span class="c"># a method call</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">methodname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">methodname</span> <span class="o">=</span> <span class="n">methodname</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">xmlheader</span><span class="p">,</span>
            <span class="s">&quot;&lt;methodCall&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;&lt;methodName&gt;&quot;</span><span class="p">,</span> <span class="n">methodname</span><span class="p">,</span> <span class="s">&quot;&lt;/methodName&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="s">&quot;&lt;/methodCall&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">methodresponse</span><span class="p">:</span>
        <span class="c"># a method response, or a fault structure</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">xmlheader</span><span class="p">,</span>
            <span class="s">&quot;&lt;methodResponse&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="s">&quot;&lt;/methodResponse&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span> <span class="c"># return as is</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Convert an XML-RPC packet to a Python object.  If the XML-RPC packet</span>
<span class="c"># represents a fault condition, this function raises a Fault exception.</span>
<span class="c">#</span>
<span class="c"># @param data An XML-RPC packet, given as an 8-bit string.</span>
<span class="c"># @return A tuple containing the unpacked data, and the method name</span>
<span class="c">#     (None if not present).</span>
<span class="c"># @see Fault</span>
</div>
<div class="viewcode-block" id="loads"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.loads">[docs]</a><span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">use_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;data -&gt; unmarshalled data, method name</span>

<span class="sd">    Convert an XML-RPC packet to unmarshalled data plus a method</span>
<span class="sd">    name (None if not present).</span>

<span class="sd">    If the XML-RPC packet represents a fault condition, this function</span>
<span class="sd">    raises a Fault exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">getparser</span><span class="p">(</span><span class="n">use_datetime</span><span class="o">=</span><span class="n">use_datetime</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="n">use_builtin_types</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">close</span><span class="p">(),</span> <span class="n">u</span><span class="o">.</span><span class="n">getmethodname</span><span class="p">()</span>

<span class="c">##</span>
<span class="c"># Encode a string using the gzip content encoding such as specified by the</span>
<span class="c"># Content-Encoding: gzip</span>
<span class="c"># in the HTTP header, as described in RFC 1952</span>
<span class="c">#</span>
<span class="c"># @param data the unencoded data</span>
<span class="c"># @return the encoded data</span>
</div>
<div class="viewcode-block" id="gzip_encode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.gzip_encode">[docs]</a><span class="k">def</span> <span class="nf">gzip_encode</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;data -&gt; gzip encoded data</span>

<span class="sd">    Encode data using the gzip content encoding as described in RFC 1952</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gzip</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;wb&quot;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">encoded</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">encoded</span>

<span class="c">##</span>
<span class="c"># Decode a string using the gzip content encoding such as specified by the</span>
<span class="c"># Content-Encoding: gzip</span>
<span class="c"># in the HTTP header, as described in RFC 1952</span>
<span class="c">#</span>
<span class="c"># @param data The encoded data</span>
<span class="c"># @return the unencoded data</span>
<span class="c"># @raises ValueError if data is not correctly coded.</span>
</div>
<div class="viewcode-block" id="gzip_decode"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.gzip_decode">[docs]</a><span class="k">def</span> <span class="nf">gzip_decode</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;gzip encoded data -&gt; unencoded data</span>

<span class="sd">    Decode data using the gzip content encoding as described in RFC 1952</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gzip</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;rb&quot;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="n">gzf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;invalid data&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">decoded</span>

<span class="c">##</span>
<span class="c"># Return a decoded file-like object for the gzip encoding</span>
<span class="c"># as described in RFC 1952.</span>
<span class="c">#</span>
<span class="c"># @param response A stream supporting a read() method</span>
<span class="c"># @return a file-like object that the decoded data can be read() from</span>
</div>
<div class="viewcode-block" id="GzipDecodedResponse"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.GzipDecodedResponse">[docs]</a><span class="k">class</span> <span class="nc">GzipDecodedResponse</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span> <span class="k">if</span> <span class="n">gzip</span> <span class="k">else</span> <span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;a file-like object to decode a response encoded with the gzip</span>
<span class="sd">    method, as described in RFC 1952.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c">#response doesn&#39;t support tell() and read(), required by</span>
        <span class="c">#GzipFile</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gzip</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;rb&quot;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">io</span><span class="p">)</span>

<div class="viewcode-block" id="GzipDecodedResponse.close"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.GzipDecodedResponse.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># request dispatcher</span>
</div></div>
<span class="k">class</span> <span class="nc">_Method</span><span class="p">:</span>
    <span class="c"># some magic to bind an XML-RPC method to an RPC server.</span>
    <span class="c"># supports &quot;nested&quot; methods (e.g. examples.getStateName)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__send</span> <span class="o">=</span> <span class="n">send</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_Method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

<span class="c">##</span>
<span class="c"># Standard transport class for XML-RPC over HTTP.</span>
<span class="c"># &lt;p&gt;</span>
<span class="c"># You can create custom transports by subclassing this method, and</span>
<span class="c"># overriding selected methods.</span>

<div class="viewcode-block" id="Transport"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport">[docs]</a><span class="k">class</span> <span class="nc">Transport</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Handles an HTTP transaction to an XML-RPC server.&quot;&quot;&quot;</span>

    <span class="c"># client identifier (may be overridden)</span>
    <span class="n">user_agent</span> <span class="o">=</span> <span class="s">&quot;Python-xmlrpc/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">__version__</span>

    <span class="c">#if true, we&#39;ll request gzip encoding</span>
    <span class="n">accept_gzip_encoding</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c"># if positive, encode request using gzip if it exceeds this threshold</span>
    <span class="c"># note that many server will get confused, so only use it if you know</span>
    <span class="c"># that they can decode such a request</span>
    <span class="n">encode_threshold</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#None = don&#39;t encode</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_datetime</span> <span class="o">=</span> <span class="n">use_datetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_builtin_types</span> <span class="o">=</span> <span class="n">use_builtin_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_headers</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">##</span>
    <span class="c"># Send a complete request, and parse the response.</span>
    <span class="c"># Retry request if a cached connection has disconnected.</span>
    <span class="c">#</span>
    <span class="c"># @param host Target host.</span>
    <span class="c"># @param handler Target PRC handler.</span>
    <span class="c"># @param request_body XML-RPC request body.</span>
    <span class="c"># @param verbose Debugging flag.</span>
    <span class="c"># @return Parsed response.</span>

<div class="viewcode-block" id="Transport.request"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.request">[docs]</a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">request_body</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c">#retry request once if cached connection has gone cold</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_request</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">request_body</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ECONNRESET</span><span class="p">,</span> <span class="n">errno</span><span class="o">.</span><span class="n">ECONNABORTED</span><span class="p">,</span>
                                        <span class="n">errno</span><span class="o">.</span><span class="n">EPIPE</span><span class="p">):</span>
                    <span class="k">raise</span>
            <span class="k">except</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BadStatusLine</span><span class="p">:</span> <span class="c">#close after we sent request</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">raise</span>
</div>
<div class="viewcode-block" id="Transport.single_request"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.single_request">[docs]</a>    <span class="k">def</span> <span class="nf">single_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">request_body</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># issue XML-RPC request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">http_conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">request_body</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">http_conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">Fault</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c">#All unexpected errors leave connection in</span>
            <span class="c"># a strange state, so we clear it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span>

        <span class="c">#We got an error response.</span>
        <span class="c">#Discard any response data and raise exception</span>
        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&quot;content-length&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">ProtocolError</span><span class="p">(</span>
            <span class="n">host</span> <span class="o">+</span> <span class="n">handler</span><span class="p">,</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">getheaders</span><span class="p">())</span>
            <span class="p">)</span>


    <span class="c">##</span>
    <span class="c"># Create parser.</span>
    <span class="c">#</span>
    <span class="c"># @return A 2-tuple containing a parser and a unmarshaller.</span>
</div>
<div class="viewcode-block" id="Transport.getparser"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.getparser">[docs]</a>    <span class="k">def</span> <span class="nf">getparser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># get parser and unmarshaller</span>
        <span class="k">return</span> <span class="n">getparser</span><span class="p">(</span><span class="n">use_datetime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_datetime</span><span class="p">,</span>
                         <span class="n">use_builtin_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_builtin_types</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Get authorization info from host parameter</span>
    <span class="c"># Host may be a string, or a (host, x509-dict) tuple; if a string,</span>
    <span class="c"># it is checked for a &quot;user:pw@host&quot; format, and a &quot;Basic</span>
    <span class="c"># Authentication&quot; header is added if appropriate.</span>
    <span class="c">#</span>
    <span class="c"># @param host Host descriptor (URL or (URL, x509 info) tuple).</span>
    <span class="c"># @return A 3-tuple containing (actual host, extra headers,</span>
    <span class="c">#     x509 info).  The header and x509 fields may be None.</span>
</div>
<div class="viewcode-block" id="Transport.get_host_info"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.get_host_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_host_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>

        <span class="n">x509</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">host</span><span class="p">,</span> <span class="n">x509</span> <span class="o">=</span> <span class="n">host</span>

        <span class="n">auth</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">splituser</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote_to_bytes</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">auth</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="c"># get rid of whitespace</span>
            <span class="n">extra_headers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s">&quot;Basic &quot;</span> <span class="o">+</span> <span class="n">auth</span><span class="p">)</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extra_headers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">host</span><span class="p">,</span> <span class="n">extra_headers</span><span class="p">,</span> <span class="n">x509</span>

    <span class="c">##</span>
    <span class="c"># Connect to server.</span>
    <span class="c">#</span>
    <span class="c"># @param host Target host.</span>
    <span class="c"># @return An HTTPConnection object</span>
</div>
<div class="viewcode-block" id="Transport.make_connection"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.make_connection">[docs]</a>    <span class="k">def</span> <span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="c">#return an existing connection if possible.  This allows</span>
        <span class="c">#HTTP/1.1 keep-alive.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">and</span> <span class="n">host</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># create a HTTP connection object from a host descriptor</span>
        <span class="n">chost</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_headers</span><span class="p">,</span> <span class="n">x509</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_host_info</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">chost</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c">##</span>
    <span class="c"># Clear any cached connection object.</span>
    <span class="c"># Used in the event of socket errors.</span>
    <span class="c">#</span></div>
<div class="viewcode-block" id="Transport.close"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Send HTTP request.</span>
    <span class="c">#</span>
    <span class="c"># @param host Host descriptor (URL or (URL, x509 info) tuple).</span>
    <span class="c"># @param handler Targer RPC handler (a path relative to host)</span>
    <span class="c"># @param request_body The XML-RPC request body</span>
    <span class="c"># @param debug Enable debugging if debug is true.</span>
    <span class="c"># @return An HTTPConnection.</span>
</div>
<div class="viewcode-block" id="Transport.send_request"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.send_request">[docs]</a>    <span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">request_body</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_connection</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_headers</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">set_debuglevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_gzip_encoding</span> <span class="ow">and</span> <span class="n">gzip</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">putrequest</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">skip_accept_encoding</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&quot;Accept-Encoding&quot;</span><span class="p">,</span> <span class="s">&quot;gzip&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">putrequest</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s">&quot;text/xml&quot;</span><span class="p">))</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&quot;User-Agent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_headers</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_content</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">request_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">connection</span>

    <span class="c">##</span>
    <span class="c"># Send request headers.</span>
    <span class="c"># This function provides a useful hook for subclassing</span>
    <span class="c">#</span>
    <span class="c"># @param connection httpConnection.</span>
    <span class="c"># @param headers list of key,value pairs for HTTP headers</span>
</div>
<div class="viewcode-block" id="Transport.send_headers"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.send_headers">[docs]</a>    <span class="k">def</span> <span class="nf">send_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">putheader</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Send request body.</span>
    <span class="c"># This function provides a useful hook for subclassing</span>
    <span class="c">#</span>
    <span class="c"># @param connection httpConnection.</span>
    <span class="c"># @param request_body XML-RPC request body.</span>
</div>
<div class="viewcode-block" id="Transport.send_content"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.send_content">[docs]</a>    <span class="k">def</span> <span class="nf">send_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">request_body</span><span class="p">):</span>
        <span class="c">#optionally encode the request</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encode_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encode_threshold</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">gzip</span><span class="p">):</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">putheader</span><span class="p">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="p">,</span> <span class="s">&quot;gzip&quot;</span><span class="p">)</span>
            <span class="n">request_body</span> <span class="o">=</span> <span class="n">gzip_encode</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>

        <span class="n">connection</span><span class="o">.</span><span class="n">putheader</span><span class="p">(</span><span class="s">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">request_body</span><span class="p">)))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">endheaders</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>

    <span class="c">##</span>
    <span class="c"># Parse response.</span>
    <span class="c">#</span>
    <span class="c"># @param file Stream.</span>
    <span class="c"># @return Response tuple and target method.</span>
</div>
<div class="viewcode-block" id="Transport.parse_response"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.Transport.parse_response">[docs]</a>    <span class="k">def</span> <span class="nf">parse_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c"># read response data from httpresponse, and parse it</span>
        <span class="c"># Check for new http response object, otherwise it is a file object.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;getheader&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;gzip&quot;</span><span class="p">:</span>
                <span class="n">stream</span> <span class="o">=</span> <span class="n">GzipDecodedResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream</span> <span class="o">=</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">response</span>

        <span class="n">p</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getparser</span><span class="p">()</span>

        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;body:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c">##</span>
<span class="c"># Standard transport class for XML-RPC over HTTPS.</span>
</div></div>
<div class="viewcode-block" id="SafeTransport"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.SafeTransport">[docs]</a><span class="k">class</span> <span class="nc">SafeTransport</span><span class="p">(</span><span class="n">Transport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handles an HTTPS transaction to an XML-RPC server.&quot;&quot;&quot;</span>

    <span class="c"># FIXME: mostly untested</span>

<div class="viewcode-block" id="SafeTransport.make_connection"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.SafeTransport.make_connection">[docs]</a>    <span class="k">def</span> <span class="nf">make_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">and</span> <span class="n">host</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="s">&quot;HTTPSConnection&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s">&quot;your version of http.client doesn&#39;t support HTTPS&quot;</span><span class="p">)</span>
        <span class="c"># create a HTTPS connection object from a host descriptor</span>
        <span class="c"># host may be a string, or a (host, x509-dict) tuple</span>
        <span class="n">chost</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_headers</span><span class="p">,</span> <span class="n">x509</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_host_info</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPSConnection</span><span class="p">(</span><span class="n">chost</span><span class="p">,</span>
            <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">x509</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c">##</span>
<span class="c"># Standard server proxy.  This class establishes a virtual connection</span>
<span class="c"># to an XML-RPC server.</span>
<span class="c"># &lt;p&gt;</span>
<span class="c"># This class is available as ServerProxy and Server.  New code should</span>
<span class="c"># use ServerProxy, to avoid confusion.</span>
<span class="c">#</span>
<span class="c"># @def ServerProxy(uri, **options)</span>
<span class="c"># @param uri The connection point on the server.</span>
<span class="c"># @keyparam transport A transport factory, compatible with the</span>
<span class="c">#    standard transport class.</span>
<span class="c"># @keyparam encoding The default encoding used for 8-bit strings</span>
<span class="c">#    (default is UTF-8).</span>
<span class="c"># @keyparam verbose Use a true value to enable debugging output.</span>
<span class="c">#    (printed to standard output).</span>
<span class="c"># @see Transport</span>
</div></div>
<div class="viewcode-block" id="ServerProxy"><a class="viewcode-back" href="../../xmlrpc.html#xmlrpc.client.ServerProxy">[docs]</a><span class="k">class</span> <span class="nc">ServerProxy</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;uri [,options] -&gt; a logical connection to an XML-RPC server</span>

<span class="sd">    uri is the connection point on the server, given as</span>
<span class="sd">    scheme://host/target.</span>

<span class="sd">    The standard implementation always supports the &quot;http&quot; scheme.  If</span>
<span class="sd">    SSL socket support is available (Python 2.0), it also supports</span>
<span class="sd">    &quot;https&quot;.</span>

<span class="sd">    If the target part and the slash preceding it are both omitted,</span>
<span class="sd">    &quot;/RPC2&quot; is assumed.</span>

<span class="sd">    The following options can be given as keyword arguments:</span>

<span class="sd">        transport: a transport factory</span>
<span class="sd">        encoding: the request encoding (default is UTF-8)</span>

<span class="sd">    All 8-bit strings passed to the server proxy are assumed to use</span>
<span class="sd">    the given encoding.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">transport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_builtin_types</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># establish a &quot;logical&quot; server connection</span>

        <span class="c"># get the url</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">splittype</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="s">&quot;https&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&quot;unsupported XML-RPC protocol&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">splithost</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="s">&quot;/RPC2&quot;</span>

        <span class="k">if</span> <span class="n">transport</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;https&quot;</span><span class="p">:</span>
                <span class="n">handler</span> <span class="o">=</span> <span class="n">SafeTransport</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">handler</span> <span class="o">=</span> <span class="n">Transport</span>
            <span class="n">transport</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">use_datetime</span><span class="o">=</span><span class="n">use_datetime</span><span class="p">,</span>
                                <span class="n">use_builtin_types</span><span class="o">=</span><span class="n">use_builtin_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__transport</span> <span class="o">=</span> <span class="n">transport</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="ow">or</span> <span class="s">&#39;utf-8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>

    <span class="k">def</span> <span class="nf">__close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodname</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c"># call a method on the remote server</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">methodname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__encoding</span><span class="p">,</span>
                        <span class="n">allow_none</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__allow_none</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__encoding</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transport</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__host</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="p">,</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__verbose</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s">&quot;&lt;ServerProxy for </span><span class="si">%s%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c"># magic method dispatcher</span>
        <span class="k">return</span> <span class="n">_Method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__request</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c"># note: to call a remote object with an non-standard name, use</span>
    <span class="c"># result getattr(server, &quot;strange-python-name&quot;)(args)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A workaround to get special attributes on the ServerProxy</span>
<span class="sd">           without interfering with the magic __getattr__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;close&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__close</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;transport&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transport</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Attribute </span><span class="si">%r</span><span class="s"> not found&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,))</span>

<span class="c"># compatibility</span>
</div>
<span class="n">Server</span> <span class="o">=</span> <span class="n">ServerProxy</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># test code</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c"># simple test program (from the XML-RPC specification)</span>

    <span class="c"># local server, available from Lib/xmlrpc/server.py</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">ServerProxy</span><span class="p">(</span><span class="s">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">currentTime</span><span class="o">.</span><span class="n">getCurrentTime</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiCall</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">multi</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>