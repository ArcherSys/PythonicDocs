

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>webbrowser &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>webbrowser</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for webbrowser</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;Interfaces for launching and remotely controlling Web browsers.&quot;&quot;&quot;</span>
<span class="c"># Maintained by Georg Brandl.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="s">&quot;open&quot;</span><span class="p">,</span> <span class="s">&quot;open_new&quot;</span><span class="p">,</span> <span class="s">&quot;open_new_tab&quot;</span><span class="p">,</span> <span class="s">&quot;get&quot;</span><span class="p">,</span> <span class="s">&quot;register&quot;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">_browsers</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c"># Dictionary of available browser controllers</span>
<span class="n">_tryorder</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c"># Preference order of available browsers</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">update_tryorder</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a browser connector and, optionally, connection.&quot;&quot;&quot;</span>
    <span class="n">_browsers</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">klass</span><span class="p">,</span> <span class="n">instance</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">update_tryorder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_tryorder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">update_tryorder</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_tryorder</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a browser launcher instance appropriate for the environment.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">using</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="p">[</span><span class="n">using</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="n">_tryorder</span>
    <span class="k">for</span> <span class="n">browser</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">browser</span><span class="p">:</span>
            <span class="c"># User gave us a command line, split it into name and args</span>
            <span class="n">browser</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">browser</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&amp;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="n">browser</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GenericBrowser</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># User gave us a browser name or path.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="n">_browsers</span><span class="p">[</span><span class="n">browser</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="n">_synthesize</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span>
    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;could not locate runnable browser&quot;</span><span class="p">)</span>

<span class="c"># Please note: the following definition hides a builtin function.</span>
<span class="c"># It is recommended one does &quot;import webbrowser&quot; and uses webbrowser.open(url)</span>
<span class="c"># instead of &quot;from webbrowser import *&quot;.</span>

<span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_tryorder</span><span class="p">:</span>
        <span class="n">browser</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">browser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">autoraise</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">open_new</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">open_new_tab</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_synthesize</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">update_tryorder</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Attempt to synthesize a controller base on existing controllers.</span>

<span class="sd">    This is useful to create a controller when a user specifies a path to</span>
<span class="sd">    an entry in the BROWSER environment variable -- we can copy a general</span>
<span class="sd">    controller to operate using a specific installation of the desired</span>
<span class="sd">    browser in this way.</span>

<span class="sd">    If we can&#39;t create a controller in this way, or if there is no</span>
<span class="sd">    executable for the requested browser, return [None, None].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">_browsers</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="c"># now attempt to clone to fit the new name:</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">controller</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">controller</span><span class="o">.</span><span class="n">basename</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">copy</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">browser</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
        <span class="n">register</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">update_tryorder</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="n">controller</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>


<span class="c"># General parent classes</span>

<span class="k">class</span> <span class="nc">BaseBrowser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parent class for all browsers. Do not use directly.&quot;&quot;&quot;</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">open_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_new_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GenericBrowser</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for all browsers started with a command</span>
<span class="sd">       and without remote functionality.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># name should be a list with arguments</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;win&#39;</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">BackgroundBrowser</span><span class="p">(</span><span class="n">GenericBrowser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for all browsers which are to be started in the</span>
<span class="sd">       background.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;win&#39;</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">start_new_session</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">UnixBrowser</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parent class for all Unix browsers with remote functionality.&quot;&quot;&quot;</span>

    <span class="n">raise_opts</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">redirect_stdout</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c"># In remote_args, %s will be replaced with the requested URL.  %action will</span>
    <span class="c"># be replaced depending on the value of &#39;new&#39; passed to open.</span>
    <span class="c"># remote_action is used for new=0 (open).  If newwin is not None, it is</span>
    <span class="c"># used for new=1 (open_new).  If newtab is not None, it is used for</span>
    <span class="c"># new=3 (open_new_tab).  After both substitutions are made, any empty</span>
    <span class="c"># strings in the transformed remote_args list will be removed.</span>
    <span class="n">remote_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;%action&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span>
    <span class="n">remote_action</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">remote_action_newwin</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">remote_action_newtab</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">autoraise</span><span class="p">):</span>
        <span class="n">raise_opt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">remote</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_opts</span><span class="p">:</span>
            <span class="c"># use autoraise argument only for remote invocation</span>
            <span class="n">autoraise</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">autoraise</span><span class="p">)</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_opts</span><span class="p">[</span><span class="n">autoraise</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">opt</span><span class="p">:</span> <span class="n">raise_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">opt</span><span class="p">]</span>

        <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">raise_opt</span> <span class="o">+</span> <span class="n">args</span>

        <span class="k">if</span> <span class="n">remote</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
            <span class="n">inout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># for TTY browsers, we need stdin/out</span>
            <span class="n">inout</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">inout</span><span class="p">,</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redirect_stdout</span> <span class="ow">and</span> <span class="n">inout</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">),</span>
                             <span class="n">stderr</span><span class="o">=</span><span class="n">inout</span><span class="p">,</span> <span class="n">start_new_session</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remote</span><span class="p">:</span>
            <span class="c"># wait at most five seconds. If the subprocess is not finished, the</span>
            <span class="c"># remote invocation has (hopefully) started a new instance.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rc</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="c"># if remote call failed, open() will try direct invocation</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="n">rc</span>
            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">new</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_action</span>
        <span class="k">elif</span> <span class="n">new</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_action_newwin</span>
        <span class="k">elif</span> <span class="n">new</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_action_newtab</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_action_newwin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_action_newtab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;Bad &#39;new&#39; parameter to open(); &quot;</span> <span class="o">+</span>
                        <span class="s">&quot;expected 0, 1, or 2, got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">new</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;%action&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_args</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">arg</span><span class="p">]</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invoke</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">autoraise</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="c"># remote invocation failed, try straight way</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invoke</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>


<span class="k">class</span> <span class="nc">Mozilla</span><span class="p">(</span><span class="n">UnixBrowser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Launcher class for Mozilla/Netscape browsers.&quot;&quot;&quot;</span>

    <span class="n">raise_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-noraise&quot;</span><span class="p">,</span> <span class="s">&quot;-raise&quot;</span><span class="p">]</span>
    <span class="n">remote_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-remote&#39;</span><span class="p">,</span> <span class="s">&#39;openURL(</span><span class="si">%s</span><span class="s">%action)&#39;</span><span class="p">]</span>
    <span class="n">remote_action</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">remote_action_newwin</span> <span class="o">=</span> <span class="s">&quot;,new-window&quot;</span>
    <span class="n">remote_action_newtab</span> <span class="o">=</span> <span class="s">&quot;,new-tab&quot;</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">Netscape</span> <span class="o">=</span> <span class="n">Mozilla</span>


<span class="k">class</span> <span class="nc">Galeon</span><span class="p">(</span><span class="n">UnixBrowser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Launcher class for Galeon/Epiphany browsers.&quot;&quot;&quot;</span>

    <span class="n">raise_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-noraise&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">]</span>
    <span class="n">remote_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;%action&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span>
    <span class="n">remote_action</span> <span class="o">=</span> <span class="s">&quot;-n&quot;</span>
    <span class="n">remote_action_newwin</span> <span class="o">=</span> <span class="s">&quot;-w&quot;</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">True</span>


<span class="k">class</span> <span class="nc">Chrome</span><span class="p">(</span><span class="n">UnixBrowser</span><span class="p">):</span>
    <span class="s">&quot;Launcher class for Google Chrome browser.&quot;</span>

    <span class="n">remote_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;%action&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span>
    <span class="n">remote_action</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">remote_action_newwin</span> <span class="o">=</span> <span class="s">&quot;--new-window&quot;</span>
    <span class="n">remote_action_newtab</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">Chromium</span> <span class="o">=</span> <span class="n">Chrome</span>


<span class="k">class</span> <span class="nc">Opera</span><span class="p">(</span><span class="n">UnixBrowser</span><span class="p">):</span>
    <span class="s">&quot;Launcher class for Opera browser.&quot;</span>

    <span class="n">raise_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-noraise&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">]</span>
    <span class="n">remote_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-remote&#39;</span><span class="p">,</span> <span class="s">&#39;openURL(</span><span class="si">%s</span><span class="s">%action)&#39;</span><span class="p">]</span>
    <span class="n">remote_action</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">remote_action_newwin</span> <span class="o">=</span> <span class="s">&quot;,new-window&quot;</span>
    <span class="n">remote_action_newtab</span> <span class="o">=</span> <span class="s">&quot;,new-page&quot;</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">True</span>


<span class="k">class</span> <span class="nc">Elinks</span><span class="p">(</span><span class="n">UnixBrowser</span><span class="p">):</span>
    <span class="s">&quot;Launcher class for Elinks browsers.&quot;</span>

    <span class="n">remote_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-remote&#39;</span><span class="p">,</span> <span class="s">&#39;openURL(</span><span class="si">%s</span><span class="s">%action)&#39;</span><span class="p">]</span>
    <span class="n">remote_action</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">remote_action_newwin</span> <span class="o">=</span> <span class="s">&quot;,new-window&quot;</span>
    <span class="n">remote_action_newtab</span> <span class="o">=</span> <span class="s">&quot;,new-tab&quot;</span>
    <span class="n">background</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># elinks doesn&#39;t like its stdout to be redirected -</span>
    <span class="c"># it uses redirected stdout as a signal to do -dump</span>
    <span class="n">redirect_stdout</span> <span class="o">=</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">Konqueror</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Controller for the KDE File Manager (kfm, or Konqueror).</span>

<span class="sd">    See the output of ``kfmclient --commands``</span>
<span class="sd">    for more information on the Konqueror remote-control interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># XXX Currently I know no way to prevent KFM from opening a new win.</span>
        <span class="k">if</span> <span class="n">new</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s">&quot;newTab&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s">&quot;openURL&quot;</span>

        <span class="n">devnull</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&quot;kfmclient&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">url</span><span class="p">],</span>
                                 <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span>
                                 <span class="n">stdout</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">devnull</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c"># fall through to next variant</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="c"># kfmclient&#39;s return code unfortunately has no meaning as it seems</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&quot;konqueror&quot;</span><span class="p">,</span> <span class="s">&quot;--silent&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">],</span>
                                 <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span>
                                 <span class="n">stdout</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span>
                                 <span class="n">start_new_session</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c"># fall through to next variant</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Should be running now.</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&quot;kfm&quot;</span><span class="p">,</span> <span class="s">&quot;-d&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">],</span>
                                 <span class="n">close_fds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span>
                                 <span class="n">stdout</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">devnull</span><span class="p">,</span>
                                 <span class="n">start_new_session</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Grail</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
    <span class="c"># There should be a way to maintain a connection to Grail, but the</span>
    <span class="c"># Grail remote control protocol doesn&#39;t really allow that at this</span>
    <span class="c"># point.  It probably never will!</span>
    <span class="k">def</span> <span class="nf">_find_grail_rc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">glob</span>
        <span class="kn">import</span> <span class="nn">pwd</span>
        <span class="kn">import</span> <span class="nn">socket</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
                               <span class="s">&quot;.grail-unix&quot;</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwuid</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">user</span> <span class="o">+</span> <span class="s">&quot;-*&quot;</span><span class="p">)</span>
        <span class="n">maybes</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">maybes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">maybes</span><span class="p">:</span>
            <span class="c"># need to PING each one until we find one that&#39;s live</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c"># no good; attempt to clean it out, but don&#39;t fail:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_grail_rc</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="s">&quot;LOADNEW &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="s">&quot;LOAD &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ok</span>


<span class="c">#</span>
<span class="c"># Platform support for Unix</span>
<span class="c">#</span>

<span class="c"># These are the right tests because all these Unix browsers require either</span>
<span class="c"># a console terminal or an X display to run.</span>

<span class="k">def</span> <span class="nf">register_X_browsers</span><span class="p">():</span>

    <span class="c"># use xdg-open if around</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;xdg-open&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;xdg-open&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="s">&quot;xdg-open&quot;</span><span class="p">))</span>

    <span class="c"># The default GNOME3 browser</span>
    <span class="k">if</span> <span class="s">&quot;GNOME_DESKTOP_SESSION_ID&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;gvfs-open&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;gvfs-open&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="s">&quot;gvfs-open&quot;</span><span class="p">))</span>

    <span class="c"># The default GNOME browser</span>
    <span class="k">if</span> <span class="s">&quot;GNOME_DESKTOP_SESSION_ID&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;gnome-open&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;gnome-open&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="s">&quot;gnome-open&quot;</span><span class="p">))</span>

    <span class="c"># The default KDE browser</span>
    <span class="k">if</span> <span class="s">&quot;KDE_FULL_SESSION&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;kfmclient&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;kfmclient&quot;</span><span class="p">,</span> <span class="n">Konqueror</span><span class="p">,</span> <span class="n">Konqueror</span><span class="p">(</span><span class="s">&quot;kfmclient&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;x-www-browser&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;x-www-browser&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="s">&quot;x-www-browser&quot;</span><span class="p">))</span>

    <span class="c"># The Mozilla/Netscape browsers</span>
    <span class="k">for</span> <span class="n">browser</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;mozilla-firefox&quot;</span><span class="p">,</span> <span class="s">&quot;firefox&quot;</span><span class="p">,</span>
                    <span class="s">&quot;mozilla-firebird&quot;</span><span class="p">,</span> <span class="s">&quot;firebird&quot;</span><span class="p">,</span>
                    <span class="s">&quot;iceweasel&quot;</span><span class="p">,</span> <span class="s">&quot;iceape&quot;</span><span class="p">,</span>
                    <span class="s">&quot;seamonkey&quot;</span><span class="p">,</span> <span class="s">&quot;mozilla&quot;</span><span class="p">,</span> <span class="s">&quot;netscape&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">browser</span><span class="p">):</span>
            <span class="n">register</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Mozilla</span><span class="p">(</span><span class="n">browser</span><span class="p">))</span>

    <span class="c"># Konqueror/kfm, the KDE browser.</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;kfm&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;kfm&quot;</span><span class="p">,</span> <span class="n">Konqueror</span><span class="p">,</span> <span class="n">Konqueror</span><span class="p">(</span><span class="s">&quot;kfm&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;konqueror&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;konqueror&quot;</span><span class="p">,</span> <span class="n">Konqueror</span><span class="p">,</span> <span class="n">Konqueror</span><span class="p">(</span><span class="s">&quot;konqueror&quot;</span><span class="p">))</span>

    <span class="c"># Gnome&#39;s Galeon and Epiphany</span>
    <span class="k">for</span> <span class="n">browser</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;galeon&quot;</span><span class="p">,</span> <span class="s">&quot;epiphany&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">browser</span><span class="p">):</span>
            <span class="n">register</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Galeon</span><span class="p">(</span><span class="n">browser</span><span class="p">))</span>

    <span class="c"># Skipstone, another Gtk/Mozilla based browser</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;skipstone&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;skipstone&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="s">&quot;skipstone&quot;</span><span class="p">))</span>

    <span class="c"># Google Chrome/Chromium browsers</span>
    <span class="k">for</span> <span class="n">browser</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;google-chrome&quot;</span><span class="p">,</span> <span class="s">&quot;chrome&quot;</span><span class="p">,</span> <span class="s">&quot;chromium&quot;</span><span class="p">,</span> <span class="s">&quot;chromium-browser&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">browser</span><span class="p">):</span>
            <span class="n">register</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Chrome</span><span class="p">(</span><span class="n">browser</span><span class="p">))</span>

    <span class="c"># Opera, quite popular</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;opera&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;opera&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Opera</span><span class="p">(</span><span class="s">&quot;opera&quot;</span><span class="p">))</span>

    <span class="c"># Next, Mosaic -- old but still in use.</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;mosaic&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;mosaic&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="s">&quot;mosaic&quot;</span><span class="p">))</span>

    <span class="c"># Grail, the Python browser. Does anybody still use it?</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;grail&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;grail&quot;</span><span class="p">,</span> <span class="n">Grail</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="c"># Prefer X browsers if present</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;DISPLAY&quot;</span><span class="p">):</span>
    <span class="n">register_X_browsers</span><span class="p">()</span>

<span class="c"># Also try console browsers</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;TERM&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;www-browser&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;www-browser&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">GenericBrowser</span><span class="p">(</span><span class="s">&quot;www-browser&quot;</span><span class="p">))</span>
    <span class="c"># The Links/elinks browsers &lt;http://artax.karlin.mff.cuni.cz/~mikulas/links/&gt;</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;links&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;links&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">GenericBrowser</span><span class="p">(</span><span class="s">&quot;links&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;elinks&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;elinks&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Elinks</span><span class="p">(</span><span class="s">&quot;elinks&quot;</span><span class="p">))</span>
    <span class="c"># The Lynx browser &lt;http://lynx.isc.org/&gt;, &lt;http://lynx.browser.org/&gt;</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;lynx&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;lynx&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">GenericBrowser</span><span class="p">(</span><span class="s">&quot;lynx&quot;</span><span class="p">))</span>
    <span class="c"># The w3m browser &lt;http://w3m.sourceforge.net/&gt;</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s">&quot;w3m&quot;</span><span class="p">):</span>
        <span class="n">register</span><span class="p">(</span><span class="s">&quot;w3m&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">GenericBrowser</span><span class="p">(</span><span class="s">&quot;w3m&quot;</span><span class="p">))</span>

<span class="c">#</span>
<span class="c"># Platform support for Windows</span>
<span class="c">#</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;win&quot;</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">WindowsDefault</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c"># [Error 22] No application is associated with the specified</span>
                <span class="c"># file for this operation: &#39;&lt;URL&gt;&#39;</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>

    <span class="n">_tryorder</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_browsers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># First try to use the default Windows browser</span>
    <span class="n">register</span><span class="p">(</span><span class="s">&quot;windows-default&quot;</span><span class="p">,</span> <span class="n">WindowsDefault</span><span class="p">)</span>

    <span class="c"># Detect some common Windows browsers, fallback to IE</span>
    <span class="n">iexplore</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;PROGRAMFILES&quot;</span><span class="p">,</span> <span class="s">&quot;C:</span><span class="se">\\</span><span class="s">Program Files&quot;</span><span class="p">),</span>
                            <span class="s">&quot;Internet Explorer</span><span class="se">\\</span><span class="s">IEXPLORE.EXE&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">browser</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;firefox&quot;</span><span class="p">,</span> <span class="s">&quot;firebird&quot;</span><span class="p">,</span> <span class="s">&quot;seamonkey&quot;</span><span class="p">,</span> <span class="s">&quot;mozilla&quot;</span><span class="p">,</span>
                    <span class="s">&quot;netscape&quot;</span><span class="p">,</span> <span class="s">&quot;opera&quot;</span><span class="p">,</span> <span class="n">iexplore</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">browser</span><span class="p">):</span>
            <span class="n">register</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">BackgroundBrowser</span><span class="p">(</span><span class="n">browser</span><span class="p">))</span>

<span class="c">#</span>
<span class="c"># Platform support for MacOS</span>
<span class="c">#</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">:</span>
    <span class="c"># Adapted from patch submitted to SourceForge by Steven J. Burr</span>
    <span class="k">class</span> <span class="nc">MacOSX</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launcher class for Aqua browsers on Mac OS X</span>

<span class="sd">        Optionally specify a browser name on instantiation.  Note that this</span>
<span class="sd">        will not work for Aqua browsers if the user has moved the application</span>
<span class="sd">        package after installation.</span>

<span class="sd">        If no browser is specified, the default browser, as specified in the</span>
<span class="sd">        Internet System Preferences panel, will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">assert</span> <span class="s">&quot;&#39;&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span>
            <span class="c"># hack for local urls</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;file:&#39;</span><span class="o">+</span><span class="n">url</span>

            <span class="c"># new must be 0 or 1</span>
            <span class="n">new</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;default&quot;</span><span class="p">:</span>
                <span class="c"># User called open, open_new or get without a browser parameter</span>
                <span class="n">script</span> <span class="o">=</span> <span class="s">&#39;open location &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;%22&#39;</span><span class="p">)</span> <span class="c"># opens in default browser</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># User called get and chose a browser</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;OmniWeb&quot;</span><span class="p">:</span>
                    <span class="n">toWindow</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Include toWindow parameter of OpenURL command for browsers</span>
                    <span class="c"># that support it.  0 == new window; -1 == existing</span>
                    <span class="n">toWindow</span> <span class="o">=</span> <span class="s">&quot;toWindow </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;OpenURL &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;%22&#39;</span><span class="p">)</span>
                <span class="n">script</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;tell application &quot;</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="s">                                activate</span>
<span class="s">                                </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"></span>
<span class="s">                            end tell&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">toWindow</span><span class="p">)</span>
            <span class="c"># Open pipe to AppleScript through osascript command</span>
            <span class="n">osapipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;osascript&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">osapipe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="c"># Write script to osascript&#39;s stdin</span>
            <span class="n">osapipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="n">osapipe</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">rc</span>

    <span class="k">class</span> <span class="nc">MacOSXOSAScript</span><span class="p">(</span><span class="n">BaseBrowser</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="s">&#39;default&#39;</span><span class="p">:</span>
                <span class="n">script</span> <span class="o">=</span> <span class="s">&#39;open location &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;%22&#39;</span><span class="p">)</span> <span class="c"># opens in default browser</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">script</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">                   tell application &quot;</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="s">                       activate</span>
<span class="s">                       open location &quot;</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="s">                   end</span>
<span class="s">                   &#39;&#39;&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;%22&#39;</span><span class="p">))</span>

            <span class="n">osapipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;osascript&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">osapipe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="n">osapipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="n">osapipe</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">rc</span>


    <span class="c"># Don&#39;t clear _tryorder or _browsers since OS X can use above Unix support</span>
    <span class="c"># (but we prefer using the OS X specific stuff)</span>
    <span class="n">register</span><span class="p">(</span><span class="s">&quot;safari&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">MacOSXOSAScript</span><span class="p">(</span><span class="s">&#39;safari&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">register</span><span class="p">(</span><span class="s">&quot;firefox&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">MacOSXOSAScript</span><span class="p">(</span><span class="s">&#39;firefox&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">register</span><span class="p">(</span><span class="s">&quot;MacOSX&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">MacOSXOSAScript</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="c"># OK, now that we know what the default preference orders for each</span>
<span class="c"># platform are, allow user to override them with the BROWSER variable.</span>
<span class="k">if</span> <span class="s">&quot;BROWSER&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">_userchoices</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;BROWSER&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
    <span class="n">_userchoices</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="c"># Treat choices in same way as if passed into get() but do register</span>
    <span class="c"># and prepend to _tryorder</span>
    <span class="k">for</span> <span class="n">cmdline</span> <span class="ow">in</span> <span class="n">_userchoices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cmdline</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">_synthesize</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">register</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">GenericBrowser</span><span class="p">(</span><span class="n">cmdline</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># to make del work if _userchoices was empty</span>
    <span class="k">del</span> <span class="n">cmdline</span>
    <span class="k">del</span> <span class="n">_userchoices</span>

<span class="c"># what to do if _tryorder is now empty?</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">getopt</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Usage: </span><span class="si">%s</span><span class="s"> [-n | -t] url</span>
<span class="s">    -n: open new window</span>
<span class="s">    -t: open new tab&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&#39;ntd&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">new_win</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="s">&#39;-n&#39;</span><span class="p">:</span> <span class="n">new_win</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">o</span> <span class="o">==</span> <span class="s">&#39;-t&#39;</span><span class="p">:</span> <span class="n">new_win</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">new_win</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\a</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>