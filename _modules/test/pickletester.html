

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.pickletester &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.pickletester</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.pickletester</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">copyreg</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">pickletools</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">http.cookies</span> <span class="kn">import</span> <span class="n">SimpleCookie</span>

<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TestFailed</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="n">run_with_locale</span><span class="p">,</span> <span class="n">no_tracing</span><span class="p">,</span>
    <span class="n">_2G</span><span class="p">,</span> <span class="n">_4G</span><span class="p">,</span> <span class="n">bigmemtest</span><span class="p">,</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">pickle</span> <span class="kn">import</span> <span class="n">bytes_types</span>

<span class="c"># Tests that try a number of pickle protocols should have a</span>
<span class="c">#     for proto in protocols:</span>
<span class="c"># kind of outer loop.</span>
<span class="n">protocols</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="c"># Return True if opcode code appears in the pickle, else False.</span>
<div class="viewcode-block" id="opcode_in_pickle"><a class="viewcode-back" href="../../test.html#test.pickletester.opcode_in_pickle">[docs]</a><span class="k">def</span> <span class="nf">opcode_in_pickle</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">pickle</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="o">.</span><span class="n">genops</span><span class="p">(</span><span class="n">pickle</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c"># Return the number of times opcode code appears in pickle.</span></div>
<div class="viewcode-block" id="count_opcode"><a class="viewcode-back" href="../../test.html#test.pickletester.count_opcode">[docs]</a><span class="k">def</span> <span class="nf">count_opcode</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">pickle</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="o">.</span><span class="n">genops</span><span class="p">(</span><span class="n">pickle</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span>

</div>
<div class="viewcode-block" id="UnseekableIO"><a class="viewcode-back" href="../../test.html#test.pickletester.UnseekableIO">[docs]</a><span class="k">class</span> <span class="nc">UnseekableIO</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">):</span>
<div class="viewcode-block" id="UnseekableIO.peek"><a class="viewcode-back" href="../../test.html#test.pickletester.UnseekableIO.peek">[docs]</a>    <span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="UnseekableIO.seekable"><a class="viewcode-back" href="../../test.html#test.pickletester.UnseekableIO.seekable">[docs]</a>    <span class="k">def</span> <span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="UnseekableIO.seek"><a class="viewcode-back" href="../../test.html#test.pickletester.UnseekableIO.seek">[docs]</a>    <span class="k">def</span> <span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span>
</div>
<div class="viewcode-block" id="UnseekableIO.tell"><a class="viewcode-back" href="../../test.html#test.pickletester.UnseekableIO.tell">[docs]</a>    <span class="k">def</span> <span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span>


<span class="c"># We can&#39;t very well test the extension registry without putting known stuff</span>
<span class="c"># in it, but we have to be careful to restore its original state.  Code</span>
<span class="c"># should do this:</span>
<span class="c">#</span>
<span class="c">#     e = ExtensionSaver(extension_code)</span>
<span class="c">#     try:</span>
<span class="c">#         fiddle w/ the extension registry&#39;s stuff for extension_code</span>
<span class="c">#     finally:</span>
<span class="c">#         e.restore()</span>
</div></div>
<div class="viewcode-block" id="ExtensionSaver"><a class="viewcode-back" href="../../test.html#test.pickletester.ExtensionSaver">[docs]</a><span class="k">class</span> <span class="nc">ExtensionSaver</span><span class="p">:</span>
    <span class="c"># Remember current registration for code (if any), and remove it (if</span>
    <span class="c"># there is one).</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">copyreg</span><span class="o">.</span><span class="n">_inverted_registry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="n">copyreg</span><span class="o">.</span><span class="n">_inverted_registry</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
            <span class="n">copyreg</span><span class="o">.</span><span class="n">remove_extension</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pair</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Restore previous registration for code.</span>
<div class="viewcode-block" id="ExtensionSaver.restore"><a class="viewcode-back" href="../../test.html#test.pickletester.ExtensionSaver.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="n">curpair</span> <span class="o">=</span> <span class="n">copyreg</span><span class="o">.</span><span class="n">_inverted_registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curpair</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">copyreg</span><span class="o">.</span><span class="n">remove_extension</span><span class="p">(</span><span class="n">curpair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">curpair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">code</span><span class="p">)</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pair</span>
        <span class="k">if</span> <span class="n">pair</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">copyreg</span><span class="o">.</span><span class="n">add_extension</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">code</span><span class="p">)</span>
</div></div>
<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getinitargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>

<span class="k">class</span> <span class="nc">H</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">__main__</span>
<span class="n">__main__</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
<span class="n">C</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="s">&quot;__main__&quot;</span>
<span class="n">__main__</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
<span class="n">D</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="s">&quot;__main__&quot;</span>
<span class="n">__main__</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
<span class="n">E</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="s">&quot;__main__&quot;</span>
<span class="n">__main__</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
<span class="n">H</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="s">&quot;__main__&quot;</span>

<div class="viewcode-block" id="myint"><a class="viewcode-back" href="../../test.html#test.pickletester.myint">[docs]</a><span class="k">class</span> <span class="nc">myint</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="initarg"><a class="viewcode-back" href="../../test.html#test.pickletester.initarg">[docs]</a><span class="k">class</span> <span class="nc">initarg</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">__getinitargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
</div>
<div class="viewcode-block" id="metaclass"><a class="viewcode-back" href="../../test.html#test.pickletester.metaclass">[docs]</a><span class="k">class</span> <span class="nc">metaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="use_metaclass"><a class="viewcode-back" href="../../test.html#test.pickletester.use_metaclass">[docs]</a><span class="k">class</span> <span class="nc">use_metaclass</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">metaclass</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="pickling_metaclass"><a class="viewcode-back" href="../../test.html#test.pickletester.pickling_metaclass">[docs]</a><span class="k">class</span> <span class="nc">pickling_metaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reduce_args</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">reduce_args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">create_dynamic_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="create_dynamic_class"><a class="viewcode-back" href="../../test.html#test.pickletester.create_dynamic_class">[docs]</a><span class="k">def</span> <span class="nf">create_dynamic_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pickling_metaclass</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
    <span class="n">result</span><span class="o">.</span><span class="n">reduce_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c"># DATA0 .. DATA2 are the pickles we expect under the various protocols, for</span>
<span class="c"># the object returned by create_data().</span>
</div>
<span class="n">DATA0</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">b</span><span class="s">&#39;(lp0</span><span class="se">\n</span><span class="s">L0L</span><span class="se">\n</span><span class="s">aL1L</span><span class="se">\n</span><span class="s">aF2.0</span><span class="se">\n</span><span class="s">ac&#39;</span>
    <span class="n">b</span><span class="s">&#39;builtins</span><span class="se">\n</span><span class="s">complex</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;p1</span><span class="se">\n</span><span class="s">(F3.0</span><span class="se">\n</span><span class="s">F0.0</span><span class="se">\n</span><span class="s">tp2</span><span class="se">\n</span><span class="s">Rp&#39;</span>
    <span class="n">b</span><span class="s">&#39;3</span><span class="se">\n</span><span class="s">aL1L</span><span class="se">\n</span><span class="s">aL-1L</span><span class="se">\n</span><span class="s">aL255L</span><span class="se">\n</span><span class="s">aL-&#39;</span>
    <span class="n">b</span><span class="s">&#39;255L</span><span class="se">\n</span><span class="s">aL-256L</span><span class="se">\n</span><span class="s">aL65535L</span><span class="se">\n</span><span class="s">a&#39;</span>
    <span class="n">b</span><span class="s">&#39;L-65535L</span><span class="se">\n</span><span class="s">aL-65536L</span><span class="se">\n</span><span class="s">aL2&#39;</span>
    <span class="n">b</span><span class="s">&#39;147483647L</span><span class="se">\n</span><span class="s">aL-2147483&#39;</span>
    <span class="n">b</span><span class="s">&#39;647L</span><span class="se">\n</span><span class="s">aL-2147483648L</span><span class="se">\n</span><span class="s">a(&#39;</span>
    <span class="n">b</span><span class="s">&#39;Vabc</span><span class="se">\n</span><span class="s">p4</span><span class="se">\n</span><span class="s">g4</span><span class="se">\n</span><span class="s">ccopyreg&#39;</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">_reconstructor</span><span class="se">\n</span><span class="s">p5</span><span class="se">\n</span><span class="s">(&#39;</span>
    <span class="n">b</span><span class="s">&#39;c__main__</span><span class="se">\n</span><span class="s">C</span><span class="se">\n</span><span class="s">p6</span><span class="se">\n</span><span class="s">cbu&#39;</span>
    <span class="n">b</span><span class="s">&#39;iltins</span><span class="se">\n</span><span class="s">object</span><span class="se">\n</span><span class="s">p7</span><span class="se">\n</span><span class="s">Nt&#39;</span>
    <span class="n">b</span><span class="s">&#39;p8</span><span class="se">\n</span><span class="s">Rp9</span><span class="se">\n</span><span class="s">(dp10</span><span class="se">\n</span><span class="s">Vfoo</span><span class="se">\n</span><span class="s">p1&#39;</span>
    <span class="n">b</span><span class="s">&#39;1</span><span class="se">\n</span><span class="s">L1L</span><span class="se">\n</span><span class="s">sVbar</span><span class="se">\n</span><span class="s">p12</span><span class="se">\n</span><span class="s">L2L</span><span class="se">\n</span><span class="s">sb&#39;</span>
    <span class="n">b</span><span class="s">&#39;g9</span><span class="se">\n</span><span class="s">tp13</span><span class="se">\n</span><span class="s">ag13</span><span class="se">\n</span><span class="s">aL5L</span><span class="se">\n</span><span class="s">a.&#39;</span>
<span class="p">)</span>

<span class="c"># Disassembly of DATA0</span>
<span class="n">DATA0_DIS</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">    0: (    MARK</span>
<span class="s">    1: l        LIST       (MARK at 0)</span>
<span class="s">    2: p    PUT        0</span>
<span class="s">    5: L    LONG       0</span>
<span class="s">    9: a    APPEND</span>
<span class="s">   10: L    LONG       1</span>
<span class="s">   14: a    APPEND</span>
<span class="s">   15: F    FLOAT      2.0</span>
<span class="s">   20: a    APPEND</span>
<span class="s">   21: c    GLOBAL     &#39;builtins complex&#39;</span>
<span class="s">   39: p    PUT        1</span>
<span class="s">   42: (    MARK</span>
<span class="s">   43: F        FLOAT      3.0</span>
<span class="s">   48: F        FLOAT      0.0</span>
<span class="s">   53: t        TUPLE      (MARK at 42)</span>
<span class="s">   54: p    PUT        2</span>
<span class="s">   57: R    REDUCE</span>
<span class="s">   58: p    PUT        3</span>
<span class="s">   61: a    APPEND</span>
<span class="s">   62: L    LONG       1</span>
<span class="s">   66: a    APPEND</span>
<span class="s">   67: L    LONG       -1</span>
<span class="s">   72: a    APPEND</span>
<span class="s">   73: L    LONG       255</span>
<span class="s">   79: a    APPEND</span>
<span class="s">   80: L    LONG       -255</span>
<span class="s">   87: a    APPEND</span>
<span class="s">   88: L    LONG       -256</span>
<span class="s">   95: a    APPEND</span>
<span class="s">   96: L    LONG       65535</span>
<span class="s">  104: a    APPEND</span>
<span class="s">  105: L    LONG       -65535</span>
<span class="s">  114: a    APPEND</span>
<span class="s">  115: L    LONG       -65536</span>
<span class="s">  124: a    APPEND</span>
<span class="s">  125: L    LONG       2147483647</span>
<span class="s">  138: a    APPEND</span>
<span class="s">  139: L    LONG       -2147483647</span>
<span class="s">  153: a    APPEND</span>
<span class="s">  154: L    LONG       -2147483648</span>
<span class="s">  168: a    APPEND</span>
<span class="s">  169: (    MARK</span>
<span class="s">  170: V        UNICODE    &#39;abc&#39;</span>
<span class="s">  175: p        PUT        4</span>
<span class="s">  178: g        GET        4</span>
<span class="s">  181: c        GLOBAL     &#39;copyreg _reconstructor&#39;</span>
<span class="s">  205: p        PUT        5</span>
<span class="s">  208: (        MARK</span>
<span class="s">  209: c            GLOBAL     &#39;__main__ C&#39;</span>
<span class="s">  221: p            PUT        6</span>
<span class="s">  224: c            GLOBAL     &#39;builtins object&#39;</span>
<span class="s">  241: p            PUT        7</span>
<span class="s">  244: N            NONE</span>
<span class="s">  245: t            TUPLE      (MARK at 208)</span>
<span class="s">  246: p        PUT        8</span>
<span class="s">  249: R        REDUCE</span>
<span class="s">  250: p        PUT        9</span>
<span class="s">  253: (        MARK</span>
<span class="s">  254: d            DICT       (MARK at 253)</span>
<span class="s">  255: p        PUT        10</span>
<span class="s">  259: V        UNICODE    &#39;foo&#39;</span>
<span class="s">  264: p        PUT        11</span>
<span class="s">  268: L        LONG       1</span>
<span class="s">  272: s        SETITEM</span>
<span class="s">  273: V        UNICODE    &#39;bar&#39;</span>
<span class="s">  278: p        PUT        12</span>
<span class="s">  282: L        LONG       2</span>
<span class="s">  286: s        SETITEM</span>
<span class="s">  287: b        BUILD</span>
<span class="s">  288: g        GET        9</span>
<span class="s">  291: t        TUPLE      (MARK at 169)</span>
<span class="s">  292: p    PUT        13</span>
<span class="s">  296: a    APPEND</span>
<span class="s">  297: g    GET        13</span>
<span class="s">  301: a    APPEND</span>
<span class="s">  302: L    LONG       5</span>
<span class="s">  306: a    APPEND</span>
<span class="s">  307: .    STOP</span>
<span class="s">highest protocol among opcodes = 0</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">DATA1</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">b</span><span class="s">&#39;]q</span><span class="se">\x00</span><span class="s">(K</span><span class="se">\x00</span><span class="s">K</span><span class="se">\x01</span><span class="s">G@</span><span class="se">\x00\x00\x00\x00\x00\x00\x00</span><span class="s">c&#39;</span>
    <span class="n">b</span><span class="s">&#39;builtins</span><span class="se">\n</span><span class="s">complex</span><span class="se">\n</span><span class="s">q</span><span class="se">\x01</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;(G@</span><span class="se">\x08\x00\x00\x00\x00\x00\x00</span><span class="s">G</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s">t&#39;</span>
    <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x02</span><span class="s">Rq</span><span class="se">\x03</span><span class="s">K</span><span class="se">\x01</span><span class="s">J</span><span class="se">\xff\xff\xff\xff</span><span class="s">K</span><span class="se">\xff</span><span class="s">J</span><span class="se">\x01\xff\xff\xff</span><span class="s">J&#39;</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff\xff\xff</span><span class="s">M</span><span class="se">\xff\xff</span><span class="s">J</span><span class="se">\x01\x00\xff\xff</span><span class="s">J</span><span class="se">\x00\x00\xff\xff</span><span class="s">J</span><span class="se">\xff\xff</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">J</span><span class="se">\x01\x00\x00\x80</span><span class="s">J</span><span class="se">\x00\x00\x00\x80</span><span class="s">(X</span><span class="se">\x03\x00\x00\x00</span><span class="s">ab&#39;</span>
    <span class="n">b</span><span class="s">&#39;cq</span><span class="se">\x04</span><span class="s">h</span><span class="se">\x04</span><span class="s">ccopyreg</span><span class="se">\n</span><span class="s">_reco&#39;</span>
    <span class="n">b</span><span class="s">&#39;nstructor</span><span class="se">\n</span><span class="s">q</span><span class="se">\x05</span><span class="s">(c__main&#39;</span>
    <span class="n">b</span><span class="s">&#39;__</span><span class="se">\n</span><span class="s">C</span><span class="se">\n</span><span class="s">q</span><span class="se">\x06</span><span class="s">cbuiltins</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;object</span><span class="se">\n</span><span class="s">q</span><span class="se">\x07</span><span class="s">Ntq</span><span class="se">\x08</span><span class="s">Rq</span><span class="se">\t</span><span class="s">}q</span><span class="se">\n</span><span class="s">(&#39;</span>
    <span class="n">b</span><span class="s">&#39;X</span><span class="se">\x03\x00\x00\x00</span><span class="s">fooq</span><span class="se">\x0b</span><span class="s">K</span><span class="se">\x01</span><span class="s">X</span><span class="se">\x03\x00\x00\x00</span><span class="s">bar&#39;</span>
    <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x0c</span><span class="s">K</span><span class="se">\x02</span><span class="s">ubh</span><span class="se">\t</span><span class="s">tq</span><span class="se">\r</span><span class="s">h</span><span class="se">\r</span><span class="s">K</span><span class="se">\x05</span><span class="s">e.&#39;</span>
<span class="p">)</span>

<span class="c"># Disassembly of DATA1</span>
<span class="n">DATA1_DIS</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">    0: ]    EMPTY_LIST</span>
<span class="s">    1: q    BINPUT     0</span>
<span class="s">    3: (    MARK</span>
<span class="s">    4: K        BININT1    0</span>
<span class="s">    6: K        BININT1    1</span>
<span class="s">    8: G        BINFLOAT   2.0</span>
<span class="s">   17: c        GLOBAL     &#39;builtins complex&#39;</span>
<span class="s">   35: q        BINPUT     1</span>
<span class="s">   37: (        MARK</span>
<span class="s">   38: G            BINFLOAT   3.0</span>
<span class="s">   47: G            BINFLOAT   0.0</span>
<span class="s">   56: t            TUPLE      (MARK at 37)</span>
<span class="s">   57: q        BINPUT     2</span>
<span class="s">   59: R        REDUCE</span>
<span class="s">   60: q        BINPUT     3</span>
<span class="s">   62: K        BININT1    1</span>
<span class="s">   64: J        BININT     -1</span>
<span class="s">   69: K        BININT1    255</span>
<span class="s">   71: J        BININT     -255</span>
<span class="s">   76: J        BININT     -256</span>
<span class="s">   81: M        BININT2    65535</span>
<span class="s">   84: J        BININT     -65535</span>
<span class="s">   89: J        BININT     -65536</span>
<span class="s">   94: J        BININT     2147483647</span>
<span class="s">   99: J        BININT     -2147483647</span>
<span class="s">  104: J        BININT     -2147483648</span>
<span class="s">  109: (        MARK</span>
<span class="s">  110: X            BINUNICODE &#39;abc&#39;</span>
<span class="s">  118: q            BINPUT     4</span>
<span class="s">  120: h            BINGET     4</span>
<span class="s">  122: c            GLOBAL     &#39;copyreg _reconstructor&#39;</span>
<span class="s">  146: q            BINPUT     5</span>
<span class="s">  148: (            MARK</span>
<span class="s">  149: c                GLOBAL     &#39;__main__ C&#39;</span>
<span class="s">  161: q                BINPUT     6</span>
<span class="s">  163: c                GLOBAL     &#39;builtins object&#39;</span>
<span class="s">  180: q                BINPUT     7</span>
<span class="s">  182: N                NONE</span>
<span class="s">  183: t                TUPLE      (MARK at 148)</span>
<span class="s">  184: q            BINPUT     8</span>
<span class="s">  186: R            REDUCE</span>
<span class="s">  187: q            BINPUT     9</span>
<span class="s">  189: }            EMPTY_DICT</span>
<span class="s">  190: q            BINPUT     10</span>
<span class="s">  192: (            MARK</span>
<span class="s">  193: X                BINUNICODE &#39;foo&#39;</span>
<span class="s">  201: q                BINPUT     11</span>
<span class="s">  203: K                BININT1    1</span>
<span class="s">  205: X                BINUNICODE &#39;bar&#39;</span>
<span class="s">  213: q                BINPUT     12</span>
<span class="s">  215: K                BININT1    2</span>
<span class="s">  217: u                SETITEMS   (MARK at 192)</span>
<span class="s">  218: b            BUILD</span>
<span class="s">  219: h            BINGET     9</span>
<span class="s">  221: t            TUPLE      (MARK at 109)</span>
<span class="s">  222: q        BINPUT     13</span>
<span class="s">  224: h        BINGET     13</span>
<span class="s">  226: K        BININT1    5</span>
<span class="s">  228: e        APPENDS    (MARK at 3)</span>
<span class="s">  229: .    STOP</span>
<span class="s">highest protocol among opcodes = 1</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">DATA2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">]q</span><span class="se">\x00</span><span class="s">(K</span><span class="se">\x00</span><span class="s">K</span><span class="se">\x01</span><span class="s">G@</span><span class="se">\x00\x00\x00\x00\x00\x00\x00</span><span class="s">c&#39;</span>
    <span class="n">b</span><span class="s">&#39;builtins</span><span class="se">\n</span><span class="s">complex</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x01</span><span class="s">G@</span><span class="se">\x08\x00\x00\x00\x00\x00\x00</span><span class="s">G</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\x86</span><span class="s">q</span><span class="se">\x02</span><span class="s">Rq</span><span class="se">\x03</span><span class="s">K</span><span class="se">\x01</span><span class="s">J</span><span class="se">\xff\xff\xff\xff</span><span class="s">K</span><span class="se">\xff</span><span class="s">J</span><span class="se">\x01\xff\xff\xff</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;J</span><span class="se">\x00\xff\xff\xff</span><span class="s">M</span><span class="se">\xff\xff</span><span class="s">J</span><span class="se">\x01\x00\xff\xff</span><span class="s">J</span><span class="se">\x00\x00\xff\xff</span><span class="s">J</span><span class="se">\xff</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff\x7f</span><span class="s">J</span><span class="se">\x01\x00\x00\x80</span><span class="s">J</span><span class="se">\x00\x00\x00\x80</span><span class="s">(X</span><span class="se">\x03\x00\x00\x00</span><span class="s">a&#39;</span>
    <span class="n">b</span><span class="s">&#39;bcq</span><span class="se">\x04</span><span class="s">h</span><span class="se">\x04</span><span class="s">c__main__</span><span class="se">\n</span><span class="s">C</span><span class="se">\n</span><span class="s">q</span><span class="se">\x05</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;)</span><span class="se">\x81</span><span class="s">q</span><span class="se">\x06</span><span class="s">}q</span><span class="se">\x07</span><span class="s">(X</span><span class="se">\x03\x00\x00\x00</span><span class="s">fooq</span><span class="se">\x08</span><span class="s">K</span><span class="se">\x01</span><span class="s">&#39;</span>
    <span class="n">b</span><span class="s">&#39;X</span><span class="se">\x03\x00\x00\x00</span><span class="s">barq</span><span class="se">\t</span><span class="s">K</span><span class="se">\x02</span><span class="s">ubh</span><span class="se">\x06</span><span class="s">tq</span><span class="se">\n</span><span class="s">h&#39;</span>
    <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">K</span><span class="se">\x05</span><span class="s">e.&#39;</span>
<span class="p">)</span>

<span class="c"># Disassembly of DATA2</span>
<span class="n">DATA2_DIS</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">    0: </span><span class="se">\x80</span><span class="s"> PROTO      2</span>
<span class="s">    2: ]    EMPTY_LIST</span>
<span class="s">    3: q    BINPUT     0</span>
<span class="s">    5: (    MARK</span>
<span class="s">    6: K        BININT1    0</span>
<span class="s">    8: K        BININT1    1</span>
<span class="s">   10: G        BINFLOAT   2.0</span>
<span class="s">   19: c        GLOBAL     &#39;builtins complex&#39;</span>
<span class="s">   37: q        BINPUT     1</span>
<span class="s">   39: G        BINFLOAT   3.0</span>
<span class="s">   48: G        BINFLOAT   0.0</span>
<span class="s">   57: </span><span class="se">\x86</span><span class="s">     TUPLE2</span>
<span class="s">   58: q        BINPUT     2</span>
<span class="s">   60: R        REDUCE</span>
<span class="s">   61: q        BINPUT     3</span>
<span class="s">   63: K        BININT1    1</span>
<span class="s">   65: J        BININT     -1</span>
<span class="s">   70: K        BININT1    255</span>
<span class="s">   72: J        BININT     -255</span>
<span class="s">   77: J        BININT     -256</span>
<span class="s">   82: M        BININT2    65535</span>
<span class="s">   85: J        BININT     -65535</span>
<span class="s">   90: J        BININT     -65536</span>
<span class="s">   95: J        BININT     2147483647</span>
<span class="s">  100: J        BININT     -2147483647</span>
<span class="s">  105: J        BININT     -2147483648</span>
<span class="s">  110: (        MARK</span>
<span class="s">  111: X            BINUNICODE &#39;abc&#39;</span>
<span class="s">  119: q            BINPUT     4</span>
<span class="s">  121: h            BINGET     4</span>
<span class="s">  123: c            GLOBAL     &#39;__main__ C&#39;</span>
<span class="s">  135: q            BINPUT     5</span>
<span class="s">  137: )            EMPTY_TUPLE</span>
<span class="s">  138: </span><span class="se">\x81</span><span class="s">         NEWOBJ</span>
<span class="s">  139: q            BINPUT     6</span>
<span class="s">  141: }            EMPTY_DICT</span>
<span class="s">  142: q            BINPUT     7</span>
<span class="s">  144: (            MARK</span>
<span class="s">  145: X                BINUNICODE &#39;foo&#39;</span>
<span class="s">  153: q                BINPUT     8</span>
<span class="s">  155: K                BININT1    1</span>
<span class="s">  157: X                BINUNICODE &#39;bar&#39;</span>
<span class="s">  165: q                BINPUT     9</span>
<span class="s">  167: K                BININT1    2</span>
<span class="s">  169: u                SETITEMS   (MARK at 144)</span>
<span class="s">  170: b            BUILD</span>
<span class="s">  171: h            BINGET     6</span>
<span class="s">  173: t            TUPLE      (MARK at 110)</span>
<span class="s">  174: q        BINPUT     10</span>
<span class="s">  176: h        BINGET     10</span>
<span class="s">  178: K        BININT1    5</span>
<span class="s">  180: e        APPENDS    (MARK at 5)</span>
<span class="s">  181: .    STOP</span>
<span class="s">highest protocol among opcodes = 2</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="c"># set([1,2]) pickled from 2.x with protocol 2</span>
<span class="n">DATA3</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">c__builtin__</span><span class="se">\n</span><span class="s">set</span><span class="se">\n</span><span class="s">q</span><span class="se">\x00</span><span class="s">]q</span><span class="se">\x01</span><span class="s">(K</span><span class="se">\x01</span><span class="s">K</span><span class="se">\x02</span><span class="s">e</span><span class="se">\x85</span><span class="s">q</span><span class="se">\x02</span><span class="s">Rq</span><span class="se">\x03</span><span class="s">.&#39;</span>

<span class="c"># xrange(5) pickled from 2.x with protocol 2</span>
<span class="n">DATA4</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">c__builtin__</span><span class="se">\n</span><span class="s">xrange</span><span class="se">\n</span><span class="s">q</span><span class="se">\x00</span><span class="s">K</span><span class="se">\x00</span><span class="s">K</span><span class="se">\x05</span><span class="s">K</span><span class="se">\x01\x87</span><span class="s">q</span><span class="se">\x01</span><span class="s">Rq</span><span class="se">\x02</span><span class="s">.&#39;</span>

<span class="c"># a SimpleCookie() object pickled from 2.x with protocol 2</span>
<span class="n">DATA5</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">cCookie</span><span class="se">\n</span><span class="s">SimpleCookie</span><span class="se">\n</span><span class="s">q</span><span class="se">\x00</span><span class="s">)</span><span class="se">\x81</span><span class="s">q</span><span class="se">\x01</span><span class="s">U</span><span class="se">\x03</span><span class="s">key&#39;</span>
         <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x02</span><span class="s">cCookie</span><span class="se">\n</span><span class="s">Morsel</span><span class="se">\n</span><span class="s">q</span><span class="se">\x03</span><span class="s">)</span><span class="se">\x81</span><span class="s">q</span><span class="se">\x04</span><span class="s">(U</span><span class="se">\x07</span><span class="s">commentq</span><span class="se">\x05</span><span class="s">U&#39;</span>
         <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">q</span><span class="se">\x06</span><span class="s">U</span><span class="se">\x06</span><span class="s">domainq</span><span class="se">\x07</span><span class="s">h</span><span class="se">\x06</span><span class="s">U</span><span class="se">\x06</span><span class="s">secureq</span><span class="se">\x08</span><span class="s">h</span><span class="se">\x06</span><span class="s">U</span><span class="se">\x07</span><span class="s">&#39;</span>
         <span class="n">b</span><span class="s">&#39;expiresq</span><span class="se">\t</span><span class="s">h</span><span class="se">\x06</span><span class="s">U</span><span class="se">\x07</span><span class="s">max-ageq</span><span class="se">\n</span><span class="s">h</span><span class="se">\x06</span><span class="s">U</span><span class="se">\x07</span><span class="s">versionq</span><span class="se">\x0b</span><span class="s">h</span><span class="se">\x06</span><span class="s">U&#39;</span>
         <span class="n">b</span><span class="s">&#39;</span><span class="se">\x04</span><span class="s">pathq</span><span class="se">\x0c</span><span class="s">h</span><span class="se">\x06</span><span class="s">U</span><span class="se">\x08</span><span class="s">httponlyq</span><span class="se">\r</span><span class="s">h</span><span class="se">\x06</span><span class="s">u}q</span><span class="se">\x0e</span><span class="s">(U</span><span class="se">\x0b</span><span class="s">&#39;</span>
         <span class="n">b</span><span class="s">&#39;coded_valueq</span><span class="se">\x0f</span><span class="s">U</span><span class="se">\x05</span><span class="s">valueq</span><span class="se">\x10</span><span class="s">h</span><span class="se">\x10</span><span class="s">h</span><span class="se">\x10</span><span class="s">h</span><span class="se">\x02</span><span class="s">h</span><span class="se">\x02</span><span class="s">ubs}q</span><span class="se">\x11</span><span class="s">b.&#39;</span><span class="p">)</span>

<span class="c"># set([3]) pickled from 2.x with protocol 2</span>
<span class="n">DATA6</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">c__builtin__</span><span class="se">\n</span><span class="s">set</span><span class="se">\n</span><span class="s">q</span><span class="se">\x00</span><span class="s">]q</span><span class="se">\x01</span><span class="s">K</span><span class="se">\x03</span><span class="s">a</span><span class="se">\x85</span><span class="s">q</span><span class="se">\x02</span><span class="s">Rq</span><span class="se">\x03</span><span class="s">.&#39;</span>

<span class="n">python2_exceptions_without_args</span> <span class="o">=</span> <span class="p">(</span>
    <span class="ne">ArithmeticError</span><span class="p">,</span>
    <span class="ne">AssertionError</span><span class="p">,</span>
    <span class="ne">AttributeError</span><span class="p">,</span>
    <span class="ne">BaseException</span><span class="p">,</span>
    <span class="n">BufferError</span><span class="p">,</span>
    <span class="n">BytesWarning</span><span class="p">,</span>
    <span class="ne">DeprecationWarning</span><span class="p">,</span>
    <span class="ne">EOFError</span><span class="p">,</span>
    <span class="ne">EnvironmentError</span><span class="p">,</span>
    <span class="ne">Exception</span><span class="p">,</span>
    <span class="ne">FloatingPointError</span><span class="p">,</span>
    <span class="ne">FutureWarning</span><span class="p">,</span>
    <span class="ne">GeneratorExit</span><span class="p">,</span>
    <span class="ne">IOError</span><span class="p">,</span>
    <span class="ne">ImportError</span><span class="p">,</span>
    <span class="ne">ImportWarning</span><span class="p">,</span>
    <span class="ne">IndentationError</span><span class="p">,</span>
    <span class="ne">IndexError</span><span class="p">,</span>
    <span class="ne">KeyError</span><span class="p">,</span>
    <span class="ne">KeyboardInterrupt</span><span class="p">,</span>
    <span class="ne">LookupError</span><span class="p">,</span>
    <span class="ne">MemoryError</span><span class="p">,</span>
    <span class="ne">NameError</span><span class="p">,</span>
    <span class="ne">NotImplementedError</span><span class="p">,</span>
    <span class="ne">OSError</span><span class="p">,</span>
    <span class="ne">OverflowError</span><span class="p">,</span>
    <span class="ne">PendingDeprecationWarning</span><span class="p">,</span>
    <span class="ne">ReferenceError</span><span class="p">,</span>
    <span class="ne">RuntimeError</span><span class="p">,</span>
    <span class="ne">RuntimeWarning</span><span class="p">,</span>
    <span class="c"># StandardError is gone in Python 3, we map it to Exception</span>
    <span class="ne">StopIteration</span><span class="p">,</span>
    <span class="ne">SyntaxError</span><span class="p">,</span>
    <span class="ne">SyntaxWarning</span><span class="p">,</span>
    <span class="ne">SystemError</span><span class="p">,</span>
    <span class="ne">SystemExit</span><span class="p">,</span>
    <span class="ne">TabError</span><span class="p">,</span>
    <span class="ne">TypeError</span><span class="p">,</span>
    <span class="ne">UnboundLocalError</span><span class="p">,</span>
    <span class="ne">UnicodeError</span><span class="p">,</span>
    <span class="ne">UnicodeWarning</span><span class="p">,</span>
    <span class="ne">UserWarning</span><span class="p">,</span>
    <span class="ne">ValueError</span><span class="p">,</span>
    <span class="ne">Warning</span><span class="p">,</span>
    <span class="ne">ZeroDivisionError</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">exception_pickle</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">cexceptions</span><span class="se">\n</span><span class="s">?</span><span class="se">\n</span><span class="s">q</span><span class="se">\x00</span><span class="s">)Rq</span><span class="se">\x01</span><span class="s">.&#39;</span>

<span class="c"># Exception objects without arguments pickled from 2.x with protocol 2</span>
<span class="n">DATA7</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">exception</span> <span class="p">:</span>
    <span class="n">exception_pickle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="n">exception</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">exception</span> <span class="ow">in</span> <span class="n">python2_exceptions_without_args</span>
<span class="p">}</span>

<span class="c"># StandardError is mapped to Exception, test that separately</span>
<span class="n">DATA8</span> <span class="o">=</span> <span class="n">exception_pickle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;StandardError&#39;</span><span class="p">)</span>

<span class="c"># UnicodeEncodeError object pickled from 2.x with protocol 2</span>
<span class="n">DATA9</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">cexceptions</span><span class="se">\n</span><span class="s">UnicodeEncodeError</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x00</span><span class="s">(U</span><span class="se">\x05</span><span class="s">asciiq</span><span class="se">\x01</span><span class="s">X</span><span class="se">\x03\x00\x00\x00</span><span class="s">fooq</span><span class="se">\x02</span><span class="s">K</span><span class="se">\x00</span><span class="s">K</span><span class="se">\x01</span><span class="s">&#39;</span>
         <span class="n">b</span><span class="s">&#39;U</span><span class="se">\x03</span><span class="s">badq</span><span class="se">\x03</span><span class="s">tq</span><span class="se">\x04</span><span class="s">Rq</span><span class="se">\x05</span><span class="s">.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="create_data"><a class="viewcode-back" href="../../test.html#test.pickletester.create_data">[docs]</a><span class="k">def</span> <span class="nf">create_data</span><span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">c</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">+</span><span class="mi">0j</span><span class="p">]</span>
    <span class="c"># Append some integer test cases at cPickle.c&#39;s internal size</span>
    <span class="c"># cutoffs.</span>
    <span class="n">uint1max</span> <span class="o">=</span> <span class="mh">0xff</span>
    <span class="n">uint2max</span> <span class="o">=</span> <span class="mh">0xffff</span>
    <span class="n">int4max</span> <span class="o">=</span> <span class="mh">0x7fffffff</span>
    <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">uint1max</span><span class="p">,</span> <span class="o">-</span><span class="n">uint1max</span><span class="p">,</span> <span class="o">-</span><span class="n">uint1max</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">uint2max</span><span class="p">,</span> <span class="o">-</span><span class="n">uint2max</span><span class="p">,</span> <span class="o">-</span><span class="n">uint2max</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">int4max</span><span class="p">,</span>  <span class="o">-</span><span class="n">int4max</span><span class="p">,</span>  <span class="o">-</span><span class="n">int4max</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

</div>
<div class="viewcode-block" id="AbstractPickleTests"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractPickleTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Subclass must define self.dumps, self.loads.</span>

    <span class="n">optimized</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">_testdata</span> <span class="o">=</span> <span class="n">create_data</span><span class="p">()</span>

<div class="viewcode-block" id="AbstractPickleTests.setUp"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.assert_is_copy"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.assert_is_copy">[docs]</a>    <span class="k">def</span> <span class="nf">assert_is_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objcopy</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method to verify if two objects are copies of each others.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;{!r} is not a copy of {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">objcopy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">objcopy</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">objcopy</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__dict__&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertDictEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">objcopy</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">objcopy</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__slots__&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__slots__</span><span class="p">,</span> <span class="n">objcopy</span><span class="o">.</span><span class="n">__slots__</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">__slots__</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">slot</span><span class="p">),</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">objcopy</span><span class="p">,</span> <span class="n">slot</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                                 <span class="nb">getattr</span><span class="p">(</span><span class="n">objcopy</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_misc"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_misc">[docs]</a>    <span class="k">def</span> <span class="nf">test_misc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># test various datatypes not tested by testdata</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">myint</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">())</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">initarg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c"># XXX test __reduce__ protocol?</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_roundtrip_equality"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_roundtrip_equality">[docs]</a>    <span class="k">def</span> <span class="nf">test_roundtrip_equality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testdata</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">got</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">got</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_from_data0"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_from_data0">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_from_data0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_from_data1"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_from_data1">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_from_data1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_from_data2"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_from_data2">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_from_data2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_classic_instance"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_classic_instance">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_classic_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># See issue5180.  Test loading 2.x pickles that</span>
        <span class="c"># contain an instance of old style class.</span>
        <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">C</span><span class="p">,</span> <span class="p">()),</span> <span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,)),</span> <span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="p">())]:</span>
            <span class="n">xname</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
            <span class="c"># Protocol 0 (text mode pickle):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            0: (    MARK</span>
<span class="sd">            1: i        INST       &#39;__main__ X&#39; (MARK at 0)</span>
<span class="sd">            15: p    PUT        0</span>
<span class="sd">            18: (    MARK</span>
<span class="sd">            19: d        DICT       (MARK at 18)</span>
<span class="sd">            20: p    PUT        1</span>
<span class="sd">            23: b    BUILD</span>
<span class="sd">            24: .    STOP</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pickle0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;(i__main__</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="n">b</span><span class="s">&quot;X</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="n">b</span><span class="s">&quot;p0</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="n">b</span><span class="s">&quot;(dp1</span><span class="se">\n</span><span class="s">b.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="n">xname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle0</span><span class="p">))</span>

            <span class="c"># Protocol 1 (binary mode pickle)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            0: (    MARK</span>
<span class="sd">            1: c        GLOBAL     &#39;__main__ X&#39;</span>
<span class="sd">            15: q        BINPUT     0</span>
<span class="sd">            17: o        OBJ        (MARK at 0)</span>
<span class="sd">            18: q    BINPUT     1</span>
<span class="sd">            20: }    EMPTY_DICT</span>
<span class="sd">            21: q    BINPUT     2</span>
<span class="sd">            23: b    BUILD</span>
<span class="sd">            24: .    STOP</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pickle1</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;(c__main__</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="n">b</span><span class="s">&#39;X</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x00</span><span class="s">oq</span><span class="se">\x01</span><span class="s">}q</span><span class="se">\x02</span><span class="s">b.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="n">xname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle1</span><span class="p">))</span>

            <span class="c"># Protocol 2 (pickle2 = b&#39;\x80\x02&#39; + pickle1)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            0: \x80 PROTO      2</span>
<span class="sd">            2: (    MARK</span>
<span class="sd">            3: c        GLOBAL     &#39;__main__ X&#39;</span>
<span class="sd">            17: q        BINPUT     0</span>
<span class="sd">            19: o        OBJ        (MARK at 2)</span>
<span class="sd">            20: q    BINPUT     1</span>
<span class="sd">            22: }    EMPTY_DICT</span>
<span class="sd">            23: q    BINPUT     2</span>
<span class="sd">            25: b    BUILD</span>
<span class="sd">            26: .    STOP</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pickle2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">(c__main__</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="n">b</span><span class="s">&#39;X</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="n">b</span><span class="s">&#39;q</span><span class="se">\x00</span><span class="s">oq</span><span class="se">\x01</span><span class="s">}q</span><span class="se">\x02</span><span class="s">b.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="n">xname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle2</span><span class="p">))</span>

    <span class="c"># There are gratuitous differences between pickles produced by</span>
    <span class="c"># pickle and cPickle, largely because cPickle starts PUT indices at</span>
    <span class="c"># 1 and pickle starts them at 0.  See XXX comment in cPickle&#39;s put2() --</span>
    <span class="c"># there&#39;s a comment with an exclamation point there whose meaning</span>
    <span class="c"># is a mystery.  cPickle also suppresses PUT for objects with a refcount</span>
    <span class="c"># of 1.</span></div>
<div class="viewcode-block" id="AbstractPickleTests.dont_test_disassembly"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.dont_test_disassembly">[docs]</a>    <span class="k">def</span> <span class="nf">dont_test_disassembly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
        <span class="kn">from</span> <span class="nn">pickletools</span> <span class="kn">import</span> <span class="n">dis</span>

        <span class="k">for</span> <span class="n">proto</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">DATA0_DIS</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">DATA1_DIS</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testdata</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">filelike</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
            <span class="n">dis</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">filelike</span><span class="p">)</span>
            <span class="n">got</span> <span class="o">=</span> <span class="n">filelike</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">got</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_list"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_tuple"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">([],)</span>
        <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_dict"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_set"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_set">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">H</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">set</span><span class="p">({</span><span class="n">h</span><span class="p">})</span>
        <span class="n">h</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_frozenset"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_frozenset">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_frozenset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">H</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({</span><span class="n">h</span><span class="p">})</span>
        <span class="n">h</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_inst"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_inst">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">dir</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_recursive_multi"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_recursive_multi">[docs]</a>    <span class="k">def</span> <span class="nf">test_recursive_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="n">l</span><span class="p">}</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">dir</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_get"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_get">[docs]</a>    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;g0</span><span class="se">\n</span><span class="s">p0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">([(</span><span class="mi">100</span><span class="p">,),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;((Kdtp0</span><span class="se">\n</span><span class="s">h</span><span class="se">\x00</span><span class="s">l.))&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_unicode"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">endcases</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;</span><span class="se">\\</span><span class="s">u&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;</span><span class="se">\\\u1234</span><span class="s">&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;</span><span class="se">\n</span><span class="s">&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;&lt;</span><span class="se">\\</span><span class="s">&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;</span><span class="se">\\\U00012345</span><span class="s">&gt;&#39;</span><span class="p">,</span>
                    <span class="c"># surrogates</span>
                    <span class="s">&#39;&lt;</span><span class="se">\udc80</span><span class="s">&gt;&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">endcases</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">u2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_unicode_high_plane"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_unicode_high_plane">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_high_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\U00012345</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_bytes"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;xyz&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;xyz&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">([</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)]:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_ints"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_ints">[docs]</a>    <span class="k">def</span> <span class="nf">test_ints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
            <span class="k">while</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">expected</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_maxint64"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_maxint64">[docs]</a>    <span class="k">def</span> <span class="nf">test_maxint64</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">maxint64</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;I&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">maxint64</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">.&#39;</span>
        <span class="n">got</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">maxint64</span><span class="p">,</span> <span class="n">got</span><span class="p">)</span>

        <span class="c"># Try too with a bogus literal.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;I&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">maxint64</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;JUNK</span><span class="se">\n</span><span class="s">.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_long"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="c"># 256 bytes is where LONG4 begins.</span>
            <span class="k">for</span> <span class="n">nbits</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="mi">254</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="mi">256</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="mi">257</span><span class="p">:</span>
                <span class="n">nbase</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">nbits</span>
                <span class="k">for</span> <span class="n">npos</span> <span class="ow">in</span> <span class="n">nbase</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbase</span><span class="p">,</span> <span class="n">nbase</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">npos</span><span class="p">,</span> <span class="o">-</span><span class="n">npos</span><span class="p">:</span>
                        <span class="n">pickle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                        <span class="n">got</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">got</span><span class="p">)</span>
        <span class="c"># Try a monster.  This is quadratic-time in protos 0 &amp; 1, so don&#39;t</span>
        <span class="c"># bother with those.</span>
        <span class="n">nbase</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&quot;deadbeeffeedface&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">nbase</span> <span class="o">+=</span> <span class="n">nbase</span> <span class="o">&lt;&lt;</span> <span class="mi">1000000</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nbase</span><span class="p">,</span> <span class="o">-</span><span class="n">nbase</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">got</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="c"># assert_is_copy is very expensive here as it precomputes</span>
            <span class="c"># a failure message by computing the repr() of n and got,</span>
            <span class="c"># we just do the check ourselves.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">got</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">got</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_float"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_float">[docs]</a>    <span class="k">def</span> <span class="nf">test_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.94e-324</span><span class="p">,</span> <span class="mf">1e-310</span><span class="p">,</span> <span class="mf">7e-308</span><span class="p">,</span> <span class="mf">6.626e-34</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
                       <span class="mf">3.14</span><span class="p">,</span> <span class="mf">263.44582062374053</span><span class="p">,</span> <span class="mf">6.022e23</span><span class="p">,</span> <span class="mf">1e30</span><span class="p">]</span>
        <span class="n">test_values</span> <span class="o">=</span> <span class="n">test_values</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">:</span>
                <span class="n">pickle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">got</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">got</span><span class="p">)</span>
</div>
    <span class="nd">@run_with_locale</span><span class="p">(</span><span class="s">&#39;LC_ALL&#39;</span><span class="p">,</span> <span class="s">&#39;de_DE&#39;</span><span class="p">,</span> <span class="s">&#39;fr_FR&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_float_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># make sure that floats are formatted locale independent with proto 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;F1.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractPickleTests.test_reduce"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">AAA</span><span class="p">()</span>
            <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dumped</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="p">,</span> <span class="n">REDUCE_A</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_getinitargs"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_getinitargs">[docs]</a>    <span class="k">def</span> <span class="nf">test_getinitargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">initarg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dumped</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">loaded</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_pop_empty_stack"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_pop_empty_stack">[docs]</a>    <span class="k">def</span> <span class="nf">test_pop_empty_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test issue7455</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_metaclass"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_metaclass">[docs]</a>    <span class="k">def</span> <span class="nf">test_metaclass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">use_metaclass</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_dynamic_class"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_dynamic_class">[docs]</a>    <span class="k">def</span> <span class="nf">test_dynamic_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">create_dynamic_class</span><span class="p">(</span><span class="s">&quot;my_dynamic_class&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,))</span>
        <span class="n">copyreg</span><span class="o">.</span><span class="n">pickle</span><span class="p">(</span><span class="n">pickling_metaclass</span><span class="p">,</span> <span class="n">pickling_metaclass</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_structseq"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_structseq">[docs]</a>    <span class="k">def</span> <span class="nf">test_structseq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;stat&quot;</span><span class="p">):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;statvfs&quot;</span><span class="p">):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">statvfs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_ellipsis"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_ellipsis">[docs]</a>    <span class="k">def</span> <span class="nf">test_ellipsis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_notimplemented"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_notimplemented">[docs]</a>    <span class="k">def</span> <span class="nf">test_notimplemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">NotImplemented</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">NotImplemented</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_singleton_types"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_singleton_types">[docs]</a>    <span class="k">def</span> <span class="nf">test_singleton_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #6477: Test that types of built-in singletons can be pickled.</span>
        <span class="n">singletons</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="bp">NotImplemented</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">singleton</span> <span class="ow">in</span> <span class="n">singletons</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">singleton</span><span class="p">),</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">singleton</span><span class="p">),</span> <span class="n">u</span><span class="p">)</span>

    <span class="c"># Tests for protocol 2</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_proto"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_proto">[docs]</a>    <span class="k">def</span> <span class="nf">test_proto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">proto_header</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PROTO</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">proto</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">pickled</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">proto_header</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">PROTO</span><span class="p">,</span> <span class="n">pickled</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">oob</span> <span class="o">=</span> <span class="n">protocols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>     <span class="c"># a future protocol</span>
        <span class="n">build_none</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span> <span class="o">+</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STOP</span>
        <span class="n">badpickle</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PROTO</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">oob</span><span class="p">])</span> <span class="o">+</span> <span class="n">build_none</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">badpickle</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;unsupported pickle protocol&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;expected bad protocol number to raise ValueError&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_long1"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_long1">[docs]</a>    <span class="k">def</span> <span class="nf">test_long1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">12345678910111213141516178920</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">LONG1</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_long4"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_long4">[docs]</a>    <span class="k">def</span> <span class="nf">test_long4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">12345678910111213141516178920</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">256</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">LONG4</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_short_tuples"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_short_tuples">[docs]</a>    <span class="k">def</span> <span class="nf">test_short_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Map (proto, len(tuple)) to expected opcode.</span>
        <span class="n">expected_opcode</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>

                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EMPTY_TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>

                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EMPTY_TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE1</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE2</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE3</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>

                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EMPTY_TUPLE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE1</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE2</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE3</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE</span><span class="p">,</span>
                          <span class="p">}</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_opcode</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_singletons"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_singletons">[docs]</a>    <span class="k">def</span> <span class="nf">test_singletons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Map (proto, singleton) to expected opcode.</span>
        <span class="n">expected_opcode</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>

                           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NEWTRUE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NEWTRUE</span><span class="p">,</span>

                           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NEWFALSE</span><span class="p">,</span>
                           <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NEWFALSE</span><span class="p">,</span>
                          <span class="p">}</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_opcode</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">x</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_newobj_tuple"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_newobj_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">test_newobj_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">MyTuple</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="n">x</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_newobj_list"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_newobj_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_newobj_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">MyList</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="n">x</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_newobj_generic"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_newobj_generic">[docs]</a>    <span class="k">def</span> <span class="nf">test_newobj_generic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">myclasses</span><span class="p">:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">__base__</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">detail</span> <span class="o">=</span> <span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c"># XXX revisit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">B</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">B</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">detail</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_newobj_proxies"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_newobj_proxies">[docs]</a>    <span class="k">def</span> <span class="nf">test_newobj_proxies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># NEWOBJ should use the __class__ rather than the raw type</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">myclasses</span><span class="p">[:]</span>
        <span class="c"># Cannot create weakproxies to these classes</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">MyInt</span><span class="p">,</span> <span class="n">MyTuple</span><span class="p">):</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">__base__</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c"># rather than type(p)</span>
                <span class="n">detail</span> <span class="o">=</span> <span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">B</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">B</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">detail</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>

    <span class="c"># Register a type with copyreg, with extension code extcode.  Pickle</span>
    <span class="c"># an object of that type.  Check that the resulting pickle uses opcode</span>
    <span class="c"># (EXT[124]) under proto 2, and not in proto 1.</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.produce_global_ext"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.produce_global_ext">[docs]</a>    <span class="k">def</span> <span class="nf">produce_global_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extcode</span><span class="p">,</span> <span class="n">opcode</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">ExtensionSaver</span><span class="p">(</span><span class="n">extcode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">copyreg</span><span class="o">.</span><span class="n">add_extension</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&quot;MyList&quot;</span><span class="p">,</span> <span class="n">extcode</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">MyList</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
            <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
            <span class="n">x</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>

            <span class="c"># Dump using protocol 1 for comparison.</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">__name__</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">s1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;MyList&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">s1</span><span class="p">))</span>

            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="c"># Dump using protocol 2 for test.</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">__name__</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">s2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;MyList&quot;</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span> <span class="bp">True</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>

            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_global_ext1"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_global_ext1">[docs]</a>    <span class="k">def</span> <span class="nf">test_global_ext1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x00000001</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT1</span><span class="p">)</span>  <span class="c"># smallest EXT1 code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x000000ff</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT1</span><span class="p">)</span>  <span class="c"># largest EXT1 code</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_global_ext2"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_global_ext2">[docs]</a>    <span class="k">def</span> <span class="nf">test_global_ext2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x00000100</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT2</span><span class="p">)</span>  <span class="c"># smallest EXT2 code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x0000ffff</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT2</span><span class="p">)</span>  <span class="c"># largest EXT2 code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x0000abcd</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT2</span><span class="p">)</span>  <span class="c"># check endianness</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_global_ext4"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_global_ext4">[docs]</a>    <span class="k">def</span> <span class="nf">test_global_ext4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x00010000</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT4</span><span class="p">)</span>  <span class="c"># smallest EXT4 code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x7fffffff</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT4</span><span class="p">)</span>  <span class="c"># largest EXT4 code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_global_ext</span><span class="p">(</span><span class="mh">0x12abcdef</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">EXT4</span><span class="p">)</span>  <span class="c"># check endianness</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_list_chunking"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_list_chunking">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_chunking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c"># too small to chunk</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">num_appends</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">APPENDS</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_appends</span><span class="p">,</span> <span class="n">proto</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2500</span>  <span class="c"># expect at least two chunks when proto &gt; 0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">num_appends</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">APPENDS</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_appends</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">num_appends</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_dict_chunking"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_dict_chunking">[docs]</a>    <span class="k">def</span> <span class="nf">test_dict_chunking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c"># too small to chunk</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">bytes_types</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">num_setitems</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">SETITEMS</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_setitems</span><span class="p">,</span> <span class="n">proto</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2500</span>  <span class="c"># expect at least two chunks when proto &gt; 0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">num_setitems</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">SETITEMS</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_setitems</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">num_setitems</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_set_chunking"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_set_chunking">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_chunking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c"># too small to chunk</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">num_additems</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">ADDITEMS</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_additems</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_additems</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2500</span>  <span class="c"># expect at least two chunks when proto &gt;= 4</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">num_additems</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">ADDITEMS</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">num_additems</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">num_additems</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_simple_newobj"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_simple_newobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_newobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">SimpleNewObj</span><span class="p">)</span>  <span class="c"># avoid __init__</span>
        <span class="n">x</span><span class="o">.</span><span class="n">abc</span> <span class="o">=</span> <span class="mi">666</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">NEWOBJ</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
                             <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">NEWOBJ_EX</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
                             <span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="c"># will raise TypeError if __init__ called</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_newobj_list_slots"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_newobj_list_slots">[docs]</a>    <span class="k">def</span> <span class="nf">test_newobj_list_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">SlotList</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="n">x</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_reduce_overrides_default_reduce_ex"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce_overrides_default_reduce_ex">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce_overrides_default_reduce_ex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">REX_one</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_reduce_called</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_reduce_called</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">_reduce_called</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_reduce_ex_called"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce_ex_called">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce_ex_called</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">REX_two</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_reduce_ex_overrides_reduce"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce_ex_overrides_reduce">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce_ex_overrides_reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">REX_three</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_reduce_ex_calls_base"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce_ex_calls_base">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce_ex_calls_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">REX_four</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">_proto</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_reduce_calls_base"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce_calls_base">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce_calls_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">REX_five</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_reduce_called</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_reduce_called</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">_reduce_called</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@no_tracing</span>
<div class="viewcode-block" id="AbstractPickleTests.test_bad_getattr"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_bad_getattr">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #3514: crash when there is an infinite loop in __getattr__</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">BadGetattr</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_reduce_bad_iterator"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_reduce_bad_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce_bad_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue4176: crash when 4th and 5th items of __reduce__()</span>
        <span class="c"># are not iterators</span>
        <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="c"># 4th item is not an iterator</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">,</span> <span class="p">(),</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">None</span>
        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="c"># 5th item is not an iterator</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">,</span> <span class="p">(),</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[]</span>

        <span class="c"># Protocol 0 is less strict and also accept iterables.</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">C</span><span class="p">(),</span> <span class="n">proto</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">PickleError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">D</span><span class="p">(),</span> <span class="n">proto</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">PickleError</span><span class="p">):</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_many_puts_and_gets"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_many_puts_and_gets">[docs]</a>    <span class="k">def</span> <span class="nf">test_many_puts_and_gets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that internal data structures correctly deal with lots of</span>
        <span class="c"># puts/gets.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;aaa&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">large_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">large_dict</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">large_dict</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">large_dict</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dumped</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assert_is_copy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">loaded</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_attribute_name_interning"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_attribute_name_interning">[docs]</a>    <span class="k">def</span> <span class="nf">test_attribute_name_interning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that attribute names of pickled objects are interned when</span>
        <span class="c"># unpickling.</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
            <span class="n">x</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
            <span class="n">x</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">x_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
            <span class="n">y_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x_key</span><span class="p">,</span> <span class="n">y_key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_keys</span><span class="p">,</span> <span class="n">y_keys</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">x_key</span><span class="p">,</span> <span class="n">y_key</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_unpickle_from_2x"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_unpickle_from_2x">[docs]</a>    <span class="k">def</span> <span class="nf">test_unpickle_from_2x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Unpickle non-trivial data from Python 2.x.</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="n">SimpleCookie</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;Set-Cookie: key=value&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DATA7</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="n">exc</span><span class="p">)</span>

        <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="ne">Exception</span><span class="p">)</span>

        <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">DATA9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="ne">UnicodeEncodeError</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_pickle_to_2x"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_pickle_to_2x">[docs]</a>    <span class="k">def</span> <span class="nf">test_pickle_to_2x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Pickle non-trivial data with protocol 2, expecting that it yields</span>
        <span class="c"># the same result as Python 2.x did.</span>
        <span class="c"># NOTE: this test is a bit too strong since we can produce different</span>
        <span class="c"># bytecode that 2.x will still understand.</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dumped</span><span class="p">,</span> <span class="n">DATA4</span><span class="p">)</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dumped</span><span class="p">,</span> <span class="n">DATA6</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_python2_str_as_bytes"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_python2_str_as_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_python2_str_as_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># From Python 2: pickle.dumps(&#39;a\x00\xa0&#39;, protocol=0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;S&#39;a</span><span class="se">\\</span><span class="s">x00</span><span class="se">\\</span><span class="s">xa0&#39;</span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;bytes&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;a</span><span class="se">\x00\xa0</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># From Python 2: pickle.dumps(&#39;a\x00\xa0&#39;, protocol=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;U</span><span class="se">\x03</span><span class="s">a</span><span class="se">\x00\xa0</span><span class="s">.&#39;</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;bytes&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;a</span><span class="se">\x00\xa0</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># From Python 2: pickle.dumps(&#39;a\x00\xa0&#39;, protocol=2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">U</span><span class="se">\x03</span><span class="s">a</span><span class="se">\x00\xa0</span><span class="s">.&#39;</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;bytes&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;a</span><span class="se">\x00\xa0</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_python2_unicode_as_str"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_python2_unicode_as_str">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_python2_unicode_as_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># From Python 2: pickle.dumps(u&#39;π&#39;, protocol=0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;V</span><span class="se">\\</span><span class="s">u03c0</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;bytes&#39;</span><span class="p">),</span> <span class="s">&#39;π&#39;</span><span class="p">)</span>
        <span class="c"># From Python 2: pickle.dumps(u&#39;π&#39;, protocol=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;X</span><span class="se">\x02\x00\x00\x00\xcf\x80</span><span class="s">.&#39;</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;bytes&quot;</span><span class="p">),</span> <span class="s">&#39;π&#39;</span><span class="p">)</span>
        <span class="c"># From Python 2: pickle.dumps(u&#39;π&#39;, protocol=2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x02</span><span class="s">X</span><span class="se">\x02\x00\x00\x00\xcf\x80</span><span class="s">.&#39;</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;bytes&quot;</span><span class="p">),</span> <span class="s">&#39;π&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_load_long_python2_str_as_bytes"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_load_long_python2_str_as_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_long_python2_str_as_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># From Python 2: pickle.dumps(&#39;x&#39; * 300, protocol=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">BINSTRING</span> <span class="o">+</span>
                                    <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span> <span class="o">+</span>
                                    <span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">300</span> <span class="o">+</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STOP</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;bytes&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">300</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_large_pickles"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_large_pickles">[docs]</a>    <span class="k">def</span> <span class="nf">test_large_pickles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test the correctness of internal buffering routines when handling</span>
        <span class="c"># large data.</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;xy&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="nb">len</span><span class="p">)</span>
            <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dumped</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_empty_bytestring"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_empty_bytestring">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_bytestring</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 11286</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x03</span><span class="s">U</span><span class="se">\x00</span><span class="s">q</span><span class="se">\x00</span><span class="s">.&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;koi8-r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_int_pickling_efficiency"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_int_pickling_efficiency">[docs]</a>    <span class="k">def</span> <span class="nf">test_int_pickling_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test compacity of int representation (see issue #12744)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                <span class="n">pickles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">70</span><span class="p">)]</span>
                <span class="n">sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">pickles</span><span class="p">))</span>
                <span class="c"># the size function is monotonic</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sizes</span><span class="p">),</span> <span class="n">sizes</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">proto</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pickles</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">LONG</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.check_negative_32b_binXXX"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.check_negative_32b_binXXX">[docs]</a>    <span class="k">def</span> <span class="nf">check_negative_32b_binXXX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dumped</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;test is only meaningful on 32-bit builds&quot;</span><span class="p">)</span>
        <span class="c"># XXX Pure Python pickle reads lengths as signed and passes</span>
        <span class="c"># them directly to read() (hence the EOFError)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">,</span>
                                <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dumped</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_negative_32b_binbytes"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_negative_32b_binbytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_negative_32b_binbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># On 32-bit builds, a BINBYTES of 2**31 or more is refused</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_negative_32b_binXXX</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x03</span><span class="s">B</span><span class="se">\xff\xff\xff\xff</span><span class="s">xyzq</span><span class="se">\x00</span><span class="s">.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_negative_32b_binunicode"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_negative_32b_binunicode">[docs]</a>    <span class="k">def</span> <span class="nf">test_negative_32b_binunicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># On 32-bit builds, a BINUNICODE of 2**31 or more is refused</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_negative_32b_binXXX</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x03</span><span class="s">X</span><span class="se">\xff\xff\xff\xff</span><span class="s">xyzq</span><span class="se">\x00</span><span class="s">.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_negative_put"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_negative_put">[docs]</a>    <span class="k">def</span> <span class="nf">test_negative_put</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #12847</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;Va</span><span class="se">\n</span><span class="s">p-1</span><span class="se">\n</span><span class="s">.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">dumped</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_negative_32b_binput"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_negative_32b_binput">[docs]</a>    <span class="k">def</span> <span class="nf">test_negative_32b_binput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #12847</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;test is only meaningful on 32-bit builds&quot;</span><span class="p">)</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x03</span><span class="s">X</span><span class="se">\x01\x00\x00\x00</span><span class="s">ar</span><span class="se">\xff\xff\xff\xff</span><span class="s">.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">dumped</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_badly_escaped_string"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_badly_escaped_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_badly_escaped_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;S&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_badly_quoted_string"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_badly_quoted_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_badly_quoted_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #17710</span>
        <span class="n">badpickles</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="s">&quot;S&#39;</span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S&quot;</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S</span><span class="se">\&#39;</span><span class="s"> </span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S&quot; </span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S</span><span class="se">\&#39;</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S&quot;</span><span class="se">\&#39;\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&quot;S&#39; &#39; </span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S&quot; &quot; </span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&quot;S &#39;&#39;</span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S &quot;&quot;</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S </span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span>
                      <span class="n">b</span><span class="s">&#39;S.&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">badpickles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_correctly_quoted_string"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_correctly_quoted_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_correctly_quoted_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">goodpickles</span> <span class="o">=</span> <span class="p">[(</span><span class="n">b</span><span class="s">&quot;S&#39;&#39;</span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">b</span><span class="s">&#39;S&quot;&quot;</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">b</span><span class="s">&#39;S&quot;</span><span class="se">\\</span><span class="s">n&quot;</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">b</span><span class="s">&quot;S&#39;</span><span class="se">\\</span><span class="s">n&#39;</span><span class="se">\n</span><span class="s">.&quot;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">goodpickles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_pickling_with_opcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">opcode_in_pickle</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">pickled</span><span class="p">))</span>
        <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">unpickled</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractPickleTests.test_appends_on_non_lists"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_appends_on_non_lists">[docs]</a>    <span class="k">def</span> <span class="nf">test_appends_on_non_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #17720</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">REX_six</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_pickling_with_opcode</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">APPEND</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_pickling_with_opcode</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">APPENDS</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_setitems_on_non_dicts"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_setitems_on_non_dicts">[docs]</a>    <span class="k">def</span> <span class="nf">test_setitems_on_non_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">REX_seven</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_pickling_with_opcode</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">SETITEM</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_pickling_with_opcode</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">SETITEMS</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

    <span class="c"># Exercise framing (proto &gt;= 4) for significant workloads</span>
</div>
    <span class="n">FRAME_SIZE_TARGET</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span>

<div class="viewcode-block" id="AbstractPickleTests.check_frame_opcodes"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.check_frame_opcodes">[docs]</a>    <span class="k">def</span> <span class="nf">check_frame_opcodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the arguments of FRAME opcodes in a protocol 4+ pickle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frame_opcode_size</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">last_arg</span> <span class="o">=</span> <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="o">.</span><span class="n">genops</span><span class="p">(</span><span class="n">pickled</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&#39;FRAME&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">last_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># The previous frame&#39;s size should be equal to the number</span>
                <span class="c"># of bytes up to the current frame.</span>
                <span class="n">frame_size</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">last_pos</span> <span class="o">-</span> <span class="n">frame_opcode_size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">frame_size</span><span class="p">,</span> <span class="n">last_arg</span><span class="p">)</span>
            <span class="n">last_arg</span><span class="p">,</span> <span class="n">last_pos</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="n">pos</span>
        <span class="c"># The last frame&#39;s size should be equal to the number of bytes up</span>
        <span class="c"># to the pickle&#39;s end.</span>
        <span class="n">frame_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span> <span class="o">-</span> <span class="n">last_pos</span> <span class="o">-</span> <span class="n">frame_opcode_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">frame_size</span><span class="p">,</span> <span class="n">last_arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_framing_many_objects"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_framing_many_objects">[docs]</a>    <span class="k">def</span> <span class="nf">test_framing_many_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">unpickled</span><span class="p">)</span>
                <span class="n">bytes_per_frame</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span> <span class="o">/</span>
                                   <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">FRAME</span><span class="p">,</span> <span class="n">pickled</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">bytes_per_frame</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">FRAME_SIZE_TARGET</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">bytes_per_frame</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">FRAME_SIZE_TARGET</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_frame_opcodes</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_framing_large_objects"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_framing_large_objects">[docs]</a>    <span class="k">def</span> <span class="nf">test_framing_large_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;y&#39;</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;z&#39;</span> <span class="o">*</span> <span class="n">N</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">unpickled</span><span class="p">)</span>
                <span class="n">n_frames</span> <span class="o">=</span> <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">FRAME</span><span class="p">,</span> <span class="n">pickled</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_frame_opcodes</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_optional_frames"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_optional_frames">[docs]</a>    <span class="k">def</span> <span class="nf">test_optional_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">remove_frames</span><span class="p">(</span><span class="n">pickled</span><span class="p">,</span> <span class="n">keep_frame</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Remove frame opcodes from the given pickle.&quot;&quot;&quot;</span>
            <span class="n">frame_starts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># 1 byte for the opcode and 8 for the argument</span>
            <span class="n">frame_opcode_size</span> <span class="o">=</span> <span class="mi">9</span>
            <span class="k">for</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">pickletools</span><span class="o">.</span><span class="n">genops</span><span class="p">(</span><span class="n">pickled</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">opcode</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;FRAME&#39;</span><span class="p">:</span>
                    <span class="n">frame_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">newpickle</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
            <span class="n">last_frame_end</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frame_starts</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">keep_frame</span> <span class="ow">and</span> <span class="n">keep_frame</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">newpickle</span> <span class="o">+=</span> <span class="n">pickled</span><span class="p">[</span><span class="n">last_frame_end</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span>
                <span class="n">last_frame_end</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">frame_opcode_size</span>
            <span class="n">newpickle</span> <span class="o">+=</span> <span class="n">pickled</span><span class="p">[</span><span class="n">last_frame_end</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">newpickle</span>

        <span class="n">frame_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FRAME_SIZE_TARGET</span>
        <span class="n">num_frames</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">([</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">frame_size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_frames</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

            <span class="n">frameless_pickle</span> <span class="o">=</span> <span class="n">remove_frames</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">FRAME</span><span class="p">,</span> <span class="n">frameless_pickle</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">frameless_pickle</span><span class="p">))</span>

            <span class="n">some_frames_pickle</span> <span class="o">=</span> <span class="n">remove_frames</span><span class="p">(</span><span class="n">pickled</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">FRAME</span><span class="p">,</span> <span class="n">some_frames_pickle</span><span class="p">),</span>
                            <span class="n">count_opcode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">FRAME</span><span class="p">,</span> <span class="n">pickled</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">some_frames_pickle</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_nested_names"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_nested_names">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">Nested</span>
        <span class="k">class</span> <span class="nc">Nested</span><span class="p">:</span>
            <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
                <span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
                    <span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Nested</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">Nested</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">Nested</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">C</span><span class="p">]:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">):</span>
                    <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">proto</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">unpickled</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_py_methods"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_py_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_py_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">PyMethodsTest</span>
        <span class="k">class</span> <span class="nc">PyMethodsTest</span><span class="p">:</span>
            <span class="nd">@staticmethod</span>
            <span class="k">def</span> <span class="nf">cheese</span><span class="p">():</span>
                <span class="k">return</span> <span class="s">&quot;cheese&quot;</span>
            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">wine</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">PyMethodsTest</span>
                <span class="k">return</span> <span class="s">&quot;wine&quot;</span>
            <span class="k">def</span> <span class="nf">biscuits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PyMethodsTest</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;biscuits&quot;</span>
            <span class="k">class</span> <span class="nc">Nested</span><span class="p">:</span>
                <span class="s">&quot;Nested class&quot;</span>
                <span class="nd">@staticmethod</span>
                <span class="k">def</span> <span class="nf">ketchup</span><span class="p">():</span>
                    <span class="k">return</span> <span class="s">&quot;ketchup&quot;</span>
                <span class="nd">@classmethod</span>
                <span class="k">def</span> <span class="nf">maple</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span>
                    <span class="k">return</span> <span class="s">&quot;maple&quot;</span>
                <span class="k">def</span> <span class="nf">pie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s">&quot;pie&quot;</span>

        <span class="n">py_methods</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">cheese</span><span class="p">,</span>
            <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">wine</span><span class="p">,</span>
            <span class="n">PyMethodsTest</span><span class="p">()</span><span class="o">.</span><span class="n">biscuits</span><span class="p">,</span>
            <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span><span class="o">.</span><span class="n">ketchup</span><span class="p">,</span>
            <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span><span class="o">.</span><span class="n">maple</span><span class="p">,</span>
            <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span><span class="p">()</span><span class="o">.</span><span class="n">pie</span>
        <span class="p">)</span>
        <span class="n">py_unbound_methods</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">biscuits</span><span class="p">,</span> <span class="n">PyMethodsTest</span><span class="p">),</span>
            <span class="p">(</span><span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span><span class="o">.</span><span class="n">pie</span><span class="p">,</span> <span class="n">PyMethodsTest</span><span class="o">.</span><span class="n">Nested</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">py_methods</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">):</span>
                    <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">proto</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">method</span><span class="p">(),</span> <span class="n">unpickled</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">py_unbound_methods</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">):</span>
                    <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">proto</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">method</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">unpickled</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractPickleTests.test_c_methods"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleTests.test_c_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_c_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">Subclass</span>
        <span class="k">class</span> <span class="nc">Subclass</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Nested</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="n">c_methods</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c"># bound built-in method</span>
            <span class="p">(</span><span class="s">&quot;abcd&quot;</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,)),</span>
            <span class="c"># unbound built-in method</span>
            <span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;abcd&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">)),</span>
            <span class="c"># bound &quot;slot&quot; method</span>
            <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">__len__</span><span class="p">,</span> <span class="p">()),</span>
            <span class="c"># unbound &quot;slot&quot; method</span>
            <span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">__len__</span><span class="p">,</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],)),</span>
            <span class="c"># bound &quot;coexist&quot; method</span>
            <span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span><span class="o">.</span><span class="n">__contains__</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)),</span>
            <span class="c"># unbound &quot;coexist&quot; method</span>
            <span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">__contains__</span><span class="p">,</span> <span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="c"># built-in class method</span>
            <span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">,</span> <span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span>
            <span class="c"># built-in static method</span>
            <span class="p">(</span><span class="nb">bytearray</span><span class="o">.</span><span class="n">maketrans</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;xyz&quot;</span><span class="p">)),</span>
            <span class="c"># subclass methods</span>
            <span class="p">(</span><span class="n">Subclass</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)),</span>
            <span class="p">(</span><span class="n">Subclass</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">Subclass</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">Subclass</span><span class="o">.</span><span class="n">Nested</span><span class="p">(</span><span class="s">&quot;sweet&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,)),</span>
            <span class="p">(</span><span class="n">Subclass</span><span class="o">.</span><span class="n">Nested</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">Subclass</span><span class="o">.</span><span class="n">Nested</span><span class="p">(</span><span class="s">&quot;sweet&quot;</span><span class="p">),</span> <span class="s">&quot;e&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">c_methods</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">):</span>
                    <span class="n">unpickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">proto</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="n">unpickled</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="BigmemPickleTests"><a class="viewcode-back" href="../../test.html#test.pickletester.BigmemPickleTests">[docs]</a><span class="k">class</span> <span class="nc">BigmemPickleTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c"># Binary protocols can serialize longs of up to 2GB-1</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_2G</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_huge_long_32b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Protocol 3 can serialize up to 4GB-1 as a bytes object</span>
    <span class="c"># (older protocols don&#39;t have a dedicated opcode for bytes and are</span>
    <span class="c"># too inefficient)</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_2G</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_huge_bytes_32b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;abcd&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                        <span class="n">header</span> <span class="o">=</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">BINBYTES</span> <span class="o">+</span>
                                  <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                        <span class="n">data_start</span> <span class="o">=</span> <span class="n">pickled</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                            <span class="n">header</span><span class="p">,</span>
                            <span class="n">pickled</span><span class="p">[</span><span class="n">data_start</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">):</span><span class="n">data_start</span><span class="p">])</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_4G</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_huge_bytes_64b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;acbd&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="c"># Protocol 3 does not support large bytes objects.</span>
                        <span class="c"># Verify that we do not crash when processing one.</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                        <span class="n">header</span> <span class="o">=</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">BINBYTES8</span> <span class="o">+</span>
                                  <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;&lt;Q&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                        <span class="n">data_start</span> <span class="o">=</span> <span class="n">pickled</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                            <span class="n">header</span><span class="p">,</span>
                            <span class="n">pickled</span><span class="p">[</span><span class="n">data_start</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">):</span><span class="n">data_start</span><span class="p">])</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># All protocols use 1-byte per printable ASCII character; we add another</span>
    <span class="c"># byte because the encoded form has to be copied into the internal buffer.</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_2G</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_huge_str_32b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;abcd&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                        <span class="n">header</span> <span class="o">=</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">BINUNICODE</span> <span class="o">+</span>
                                  <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                        <span class="n">data_start</span> <span class="o">=</span> <span class="n">pickled</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;abcd&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                            <span class="n">header</span><span class="p">,</span>
                            <span class="n">pickled</span><span class="p">[</span><span class="n">data_start</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">):</span><span class="n">data_start</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">pickled</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abcd&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abcd&quot;</span><span class="p">)</span> <span class="o">-</span>
                                          <span class="n">pickled</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abcd&quot;</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># BINUNICODE (protocols 1, 2 and 3) cannot carry more than 2**32 - 1 bytes</span>
    <span class="c"># of utf-8 encoded unicode. BINUNICODE8 (protocol 4) supports these huge</span>
    <span class="c"># unicode strings however.</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_4G</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_huge_str_64b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;abcd&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">proto</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                        <span class="n">header</span> <span class="o">=</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">BINUNICODE8</span> <span class="o">+</span>
                                  <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;&lt;Q&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                        <span class="n">data_start</span> <span class="o">=</span> <span class="n">pickled</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;abcd&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                            <span class="n">header</span><span class="p">,</span>
                            <span class="n">pickled</span><span class="p">[</span><span class="n">data_start</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">):</span><span class="n">data_start</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">pickled</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abcd&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abcd&quot;</span><span class="p">)</span> <span class="o">-</span>
                                          <span class="n">pickled</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abcd&quot;</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">pickled</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>


<span class="c"># Test classes for reduce_ex</span>
</div>
<div class="viewcode-block" id="REX_one"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_one">[docs]</a><span class="k">class</span> <span class="nc">REX_one</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;No __reduce_ex__ here, but inheriting it from object&quot;&quot;&quot;</span>
    <span class="n">_reduce_called</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_called</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">REX_one</span><span class="p">,</span> <span class="p">()</span>
</div>
<div class="viewcode-block" id="REX_two"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_two">[docs]</a><span class="k">class</span> <span class="nc">REX_two</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;No __reduce__ here, but inheriting it from object&quot;&quot;&quot;</span>
    <span class="n">_proto</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proto</span> <span class="o">=</span> <span class="n">proto</span>
        <span class="k">return</span> <span class="n">REX_two</span><span class="p">,</span> <span class="p">()</span>
</div>
<div class="viewcode-block" id="REX_three"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_three">[docs]</a><span class="k">class</span> <span class="nc">REX_three</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_proto</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proto</span> <span class="o">=</span> <span class="n">proto</span>
        <span class="k">return</span> <span class="n">REX_two</span><span class="p">,</span> <span class="p">()</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">TestFailed</span><span class="p">(</span><span class="s">&quot;This __reduce__ shouldn&#39;t be called&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="REX_four"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_four">[docs]</a><span class="k">class</span> <span class="nc">REX_four</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calling base class method should succeed&quot;&quot;&quot;</span>
    <span class="n">_proto</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proto</span> <span class="o">=</span> <span class="n">proto</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="REX_five"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_five">[docs]</a><span class="k">class</span> <span class="nc">REX_five</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This one used to fail with infinite recursion&quot;&quot;&quot;</span>
    <span class="n">_reduce_called</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_called</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="REX_six"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_six">[docs]</a><span class="k">class</span> <span class="nc">REX_six</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class is used to check the 4th argument (list iterator) of</span>
<span class="sd">    the reduce protocol.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
<div class="viewcode-block" id="REX_six.append"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_six.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="p">(),</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="REX_seven"><a class="viewcode-back" href="../../test.html#test.pickletester.REX_seven">[docs]</a><span class="k">class</span> <span class="nc">REX_seven</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class is used to check the 5th argument (dict iterator) of</span>
<span class="sd">    the reduce protocol.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span> <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="p">(),</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>


<span class="c"># Test classes for newobj</span>
</div>
<div class="viewcode-block" id="MyInt"><a class="viewcode-back" href="../../test.html#test.pickletester.MyInt">[docs]</a><span class="k">class</span> <span class="nc">MyInt</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="MyFloat"><a class="viewcode-back" href="../../test.html#test.pickletester.MyFloat">[docs]</a><span class="k">class</span> <span class="nc">MyFloat</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="mf">1.0</span>
</div>
<div class="viewcode-block" id="MyComplex"><a class="viewcode-back" href="../../test.html#test.pickletester.MyComplex">[docs]</a><span class="k">class</span> <span class="nc">MyComplex</span><span class="p">(</span><span class="nb">complex</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.0j</span>
</div>
<div class="viewcode-block" id="MyStr"><a class="viewcode-back" href="../../test.html#test.pickletester.MyStr">[docs]</a><span class="k">class</span> <span class="nc">MyStr</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
</div>
<div class="viewcode-block" id="MyUnicode"><a class="viewcode-back" href="../../test.html#test.pickletester.MyUnicode">[docs]</a><span class="k">class</span> <span class="nc">MyUnicode</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="s">&quot;hello </span><span class="se">\u1234</span><span class="s">&quot;</span>
</div>
<div class="viewcode-block" id="MyTuple"><a class="viewcode-back" href="../../test.html#test.pickletester.MyTuple">[docs]</a><span class="k">class</span> <span class="nc">MyTuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MyList"><a class="viewcode-back" href="../../test.html#test.pickletester.MyList">[docs]</a><span class="k">class</span> <span class="nc">MyList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="MyDict"><a class="viewcode-back" href="../../test.html#test.pickletester.MyDict">[docs]</a><span class="k">class</span> <span class="nc">MyDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="MySet"><a class="viewcode-back" href="../../test.html#test.pickletester.MySet">[docs]</a><span class="k">class</span> <span class="nc">MySet</span><span class="p">(</span><span class="nb">set</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="MyFrozenSet"><a class="viewcode-back" href="../../test.html#test.pickletester.MyFrozenSet">[docs]</a><span class="k">class</span> <span class="nc">MyFrozenSet</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">})</span>
</div>
<span class="n">myclasses</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyInt</span><span class="p">,</span> <span class="n">MyFloat</span><span class="p">,</span>
             <span class="n">MyComplex</span><span class="p">,</span>
             <span class="n">MyStr</span><span class="p">,</span> <span class="n">MyUnicode</span><span class="p">,</span>
             <span class="n">MyTuple</span><span class="p">,</span> <span class="n">MyList</span><span class="p">,</span> <span class="n">MyDict</span><span class="p">,</span> <span class="n">MySet</span><span class="p">,</span> <span class="n">MyFrozenSet</span><span class="p">]</span>


<div class="viewcode-block" id="SlotList"><a class="viewcode-back" href="../../test.html#test.pickletester.SlotList">[docs]</a><span class="k">class</span> <span class="nc">SlotList</span><span class="p">(</span><span class="n">MyList</span><span class="p">):</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SimpleNewObj"><a class="viewcode-back" href="../../test.html#test.pickletester.SimpleNewObj">[docs]</a><span class="k">class</span> <span class="nc">SimpleNewObj</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c"># raise an error, to make sure this isn&#39;t called</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;SimpleNewObj.__init__() didn&#39;t expect to get called&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>
</div>
<div class="viewcode-block" id="BadGetattr"><a class="viewcode-back" href="../../test.html#test.pickletester.BadGetattr">[docs]</a><span class="k">class</span> <span class="nc">BadGetattr</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foo</span>

</div>
<div class="viewcode-block" id="AbstractPickleModuleTests"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractPickleModuleTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="AbstractPickleModuleTests.test_dump_closed_file"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_dump_closed_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_dump_closed_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleModuleTests.test_load_closed_file"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_load_closed_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_closed_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleModuleTests.test_load_from_and_dump_to_file"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_load_from_and_dump_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_from_and_dump_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="p">{},</span> <span class="mi">124</span><span class="p">]</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">unpickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickled</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleModuleTests.test_highest_protocol"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_highest_protocol">[docs]</a>    <span class="k">def</span> <span class="nf">test_highest_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Of course this needs to be changed when HIGHEST_PROTOCOL changes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleModuleTests.test_callapi"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_callapi">[docs]</a>    <span class="k">def</span> <span class="nf">test_callapi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="c"># With and without keyword arguments</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleModuleTests.test_bad_init"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_bad_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test issue3664 (pickle can segfault from a badly initialized Pickler).</span>
        <span class="c"># Override initialization without calling __init__() of the superclass.</span>
        <span class="k">class</span> <span class="nc">BadPickler</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

        <span class="k">class</span> <span class="nc">BadUnpickler</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">PicklingError</span><span class="p">,</span> <span class="n">BadPickler</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">,</span> <span class="n">BadUnpickler</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPickleModuleTests.test_bad_input"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPickleModuleTests.test_bad_input">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test issue4298</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="mh">0x58</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AbstractPersistentPicklerTests"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPersistentPicklerTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractPersistentPicklerTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c"># This class defines persistent_id() and persistent_load()</span>
    <span class="c"># functions that should be used by the pickler.  All even integers</span>
    <span class="c"># are pickled using persistent ids.</span>

<div class="viewcode-block" id="AbstractPersistentPicklerTests.persistent_id"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPersistentPicklerTests.persistent_id">[docs]</a>    <span class="k">def</span> <span class="nf">persistent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">object</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">object</span> <span class="o">==</span> <span class="s">&quot;test_false_value&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">false_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="AbstractPersistentPicklerTests.persistent_load"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPersistentPicklerTests.persistent_load">[docs]</a>    <span class="k">def</span> <span class="nf">persistent_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">oid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_false_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="s">&quot;test_false_value&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">object</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">object</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="nb">object</span>
</div>
<div class="viewcode-block" id="AbstractPersistentPicklerTests.test_persistence"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPersistentPicklerTests.test_persistence">[docs]</a>    <span class="k">def</span> <span class="nf">test_persistence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;test_false_value&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">false_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_false_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">proto</span><span class="p">)),</span> <span class="n">L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_count</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">false_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_count</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_false_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractPicklerUnpicklerObjectTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">pickler_class</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">unpickler_class</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.setUp"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpickler_class</span>
</div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_clear_pickler_memo"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_clear_pickler_memo">[docs]</a>    <span class="k">def</span> <span class="nf">test_clear_pickler_memo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># To test whether clear_memo() has any effect, we pickle an object,</span>
        <span class="c"># then pickle it again without clearing the memo; the two serialized</span>
        <span class="c"># forms should be different. If we clear_memo() and then pickle the</span>
        <span class="c"># object again, the third serialized form should be identical to the</span>
        <span class="c"># first one we obtained.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">first_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="c"># Reset BytesIO object.</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">second_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="c"># Reset the Pickler and BytesIO objects.</span>
        <span class="n">pickler</span><span class="o">.</span><span class="n">clear_memo</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">third_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">first_pickled</span><span class="p">,</span> <span class="n">second_pickled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">first_pickled</span><span class="p">,</span> <span class="n">third_pickled</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_priming_pickler_memo"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_priming_pickler_memo">[docs]</a>    <span class="k">def</span> <span class="nf">test_priming_pickler_memo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that we can set the Pickler&#39;s memo attribute.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">first_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">primed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">primed</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="n">pickler</span><span class="o">.</span><span class="n">memo</span>

        <span class="n">primed</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">primed_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">first_pickled</span><span class="p">,</span> <span class="n">primed_pickled</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_priming_unpickler_memo"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_priming_unpickler_memo">[docs]</a>    <span class="k">def</span> <span class="nf">test_priming_unpickler_memo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that we can set the Unpickler&#39;s memo attribute.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">first_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">primed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">primed</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="n">pickler</span><span class="o">.</span><span class="n">memo</span>

        <span class="n">primed</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">primed_pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="n">unpickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpickler_class</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">first_pickled</span><span class="p">))</span>
        <span class="n">unpickled_data1</span> <span class="o">=</span> <span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickled_data1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="n">primed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpickler_class</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">primed_pickled</span><span class="p">))</span>
        <span class="n">primed</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="n">unpickler</span><span class="o">.</span><span class="n">memo</span>
        <span class="n">unpickled_data2</span> <span class="o">=</span> <span class="n">primed</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="n">primed</span><span class="o">.</span><span class="n">memo</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickled_data2</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">unpickled_data2</span> <span class="ow">is</span> <span class="n">unpickled_data1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_reusing_unpickler_objects"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_reusing_unpickler_objects">[docs]</a>    <span class="k">def</span> <span class="nf">test_reusing_unpickler_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
        <span class="n">pickled1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="n">data2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;abcdefg&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
        <span class="n">pickled2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pickled1</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">unpickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="n">data1</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pickled2</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="n">data2</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_multiple_unpicklings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioclass</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">):</span>
                <span class="n">data1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2000</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="s">&quot;abcde&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">]</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">ioclass</span><span class="p">()</span>
                <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
                <span class="n">pickled</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

                <span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">ioclass</span><span class="p">(</span><span class="n">pickled</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">unpickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">seekable</span><span class="p">():</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="n">data1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">seekable</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">pickled</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_multiple_unpicklings_seekable"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_multiple_unpicklings_seekable">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_unpicklings_seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_multiple_unpicklings</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_multiple_unpicklings_unseekable"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_multiple_unpicklings_unseekable">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_unpicklings_unseekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_multiple_unpicklings</span><span class="p">(</span><span class="n">UnseekableIO</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractPicklerUnpicklerObjectTests.test_unpickling_buffering_readline"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractPicklerUnpicklerObjectTests.test_unpickling_buffering_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_unpickling_buffering_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #12687: the unpickler&#39;s buffering logic could fail with</span>
        <span class="c"># text mode opcodes.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">buf_size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedRandom</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="n">buffer_size</span><span class="o">=</span><span class="n">buf_size</span><span class="p">)</span>
                <span class="n">pickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                <span class="n">pickler</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">unpickler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">unpickler</span><span class="o">.</span><span class="n">load</span><span class="p">(),</span> <span class="n">data</span><span class="p">)</span>


<span class="c"># Tests for dispatch_table attribute</span>
</div></div>
<span class="n">REDUCE_A</span> <span class="o">=</span> <span class="s">&#39;reduce_A&#39;</span>

<div class="viewcode-block" id="AAA"><a class="viewcode-back" href="../../test.html#test.pickletester.AAA">[docs]</a><span class="k">class</span> <span class="nc">AAA</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="n">REDUCE_A</span><span class="p">,)</span>
</div>
<div class="viewcode-block" id="BBB"><a class="viewcode-back" href="../../test.html#test.pickletester.BBB">[docs]</a><span class="k">class</span> <span class="nc">BBB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractDispatchTableTests"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractDispatchTableTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractDispatchTableTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="AbstractDispatchTableTests.test_default_dispatch_table"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractDispatchTableTests.test_default_dispatch_table">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_dispatch_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No dispatch_table attribute by default</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">dispatch_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&#39;dispatch_table&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractDispatchTableTests.test_class_dispatch_table"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractDispatchTableTests.test_class_dispatch_table">[docs]</a>    <span class="k">def</span> <span class="nf">test_class_dispatch_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A dispatch_table attribute can be specified class-wide</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dispatch_table</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">MyPickler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">):</span>
            <span class="n">dispatch_table</span> <span class="o">=</span> <span class="n">dt</span>

        <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">MyPickler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dispatch_table</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_test_dispatch_table</span><span class="p">(</span><span class="n">dumps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractDispatchTableTests.test_instance_dispatch_table"><a class="viewcode-back" href="../../test.html#test.pickletester.AbstractDispatchTableTests.test_instance_dispatch_table">[docs]</a>    <span class="k">def</span> <span class="nf">test_instance_dispatch_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A dispatch_table attribute can also be specified instance-wide</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dispatch_table</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickler_class</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">dispatch_table</span> <span class="o">=</span> <span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dispatch_table</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_test_dispatch_table</span><span class="p">(</span><span class="n">dumps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_dispatch_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">dispatch_table</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">custom_load_dump</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">default_load_dump</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c"># pickling complex numbers using protocol 0 relies on copyreg</span>
        <span class="c"># so check pickling a complex number still works</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2j</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>

        <span class="c"># modify pickling of complex</span>
        <span class="n">REDUCE_1</span> <span class="o">=</span> <span class="s">&#39;reduce_1&#39;</span>
        <span class="k">def</span> <span class="nf">reduce_1</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="n">REDUCE_1</span><span class="p">,)</span>
        <span class="n">dispatch_table</span><span class="p">[</span><span class="nb">complex</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduce_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">REDUCE_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>

        <span class="c"># check picklability of AAA and BBB</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">AAA</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">BBB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">REDUCE_A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">BBB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">REDUCE_A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">BBB</span><span class="p">)</span>

        <span class="c"># modify pickling of BBB</span>
        <span class="n">dispatch_table</span><span class="p">[</span><span class="n">BBB</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduce_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">REDUCE_A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">REDUCE_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">REDUCE_A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">BBB</span><span class="p">)</span>

        <span class="c"># revert pickling of BBB and modify pickling of AAA</span>
        <span class="n">REDUCE_2</span> <span class="o">=</span> <span class="s">&#39;reduce_2&#39;</span>
        <span class="k">def</span> <span class="nf">reduce_2</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="n">REDUCE_2</span><span class="p">,)</span>
        <span class="n">dispatch_table</span><span class="p">[</span><span class="n">AAA</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduce_2</span>
        <span class="k">del</span> <span class="n">dispatch_table</span><span class="p">[</span><span class="n">BBB</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">REDUCE_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">custom_load_dump</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">BBB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">REDUCE_A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">default_load_dump</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">BBB</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c"># Print some stuff that can be used to rewrite DATA{0,1,2}</span>
    <span class="kn">from</span> <span class="nn">pickletools</span> <span class="kn">import</span> <span class="n">dis</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">create_data</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;DATA{0} = (&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">20</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">20</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;    {0!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# Disassembly of DATA{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;DATA{0}_DIS = </span><span class="se">\&quot;\&quot;\&quot;\\</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">dis</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\&quot;\&quot;\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>