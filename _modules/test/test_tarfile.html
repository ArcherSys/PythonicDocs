

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_tarfile &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_tarfile</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_tarfile</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">tarfile</span>

<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span><span class="p">,</span> <span class="n">script_helper</span>

<span class="c"># Check for our compression modules.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gzip</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">gzip</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">bz2</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">bz2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">lzma</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">lzma</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="md5sum"><a class="viewcode-back" href="../../test.html#test.test_tarfile.md5sum">[docs]</a><span class="k">def</span> <span class="nf">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">md5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</div>
<span class="n">TEMPDIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-tardir&quot;</span>
<span class="n">tarextdir</span> <span class="o">=</span> <span class="n">TEMPDIR</span> <span class="o">+</span> <span class="s">&#39;-extract-test&#39;</span>
<span class="n">tarname</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&quot;testtar.tar&quot;</span><span class="p">)</span>
<span class="n">gzipname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;testtar.tar.gz&quot;</span><span class="p">)</span>
<span class="n">bz2name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;testtar.tar.bz2&quot;</span><span class="p">)</span>
<span class="n">xzname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;testtar.tar.xz&quot;</span><span class="p">)</span>
<span class="n">tmpname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;tmp.tar&quot;</span><span class="p">)</span>
<span class="n">dotlessname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;testtar&quot;</span><span class="p">)</span>

<span class="n">md5_regtype</span> <span class="o">=</span> <span class="s">&quot;65f477c818ad9e15f7feab0c6d37742f&quot;</span>
<span class="n">md5_sparse</span> <span class="o">=</span> <span class="s">&quot;a54fbc4ca4f4399a90e1b27164012fc6&quot;</span>


<div class="viewcode-block" id="TarTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.TarTest">[docs]</a><span class="k">class</span> <span class="nc">TarTest</span><span class="p">:</span>
    <span class="n">tarname</span> <span class="o">=</span> <span class="n">tarname</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="nb">open</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">FileIO</span>
    <span class="n">taropen</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="o">.</span><span class="n">taropen</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span>
</div>
<span class="nd">@support.requires_gzip</span>
<div class="viewcode-block" id="GzipTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipTest">[docs]</a><span class="k">class</span> <span class="nc">GzipTest</span><span class="p">:</span>
    <span class="n">tarname</span> <span class="o">=</span> <span class="n">gzipname</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;gz&#39;</span>
    <span class="nb">open</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span> <span class="k">if</span> <span class="n">gzip</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">taropen</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="o">.</span><span class="n">gzopen</span>
</div>
<span class="nd">@support.requires_bz2</span>
<div class="viewcode-block" id="Bz2Test"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2Test">[docs]</a><span class="k">class</span> <span class="nc">Bz2Test</span><span class="p">:</span>
    <span class="n">tarname</span> <span class="o">=</span> <span class="n">bz2name</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;bz2&#39;</span>
    <span class="nb">open</span> <span class="o">=</span> <span class="n">bz2</span><span class="o">.</span><span class="n">BZ2File</span> <span class="k">if</span> <span class="n">bz2</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">taropen</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="o">.</span><span class="n">bz2open</span>
</div>
<span class="nd">@support.requires_lzma</span>
<div class="viewcode-block" id="LzmaTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaTest</span><span class="p">:</span>
    <span class="n">tarname</span> <span class="o">=</span> <span class="n">xzname</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;xz&#39;</span>
    <span class="nb">open</span> <span class="o">=</span> <span class="n">lzma</span><span class="o">.</span><span class="n">LZMAFile</span> <span class="k">if</span> <span class="n">lzma</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">taropen</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="o">.</span><span class="n">xzopen</span>

</div>
<div class="viewcode-block" id="ReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ReadTest">[docs]</a><span class="k">class</span> <span class="nc">ReadTest</span><span class="p">(</span><span class="n">TarTest</span><span class="p">):</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;r:&quot;</span>

<div class="viewcode-block" id="ReadTest.setUp"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ReadTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                                <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadTest.tearDown"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ReadTest.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="UstarReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest">[docs]</a><span class="k">class</span> <span class="nc">UstarReadTest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="UstarReadTest.test_fileobj_regular_file"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_regular_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_regular_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                    <span class="s">&quot;regular file extraction failed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_regtype</span><span class="p">,</span>
                    <span class="s">&quot;regular file extraction failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_readlines"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_readlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">),</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj1</span><span class="p">:</span>
            <span class="n">lines1</span> <span class="o">=</span> <span class="n">fobj1</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj2</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
            <span class="n">lines2</span> <span class="o">=</span> <span class="n">fobj2</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines1</span><span class="p">,</span> <span class="n">lines2</span><span class="p">,</span>
                    <span class="s">&quot;fileobj.readlines() failed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines2</span><span class="p">),</span> <span class="mi">114</span><span class="p">,</span>
                    <span class="s">&quot;fileobj.readlines() failed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines2</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span>
                    <span class="s">&quot;I will gladly admit that Python is not the fastest &quot;</span>
                    <span class="s">&quot;running scripting language.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="s">&quot;fileobj.readlines() failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_iter"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_iter">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">),</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj1</span><span class="p">:</span>
            <span class="n">lines1</span> <span class="o">=</span> <span class="n">fobj1</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj2</span><span class="p">:</span>
            <span class="n">lines2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">fobj2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines1</span><span class="p">,</span> <span class="n">lines2</span><span class="p">,</span>
                    <span class="s">&quot;fileobj.__iter__() failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_seek"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_seek">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_seek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">),</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;seek() to file&#39;s start failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;seek() to absolute position failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;seek() to negative relative position failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;seek() to positive relative position failed&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2048</span><span class="p">:</span><span class="mi">2058</span><span class="p">],</span>
                     <span class="s">&quot;read() after seek failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;seek() to file&#39;s end failed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span>
                     <span class="s">&quot;read() at file&#39;s end did not return empty string&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;relative seek() to file&#39;s end failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span>
                     <span class="s">&quot;readlines() after seek failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">readline</span><span class="p">()),</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;tell() after readline() failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span> <span class="o">+</span> <span class="mi">512</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span>
                     <span class="s">&quot;tell() after seek() and readline() failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):],</span>
                     <span class="s">&quot;read() after readline() failed&quot;</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_text"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_text">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_regtype</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c"># Issue #13815: seek() complained about a missing</span>
                <span class="c"># flush() method.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;seeking failed in text mode&quot;</span><span class="p">)</span>

    <span class="c"># Test if symbolic and hard links are resolved by extractfile().  The</span>
    <span class="c"># test link members each point to a regular member whose data is</span>
    <span class="c"># supposed to be exported.</span></div>
    <span class="k">def</span> <span class="nf">_test_fileobj_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lnktype</span><span class="p">,</span> <span class="n">regtype</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">lnktype</span><span class="p">)</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">regtype</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="UstarReadTest.test_fileobj_link1"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_link1">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_link1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_fileobj_link</span><span class="p">(</span><span class="s">&quot;ustar/lnktype&quot;</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_link2"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_link2">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_link2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_fileobj_link</span><span class="p">(</span><span class="s">&quot;./ustar/linktest2/lnktype&quot;</span><span class="p">,</span>
                                <span class="s">&quot;ustar/linktest1/regtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_symlink1"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_symlink1">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_symlink1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_fileobj_link</span><span class="p">(</span><span class="s">&quot;ustar/symtype&quot;</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_fileobj_symlink2"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_fileobj_symlink2">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_symlink2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_fileobj_link</span><span class="p">(</span><span class="s">&quot;./ustar/linktest2/symtype&quot;</span><span class="p">,</span>
                                <span class="s">&quot;ustar/linktest1/regtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarReadTest.test_issue14160"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarReadTest.test_issue14160">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue14160</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_fileobj_link</span><span class="p">(</span><span class="s">&quot;symtype2&quot;</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="GzipUstarReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipUstarReadTest">[docs]</a><span class="k">class</span> <span class="nc">GzipUstarReadTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">UstarReadTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2UstarReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2UstarReadTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2UstarReadTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">UstarReadTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="LzmaUstarReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaUstarReadTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaUstarReadTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">UstarReadTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="ListTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ListTest">[docs]</a><span class="k">class</span> <span class="nc">ListTest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c"># Override setUp to use default encoding (UTF-8)</span>
<div class="viewcode-block" id="ListTest.setUp"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ListTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ListTest.test_list"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ListTest.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tio</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">swap_attr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;stdout&#39;</span><span class="p">,</span> <span class="n">tio</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tio</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/conttype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/regtype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/lnktype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;/12345&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;67/longname&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;./ustar/linktest2/symtype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;./ustar/linktest2/lnktype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="c"># Make sure it puts trailing slash for directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/dirtype/&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/dirtype-with-size/&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="c"># Make sure it is able to print unencodable characters</span>
        <span class="k">def</span> <span class="nf">conv</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&#39;surrogateescape&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;backslashreplace&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/umlauts-</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;misc/regtype-hpux-signed-chksum-&#39;</span>
                           <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;misc/regtype-old-v7-signed-chksum-&#39;</span>
                           <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;pax/bad-pax-</span><span class="se">\xe4\xf6\xfc</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">conv</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;pax/hdrcharset-</span><span class="se">\xe4\xf6\xfc</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
        <span class="c"># Make sure it prints files separated by one newline without any</span>
        <span class="c"># &#39;ls -l&#39;-like accessories if verbose flag is not being used</span>
        <span class="c"># ...</span>
        <span class="c"># ustar/conttype</span>
        <span class="c"># ustar/regtype</span>
        <span class="c"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;ustar/conttype ?</span><span class="se">\r</span><span class="s">?</span><span class="se">\n</span><span class="s">&#39;</span>
                              <span class="n">br</span><span class="s">&#39;ustar/regtype ?</span><span class="se">\r</span><span class="s">?</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Make sure it does not print the source of link without verbose flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;link to&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ListTest.test_list_verbose"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ListTest.test_list_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tio</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">swap_attr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;stdout&#39;</span><span class="p">,</span> <span class="n">tio</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tio</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="c"># Make sure it prints files separated by one newline with &#39;ls -l&#39;-like</span>
        <span class="c"># accessories if verbose flag is being used</span>
        <span class="c"># ...</span>
        <span class="c"># ?rw-r--r-- tarfile/tarfile     7011 2003-01-06 07:19:43 ustar/conttype</span>
        <span class="c"># ?rw-r--r-- tarfile/tarfile     7011 2003-01-06 07:19:43 ustar/regtype</span>
        <span class="c"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="n">br</span><span class="s">&#39;\?rw-r--r-- tarfile/tarfile\s+7011 &#39;</span>
                               <span class="n">br</span><span class="s">&#39;\d{4}-\d\d-\d\d\s+\d\d:\d\d:\d\d &#39;</span>
                               <span class="n">br</span><span class="s">&#39;ustar/\w+type ?</span><span class="se">\r</span><span class="s">?</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c"># Make sure it prints the source of link with verbose flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;ustar/symtype -&gt; regtype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;./ustar/linktest2/symtype -&gt; ../linktest1/regtype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;./ustar/linktest2/lnktype link to &#39;</span>
                      <span class="n">b</span><span class="s">&#39;./ustar/linktest1/regtype&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;gnu&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;/123&#39;</span> <span class="o">*</span> <span class="mi">125</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;/longlink link to gnu&#39;</span> <span class="o">+</span>
                      <span class="p">(</span><span class="n">b</span><span class="s">&#39;/123&#39;</span> <span class="o">*</span> <span class="mi">125</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;/longname&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;pax&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;/123&#39;</span> <span class="o">*</span> <span class="mi">125</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;/longlink link to pax&#39;</span> <span class="o">+</span>
                      <span class="p">(</span><span class="n">b</span><span class="s">&#39;/123&#39;</span> <span class="o">*</span> <span class="mi">125</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;/longname&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="GzipListTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipListTest">[docs]</a><span class="k">class</span> <span class="nc">GzipListTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">ListTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="Bz2ListTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2ListTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2ListTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">ListTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="LzmaListTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaListTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaListTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">ListTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="CommonReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommonReadTest">[docs]</a><span class="k">class</span> <span class="nc">CommonReadTest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">):</span>

<div class="viewcode-block" id="CommonReadTest.test_empty_tarfile"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommonReadTest.test_empty_tarfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_tarfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for issue6123: Allow opening empty archives.</span>
        <span class="c"># This test checks if tarfile.open() is able to open an empty tar</span>
        <span class="c"># archive successfully. Note that an empty tar archive is not the</span>
        <span class="c"># same as an empty file!</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)):</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;tarfile.open() failed on empty archive&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CommonReadTest.test_non_existent_tarfile"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommonReadTest.test_non_existent_tarfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_non_existent_tarfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for issue11513: prevent non-existent gzipped tarfiles raising</span>
        <span class="c"># multiple exceptions.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">FileNotFoundError</span><span class="p">,</span> <span class="s">&quot;xxx&quot;</span><span class="p">):</span>
            <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommonReadTest.test_null_tarfile"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommonReadTest.test_null_tarfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_null_tarfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for issue6123: Allow opening empty archives.</span>
        <span class="c"># This test guarantees that tarfile.open() does not treat an empty</span>
        <span class="c"># file as an empty tar archive.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommonReadTest.test_ignore_zeros"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommonReadTest.test_ignore_zeros">[docs]</a>    <span class="k">def</span> <span class="nf">test_ignore_zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test TarFile&#39;s ignore_zeros option.</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;a&#39;</span><span class="p">):</span>
            <span class="c"># Test if EOFHeaderError (&#39;\0&#39;) and InvalidHeaderError (&#39;a&#39;)</span>
            <span class="c"># are ignored correctly.</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tobuf</span><span class="p">())</span>

            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">ignore_zeros</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">(),</span> <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">],</span>
                    <span class="s">&quot;ignore_zeros=True should have skipped the </span><span class="si">%r</span><span class="s">-blocks&quot;</span> <span class="o">%</span>
                    <span class="n">char</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="MiscReadTestBase"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase">[docs]</a><span class="k">class</span> <span class="nc">MiscReadTestBase</span><span class="p">(</span><span class="n">CommonReadTest</span><span class="p">):</span>
<div class="viewcode-block" id="MiscReadTestBase.requires_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.requires_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">requires_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_no_name_argument"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_no_name_argument">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_name_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires_name_attribute</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_no_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_no_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">fobj</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_empty_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_empty_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_int_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_int_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_int_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 21044: tarfile.open() should handle fileobj with an integer</span>
        <span class="c"># &#39;name&#39; attribute.</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDONLY</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_bytes_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_bytes_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires_name_attribute</span><span class="p">()</span>
        <span class="n">tarname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fsencode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_illegal_mode_arg"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_illegal_mode_arg">[docs]</a>    <span class="k">def</span> <span class="nf">test_illegal_mode_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s">&#39;mode must be &#39;</span><span class="p">):</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taropen</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s">&#39;mode must be &#39;</span><span class="p">):</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taropen</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&#39;rw&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s">&#39;mode must be &#39;</span><span class="p">):</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taropen</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_fileobj_with_offset"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_fileobj_with_offset">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_with_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Skip the first member and store values from the second member</span>
        <span class="c"># of the testtar.</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">offset</span>
            <span class="k">with</span> <span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Open the testtar and seek to the offset of the second member.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

            <span class="c"># Test if the tarfile starts with the second member.</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r:&quot;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="c"># Read to the end of fileobj and test if seeking back to the</span>
            <span class="c"># beginning works.</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span><span class="p">,</span>
                    <span class="s">&quot;seek back did not work&quot;</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_fail_comp"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_fail_comp">[docs]</a>    <span class="k">def</span> <span class="nf">test_fail_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># For Gzip and Bz2 Tests: fail with a ReadError on an uncompressed file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">tarname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">,</span>
                              <span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_v7_dirtype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_v7_dirtype">[docs]</a>    <span class="k">def</span> <span class="nf">test_v7_dirtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test old style dirtype member (bug #1336623):</span>
        <span class="c"># Old V7 tars create directory members using an AREGTYPE</span>
        <span class="c"># header with a &quot;/&quot; appended to the filename field.</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;misc/dirtype-old-v7&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">DIRTYPE</span><span class="p">,</span>
                <span class="s">&quot;v7 dirtype failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_xstar_type"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_xstar_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_xstar_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The xstar format stores extra atime and ctime fields inside the</span>
        <span class="c"># space reserved for the prefix field. The prefix field must be</span>
        <span class="c"># ignored in this case, otherwise it will mess up the name.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;misc/regtype-xstar&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;failed to find misc/regtype-xstar (mangled prefix?)&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_check_members"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_check_members">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tarinfo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">mtime</span><span class="p">),</span> <span class="mi">0</span><span class="n">o7606136617</span><span class="p">,</span>
                    <span class="s">&quot;wrong mtime for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;ustar/&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;tarfile&quot;</span><span class="p">,</span>
                    <span class="s">&quot;wrong uname for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_find_members"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_find_members">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;misc/eof&quot;</span><span class="p">,</span>
                <span class="s">&quot;could not find all members&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;link&quot;</span><span class="p">),</span>
                         <span class="s">&quot;Missing hardlink implementation&quot;</span><span class="p">)</span>
    <span class="nd">@support.skip_unless_symlink</span>
<div class="viewcode-block" id="MiscReadTestBase.test_extract_hardlink"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_extract_hardlink">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_hardlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test hardlink extraction (e.g. bug #857297).</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">errorlevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/regtype&quot;</span><span class="p">))</span>

            <span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;ustar/lnktype&quot;</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/lnktype&quot;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/lnktype&quot;</span><span class="p">),</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_regtype</span><span class="p">)</span>

            <span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s">&quot;ustar/symtype&quot;</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/symtype&quot;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;ustar/symtype&quot;</span><span class="p">),</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_regtype</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_extractall"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_extractall">[docs]</a>    <span class="k">def</span> <span class="nf">test_extractall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test if extractall() correctly restores directory permissions</span>
        <span class="c"># and times (see issue1735).</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="n">DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;extractall&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tar</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">isdir</span><span class="p">()]</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="n">directories</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tarinfo</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
                    <span class="c"># Win32 has no support for fine grained permissions.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o777</span><span class="p">,</span>
                                     <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o777</span><span class="p">)</span>
                <span class="k">def</span> <span class="nf">format_mtime</span><span class="p">(</span><span class="n">mtime</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                        <span class="k">return</span> <span class="s">&quot;{} ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="n">mtime</span><span class="o">.</span><span class="n">hex</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s">&quot;{!r} (int)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtime</span><span class="p">)</span>
                <span class="n">file_mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&quot;tar mtime {0} != file time {1} of path {2!a}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">format_mtime</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">mtime</span><span class="p">),</span>
                    <span class="n">format_mtime</span><span class="p">(</span><span class="n">file_mtime</span><span class="p">),</span>
                    <span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">mtime</span><span class="p">,</span> <span class="n">file_mtime</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">DIR</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_extract_directory"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_extract_directory">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dirtype</span> <span class="o">=</span> <span class="s">&quot;ustar/dirtype&quot;</span>
        <span class="n">DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;extractdir&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">dirtype</span><span class="p">)</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">DIR</span><span class="p">)</span>
                <span class="n">extracted</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="n">dirtype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">extracted</span><span class="p">),</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o777</span><span class="p">,</span> <span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">DIR</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_init_close_fobj"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_init_close_fobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_init_close_fobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #7341: Close the internal file object in the TarFile</span>
        <span class="c"># constructor in case of an error. For the test we rely on</span>
        <span class="c"># the fact that opening an empty file raises a ReadError.</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;empty&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ReadError not raised&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscReadTestBase.test_parallel_iteration"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTestBase.test_parallel_iteration">[docs]</a>    <span class="k">def</span> <span class="nf">test_parallel_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #16601: Restarting iteration over tarfile continued</span>
        <span class="c"># from where it left off.</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tar</span><span class="p">,</span> <span class="n">tar</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">m2</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="n">m2</span><span class="o">.</span><span class="n">get_info</span><span class="p">())</span>
</div></div>
<div class="viewcode-block" id="MiscReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscReadTest">[docs]</a><span class="k">class</span> <span class="nc">MiscReadTest</span><span class="p">(</span><span class="n">MiscReadTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">test_fail_comp</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="GzipMiscReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipMiscReadTest">[docs]</a><span class="k">class</span> <span class="nc">GzipMiscReadTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">MiscReadTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2MiscReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2MiscReadTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2MiscReadTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">MiscReadTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="Bz2MiscReadTest.requires_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2MiscReadTest.requires_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">requires_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;BZ2File have no name attribute&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="LzmaMiscReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaMiscReadTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaMiscReadTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">MiscReadTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="LzmaMiscReadTest.requires_name_attribute"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaMiscReadTest.requires_name_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">requires_name_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;LZMAFile have no name attribute&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="StreamReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamReadTest">[docs]</a><span class="k">class</span> <span class="nc">StreamReadTest</span><span class="p">(</span><span class="n">CommonReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;r|&quot;</span>

<div class="viewcode-block" id="StreamReadTest.test_read_through"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamReadTest.test_read_through">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_through</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #11224: A poorly designed _FileInFile.read() method</span>
        <span class="c"># caused seeking errors with stream tar files.</span>
        <span class="k">for</span> <span class="n">tarinfo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">isreg</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">buf</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">StreamError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;simple read-through using &quot;</span>
                                  <span class="s">&quot;TarFile.extractfile() failed&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">buf</span><span class="p">:</span>
                        <span class="k">break</span>
</div>
<div class="viewcode-block" id="StreamReadTest.test_fileobj_regular_file"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamReadTest.test_fileobj_regular_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_regular_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c"># get &quot;regtype&quot; (can&#39;t use getmember)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                <span class="s">&quot;regular file extraction failed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_regtype</span><span class="p">,</span>
                <span class="s">&quot;regular file extraction failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StreamReadTest.test_provoke_stream_error"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamReadTest.test_provoke_stream_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_provoke_stream_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c"># read the first member</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">StreamError</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StreamReadTest.test_compare_members"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamReadTest.test_compare_members">[docs]</a>    <span class="k">def</span> <span class="nf">test_compare_members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tar1</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span>

            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">tar1</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="n">tar2</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">t1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="s">&quot;stream.next() failed.&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">t2</span><span class="o">.</span><span class="n">islnk</span><span class="p">()</span> <span class="ow">or</span> <span class="n">t2</span><span class="o">.</span><span class="n">issym</span><span class="p">():</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">StreamError</span><span class="p">):</span>
                        <span class="n">tar2</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">v1</span> <span class="o">=</span> <span class="n">tar1</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="n">tar2</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="s">&quot;stream.extractfile() failed&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">v2</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                        <span class="s">&quot;stream extraction failed&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div></div>
<div class="viewcode-block" id="GzipStreamReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipStreamReadTest">[docs]</a><span class="k">class</span> <span class="nc">GzipStreamReadTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">StreamReadTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2StreamReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2StreamReadTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2StreamReadTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">StreamReadTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="LzmaStreamReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaStreamReadTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaStreamReadTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">StreamReadTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="DetectReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.DetectReadTest">[docs]</a><span class="k">class</span> <span class="nc">DetectReadTest</span><span class="p">(</span><span class="n">TarTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_testfunc_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_testfunc_fileobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_test_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testfunc</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">):</span>
                <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">):</span>
                <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r|&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">):</span>
                <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r:&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">):</span>
                <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r|&quot;</span><span class="p">)</span>
        <span class="n">testfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">testfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;r:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">testfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;r:*&quot;</span><span class="p">)</span>
        <span class="n">testfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;r|&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">testfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;r|*&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="DetectReadTest.test_detect_file"><a class="viewcode-back" href="../../test.html#test.test_tarfile.DetectReadTest.test_detect_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_detect_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_modes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testfunc_file</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DetectReadTest.test_detect_fileobj"><a class="viewcode-back" href="../../test.html#test.test_tarfile.DetectReadTest.test_detect_fileobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_detect_fileobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_modes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_testfunc_fileobj</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="GzipDetectReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipDetectReadTest">[docs]</a><span class="k">class</span> <span class="nc">GzipDetectReadTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">DetectReadTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2DetectReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2DetectReadTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2DetectReadTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">DetectReadTest</span><span class="p">):</span>
<div class="viewcode-block" id="Bz2DetectReadTest.test_detect_stream_bz2"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2DetectReadTest.test_detect_stream_bz2">[docs]</a>    <span class="k">def</span> <span class="nf">test_detect_stream_bz2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Originally, tarfile&#39;s stream detection looked for the string</span>
        <span class="c"># &quot;BZh91&quot; at the start of the file. This is incorrect because</span>
        <span class="c"># the &#39;9&#39; represents the blocksize (900kB). If the file was</span>
        <span class="c"># compressed using another blocksize autodetection fails.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c"># Compress with blocksize 100kB, the file starts with &quot;BZh11&quot;.</span>
        <span class="k">with</span> <span class="n">bz2</span><span class="o">.</span><span class="n">BZ2File</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_testfunc_file</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;r|*&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="LzmaDetectReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaDetectReadTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaDetectReadTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">DetectReadTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="MemberReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest">[docs]</a><span class="k">class</span> <span class="nc">MemberReadTest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_test_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tarinfo</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chksum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span> <span class="n">chksum</span><span class="p">,</span>
                        <span class="s">&quot;wrong md5sum for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;mtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o7606136617</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;uid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;gid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="s">&quot;old-v7&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="c"># V7 tar can&#39;t handle alphabetic owners.</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;uname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;tarfile&quot;</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;gname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;tarfile&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">,</span>
                    <span class="s">&quot;wrong value in </span><span class="si">%s</span><span class="s"> field of </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<div class="viewcode-block" id="MemberReadTest.test_find_regtype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_regtype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_regtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7011</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_regtype</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_conttype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_conttype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_conttype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/conttype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7011</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_regtype</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_dirtype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_dirtype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_dirtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/dirtype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_dirtype_with_size"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_dirtype_with_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_dirtype_with_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/dirtype-with-size&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_lnktype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_lnktype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_lnktype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/lnktype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linkname</span><span class="o">=</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_symtype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_symtype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_symtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/symtype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linkname</span><span class="o">=</span><span class="s">&quot;regtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_blktype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_blktype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_blktype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/blktype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">devmajor</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">devminor</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_chrtype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_chrtype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_chrtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/chrtype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">devmajor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">devminor</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_fifotype"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_fifotype">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_fifotype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/fifotype&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_sparse"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_sparse">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/sparse&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">86016</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_sparse</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_gnusparse"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_gnusparse">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_gnusparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;gnu/sparse&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">86016</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_sparse</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_gnusparse_00"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_gnusparse_00">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_gnusparse_00</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;gnu/sparse-0.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">86016</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_sparse</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_gnusparse_01"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_gnusparse_01">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_gnusparse_01</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;gnu/sparse-0.1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">86016</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_sparse</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_gnusparse_10"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_gnusparse_10">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_gnusparse_10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;gnu/sparse-1.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">86016</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_sparse</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_umlauts"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_umlauts">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_umlauts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/umlauts-&quot;</span>
                                     <span class="s">&quot;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7011</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_regtype</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_ustar_longname"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_ustar_longname">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_ustar_longname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ustar/&quot;</span> <span class="o">+</span> <span class="s">&quot;12345/&quot;</span> <span class="o">*</span> <span class="mi">39</span> <span class="o">+</span> <span class="s">&quot;1234567/longname&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_regtype_oldv7"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_regtype_oldv7">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_regtype_oldv7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;misc/regtype-old-v7&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7011</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_regtype</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MemberReadTest.test_find_pax_umlauts"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MemberReadTest.test_find_pax_umlauts">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_pax_umlauts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                                <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;pax/umlauts-&quot;</span>
                                     <span class="s">&quot;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_member</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7011</span><span class="p">,</span> <span class="n">chksum</span><span class="o">=</span><span class="n">md5_regtype</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="LongnameTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LongnameTest">[docs]</a><span class="k">class</span> <span class="nc">LongnameTest</span><span class="p">:</span>

<div class="viewcode-block" id="LongnameTest.test_read_longname"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LongnameTest.test_read_longname">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_longname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test reading of longname (bug #1471427).</span>
        <span class="n">longname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">125</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">longname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;longname not found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">DIRTYPE</span><span class="p">,</span>
                <span class="s">&quot;read longname as dirtype&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongnameTest.test_read_longlink"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LongnameTest.test_read_longlink">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_longlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">longname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">125</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="n">longlink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">125</span> <span class="o">+</span> <span class="s">&quot;longlink&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">longlink</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;longlink not found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span><span class="p">,</span> <span class="n">longname</span><span class="p">,</span> <span class="s">&quot;linkname wrong&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongnameTest.test_truncated_longname"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LongnameTest.test_truncated_longname">[docs]</a>    <span class="k">def</span> <span class="nf">test_truncated_longname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">longname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">125</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">longname</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">512</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">):</span>
            <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;foo.tar&quot;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongnameTest.test_header_offset"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LongnameTest.test_header_offset">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test if the start offset of the TarInfo object includes</span>
        <span class="c"># the preceding extended header.</span>
        <span class="n">longname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">125</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">longname</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="o">.</span><span class="n">frombuf</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span>
                                              <span class="s">&quot;iso8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">longnametype</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="GNUReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUReadTest">[docs]</a><span class="k">class</span> <span class="nc">GNUReadTest</span><span class="p">(</span><span class="n">LongnameTest</span><span class="p">,</span> <span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">subdir</span> <span class="o">=</span> <span class="s">&quot;gnu&quot;</span>
    <span class="n">longnametype</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">GNUTYPE_LONGNAME</span>

    <span class="c"># Since 3.2 tarfile is supposed to accurately restore sparse members and</span>
    <span class="c"># produce files with holes. This is what we actually want to test here.</span>
    <span class="c"># Unfortunately, not all platforms/filesystems support sparse files, and</span>
    <span class="c"># even on platforms that do it is non-trivial to make reliable assertions</span>
    <span class="c"># about holes in files. Therefore, we first do one basic test which works</span>
    <span class="c"># an all platforms, and after that a test that will work only on</span>
    <span class="c"># platforms/filesystems that prove to support sparse files.</span>
    <span class="k">def</span> <span class="nf">_test_sparse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_sparse</span><span class="p">,</span>
                <span class="s">&quot;wrong md5sum for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fs_supports_holes</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">st_blocks</span> <span class="o">*</span> <span class="mi">512</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">st_size</span><span class="p">)</span>

<div class="viewcode-block" id="GNUReadTest.test_sparse_file_old"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUReadTest.test_sparse_file_old">[docs]</a>    <span class="k">def</span> <span class="nf">test_sparse_file_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_sparse_file</span><span class="p">(</span><span class="s">&quot;gnu/sparse&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUReadTest.test_sparse_file_00"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUReadTest.test_sparse_file_00">[docs]</a>    <span class="k">def</span> <span class="nf">test_sparse_file_00</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_sparse_file</span><span class="p">(</span><span class="s">&quot;gnu/sparse-0.0&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUReadTest.test_sparse_file_01"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUReadTest.test_sparse_file_01">[docs]</a>    <span class="k">def</span> <span class="nf">test_sparse_file_01</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_sparse_file</span><span class="p">(</span><span class="s">&quot;gnu/sparse-0.1&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUReadTest.test_sparse_file_10"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUReadTest.test_sparse_file_10">[docs]</a>    <span class="k">def</span> <span class="nf">test_sparse_file_10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_sparse_file</span><span class="p">(</span><span class="s">&quot;gnu/sparse-1.0&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_fs_supports_holes</span><span class="p">():</span>
        <span class="c"># Return True if the platform knows the st_blocks stat attribute and</span>
        <span class="c"># uses st_blocks units of 512 bytes, and if the filesystem is able to</span>
        <span class="c"># store holes in files.</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;linux&quot;</span><span class="p">):</span>
            <span class="c"># Linux evidentially has 512 byte st_blocks units.</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;sparse-test&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">st_blocks</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="PaxReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PaxReadTest">[docs]</a><span class="k">class</span> <span class="nc">PaxReadTest</span><span class="p">(</span><span class="n">LongnameTest</span><span class="p">,</span> <span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">subdir</span> <span class="o">=</span> <span class="s">&quot;pax&quot;</span>
    <span class="n">longnametype</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">XHDTYPE</span>

<div class="viewcode-block" id="PaxReadTest.test_pax_global_headers"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PaxReadTest.test_pax_global_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_pax_global_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;pax/regtype1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">gname</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">pax_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;VENDOR.umlauts&quot;</span><span class="p">),</span>
                             <span class="s">&quot;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;pax/regtype2&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">gname</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">pax_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;VENDOR.umlauts&quot;</span><span class="p">),</span>
                             <span class="s">&quot;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;pax/regtype3&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;tarfile&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">gname</span><span class="p">,</span> <span class="s">&quot;tarfile&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">pax_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;VENDOR.umlauts&quot;</span><span class="p">),</span>
                             <span class="s">&quot;</span><span class="se">\xc4\xd6\xdc\xe4\xf6\xfc\xdf</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PaxReadTest.test_pax_number_fields"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PaxReadTest.test_pax_number_fields">[docs]</a>    <span class="k">def</span> <span class="nf">test_pax_number_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># All following number fields are read from the pax header.</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;pax/regtype4&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">7011</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">mtime</span><span class="p">,</span> <span class="mf">1041808783.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">mtime</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">pax_headers</span><span class="p">[</span><span class="s">&quot;atime&quot;</span><span class="p">]),</span> <span class="mf">1041808783.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">pax_headers</span><span class="p">[</span><span class="s">&quot;ctime&quot;</span><span class="p">]),</span> <span class="mf">1041808783.0</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="WriteTestBase"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTestBase">[docs]</a><span class="k">class</span> <span class="nc">WriteTestBase</span><span class="p">(</span><span class="n">TarTest</span><span class="p">):</span>
    <span class="c"># Put all write tests in here that are supposed to be tested</span>
    <span class="c"># in all possible mode combinations.</span>

<div class="viewcode-block" id="WriteTestBase.test_fileobj_no_close"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTestBase.test_fileobj_no_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj_no_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">))</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;external fileobjs must never closed&quot;</span><span class="p">)</span>
        <span class="c"># Issue #20238: Incomplete gzip output with mode=&quot;w:gz&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">tar</span>
        <span class="n">support</span><span class="o">.</span><span class="n">gc_collect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fobj</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

</div></div>
<div class="viewcode-block" id="WriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest">[docs]</a><span class="k">class</span> <span class="nc">WriteTest</span><span class="p">(</span><span class="n">WriteTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;w:&quot;</span>

<div class="viewcode-block" id="WriteTest.test_100_char_name"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_100_char_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_100_char_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The name field in a tar header stores strings of at most 100 chars.</span>
        <span class="c"># If a string is shorter than 100 chars it has to be padded with &#39;\0&#39;,</span>
        <span class="c"># which implies that a string of exactly 100 chars is stored without</span>
        <span class="c"># a trailing &#39;\0&#39;.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;0123456789&quot;</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s">&quot;failed to store 100 char filename&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WriteTest.test_tar_size"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_tar_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_tar_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for bug #1013882.</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;file&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;aaa&quot;</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">tmpname</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&quot;tarfile is empty&quot;</span><span class="p">)</span>

    <span class="c"># The test_*_size tests test for bug #1167128.</span></div>
<div class="viewcode-block" id="WriteTest.test_file_size"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_file_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;file&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;aaa&quot;</span><span class="p">)</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WriteTest.test_directory_size"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_directory_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_directory_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;directory&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;link&quot;</span><span class="p">),</span>
                         <span class="s">&quot;Missing hardlink implementation&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="WriteTest.test_link_size"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_link_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_link_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;link&quot;</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;link_target&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;aaa&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Record the link target in the inodes list.</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</div>
    <span class="nd">@support.skip_unless_symlink</span>
<div class="viewcode-block" id="WriteTest.test_symlink_size"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_symlink_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_symlink_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;symlink&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="s">&quot;link_target&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WriteTest.test_add_self"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_add_self">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_self</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for #1257255.</span>
        <span class="n">dstname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dstname</span><span class="p">,</span>
                    <span class="s">&quot;archive name must be absolute&quot;</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dstname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">(),</span> <span class="p">[],</span>
                    <span class="s">&quot;added the archive to itself&quot;</span><span class="p">)</span>

            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dstname</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">(),</span> <span class="p">[],</span>
                    <span class="s">&quot;added the archive to itself&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="WriteTest.test_exclude"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_exclude">[docs]</a>    <span class="k">def</span> <span class="nf">test_exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;exclude&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">support</span><span class="o">.</span><span class="n">create_empty_file</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">exclude</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span>

            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&quot;use the filter argument&quot;</span><span class="p">,</span>
                                             <span class="ne">DeprecationWarning</span><span class="p">)):</span>
                    <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="s">&quot;empty_dir&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;empty_dir&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WriteTest.test_filter"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_filter">[docs]</a>    <span class="k">def</span> <span class="nf">test_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;filter&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">support</span><span class="o">.</span><span class="n">create_empty_file</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">tarinfo</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="mi">123</span>
                <span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span>
                <span class="k">return</span> <span class="n">tarinfo</span>

            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="s">&quot;empty_dir&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c"># Verify that filter is a keyword-only argument</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="s">&quot;empty_dir&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>

            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tarinfo</span> <span class="ow">in</span> <span class="n">tar</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>

    <span class="c"># Guarantee that stored pathnames are not modified. Don&#39;t</span>
    <span class="c"># remove ./ or ../ or double slashes. Still make absolute</span>
    <span class="c"># pathnames relative.</span>
    <span class="c"># For details see bug #6054.</span></div>
    <span class="k">def</span> <span class="nf">_test_pathname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmp_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># Create a tarfile with an empty member named path</span>
        <span class="c"># and compare the stored name with the original.</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">create_empty_file</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cmp_path</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">))</span>


    <span class="nd">@support.skip_unless_symlink</span>
<div class="viewcode-block" id="WriteTest.test_extractall_symlinks"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_extractall_symlinks">[docs]</a>    <span class="k">def</span> <span class="nf">test_extractall_symlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test if extractall works properly when tarfile contains symlinks</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;testsymlinks&quot;</span><span class="p">)</span>
        <span class="n">temparchive</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;testsymlinks.tar&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">source_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span><span class="s">&#39;source&#39;</span><span class="p">)</span>
            <span class="n">target_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span><span class="s">&#39;symlink&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;something</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">temparchive</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source_file</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c"># Let&#39;s extract it to the location which contains the symlink</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">temparchive</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="c"># this should not raise OSError: [Errno 17] File exists</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">tempdir</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;extractall failed with symlinked files&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temparchive</span><span class="p">)</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WriteTest.test_pathnames"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_pathnames">[docs]</a>    <span class="k">def</span> <span class="nf">test_pathnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="s">&quot;foo&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="s">&quot;foo&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WriteTest.test_abs_pathnames"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_abs_pathnames">[docs]</a>    <span class="k">def</span> <span class="nf">test_abs_pathnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">foo&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="s">&quot;/foo&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_pathname</span><span class="p">(</span><span class="s">&quot;///foo&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WriteTest.test_cwd"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_cwd">[docs]</a>    <span class="k">def</span> <span class="nf">test_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test adding the current working directory.</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tar</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;.&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;./&quot;</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WriteTest.test_open_nonwritable_fileobj"><a class="viewcode-back" href="../../test.html#test.test_tarfile.WriteTest.test_open_nonwritable_fileobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_open_nonwritable_fileobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">exctype</span> <span class="ow">in</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">class</span> <span class="nc">BadFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">):</span>
                <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">raise</span> <span class="n">exctype</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">BadFile</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exctype</span><span class="p">):</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                                   <span class="n">format</span><span class="o">=</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">,</span>
                                   <span class="n">pax_headers</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;non&#39;</span><span class="p">:</span> <span class="s">&#39;empty&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="GzipWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipWriteTest">[docs]</a><span class="k">class</span> <span class="nc">GzipWriteTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">WriteTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2WriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2WriteTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2WriteTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">WriteTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="LzmaWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaWriteTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaWriteTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">WriteTest</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="StreamWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamWriteTest">[docs]</a><span class="k">class</span> <span class="nc">StreamWriteTest</span><span class="p">(</span><span class="n">WriteTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;w|&quot;</span>
    <span class="n">decompressor</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="StreamWriteTest.test_stream_padding"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamWriteTest.test_stream_padding">[docs]</a>    <span class="k">def</span> <span class="nf">test_stream_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for bug #1543303.</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decompressor</span><span class="p">:</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decompressor</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">dec</span><span class="o">.</span><span class="n">unused_data</span><span class="p">,</span> <span class="s">&quot;found trailing data&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">),</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">RECORDSIZE</span><span class="p">,</span>
                        <span class="s">&quot;incorrect zero padding&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;win32&quot;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;umask&quot;</span><span class="p">),</span>
                         <span class="s">&quot;Missing umask implementation&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="StreamWriteTest.test_file_mode"><a class="viewcode-back" href="../../test.html#test.test_tarfile.StreamWriteTest.test_file_mode">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for issue #8464: Create files with correct</span>
        <span class="c"># permissions.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpname</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>

        <span class="n">original_umask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o022</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o777</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="n">o644</span><span class="p">,</span> <span class="s">&quot;wrong file permissions&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">original_umask</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="GzipStreamWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipStreamWriteTest">[docs]</a><span class="k">class</span> <span class="nc">GzipStreamWriteTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">StreamWriteTest</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2StreamWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2StreamWriteTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2StreamWriteTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">StreamWriteTest</span><span class="p">):</span>
    <span class="n">decompressor</span> <span class="o">=</span> <span class="n">bz2</span><span class="o">.</span><span class="n">BZ2Decompressor</span> <span class="k">if</span> <span class="n">bz2</span> <span class="k">else</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="LzmaStreamWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaStreamWriteTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaStreamWriteTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">StreamWriteTest</span><span class="p">):</span>
    <span class="n">decompressor</span> <span class="o">=</span> <span class="n">lzma</span><span class="o">.</span><span class="n">LZMADecompressor</span> <span class="k">if</span> <span class="n">lzma</span> <span class="k">else</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="GNUWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest">[docs]</a><span class="k">class</span> <span class="nc">GNUWriteTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># This testcase checks for correct creation of GNU Longname</span>
    <span class="c"># and Longlink extended headers (cp. bug #812325).</span>

    <span class="k">def</span> <span class="nf">_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">//</span> <span class="mi">512</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">blocks</span> <span class="o">*</span> <span class="mi">512</span>

    <span class="k">def</span> <span class="nf">_calc_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Initial tar header</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">512</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">LENGTH_NAME</span><span class="p">:</span>
            <span class="c"># GNU longname extended header + longname</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">512</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">LENGTH_LINK</span><span class="p">:</span>
            <span class="c"># GNU longlink extended header + longlink</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">512</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count</span>

    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
            <span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span> <span class="o">=</span> <span class="n">link</span>
            <span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">LNKTYPE</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span>

            <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_size</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="s">&quot;GNU longname/longlink creation failed&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">member</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">member</span><span class="p">,</span>
                    <span class="s">&quot;unable to read longname member&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s">&quot;unable to read longname member&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">linkname</span><span class="p">,</span>
                    <span class="s">&quot;unable to read longname member&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="GNUWriteTest.test_longname_1023"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longname_1023">[docs]</a>    <span class="k">def</span> <span class="nf">test_longname_1023</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">((</span><span class="s">&quot;longnam/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longnam&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longname_1024"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longname_1024">[docs]</a>    <span class="k">def</span> <span class="nf">test_longname_1024</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">((</span><span class="s">&quot;longnam/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longname_1025"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longname_1025">[docs]</a>    <span class="k">def</span> <span class="nf">test_longname_1025</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">((</span><span class="s">&quot;longnam/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longname_&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longlink_1023"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longlink_1023">[docs]</a>    <span class="k">def</span> <span class="nf">test_longlink_1023</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;longlnk/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longlnk&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longlink_1024"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longlink_1024">[docs]</a>    <span class="k">def</span> <span class="nf">test_longlink_1024</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;longlnk/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longlink&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longlink_1025"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longlink_1025">[docs]</a>    <span class="k">def</span> <span class="nf">test_longlink_1025</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;longlnk/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longlink_&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longnamelink_1023"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longnamelink_1023">[docs]</a>    <span class="k">def</span> <span class="nf">test_longnamelink_1023</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">((</span><span class="s">&quot;longnam/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longnam&quot;</span><span class="p">,</span>
                   <span class="p">(</span><span class="s">&quot;longlnk/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longlnk&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longnamelink_1024"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longnamelink_1024">[docs]</a>    <span class="k">def</span> <span class="nf">test_longnamelink_1024</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">((</span><span class="s">&quot;longnam/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">,</span>
                   <span class="p">(</span><span class="s">&quot;longlnk/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longlink&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GNUWriteTest.test_longnamelink_1025"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUWriteTest.test_longnamelink_1025">[docs]</a>    <span class="k">def</span> <span class="nf">test_longnamelink_1025</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">((</span><span class="s">&quot;longnam/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longname_&quot;</span><span class="p">,</span>
                   <span class="p">(</span><span class="s">&quot;longlnk/&quot;</span> <span class="o">*</span> <span class="mi">127</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;longlink_&quot;</span><span class="p">)</span>

</div></div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;link&quot;</span><span class="p">),</span> <span class="s">&quot;Missing hardlink implementation&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="HardlinkTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.HardlinkTest">[docs]</a><span class="k">class</span> <span class="nc">HardlinkTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Test the creation of LNKTYPE (hardlink) members in an archive.</span>

<div class="viewcode-block" id="HardlinkTest.setUp"><a class="viewcode-back" href="../../test.html#test.test_tarfile.HardlinkTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HardlinkTest.tearDown"><a class="viewcode-back" href="../../test.html#test.test_tarfile.HardlinkTest.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
        <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HardlinkTest.test_add_twice"><a class="viewcode-back" href="../../test.html#test.test_tarfile.HardlinkTest.test_add_twice">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_twice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The same name will be added as a REGTYPE every</span>
        <span class="c"># time regardless of st_nlink.</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">REGTYPE</span><span class="p">,</span>
                <span class="s">&quot;add file as regular failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HardlinkTest.test_add_hardlink"><a class="viewcode-back" href="../../test.html#test.test_tarfile.HardlinkTest.test_add_hardlink">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_hardlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">LNKTYPE</span><span class="p">,</span>
                <span class="s">&quot;add file as hardlink failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HardlinkTest.test_dereference_hardlink"><a class="viewcode-back" href="../../test.html#test.test_tarfile.HardlinkTest.test_dereference_hardlink">[docs]</a>    <span class="k">def</span> <span class="nf">test_dereference_hardlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">dereference</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gettarinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">REGTYPE</span><span class="p">,</span>
                <span class="s">&quot;dereferencing hardlink failed&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PaxWriteTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PaxWriteTest">[docs]</a><span class="k">class</span> <span class="nc">PaxWriteTest</span><span class="p">(</span><span class="n">GNUWriteTest</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># See GNUWriteTest.</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
            <span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span> <span class="o">=</span> <span class="n">link</span>
            <span class="n">tarinfo</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">LNKTYPE</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">linkname</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="s">&quot;PAX longlink creation failed&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s">&quot;PAX longname creation failed&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="PaxWriteTest.test_pax_global_header"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PaxWriteTest.test_pax_global_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_pax_global_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pax_headers</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span>
                <span class="s">&quot;uid&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
                <span class="s">&quot;mtime&quot;</span><span class="p">:</span> <span class="s">&quot;1.23&quot;</span><span class="p">,</span>
                <span class="s">&quot;test&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">}</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">,</span>
                <span class="n">pax_headers</span><span class="o">=</span><span class="n">pax_headers</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Test if the global header was written correctly.</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">pax_headers</span><span class="p">,</span> <span class="n">pax_headers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pax_headers</span><span class="p">,</span> <span class="n">pax_headers</span><span class="p">)</span>
            <span class="c"># Test if all the fields are strings.</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">pax_headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_NUMBER_FIELDS</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_NUMBER_FIELDS</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;unable to convert pax header field&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PaxWriteTest.test_pax_extended_header"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PaxWriteTest.test_pax_extended_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_pax_extended_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The fields from the pax header have priority over the</span>
        <span class="c"># TarInfo.</span>
        <span class="n">pax_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;path&quot;</span><span class="p">:</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;uid&quot;</span><span class="p">:</span> <span class="s">&quot;123&quot;</span><span class="p">}</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">,</span>
                           <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">()</span>
            <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span> <span class="c"># non-ASCII</span>
            <span class="n">t</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="mi">8</span><span class="o">**</span><span class="mi">8</span> <span class="c"># too large</span>
            <span class="n">t</span><span class="o">.</span><span class="n">pax_headers</span> <span class="o">=</span> <span class="n">pax_headers</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">pax_headers</span><span class="p">,</span> <span class="n">pax_headers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="UstarUnicodeTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest">[docs]</a><span class="k">class</span> <span class="nc">UstarUnicodeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">format</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span>

<div class="viewcode-block" id="UstarUnicodeTest.test_iso8859_1_filename"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest.test_iso8859_1_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_iso8859_1_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_unicode_filename</span><span class="p">(</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarUnicodeTest.test_utf7_filename"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest.test_utf7_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_utf7_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_unicode_filename</span><span class="p">(</span><span class="s">&quot;utf7&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UstarUnicodeTest.test_utf8_filename"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest.test_utf8_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_utf8_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_unicode_filename</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_unicode_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                           <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&quot;strict&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="UstarUnicodeTest.test_unicode_filename_error"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest.test_unicode_filename_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_filename_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                           <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&quot;strict&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">()</span>

            <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">,</span> <span class="n">tarinfo</span><span class="p">)</span>

            <span class="n">tarinfo</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span>
            <span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">,</span> <span class="n">tarinfo</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="UstarUnicodeTest.test_unicode_argument"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest.test_unicode_argument">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span>
                           <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&quot;strict&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">linkname</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">uname</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">gname</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="UstarUnicodeTest.test_uname_unicode"><a class="viewcode-back" href="../../test.html#test.test_tarfile.UstarUnicodeTest.test_uname_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">test_uname_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span>
        <span class="n">t</span><span class="o">.</span><span class="n">gname</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                           <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">gname</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">!=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">uname</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\udce4\udcf6\udcfc</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">gname</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\udce4\udcf6\udcfc</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="GNUUnicodeTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUUnicodeTest">[docs]</a><span class="k">class</span> <span class="nc">GNUUnicodeTest</span><span class="p">(</span><span class="n">UstarUnicodeTest</span><span class="p">):</span>

    <span class="n">format</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span>

<div class="viewcode-block" id="GNUUnicodeTest.test_bad_pax_header"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GNUUnicodeTest.test_bad_pax_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_pax_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for issue #8633. GNU tar &lt;= 1.23 creates raw binary fields</span>
        <span class="c"># without a hdrcharset=BINARY header.</span>
        <span class="k">for</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;pax/bad-pax-</span><span class="se">\udce4\udcf6\udcfc</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;pax/bad-pax-</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span><span class="p">),):</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                              <span class="n">errors</span><span class="o">=</span><span class="s">&quot;surrogateescape&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;unable to read bad GNU tar pax header&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PAXUnicodeTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PAXUnicodeTest">[docs]</a><span class="k">class</span> <span class="nc">PAXUnicodeTest</span><span class="p">(</span><span class="n">UstarUnicodeTest</span><span class="p">):</span>

    <span class="n">format</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span>

    <span class="c"># PAX_FORMAT ignores encoding in write mode.</span>
    <span class="n">test_unicode_filename_error</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="PAXUnicodeTest.test_binary_header"><a class="viewcode-back" href="../../test.html#test.test_tarfile.PAXUnicodeTest.test_binary_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test a POSIX.1-2008 compatible header with a hdrcharset=BINARY field.</span>
        <span class="k">for</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;pax/hdrcharset-</span><span class="se">\udce4\udcf6\udcfc</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;pax/hdrcharset-</span><span class="se">\xe4\xf6\xfc</span><span class="s">&quot;</span><span class="p">),):</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                              <span class="n">errors</span><span class="o">=</span><span class="s">&quot;surrogateescape&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;unable to read POSIX.1-2008 binary header&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AppendTestBase"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTestBase">[docs]</a><span class="k">class</span> <span class="nc">AppendTestBase</span><span class="p">:</span>
    <span class="c"># Test append mode (cp. patch #1652681).</span>

<div class="viewcode-block" id="AppendTestBase.setUp"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTestBase.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tarname</span> <span class="o">=</span> <span class="n">tmpname</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_create_testtar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w:&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;iso8859-1&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="s">&quot;ustar/regtype&quot;</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span>
            <span class="k">with</span> <span class="n">src</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                    <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<div class="viewcode-block" id="AppendTestBase.test_append_compressed"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTestBase.test_append_compressed">[docs]</a>    <span class="k">def</span> <span class="nf">test_append_compressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_testtar</span><span class="p">(</span><span class="s">&quot;w:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="AppendTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest">[docs]</a><span class="k">class</span> <span class="nc">AppendTest</span><span class="p">(</span><span class="n">AppendTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">test_append_compressed</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_add_testfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fileobj</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fileobj</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getnames</span><span class="p">(),</span> <span class="n">names</span><span class="p">)</span>

<div class="viewcode-block" id="AppendTest.test_non_existing"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_non_existing">[docs]</a>    <span class="k">def</span> <span class="nf">test_non_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_testfile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AppendTest.test_empty"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;w:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_testfile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AppendTest.test_empty_fileobj"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_empty_fileobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_fileobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_testfile</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppendTest.test_fileobj"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_fileobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_testtar</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_testfile</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
        <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppendTest.test_existing"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_existing">[docs]</a>    <span class="k">def</span> <span class="nf">test_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_testtar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_testfile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">])</span>

    <span class="c"># Append mode is supposed to fail if the tarfile to append to</span>
    <span class="c"># does not end with a zero block.</span></div>
    <span class="k">def</span> <span class="nf">_test_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_testfile</span><span class="p">)</span>

<div class="viewcode-block" id="AppendTest.test_null"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_null">[docs]</a>    <span class="k">def</span> <span class="nf">test_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_error</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppendTest.test_incomplete"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_incomplete">[docs]</a>    <span class="k">def</span> <span class="nf">test_incomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_error</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span> <span class="o">*</span> <span class="mi">13</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppendTest.test_premature_eof"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_premature_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_premature_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tobuf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_error</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppendTest.test_trailing_garbage"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_trailing_garbage">[docs]</a>    <span class="k">def</span> <span class="nf">test_trailing_garbage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tobuf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_error</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span> <span class="o">*</span> <span class="mi">13</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AppendTest.test_invalid"><a class="viewcode-back" href="../../test.html#test.test_tarfile.AppendTest.test_invalid">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_error</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">512</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="GzipAppendTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.GzipAppendTest">[docs]</a><span class="k">class</span> <span class="nc">GzipAppendTest</span><span class="p">(</span><span class="n">GzipTest</span><span class="p">,</span> <span class="n">AppendTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Bz2AppendTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2AppendTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2AppendTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">AppendTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="LzmaAppendTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LzmaAppendTest">[docs]</a><span class="k">class</span> <span class="nc">LzmaAppendTest</span><span class="p">(</span><span class="n">LzmaTest</span><span class="p">,</span> <span class="n">AppendTestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="LimitsTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LimitsTest">[docs]</a><span class="k">class</span> <span class="nc">LimitsTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="LimitsTest.test_ustar_limits"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LimitsTest.test_ustar_limits">[docs]</a>    <span class="k">def</span> <span class="nf">test_ustar_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 100 char name</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;0123456789&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>

        <span class="c"># 101 char name that cannot be stored</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;0123456789&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>

        <span class="c"># 256 char name with a slash at pos 156</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">62</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>

        <span class="c"># 256 char name that cannot be stored</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;1234567/&quot;</span> <span class="o">*</span> <span class="mi">31</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>

        <span class="c"># 512 char name</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">126</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>

        <span class="c"># 512 char linkname</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;longlink&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span> <span class="o">=</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">126</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>

        <span class="c"># uid &gt; 8 digits</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o10000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LimitsTest.test_gnu_limits"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LimitsTest.test_gnu_limits">[docs]</a>    <span class="k">def</span> <span class="nf">test_gnu_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">126</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span><span class="p">)</span>

        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;longlink&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span> <span class="o">=</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">126</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span><span class="p">)</span>

        <span class="c"># uid &gt;= 256 ** 7</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o4000000000000000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LimitsTest.test_pax_limits"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LimitsTest.test_pax_limits">[docs]</a>    <span class="k">def</span> <span class="nf">test_pax_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">126</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">)</span>

        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;longlink&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">linkname</span> <span class="o">=</span> <span class="s">&quot;123/&quot;</span> <span class="o">*</span> <span class="mi">126</span> <span class="o">+</span> <span class="s">&quot;longname&quot;</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">)</span>

        <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o4000000000000000000</span>
        <span class="n">tarinfo</span><span class="o">.</span><span class="n">tobuf</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">PAX_FORMAT</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="MiscTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscTest">[docs]</a><span class="k">class</span> <span class="nc">MiscTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="MiscTest.test_char_fields"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscTest.test_char_fields">[docs]</a>    <span class="k">def</span> <span class="nf">test_char_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">stn</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;foo</span><span class="se">\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">stn</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nts</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;foo</span><span class="se">\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">),</span>
                         <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nts</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;foo</span><span class="se">\0</span><span class="s">bar</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">),</span>
                         <span class="s">&quot;foo&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTest.test_read_number_fields"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscTest.test_read_number_fields">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_number_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 13158: Test if GNU tar specific base-256 number fields</span>
        <span class="c"># are decoded correctly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;0000001</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;7777777</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="n">o7777777</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\x00\x00\x00\x00\x20\x00\x00</span><span class="s">&quot;</span><span class="p">),</span>
                         <span class="mi">0</span><span class="n">o10000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\x00\x00\x00\xff\xff\xff\xff</span><span class="s">&quot;</span><span class="p">),</span>
                         <span class="mh">0xffffffff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\xff\xff\xff\xff\xff\xff\xff</span><span class="s">&quot;</span><span class="p">),</span>
                         <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\xff\xff\xff\xff\xff\xff\x9c</span><span class="s">&quot;</span><span class="p">),</span>
                         <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">nti</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\x00\x00\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="p">),</span>
                         <span class="o">-</span><span class="mh">0x100000000000000</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTest.test_write_number_fields"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscTest.test_write_number_fields">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_number_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;0000001</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="mi">0</span><span class="n">o7777777</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;7777777</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="mi">0</span><span class="n">o10000000</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\x00\x00\x00\x00\x20\x00\x00</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="mh">0xffffffff</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\x00\x00\x00\xff\xff\xff\xff</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\xff\xff\xff\xff\xff\xff\xff</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\xff\xff\xff\xff\xff\xff\x9c</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="o">-</span><span class="mh">0x100000000000000</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\x00\x00\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTest.test_number_field_limits"><a class="viewcode-back" href="../../test.html#test.test_tarfile.MiscTest.test_number_field_limits">[docs]</a>    <span class="k">def</span> <span class="nf">test_number_field_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="mi">0</span><span class="n">o10000000</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">USTAR_FORMAT</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="o">-</span><span class="mh">0x10000000001</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">tarfile</span><span class="o">.</span><span class="n">itn</span><span class="p">(</span><span class="mh">0x10000000000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">GNU_FORMAT</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="CommandLineTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest">[docs]</a><span class="k">class</span> <span class="nc">CommandLineTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="CommandLineTest.tarfilecmd"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.tarfilecmd">[docs]</a>    <span class="k">def</span> <span class="nf">tarfilecmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">assert_python_ok</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="s">&#39;tarfile&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.tarfilecmd_failure"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.tarfilecmd_failure">[docs]</a>    <span class="k">def</span> <span class="nf">tarfilecmd_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">assert_python_failure</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="s">&#39;tarfile&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.make_simple_tarfile"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.make_simple_tarfile">[docs]</a>    <span class="k">def</span> <span class="nf">make_simple_tarfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests.txt&#39;</span><span class="p">),</span>
                 <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests-no-coding-cookie-&#39;</span>
                                  <span class="s">&#39;and-utf8-bom-sig-only.txt&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_name</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tardata</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tardata</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">tardata</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_test_command"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_test_command">[docs]</a>    <span class="k">def</span> <span class="nf">test_test_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tar_name</span> <span class="ow">in</span> <span class="n">testtarnames</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--test&#39;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_test_command_verbose"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_test_command_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">test_test_command_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tar_name</span> <span class="ow">in</span> <span class="n">testtarnames</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;is a tar archive.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_test_command_invalid_file"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_test_command_invalid_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_test_command_invalid_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zipname</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;zipdir.zip&#39;</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd_failure</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="n">zipname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39; is not a tar archive.&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tar_name</span> <span class="ow">in</span> <span class="n">testtarnames</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">tar_name</span><span class="o">=</span><span class="n">tar_name</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tar_name</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">511</span><span class="p">])</span>
                    <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd_failure</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_list_command"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_list_command">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tar_name</span> <span class="ow">in</span> <span class="n">testtarnames</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_name</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;backslashreplace&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--list&#39;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">,</span>
                                      <span class="n">PYTHONIOENCODING</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_list_command_verbose"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_list_command_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_command_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tar_name</span> <span class="ow">in</span> <span class="n">testtarnames</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_name</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;backslashreplace&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">,</span>
                                      <span class="n">PYTHONIOENCODING</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_list_command_invalid_file"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_list_command_invalid_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_command_invalid_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zipname</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;zipdir.zip&#39;</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd_failure</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">zipname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39; is not a tar archive.&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_create_command"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_create_command">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests.txt&#39;</span><span class="p">),</span>
                 <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests-no-coding-cookie-&#39;</span>
                                  <span class="s">&#39;and-utf8-bom-sig-only.txt&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--create&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                    <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_create_command_verbose"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_create_command_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_command_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests.txt&#39;</span><span class="p">),</span>
                 <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests-no-coding-cookie-&#39;</span>
                                  <span class="s">&#39;and-utf8-bom-sig-only.txt&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39; file created.&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                    <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_create_command_dotless_filename"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_create_command_dotless_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_command_dotless_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests.txt&#39;</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="n">dotlessname</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dotlessname</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">dotlessname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_create_command_dot_started_filename"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_create_command_dot_started_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_command_dot_started_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tar_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="s">&quot;.testtar&quot;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;tokenize_tests.txt&#39;</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="n">tar_name</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tar_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_extract_command"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_extract_command">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_simple_tarfile</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-e&#39;</span><span class="p">,</span> <span class="s">&#39;--extract&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">temp_cwd</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">):</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_extract_command_verbose"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_extract_command_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_command_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_simple_tarfile</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">temp_cwd</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">):</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="s">&#39;-e&#39;</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39; file is extracted.&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_extract_command_different_directory"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_extract_command_different_directory">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_command_different_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_simple_tarfile</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">temp_cwd</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd</span><span class="p">(</span><span class="s">&#39;-e&#39;</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">,</span> <span class="s">&#39;spamdir&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CommandLineTest.test_extract_command_invalid_file"><a class="viewcode-back" href="../../test.html#test.test_tarfile.CommandLineTest.test_extract_command_invalid_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_command_invalid_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zipname</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">findfile</span><span class="p">(</span><span class="s">&#39;zipdir.zip&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">temp_cwd</span><span class="p">(</span><span class="n">tarextdir</span><span class="p">):</span>
            <span class="n">rc</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tarfilecmd_failure</span><span class="p">(</span><span class="s">&#39;-e&#39;</span><span class="p">,</span> <span class="n">zipname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&#39; is not a tar archive.&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ContextManagerTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest">[docs]</a><span class="k">class</span> <span class="nc">ContextManagerTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="ContextManagerTest.test_basic"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest.test_basic">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;closed inside runtime context&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;context manager failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ContextManagerTest.test_closed"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest.test_closed">[docs]</a>    <span class="k">def</span> <span class="nf">test_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The __enter__() method is supposed to raise OSError</span>
        <span class="c"># if the TarFile object is already closed.</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">)</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">tar</span><span class="p">:</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="ContextManagerTest.test_exception"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest.test_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test if the OSError exception is passed through properly.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">OSError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span>
                              <span class="s">&quot;wrong exception raised in context manager&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;context manager failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ContextManagerTest.test_no_eof"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest.test_no_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># __exit__() must not write end-of-archive blocks if an</span>
        <span class="c"># exception was raised.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">tmpname</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&quot;context manager wrote an end-of-archive block&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;context manager failed&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ContextManagerTest.test_eof"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest.test_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># __exit__() must write end-of-archive blocks, i.e. call</span>
        <span class="c"># TarFile.close() if there was no error.</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">tmpname</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&quot;context manager wrote no end-of-archive block&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ContextManagerTest.test_fileobj"><a class="viewcode-back" href="../../test.html#test.test_tarfile.ContextManagerTest.test_fileobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_fileobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that __exit__() did not close the external file</span>
        <span class="c"># object.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fobj</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;external file object was closed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;context manager failed&quot;</span><span class="p">)</span>

</div></div>
<span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;link&quot;</span><span class="p">),</span> <span class="s">&quot;requires os.link to be missing&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="LinkEmulationTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LinkEmulationTest">[docs]</a><span class="k">class</span> <span class="nc">LinkEmulationTest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c"># Test for issue #8741 regression. On platforms that do not support</span>
    <span class="c"># symbolic or hard links tarfile tries to extract these types of members</span>
    <span class="c"># as the regular files they point to.</span>
    <span class="k">def</span> <span class="nf">_test_link_extraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">TEMPDIR</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">md5_regtype</span><span class="p">)</span>

    <span class="c"># See issues #1578269, #8879, and #17689 for some history on these skips</span>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;islink&quot;</span><span class="p">),</span>
                     <span class="s">&quot;Skip emulation - has os.path.islink but not os.link&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="LinkEmulationTest.test_hardlink_extraction1"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LinkEmulationTest.test_hardlink_extraction1">[docs]</a>    <span class="k">def</span> <span class="nf">test_hardlink_extraction1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_link_extraction</span><span class="p">(</span><span class="s">&quot;ustar/lnktype&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;islink&quot;</span><span class="p">),</span>
                     <span class="s">&quot;Skip emulation - has os.path.islink but not os.link&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="LinkEmulationTest.test_hardlink_extraction2"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LinkEmulationTest.test_hardlink_extraction2">[docs]</a>    <span class="k">def</span> <span class="nf">test_hardlink_extraction2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_link_extraction</span><span class="p">(</span><span class="s">&quot;./ustar/linktest2/lnktype&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;symlink&quot;</span><span class="p">),</span>
                     <span class="s">&quot;Skip emulation if symlink exists&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="LinkEmulationTest.test_symlink_extraction1"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LinkEmulationTest.test_symlink_extraction1">[docs]</a>    <span class="k">def</span> <span class="nf">test_symlink_extraction1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_link_extraction</span><span class="p">(</span><span class="s">&quot;ustar/symtype&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;symlink&quot;</span><span class="p">),</span>
                     <span class="s">&quot;Skip emulation if symlink exists&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="LinkEmulationTest.test_symlink_extraction2"><a class="viewcode-back" href="../../test.html#test.test_tarfile.LinkEmulationTest.test_symlink_extraction2">[docs]</a>    <span class="k">def</span> <span class="nf">test_symlink_extraction2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_link_extraction</span><span class="p">(</span><span class="s">&quot;./ustar/linktest2/symtype&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Bz2PartialReadTest"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2PartialReadTest">[docs]</a><span class="k">class</span> <span class="nc">Bz2PartialReadTest</span><span class="p">(</span><span class="n">Bz2Test</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Issue5068: The _BZ2Proxy.read() method loops forever</span>
    <span class="c"># on an empty or partial bzipped file.</span>

    <span class="k">def</span> <span class="nf">_test_partial_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MyBytesIO</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">):</span>
            <span class="n">hit_eof</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_eof</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;infinite loop detected in &quot;</span>
                                         <span class="s">&quot;tarfile.open()&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hit_eof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyBytesIO</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hit_eof</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyBytesIO</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">bz2</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tobuf</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">MyBytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">x</span><span class="p">]),</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">ReadError</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c"># we have no interest in ReadErrors</span>

<div class="viewcode-block" id="Bz2PartialReadTest.test_partial_input"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2PartialReadTest.test_partial_input">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_partial_input</span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bz2PartialReadTest.test_partial_input_bz2"><a class="viewcode-back" href="../../test.html#test.test_tarfile.Bz2PartialReadTest.test_partial_input_bz2">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial_input_bz2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_partial_input</span><span class="p">(</span><span class="s">&quot;r:bz2&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="setUpModule"><a class="viewcode-back" href="../../test.html#test.test_tarfile.setUpModule">[docs]</a><span class="k">def</span> <span class="nf">setUpModule</span><span class="p">():</span>
    <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">)</span>

    <span class="k">global</span> <span class="n">testtarnames</span>
    <span class="n">testtarnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">tarname</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c"># Create compressed tarfiles.</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">GzipTest</span><span class="p">,</span> <span class="n">Bz2Test</span><span class="p">,</span> <span class="n">LzmaTest</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">open</span><span class="p">:</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tarname</span><span class="p">)</span>
            <span class="n">testtarnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tarname</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">c</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tarname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
                <span class="n">tar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tearDownModule"><a class="viewcode-back" href="../../test.html#test.test_tarfile.tearDownModule">[docs]</a><span class="k">def</span> <span class="nf">tearDownModule</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">):</span>
        <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">TEMPDIR</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>