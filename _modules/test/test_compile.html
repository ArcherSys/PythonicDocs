

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_compile &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_compile</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_compile</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">_ast</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>

<div class="viewcode-block" id="TestSpecifics"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics">[docs]</a><span class="k">class</span> <span class="nc">TestSpecifics</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestSpecifics.compile_single"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.compile_single">[docs]</a>    <span class="k">def</span> <span class="nf">compile_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="nb">compile</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&quot;&lt;single&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;single&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.assertInvalidSingle"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.assertInvalidSingle">[docs]</a>    <span class="k">def</span> <span class="nf">assertInvalidSingle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_no_ending_newline"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_no_ending_newline">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_ending_newline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;hi</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_empty"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_other_newlines"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_other_newlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_other_newlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;hi</span><span class="se">\r\n</span><span class="s">stuff</span><span class="se">\r\n</span><span class="s">def f():</span><span class="se">\n</span><span class="s">    pass</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
        <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;this_is</span><span class="se">\r</span><span class="s">really_old_mac</span><span class="se">\r</span><span class="s">def f():</span><span class="se">\n</span><span class="s">    pass&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;test&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_debug_assignment"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_debug_assignment">[docs]</a>    <span class="k">def</span> <span class="nf">test_debug_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># catch assignments to __debug__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="s">&#39;__debug__ = 1&#39;</span><span class="p">,</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;single&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">builtins</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">__debug__</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="s">&#39;__debug__&#39;</span><span class="p">,</span> <span class="s">&#39;sure&#39;</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="s">&#39;__debug__&#39;</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_argument_handling"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_argument_handling">[docs]</a>    <span class="k">def</span> <span class="nf">test_argument_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># detect duplicate positional and keyword arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&#39;lambda a,a:0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&#39;lambda a,a=1:0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&#39;lambda a=1,a=1:0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;def f(a, a): pass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;def f(a = 0, a = 1): pass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;def f(a): global a; a = 1&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_syntax_error"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_syntax_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_syntax_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="s">&quot;1+*3&quot;</span><span class="p">,</span> <span class="s">&quot;filename&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_none_keyword_arg"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_none_keyword_arg">[docs]</a>    <span class="k">def</span> <span class="nf">test_none_keyword_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="s">&quot;f(None=1)&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_duplicate_global_local"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_duplicate_global_local">[docs]</a>    <span class="k">def</span> <span class="nf">test_duplicate_global_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;def f(a): global a; a = 1&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_exec_with_general_mapping_for_locals"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_exec_with_general_mapping_for_locals">[docs]</a>    <span class="k">def</span> <span class="nf">test_exec_with_general_mapping_for_locals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">class</span> <span class="nc">M</span><span class="p">:</span>
            <span class="s">&quot;Test mapping interface versus possible calls from eval().&quot;</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">12</span>
                <span class="k">raise</span> <span class="ne">KeyError</span>
            <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="s">&#39;xyz&#39;</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
        <span class="k">exec</span><span class="p">(</span><span class="s">&#39;z = a&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">exec</span><span class="p">(</span><span class="s">&#39;z = b&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Did not detect a KeyError&#39;</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="s">&#39;z = dir()&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="s">&#39;xyz&#39;</span><span class="p">)))</span>
        <span class="k">exec</span><span class="p">(</span><span class="s">&#39;z = globals()&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
        <span class="k">exec</span><span class="p">(</span><span class="s">&#39;z = locals()&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;z = b&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="s">&quot;Non-mapping&quot;</span>
            <span class="k">pass</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;z = a&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="c"># Verify that dict subclasses work as well</span>
        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">12</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
        <span class="k">exec</span><span class="p">(</span><span class="s">&#39;z = a&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span> <span class="mi">12</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_extended_arg"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_extended_arg">[docs]</a>    <span class="k">def</span> <span class="nf">test_extended_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">longexpr</span> <span class="o">=</span> <span class="s">&#39;x = x or &#39;</span> <span class="o">+</span> <span class="s">&#39;-x&#39;</span> <span class="o">*</span> <span class="mi">2500</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">def f(x):</span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    # the expressions above have no effect, x == argument</span>
<span class="s">    while x:</span>
<span class="s">        x -= 1</span>
<span class="s">        # EXTENDED_ARG/JUMP_ABSOLUTE here</span>
<span class="s">    return x</span>
<span class="s">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">longexpr</span><span class="p">,)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">](</span><span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_argument_order"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_argument_order">[docs]</a>    <span class="k">def</span> <span class="nf">test_argument_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="k">exec</span><span class="p">,</span> <span class="s">&#39;def f(a=1, b): pass&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_float_literals"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_float_literals">[docs]</a>    <span class="k">def</span> <span class="nf">test_float_literals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># testing bad float literals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&quot;2e&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&quot;2.0e+&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&quot;1e-&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="s">&quot;3-4e/21&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_indentation"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_indentation">[docs]</a>    <span class="k">def</span> <span class="nf">test_indentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># testing compile() of indented block w/o trailing newline&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">if 1:</span>
<span class="s">    if 2:</span>
<span class="s">        pass&quot;&quot;&quot;</span>
        <span class="nb">compile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>

    <span class="c"># This test is probably specific to CPython and may not generalize</span>
    <span class="c"># to other implementations.  We are trying to ensure that when</span>
    <span class="c"># the first line of code starts after 256, correct line numbers</span>
    <span class="c"># in tracebacks are still produced.</span></div>
<div class="viewcode-block" id="TestSpecifics.test_leading_newlines"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_leading_newlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_leading_newlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s256</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;spam&quot;</span><span class="p">])</span>
        <span class="n">co</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">s256</span><span class="p">,</span> <span class="s">&#39;fn&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">,</span> <span class="mi">257</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">co_lnotab</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_literals_with_leading_zeroes"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_literals_with_leading_zeroes">[docs]</a>    <span class="k">def</span> <span class="nf">test_literals_with_leading_zeroes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;077787&quot;</span><span class="p">,</span> <span class="s">&quot;0xj&quot;</span><span class="p">,</span> <span class="s">&quot;0x.&quot;</span><span class="p">,</span> <span class="s">&quot;0e&quot;</span><span class="p">,</span>  <span class="s">&quot;090000000000000&quot;</span><span class="p">,</span>
                    <span class="s">&quot;080000000000000&quot;</span><span class="p">,</span> <span class="s">&quot;000000000000009&quot;</span><span class="p">,</span> <span class="s">&quot;000000000000008&quot;</span><span class="p">,</span>
                    <span class="s">&quot;0b42&quot;</span><span class="p">,</span> <span class="s">&quot;0BADCAFE&quot;</span><span class="p">,</span> <span class="s">&quot;0o123456789&quot;</span><span class="p">,</span> <span class="s">&quot;0b1.1&quot;</span><span class="p">,</span> <span class="s">&quot;0o4.2&quot;</span><span class="p">,</span>
                    <span class="s">&quot;0b101j2&quot;</span><span class="p">,</span> <span class="s">&quot;0o153j2&quot;</span><span class="p">,</span> <span class="s">&quot;0b100e1&quot;</span><span class="p">,</span> <span class="s">&quot;0o777e1&quot;</span><span class="p">,</span> <span class="s">&quot;0777&quot;</span><span class="p">,</span>
                    <span class="s">&quot;000777&quot;</span><span class="p">,</span> <span class="s">&quot;000000000000007&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0xff&quot;</span><span class="p">),</span> <span class="mi">255</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0777.&quot;</span><span class="p">),</span> <span class="mi">777</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0777.0&quot;</span><span class="p">),</span> <span class="mi">777</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;000000000000000000000000000000000000000000000000000777e0&quot;</span><span class="p">),</span> <span class="mi">777</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0777e1&quot;</span><span class="p">),</span> <span class="mi">7770</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0e0&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0000e-012&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;09.5&quot;</span><span class="p">),</span> <span class="mf">9.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0777j&quot;</span><span class="p">),</span> <span class="mi">777j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;000&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;00j&quot;</span><span class="p">),</span> <span class="mi">0j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;00.0&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0e3&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;090000000000000.&quot;</span><span class="p">),</span> <span class="mf">90000000000000.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;090000000000000.0000000000000000000000&quot;</span><span class="p">),</span> <span class="mf">90000000000000.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;090000000000000e0&quot;</span><span class="p">),</span> <span class="mf">90000000000000.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;090000000000000e-0&quot;</span><span class="p">),</span> <span class="mf">90000000000000.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;090000000000000j&quot;</span><span class="p">),</span> <span class="mi">90000000000000j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;000000000000008.&quot;</span><span class="p">),</span> <span class="mf">8.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;000000000000009.&quot;</span><span class="p">),</span> <span class="mf">9.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0b101010&quot;</span><span class="p">),</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;-0b000000000010&quot;</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;0o777&quot;</span><span class="p">),</span> <span class="mi">511</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;-0o0000010&quot;</span><span class="p">),</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_unary_minus"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_unary_minus">[docs]</a>    <span class="k">def</span> <span class="nf">test_unary_minus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify treatment of unary minus on negative numbers SF bug #660455</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">==</span> <span class="mi">2147483647</span><span class="p">:</span>
            <span class="c"># 32-bit machine</span>
            <span class="n">all_one_bits</span> <span class="o">=</span> <span class="s">&#39;0xffffffff&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">all_one_bits</span><span class="p">),</span> <span class="mi">4294967295</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">all_one_bits</span><span class="p">),</span> <span class="o">-</span><span class="mi">4294967295</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">==</span> <span class="mi">9223372036854775807</span><span class="p">:</span>
            <span class="c"># 64-bit machine</span>
            <span class="n">all_one_bits</span> <span class="o">=</span> <span class="s">&#39;0xffffffffffffffff&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">all_one_bits</span><span class="p">),</span> <span class="mi">18446744073709551615</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">all_one_bits</span><span class="p">),</span> <span class="o">-</span><span class="mi">18446744073709551615</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;How many bits *does* this machine have???&quot;</span><span class="p">)</span>
        <span class="c"># Verify treatment of constant folding on -(sys.maxsize+1)</span>
        <span class="c"># i.e. -2147483648 on 32 bit platforms.  Should return int.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">)</span>
</div>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">==</span> <span class="mi">9223372036854775807</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">test_32_63_bit_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="o">+</span><span class="mi">4294967296</span>  <span class="c"># 1 &lt;&lt; 32</span>
            <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4294967296</span>  <span class="c"># 1 &lt;&lt; 32</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">+</span><span class="mi">281474976710656</span>  <span class="c"># 1 &lt;&lt; 48</span>
            <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="mi">281474976710656</span>  <span class="c"># 1 &lt;&lt; 48</span>
            <span class="n">e</span> <span class="o">=</span> <span class="o">+</span><span class="mi">4611686018427387904</span>  <span class="c"># 1 &lt;&lt; 62</span>
            <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4611686018427387904</span>  <span class="c"># 1 &lt;&lt; 62</span>
            <span class="n">g</span> <span class="o">=</span> <span class="o">+</span><span class="mi">9223372036854775807</span>  <span class="c"># 1 &lt;&lt; 63 - 1</span>
            <span class="n">h</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9223372036854775807</span>  <span class="c"># 1 &lt;&lt; 63 - 1</span>

            <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_32_63_bit_values</span><span class="o">.</span><span class="n">__code__</span><span class="o">.</span><span class="n">co_consts</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

<div class="viewcode-block" id="TestSpecifics.test_sequence_unpacking_error"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_sequence_unpacking_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_sequence_unpacking_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify sequence packing/unpacking with &quot;or&quot;.  SF bug #757818</span>
        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_none_assignment"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_none_assignment">[docs]</a>    <span class="k">def</span> <span class="nf">test_none_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stmts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;None = 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;None += 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;__builtins__.None = 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;def None(): pass&#39;</span><span class="p">,</span>
            <span class="s">&#39;class None: pass&#39;</span><span class="p">,</span>
            <span class="s">&#39;(a, None) = 0, 0&#39;</span><span class="p">,</span>
            <span class="s">&#39;for None in range(10): pass&#39;</span><span class="p">,</span>
            <span class="s">&#39;def f(None): pass&#39;</span><span class="p">,</span>
            <span class="s">&#39;import None&#39;</span><span class="p">,</span>
            <span class="s">&#39;import x as None&#39;</span><span class="p">,</span>
            <span class="s">&#39;from x import None&#39;</span><span class="p">,</span>
            <span class="s">&#39;from x import y as None&#39;</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts</span><span class="p">:</span>
            <span class="n">stmt</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;single&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_import"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_import">[docs]</a>    <span class="k">def</span> <span class="nf">test_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">succeed</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;import sys&#39;</span><span class="p">,</span>
            <span class="s">&#39;import os, sys&#39;</span><span class="p">,</span>
            <span class="s">&#39;import os as bar&#39;</span><span class="p">,</span>
            <span class="s">&#39;import os.path as bar&#39;</span><span class="p">,</span>
            <span class="s">&#39;from __future__ import nested_scopes, generators&#39;</span><span class="p">,</span>
            <span class="s">&#39;from __future__ import (nested_scopes,</span><span class="se">\n</span><span class="s">generators)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from __future__ import (nested_scopes,</span><span class="se">\n</span><span class="s">generators,)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin, stderr, stdout&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin, stderr,</span><span class="se">\n</span><span class="s">stdout)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin, stderr,</span><span class="se">\n</span><span class="s">stdout,)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin</span><span class="se">\n</span><span class="s">, stderr, stdout)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin</span><span class="se">\n</span><span class="s">, stderr, stdout,)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin as si, stdout as so, stderr as se&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin as si, stdout as so, stderr as se)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin as si, stdout as so, stderr as se,)&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="n">fail</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;import (os, sys)&#39;</span><span class="p">,</span>
            <span class="s">&#39;import (os), (sys)&#39;</span><span class="p">,</span>
            <span class="s">&#39;import ((os), (sys))&#39;</span><span class="p">,</span>
            <span class="s">&#39;import (sys&#39;</span><span class="p">,</span>
            <span class="s">&#39;import sys)&#39;</span><span class="p">,</span>
            <span class="s">&#39;import (os,)&#39;</span><span class="p">,</span>
            <span class="s">&#39;import os As bar&#39;</span><span class="p">,</span>
            <span class="s">&#39;import os.path a bar&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin As stdout&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin a stdout&#39;</span><span class="p">,</span>
            <span class="s">&#39;from (sys) import stdin&#39;</span><span class="p">,</span>
            <span class="s">&#39;from __future__ import (nested_scopes&#39;</span><span class="p">,</span>
            <span class="s">&#39;from __future__ import nested_scopes)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from __future__ import nested_scopes,</span><span class="se">\n</span><span class="s">generators&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin, stdout,</span><span class="se">\n</span><span class="s">stderr&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin si&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import stdin,&#39;</span>
            <span class="s">&#39;from sys import (*)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin,, stdout, stderr)&#39;</span><span class="p">,</span>
            <span class="s">&#39;from sys import (stdin, stdout),&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">succeed</span><span class="p">:</span>
            <span class="nb">compile</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">fail</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_for_distinct_code_objects"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_for_distinct_code_objects">[docs]</a>    <span class="k">def</span> <span class="nf">test_for_distinct_code_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># SF bug 1048870</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="n">x</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="n">x</span>
            <span class="k">return</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span>
        <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">__code__</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">__code__</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_lambda_doc"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_lambda_doc">[docs]</a>    <span class="k">def</span> <span class="nf">test_lambda_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s">&quot;foo&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_encoding"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;# -*- coding: badencoding -*-</span><span class="se">\n</span><span class="s">pass</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&#39;# -*- coding: badencoding -*-</span><span class="se">\n</span><span class="s">&quot;</span><span class="se">\xc2\xa4</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="nb">compile</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\xc2\xa4</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&#39;&quot;</span><span class="se">\xc2\xa4</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\xc2\xa4</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&quot;</span><span class="se">\xc2\xa4</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\xa4</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;# -*- coding: latin1 -*-</span><span class="se">\n</span><span class="s">&quot;</span><span class="se">\xc2\xa4</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\xc2\xa4</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;# -*- coding: utf-8 -*-</span><span class="se">\n</span><span class="s">&quot;</span><span class="se">\xc2\xa4</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\xa4</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;# -*- coding: iso8859-15 -*-</span><span class="se">\n</span><span class="s">&quot;</span><span class="se">\xc2\xa4</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\xc2\u20ac</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&#39;&quot;&quot;&quot;</span><span class="se">\\\n</span><span class="s"># -*- coding: iso8859-15 -*-</span><span class="se">\n\xc2\xa4</span><span class="s">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;# -*- coding: iso8859-15 -*-</span><span class="se">\n\xc2\xa4</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&quot;&quot;&quot;</span><span class="se">\\\n</span><span class="s"># -*- coding: iso8859-15 -*-</span><span class="se">\n\xc2\xa4</span><span class="s">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="s">&#39;# -*- coding: iso8859-15 -*-</span><span class="se">\n\xa4</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_subscripts"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_subscripts">[docs]</a>    <span class="k">def</span> <span class="nf">test_subscripts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># SF bug 1448804</span>
        <span class="c"># Class to make testing subscript results easy</span>
        <span class="k">class</span> <span class="nc">str_map</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
            <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
            <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">str_map</span><span class="p">()</span>
        <span class="c"># Index</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Tuple of indices</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Simple slice</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Tuple of simple slices</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Extended slice</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Tuple of extended slices</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Ellipsis</span>
        <span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="c"># Tuple of Ellipses</span>
        <span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">((</span><span class="bp">Ellipsis</span><span class="p">,</span> <span class="bp">Ellipsis</span><span class="p">),</span> <span class="n">d</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_annotation_limit"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_annotation_limit">[docs]</a>    <span class="k">def</span> <span class="nf">test_annotation_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 16 bits are available for # of annotations, but only 8 bits are</span>
        <span class="c"># available for the parameter count, hence 255</span>
        <span class="c"># is the max. Ensure the result of too many annotations is a</span>
        <span class="c"># SyntaxError.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;def f(</span><span class="si">%s</span><span class="s">): pass&quot;</span>
        <span class="n">s</span> <span class="o">%=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;a</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="c"># Test that the max # of annotations compiles.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;def f(</span><span class="si">%s</span><span class="s">): pass&quot;</span>
        <span class="n">s</span> <span class="o">%=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;a</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
        <span class="nb">compile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_mangling"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_mangling">[docs]</a>    <span class="k">def</span> <span class="nf">test_mangling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
                <span class="n">__mangled</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">__not_mangled__</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="kn">import</span> <span class="nn">__mangled_mod</span>
                <span class="kn">import</span> <span class="nn">__package__.module</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;_A__mangled&quot;</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;__not_mangled__&quot;</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;_A__mangled_mod&quot;</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;__package__&quot;</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_compile_ast"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_compile_ast">[docs]</a>    <span class="k">def</span> <span class="nf">test_compile_ast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">__file__</span>
        <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s">&#39;pyc&#39;</span><span class="p">,</span> <span class="s">&#39;pyo&#39;</span><span class="p">)):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">fcontents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">sample_code</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s">&#39;&lt;assign&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;x = 5&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&#39;&lt;ifblock&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;if True:</span><span class="se">\n</span><span class="s">    pass</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&#39;&lt;forblock&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;for n in [1, 2, 3]:</span><span class="se">\n</span><span class="s">    print(n)</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&#39;&lt;deffunc&gt;&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;def foo():</span><span class="se">\n</span><span class="s">    pass</span><span class="se">\n</span><span class="s">foo()</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">fname</span><span class="p">,</span> <span class="n">fcontents</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">sample_code</span><span class="p">:</span>
            <span class="n">co1</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">1&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
            <span class="n">ast</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">2&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">,</span> <span class="n">_ast</span><span class="o">.</span><span class="n">PyCF_ONLY_AST</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span> <span class="o">==</span> <span class="n">_ast</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span>
            <span class="n">co2</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">3&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">co1</span><span class="p">,</span> <span class="n">co2</span><span class="p">)</span>
            <span class="c"># the code object&#39;s filename comes from the second compilation step</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">co2</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">3&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>

        <span class="c"># raise exception when node type doesn&#39;t match with compile mode</span>
        <span class="n">co1</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">&#39;print(1)&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">,</span> <span class="n">_ast</span><span class="o">.</span><span class="n">PyCF_ONLY_AST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">co1</span><span class="p">,</span> <span class="s">&#39;&lt;ast&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;eval&#39;</span><span class="p">)</span>

        <span class="c"># raise exception when node type is no start node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">_ast</span><span class="o">.</span><span class="n">If</span><span class="p">(),</span> <span class="s">&#39;&lt;ast&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>

        <span class="c"># raise exception when node has invalid children</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">_ast</span><span class="o">.</span><span class="n">Module</span><span class="p">()</span>
        <span class="n">ast</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">_ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">ast</span><span class="p">,</span> <span class="s">&#39;&lt;ast&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@support.cpython_only</span>
<div class="viewcode-block" id="TestSpecifics.test_same_filename_used"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_same_filename_used">[docs]</a>    <span class="k">def</span> <span class="nf">test_same_filename_used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;def f(): pass</span><span class="se">\n</span><span class="s">def g(): pass&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;myfile&quot;</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">co_consts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">CodeType</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">co_filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_single_statement"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_single_statement">[docs]</a>    <span class="k">def</span> <span class="nf">test_single_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1 + 2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">1 + 2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1 + 2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1 + 2</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1 + 2</span><span class="se">\t\t\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1 + 2</span><span class="se">\t\t\n</span><span class="s">        &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1 + 2 # one plus two&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;1; 2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;import sys; sys&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;def f():</span><span class="se">\n</span><span class="s">   pass&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;while False:</span><span class="se">\n</span><span class="s">   pass&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;if x:</span><span class="se">\n</span><span class="s">   f(x)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;if x:</span><span class="se">\n</span><span class="s">   f(x)</span><span class="se">\n</span><span class="s">else:</span><span class="se">\n</span><span class="s">   g(x)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="s">&quot;class T:</span><span class="se">\n</span><span class="s">   pass&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSpecifics.test_bad_single_statement"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_bad_single_statement">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_single_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;1</span><span class="se">\n</span><span class="s">2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;def f(): pass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;a = 13</span><span class="se">\n</span><span class="s">b = 187&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;del x</span><span class="se">\n</span><span class="s">del y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;f()</span><span class="se">\n</span><span class="s">g()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;f()</span><span class="se">\n</span><span class="s"># blah</span><span class="se">\n</span><span class="s">blah()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;f()</span><span class="se">\n</span><span class="s">xy # blah</span><span class="se">\n</span><span class="s">blah()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalidSingle</span><span class="p">(</span><span class="s">&#39;x = 5 # comment</span><span class="se">\n</span><span class="s">x = 6</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@support.cpython_only</span>
<div class="viewcode-block" id="TestSpecifics.test_compiler_recursion_limit"><a class="viewcode-back" href="../../test.html#test.test_compile.TestSpecifics.test_compiler_recursion_limit">[docs]</a>    <span class="k">def</span> <span class="nf">test_compiler_recursion_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Expected limit is sys.getrecursionlimit() * the scaling factor</span>
        <span class="c"># in symtable.c (currently 3)</span>
        <span class="c"># We expect to fail *at* that limit, because we use up some of</span>
        <span class="c"># the stack depth limit in the test suite code</span>
        <span class="c"># So we check the expected limit and 75% of that</span>
        <span class="c"># XXX (ncoghlan): duplicating the scaling factor here is a little</span>
        <span class="c"># ugly. Perhaps it should be exposed somewhere...</span>
        <span class="n">fail_depth</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getrecursionlimit</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="n">success_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_depth</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">check_limit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">repeated</span><span class="p">):</span>
            <span class="n">expect_ok</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">repeated</span> <span class="o">*</span> <span class="n">success_depth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="n">expect_ok</span><span class="p">)</span>
            <span class="n">broken</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">repeated</span> <span class="o">*</span> <span class="n">fail_depth</span>
            <span class="n">details</span> <span class="o">=</span> <span class="s">&quot;Compiling ({!r} + {!r} * {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">prefix</span><span class="p">,</span> <span class="n">repeated</span><span class="p">,</span> <span class="n">fail_depth</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">details</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compile_single</span><span class="p">(</span><span class="n">broken</span><span class="p">)</span>

        <span class="n">check_limit</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;()&quot;</span><span class="p">)</span>
        <span class="n">check_limit</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;.b&quot;</span><span class="p">)</span>
        <span class="n">check_limit</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;[0]&quot;</span><span class="p">)</span>
        <span class="n">check_limit</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;*a&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestStackSize"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize">[docs]</a><span class="k">class</span> <span class="nc">TestStackSize</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># These tests check that the computed stack size for a code object</span>
    <span class="c"># stays within reasonable bounds (see issue #21523 for an example</span>
    <span class="c"># dysfunction).</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<div class="viewcode-block" id="TestStackSize.check_stack_size"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.check_stack_size">[docs]</a>    <span class="k">def</span> <span class="nf">check_stack_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="c"># To assert that the alleged stack size is not O(N), we</span>
        <span class="c"># check that it is smaller than log(N).</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s">&quot;&lt;foo&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;single&quot;</span><span class="p">)</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_code</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_stacksize</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_and"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_and">[docs]</a>    <span class="k">def</span> <span class="nf">test_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="s">&quot;x and &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_or"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_or">[docs]</a>    <span class="k">def</span> <span class="nf">test_or</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="s">&quot;x or &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_and_or"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_and_or">[docs]</a>    <span class="k">def</span> <span class="nf">test_and_or</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="s">&quot;x and x or &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_chained_comparison"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_chained_comparison">[docs]</a>    <span class="k">def</span> <span class="nf">test_chained_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="s">&quot;x &lt; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_if_else"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_if_else">[docs]</a>    <span class="k">def</span> <span class="nf">test_if_else</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="s">&quot;x if x else &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_binop"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_binop">[docs]</a>    <span class="k">def</span> <span class="nf">test_binop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="s">&quot;x + &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestStackSize.test_func_and"><a class="viewcode-back" href="../../test.html#test.test_compile.TestStackSize.test_func_and">[docs]</a>    <span class="k">def</span> <span class="nf">test_func_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&quot;def f(x):</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="s">&quot;   x and x</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stack_size</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>