

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_zlib &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_zlib</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_zlib</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="n">bigmemtest</span><span class="p">,</span> <span class="n">_1G</span><span class="p">,</span> <span class="n">_4G</span>

<span class="n">zlib</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;zlib&#39;</span><span class="p">)</span>

<span class="n">requires_Compress_copy</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">skipUnless</span><span class="p">(</span>
        <span class="nb">hasattr</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(),</span> <span class="s">&quot;copy&quot;</span><span class="p">),</span>
        <span class="s">&#39;requires Compress.copy()&#39;</span><span class="p">)</span>
<span class="n">requires_Decompress_copy</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">skipUnless</span><span class="p">(</span>
        <span class="nb">hasattr</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">(),</span> <span class="s">&quot;copy&quot;</span><span class="p">),</span>
        <span class="s">&#39;requires Decompress.copy()&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="VersionTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.VersionTestCase">[docs]</a><span class="k">class</span> <span class="nc">VersionTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="VersionTestCase.test_library_version"><a class="viewcode-back" href="../../test.html#test.test_zlib.VersionTestCase.test_library_version">[docs]</a>    <span class="k">def</span> <span class="nf">test_library_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that the major version of the actual library in use matches the</span>
        <span class="c"># major version that we were compiled against. We can&#39;t guarantee that</span>
        <span class="c"># the minor versions will match (even on the machine on which the module</span>
        <span class="c"># was compiled), and the API is stable between minor versions, so</span>
        <span class="c"># testing only the major versions avoids spurious failures.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">ZLIB_RUNTIME_VERSION</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zlib</span><span class="o">.</span><span class="n">ZLIB_VERSION</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="ChecksumTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase">[docs]</a><span class="k">class</span> <span class="nc">ChecksumTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># checksum test cases</span>
<div class="viewcode-block" id="ChecksumTestCase.test_crc32start"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_crc32start">[docs]</a>    <span class="k">def</span> <span class="nf">test_crc32start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.test_crc32empty"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_crc32empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_crc32empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">432</span><span class="p">),</span> <span class="mi">432</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.test_adler32start"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_adler32start">[docs]</a>    <span class="k">def</span> <span class="nf">test_adler32start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.test_adler32empty"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_adler32empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_adler32empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">432</span><span class="p">),</span> <span class="mi">432</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.assertEqual32"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.assertEqual32">[docs]</a>    <span class="k">def</span> <span class="nf">assertEqual32</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seen</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="c"># 32-bit values masked -- checksums on 32- vs 64- bit machines</span>
        <span class="c"># This is important if bit 31 (0x08000000L) is set.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">seen</span> <span class="o">&amp;</span> <span class="mh">0x0FFFFFFFF</span><span class="p">,</span> <span class="n">expected</span> <span class="o">&amp;</span> <span class="mh">0x0FFFFFFFF</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.test_penguins"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_penguins">[docs]</a>    <span class="k">def</span> <span class="nf">test_penguins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual32</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x0e5c1a120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual32</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mh">0x43b6aa94</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual32</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x0bcf02f6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual32</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mh">0x0bd602f7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">),</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">),</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;penguin&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.test_crc32_adler32_unsigned"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_crc32_adler32_unsigned">[docs]</a>    <span class="k">def</span> <span class="nf">test_crc32_adler32_unsigned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;abcdefghijklmnop&#39;</span>
        <span class="c"># explicitly test signed behavior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="mi">2486878355</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;spam&#39;</span><span class="p">),</span> <span class="mi">1138425661</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">foo</span><span class="o">+</span><span class="n">foo</span><span class="p">),</span> <span class="mi">3573550353</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;spam&#39;</span><span class="p">),</span> <span class="mi">72286642</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ChecksumTestCase.test_same_as_binascii_crc32"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumTestCase.test_same_as_binascii_crc32">[docs]</a>    <span class="k">def</span> <span class="nf">test_same_as_binascii_crc32</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;abcdefghijklmnop&#39;</span>
        <span class="n">crc</span> <span class="o">=</span> <span class="mi">2486878355</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="n">crc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="n">crc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;spam&#39;</span><span class="p">),</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;spam&#39;</span><span class="p">))</span>


<span class="c"># Issue #10276 - check that inputs &gt;=4GB are handled correctly.</span></div></div>
<div class="viewcode-block" id="ChecksumBigBufferTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.ChecksumBigBufferTestCase">[docs]</a><span class="k">class</span> <span class="nc">ChecksumBigBufferTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_4G</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_big_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;nyan&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">_1G</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">1044521549</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">2256789997</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ExceptionTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.ExceptionTestCase">[docs]</a><span class="k">class</span> <span class="nc">ExceptionTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># make sure we generate some expected errors</span>
<div class="viewcode-block" id="ExceptionTestCase.test_badlevel"><a class="viewcode-back" href="../../test.html#test.test_zlib.ExceptionTestCase.test_badlevel">[docs]</a>    <span class="k">def</span> <span class="nf">test_badlevel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># specifying compression level out of range causes an error</span>
        <span class="c"># (but -1 is Z_DEFAULT_COMPRESSION and apparently the zlib</span>
        <span class="c"># accepts 0 too)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;ERROR&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionTestCase.test_badargs"><a class="viewcode-back" href="../../test.html#test.test_zlib.ExceptionTestCase.test_badargs">[docs]</a>    <span class="k">def</span> <span class="nf">test_badargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">adler32</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionTestCase.test_badcompressobj"><a class="viewcode-back" href="../../test.html#test.test_zlib.ExceptionTestCase.test_badcompressobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_badcompressobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># verify failure on building compress object with bad params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">DEFLATED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c"># specifying total bits too large causes an error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span>
                <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">DEFLATED</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">MAX_WBITS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionTestCase.test_baddecompressobj"><a class="viewcode-back" href="../../test.html#test.test_zlib.ExceptionTestCase.test_baddecompressobj">[docs]</a>    <span class="k">def</span> <span class="nf">test_baddecompressobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># verify failure on building decompress object with bad params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionTestCase.test_decompressobj_badflush"><a class="viewcode-back" href="../../test.html#test.test_zlib.ExceptionTestCase.test_decompressobj_badflush">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompressobj_badflush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># verify failure on calling decompressobj.flush with bad params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span><span class="o">.</span><span class="n">flush</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span><span class="o">.</span><span class="n">flush</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="BaseCompressTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.BaseCompressTestCase">[docs]</a><span class="k">class</span> <span class="nc">BaseCompressTestCase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="BaseCompressTestCase.check_big_compress_buffer"><a class="viewcode-back" href="../../test.html#test.test_zlib.BaseCompressTestCase.check_big_compress_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">check_big_compress_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">compress_func</span><span class="p">):</span>
        <span class="n">_1M</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">0</span><span class="si">%d</span><span class="s">x&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_1M</span><span class="p">)</span>
        <span class="c"># Generate 10MB worth of random, and expand it by repeating it.</span>
        <span class="c"># The assumption is that zlib&#39;s memory is not big enough to exploit</span>
        <span class="c"># such spread out redundancy.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">_1M</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">_1M</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">compress_func</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c"># Release memory</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="BaseCompressTestCase.check_big_decompress_buffer"><a class="viewcode-back" href="../../test.html#test.test_zlib.BaseCompressTestCase.check_big_decompress_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">check_big_decompress_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">decompress_func</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="n">size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c"># Release memory</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">decompress_func</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
        <span class="c"># Sanity check</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;x&#39;</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

</div></div>
<div class="viewcode-block" id="CompressTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressTestCase">[docs]</a><span class="k">class</span> <span class="nc">CompressTestCase</span><span class="p">(</span><span class="n">BaseCompressTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Test compression in one go (whole message compression)</span>
<div class="viewcode-block" id="CompressTestCase.test_speech"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressTestCase.test_speech">[docs]</a>    <span class="k">def</span> <span class="nf">test_speech</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">HAMLET_SCENE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressTestCase.test_speech128"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressTestCase.test_speech128">[docs]</a>    <span class="k">def</span> <span class="nf">test_speech128</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># compress more data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span> <span class="o">*</span> <span class="mi">128</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">ob</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressTestCase.test_incomplete_stream"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressTestCase.test_incomplete_stream">[docs]</a>    <span class="k">def</span> <span class="nf">test_incomplete_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># An useful error message is given</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
            <span class="s">&quot;Error -5 while decompressing data: incomplete or truncated stream&quot;</span><span class="p">,</span>
            <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c"># Memory use of the following functions takes into account overallocation</span>
</div>
    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_1G</span> <span class="o">+</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_big_compress_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">compress</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_big_compress_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_1G</span> <span class="o">+</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_big_decompress_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_big_decompress_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">)</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_4G</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_length_overflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="n">size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="CompressObjectTestCase"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase">[docs]</a><span class="k">class</span> <span class="nc">CompressObjectTestCase</span><span class="p">(</span><span class="n">BaseCompressTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Test compression object</span>
<div class="viewcode-block" id="CompressObjectTestCase.test_pair"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_pair">[docs]</a>    <span class="k">def</span> <span class="nf">test_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># straightforward compress/decompress objects</span>
        <span class="n">datasrc</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span> <span class="o">*</span> <span class="mi">128</span>
        <span class="n">datazip</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">datasrc</span><span class="p">)</span>
        <span class="c"># should compress both bytes and bytearray data</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">datasrc</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">datasrc</span><span class="p">)):</span>
            <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">()</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">)</span> <span class="c"># second flush should not work</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">datazip</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">x2</span><span class="p">))):</span>
            <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unused_data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_compressoptions"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_compressoptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_compressoptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># specify lots of options to compressobj()</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">DEFLATED</span>
        <span class="n">wbits</span> <span class="o">=</span> <span class="o">-</span><span class="mi">12</span>
        <span class="n">memlevel</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">strategy</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">Z_FILTERED</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">wbits</span><span class="p">,</span> <span class="n">memlevel</span><span class="p">,</span> <span class="n">strategy</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">(</span><span class="n">wbits</span><span class="p">)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_compressincremental"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_compressincremental">[docs]</a>    <span class="k">def</span> <span class="nf">test_compressincremental</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># compress object in steps, decompress object as one-shot</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span> <span class="o">*</span> <span class="mi">128</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">256</span><span class="p">):</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">256</span><span class="p">]))</span>
        <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="n">combuf</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">)</span>

        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">))</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompinc"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompinc">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompinc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cx</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">dcx</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
        <span class="c"># compress object in steps, decompress object in steps</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span> <span class="ow">or</span> <span class="n">HAMLET_SCENE</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">source</span> <span class="o">*</span> <span class="mi">128</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">cx</span><span class="p">):</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">cx</span><span class="p">]))</span>
        <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="n">combuf</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">)</span>

        <span class="n">decombuf</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">combuf</span><span class="p">)</span>
        <span class="c"># Test type of return value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">decombuf</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decombuf</span><span class="p">)</span>

        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">combuf</span><span class="p">),</span> <span class="n">dcx</span><span class="p">):</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">combuf</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">dcx</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">,</span> <span class="c">########</span>
                             <span class="s">&quot;(A) uct should be b&#39;&#39;: not </span><span class="si">%d</span><span class="s"> long&quot;</span> <span class="o">%</span>
                                       <span class="nb">len</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">unused_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flush</span><span class="p">:</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">,</span> <span class="c">########</span>
                         <span class="s">&quot;(B) uct should be b&#39;&#39;: not </span><span class="si">%d</span><span class="s"> long&quot;</span> <span class="o">%</span>
                                       <span class="nb">len</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">unused_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">))</span>
        <span class="c"># Failure means: &quot;decompressobj with init options failed&quot;</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompincflush"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompincflush">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompincflush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_decompinc</span><span class="p">(</span><span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompimax"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompimax">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompimax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cx</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">dcx</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
        <span class="c"># compress in steps, decompress in length-restricted steps</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span> <span class="ow">or</span> <span class="n">HAMLET_SCENE</span>
        <span class="c"># Check a decompression object with max_length specified</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">source</span> <span class="o">*</span> <span class="mi">128</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">cx</span><span class="p">):</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">cx</span><span class="p">]))</span>
        <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="n">combuf</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">combuf</span><span class="p">),</span>
                         <span class="s">&#39;compressed data failure&#39;</span><span class="p">)</span>

        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">combuf</span>
        <span class="k">while</span> <span class="n">cb</span><span class="p">:</span>
            <span class="c">#max_length = 1 + len(cb)//10</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">dcx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dcx</span><span class="p">,</span>
                    <span class="s">&#39;chunk too big (</span><span class="si">%d</span><span class="s">&gt;</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span> <span class="n">dcx</span><span class="p">))</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span>
        <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">),</span> <span class="s">&#39;Wrong data retrieved&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompressmaxlen"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompressmaxlen">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompressmaxlen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># Check a decompression object with max_length specified</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span> <span class="o">*</span> <span class="mi">128</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">256</span><span class="p">):</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">256</span><span class="p">]))</span>
        <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="n">combuf</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">combuf</span><span class="p">),</span>
                         <span class="s">&#39;compressed data failure&#39;</span><span class="p">)</span>

        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">combuf</span>
        <span class="k">while</span> <span class="n">cb</span><span class="p">:</span>
            <span class="n">max_length</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span><span class="o">//</span><span class="mi">10</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">,</span>
                        <span class="s">&#39;chunk too big (</span><span class="si">%d</span><span class="s">&gt;</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span><span class="n">max_length</span><span class="p">))</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span>
        <span class="k">if</span> <span class="n">flush</span><span class="p">:</span>
            <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">,</span>
                            <span class="s">&#39;chunk too big (</span><span class="si">%d</span><span class="s">&gt;</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span><span class="n">max_length</span><span class="p">))</span>
                <span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs</span><span class="p">),</span> <span class="s">&#39;Wrong data retrieved&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompressmaxlenflush"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompressmaxlenflush">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompressmaxlenflush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_decompressmaxlen</span><span class="p">(</span><span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_maxlenmisc"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_maxlenmisc">[docs]</a>    <span class="k">def</span> <span class="nf">test_maxlenmisc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Misc tests of max_length</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_clear_unconsumed_tail"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_clear_unconsumed_tail">[docs]</a>    <span class="k">def</span> <span class="nf">test_clear_unconsumed_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #12050: calling decompress() without providing max_length</span>
        <span class="c"># should clear the unconsumed_tail attribute.</span>
        <span class="n">cdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;x</span><span class="se">\x9c</span><span class="s">KLJ</span><span class="se">\x06\x00\x02</span><span class="s">M</span><span class="se">\x01</span><span class="s">&quot;</span>    <span class="c"># &quot;abc&quot;</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">ddata</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ddata</span> <span class="o">+=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_flushes"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_flushes">[docs]</a>    <span class="k">def</span> <span class="nf">test_flushes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test flush() with the various options, using all the</span>
        <span class="c"># different levels in order to provide more variations.</span>
        <span class="n">sync_opt</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Z_NO_FLUSH&#39;</span><span class="p">,</span> <span class="s">&#39;Z_SYNC_FLUSH&#39;</span><span class="p">,</span> <span class="s">&#39;Z_FULL_FLUSH&#39;</span><span class="p">]</span>
        <span class="n">sync_opt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">zlib</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">sync_opt</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">zlib</span><span class="p">,</span> <span class="n">opt</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span> <span class="o">*</span> <span class="mi">8</span>

        <span class="k">for</span> <span class="n">sync</span> <span class="ow">in</span> <span class="n">sync_opt</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span> <span class="n">level</span> <span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3000</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span> <span class="n">sync</span> <span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span><span class="mi">3000</span><span class="p">:]</span> <span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">])),</span>
                                 <span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Decompress failed: flush &quot;</span>
                                        <span class="s">&quot;mode=</span><span class="si">%i</span><span class="s">, level=</span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">sync</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">obj</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">zlib</span><span class="p">,</span> <span class="s">&#39;Z_SYNC_FLUSH&#39;</span><span class="p">),</span>
                         <span class="s">&#39;requires zlib.Z_SYNC_FLUSH&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="CompressObjectTestCase.test_odd_flush"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_odd_flush">[docs]</a>    <span class="k">def</span> <span class="nf">test_odd_flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for odd flushing bugs noted in 2.0, and hopefully fixed in 2.1</span>
        <span class="kn">import</span> <span class="nn">random</span>
        <span class="c"># Testing on 17K of &quot;random&quot; data</span>

        <span class="c"># Create compressor and decompressor objects</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_BEST_COMPRESSION</span><span class="p">)</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>

        <span class="c"># Try 17K of data</span>
        <span class="c"># generate random data stream</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># In 2.3 and later, WichmannHill is the RNG of the bug report</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">WichmannHill</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># 2.2 called it Random</span>
                <span class="n">gen</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c"># others might simply have a single RNG</span>
                <span class="n">gen</span> <span class="o">=</span> <span class="n">random</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">genblock</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">)</span>

        <span class="c"># compress, sync-flush, and decompress</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_SYNC_FLUSH</span><span class="p">)</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="p">)</span>

        <span class="c"># if decompressed data is different from the input data, choke.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expanded</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s">&quot;17K random source doesn&#39;t match&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_empty_flush"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_empty_flush">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that calling .flush() on unused objects works.</span>
        <span class="c"># (Bug #1083110 -- calling .flush() on decompress objects</span>
        <span class="c"># caused a core dump.)</span>

        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_BEST_COMPRESSION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>  <span class="c"># Returns a zlib header</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">(),</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="c"># Returns nothing</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_dictionary"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_dictionary">[docs]</a>    <span class="k">def</span> <span class="nf">test_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span>
        <span class="c"># Build a simulated dictionary out of the words in HAMLET.</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="n">zdict</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="c"># Use it to compress HAMLET.</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="n">zdict</span><span class="o">=</span><span class="n">zdict</span><span class="p">)</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="c"># Verify that it will decompress with the dictionary.</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">(</span><span class="n">zdict</span><span class="o">=</span><span class="n">zdict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">+</span> <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">(),</span> <span class="n">h</span><span class="p">)</span>
        <span class="c"># Verify that it fails when not given the dictionary.</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_dictionary_streaming"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_dictionary_streaming">[docs]</a>    <span class="k">def</span> <span class="nf">test_dictionary_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This simulates the reuse of a compressor object for compressing</span>
        <span class="c"># several separate data streams.</span>
        <span class="n">co</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="n">zdict</span><span class="o">=</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="n">do</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">(</span><span class="n">zdict</span><span class="o">=</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span><span class="p">[</span><span class="mi">1000</span><span class="p">:</span><span class="mi">1500</span><span class="p">]</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span> <span class="o">+</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_SYNC_FLUSH</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">piece</span><span class="p">[</span><span class="mi">100</span><span class="p">:])</span> <span class="o">+</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_SYNC_FLUSH</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">piece</span><span class="p">[:</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span> <span class="o">+</span> <span class="n">co</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_SYNC_FLUSH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">do</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">d0</span><span class="p">),</span> <span class="n">piece</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">do</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">d1</span><span class="p">),</span> <span class="n">piece</span><span class="p">[</span><span class="mi">100</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">do</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">d2</span><span class="p">),</span> <span class="n">piece</span><span class="p">[:</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompress_incomplete_stream"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompress_incomplete_stream">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompress_incomplete_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This is &#39;foo&#39;, deflated</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;x</span><span class="se">\x9c</span><span class="s">K</span><span class="se">\xcb\xcf\x07\x00\x02\x82\x01</span><span class="s">E&#39;</span>
        <span class="c"># For the record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="c"># Omitting the stream end works with decompressor objects</span>
        <span class="c"># (see issue #8672).</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompress_eof"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompress_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompress_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;x</span><span class="se">\x9c</span><span class="s">K</span><span class="se">\xcb\xcf\x07\x00\x02\x82\x01</span><span class="s">E&#39;</span>  <span class="c"># &#39;foo&#39;</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
        <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
        <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
        <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompress_eof_incomplete_stream"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompress_eof_incomplete_stream">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompress_eof_incomplete_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;x</span><span class="se">\x9c</span><span class="s">K</span><span class="se">\xcb\xcf\x07\x00\x02\x82\x01</span><span class="s">E&#39;</span>  <span class="c"># &#39;foo&#39;</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
        <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
        <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompress_unused_data"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompress_unused_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompress_unused_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Repeated calls to decompress() after EOF should accumulate data in</span>
        <span class="c"># dco.unused_data, instead of just storing the arg to the last call.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;0123456789&#39;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">remainder</span>
        <span class="k">for</span> <span class="n">maxlen</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">step</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unused_data</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">maxlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">+=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">step</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">+=</span> <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span>
                                <span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">step</span><span class="p">],</span> <span class="n">maxlen</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">eof</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unconsumed_tail</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">unused_data</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CompressObjectTestCase.test_flush_with_freed_input"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_flush_with_freed_input">[docs]</a>    <span class="k">def</span> <span class="nf">test_flush_with_freed_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #16411: decompressor accesses input to last decompress() call</span>
        <span class="c"># in flush(), even if this object has been freed in the meanwhile.</span>
        <span class="n">input1</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
        <span class="n">input2</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;QWERTYUIOPASDFGHJKLZXCVBNM&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span>
        <span class="n">dco</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">dco</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dco</span><span class="o">.</span><span class="n">flush</span><span class="p">(),</span> <span class="n">input1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</div>
    <span class="nd">@requires_Compress_copy</span>
<div class="viewcode-block" id="CompressObjectTestCase.test_compresscopy"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_compresscopy">[docs]</a>    <span class="k">def</span> <span class="nf">test_compresscopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test copying a compression object</span>
        <span class="n">data0</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">swapcase</span><span class="p">(),</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">Z_BEST_COMPRESSION</span><span class="p">)</span>
        <span class="n">bufs0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bufs0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c0</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data0</span><span class="p">))</span>

        <span class="n">c1</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bufs1</span> <span class="o">=</span> <span class="n">bufs0</span><span class="p">[:]</span>

        <span class="n">bufs0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c0</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data0</span><span class="p">))</span>
        <span class="n">bufs0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c0</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs0</span><span class="p">)</span>

        <span class="n">bufs1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data1</span><span class="p">))</span>
        <span class="n">bufs1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">s0</span><span class="p">),</span><span class="n">data0</span><span class="o">+</span><span class="n">data0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span><span class="n">data0</span><span class="o">+</span><span class="n">data1</span><span class="p">)</span>
</div>
    <span class="nd">@requires_Compress_copy</span>
<div class="viewcode-block" id="CompressObjectTestCase.test_badcompresscopy"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_badcompresscopy">[docs]</a>    <span class="k">def</span> <span class="nf">test_badcompresscopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test copying a compression object in an inconsistent state</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">copy</span><span class="p">)</span>
</div>
    <span class="nd">@requires_Decompress_copy</span>
<div class="viewcode-block" id="CompressObjectTestCase.test_decompresscopy"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_decompresscopy">[docs]</a>    <span class="k">def</span> <span class="nf">test_decompresscopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test copying a decompression object</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">HAMLET_SCENE</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c"># Test type of return value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>

        <span class="n">d0</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">bufs0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bufs0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d0</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">comp</span><span class="p">[:</span><span class="mi">32</span><span class="p">]))</span>

        <span class="n">d1</span> <span class="o">=</span> <span class="n">d0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bufs1</span> <span class="o">=</span> <span class="n">bufs0</span><span class="p">[:]</span>

        <span class="n">bufs0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d0</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">32</span><span class="p">:]))</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs0</span><span class="p">)</span>

        <span class="n">bufs1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">32</span><span class="p">:]))</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bufs1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="n">s1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
</div>
    <span class="nd">@requires_Decompress_copy</span>
<div class="viewcode-block" id="CompressObjectTestCase.test_baddecompresscopy"><a class="viewcode-back" href="../../test.html#test.test_zlib.CompressObjectTestCase.test_baddecompresscopy">[docs]</a>    <span class="k">def</span> <span class="nf">test_baddecompresscopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test copying a compression object in an inconsistent state</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">HAMLET_SCENE</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">copy</span><span class="p">)</span>

    <span class="c"># Memory use of the following functions takes into account overallocation</span>
</div>
    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_1G</span> <span class="o">+</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_big_compress_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">compress</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_big_compress_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_1G</span> <span class="o">+</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_big_decompress_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="n">decompress</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_big_decompress_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">decompress</span><span class="p">)</span>

    <span class="nd">@bigmemtest</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">_4G</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">memuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_length_overflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="n">size</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compressobj</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompressobj</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">decompress</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="genblock"><a class="viewcode-back" href="../../test.html#test.test_zlib.genblock">[docs]</a><span class="k">def</span> <span class="nf">genblock</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">random</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;length-byte stream of random data from a seed (in step-byte blocks).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">generator</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">randint</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">randint</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">step</span> <span class="ow">or</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">length</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">blocks</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">blocks</span>


</div>
<div class="viewcode-block" id="choose_lines"><a class="viewcode-back" href="../../test.html#test.test_zlib.choose_lines">[docs]</a><span class="k">def</span> <span class="nf">choose_lines</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">random</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a list of number lines randomly chosen from the source&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">generator</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">)]</span>


</div>
<span class="n">HAMLET_SCENE</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">LAERTES</span>

<span class="s">       O, fear me not.</span>
<span class="s">       I stay too long: but here my father comes.</span>

<span class="s">       Enter POLONIUS</span>

<span class="s">       A double blessing is a double grace,</span>
<span class="s">       Occasion smiles upon a second leave.</span>

<span class="s">LORD POLONIUS</span>

<span class="s">       Yet here, Laertes! aboard, aboard, for shame!</span>
<span class="s">       The wind sits in the shoulder of your sail,</span>
<span class="s">       And you are stay&#39;d for. There; my blessing with thee!</span>
<span class="s">       And these few precepts in thy memory</span>
<span class="s">       See thou character. Give thy thoughts no tongue,</span>
<span class="s">       Nor any unproportioned thought his act.</span>
<span class="s">       Be thou familiar, but by no means vulgar.</span>
<span class="s">       Those friends thou hast, and their adoption tried,</span>
<span class="s">       Grapple them to thy soul with hoops of steel;</span>
<span class="s">       But do not dull thy palm with entertainment</span>
<span class="s">       Of each new-hatch&#39;d, unfledged comrade. Beware</span>
<span class="s">       Of entrance to a quarrel, but being in,</span>
<span class="s">       Bear&#39;t that the opposed may beware of thee.</span>
<span class="s">       Give every man thy ear, but few thy voice;</span>
<span class="s">       Take each man&#39;s censure, but reserve thy judgment.</span>
<span class="s">       Costly thy habit as thy purse can buy,</span>
<span class="s">       But not express&#39;d in fancy; rich, not gaudy;</span>
<span class="s">       For the apparel oft proclaims the man,</span>
<span class="s">       And they in France of the best rank and station</span>
<span class="s">       Are of a most select and generous chief in that.</span>
<span class="s">       Neither a borrower nor a lender be;</span>
<span class="s">       For loan oft loses both itself and friend,</span>
<span class="s">       And borrowing dulls the edge of husbandry.</span>
<span class="s">       This above all: to thine ownself be true,</span>
<span class="s">       And it must follow, as the night the day,</span>
<span class="s">       Thou canst not then be false to any man.</span>
<span class="s">       Farewell: my blessing season this in thee!</span>

<span class="s">LAERTES</span>

<span class="s">       Most humbly do I take my leave, my lord.</span>

<span class="s">LORD POLONIUS</span>

<span class="s">       The time invites you; go; your servants tend.</span>

<span class="s">LAERTES</span>

<span class="s">       Farewell, Ophelia; and remember well</span>
<span class="s">       What I have said to you.</span>

<span class="s">OPHELIA</span>

<span class="s">       &#39;Tis in my memory lock&#39;d,</span>
<span class="s">       And you yourself shall keep the key of it.</span>

<span class="s">LAERTES</span>

<span class="s">       Farewell.</span>
<span class="s">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_zlib.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">():</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span>
        <span class="n">VersionTestCase</span><span class="p">,</span>
        <span class="n">ChecksumTestCase</span><span class="p">,</span>
        <span class="n">ChecksumBigBufferTestCase</span><span class="p">,</span>
        <span class="n">ExceptionTestCase</span><span class="p">,</span>
        <span class="n">CompressTestCase</span><span class="p">,</span>
        <span class="n">CompressObjectTestCase</span>
    <span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="c"># XXX</span>
    <span class="c">###test_main()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>