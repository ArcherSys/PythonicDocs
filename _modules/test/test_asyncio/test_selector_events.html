

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_asyncio.test_selector_events &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../../index.html"/>
        <link rel="up" title="test.test_asyncio" href="../test_asyncio.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../test_asyncio.html">test.test_asyncio</a> &raquo;</li>
      
    <li>test.test_asyncio.test_selector_events</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_asyncio.test_selector_events</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Tests for selector_events.py&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">mock</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ssl</span> <span class="o">=</span> <span class="bp">None</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">asyncio</span> <span class="kn">import</span> <span class="n">selectors</span>
<span class="kn">from</span> <span class="nn">asyncio</span> <span class="kn">import</span> <span class="n">test_utils</span>
<span class="kn">from</span> <span class="nn">asyncio.selector_events</span> <span class="kn">import</span> <span class="n">BaseSelectorEventLoop</span>
<span class="kn">from</span> <span class="nn">asyncio.selector_events</span> <span class="kn">import</span> <span class="n">_SelectorTransport</span>
<span class="kn">from</span> <span class="nn">asyncio.selector_events</span> <span class="kn">import</span> <span class="n">_SelectorSslTransport</span>
<span class="kn">from</span> <span class="nn">asyncio.selector_events</span> <span class="kn">import</span> <span class="n">_SelectorSocketTransport</span>
<span class="kn">from</span> <span class="nn">asyncio.selector_events</span> <span class="kn">import</span> <span class="n">_SelectorDatagramTransport</span>


<span class="n">MOCK_ANY</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">ANY</span>


<div class="viewcode-block" id="TestBaseSelectorEventLoop"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.TestBaseSelectorEventLoop">[docs]</a><span class="k">class</span> <span class="nc">TestBaseSelectorEventLoop</span><span class="p">(</span><span class="n">BaseSelectorEventLoop</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_make_self_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_fds</span> <span class="o">+=</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="list_to_buffer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.list_to_buffer">[docs]</a><span class="k">def</span> <span class="nf">list_to_buffer</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="p">()):</span>
    <span class="k">return</span> <span class="nb">bytearray</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests">[docs]</a><span class="k">class</span> <span class="nc">BaseSelectorEventLoopTests</span><span class="p">(</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="BaseSelectorEventLoopTests.setUp"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span> <span class="o">=</span> <span class="n">TestBaseSelectorEventLoop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_make_socket_transport"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_make_socket_transport">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_socket_transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_make_socket_transport</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">_SelectorSocketTransport</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">ssl</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;No ssl module&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_make_ssl_transport"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_make_ssl_transport">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_ssl_transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">waiter</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">disable_logger</span><span class="p">():</span>
            <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_make_ssl_transport</span><span class="p">(</span>
                <span class="n">m</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">(),</span> <span class="n">m</span><span class="p">,</span> <span class="n">waiter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">_SelectorSslTransport</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.selector_events.ssl&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_make_ssl_transport_without_ssl_error"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_make_ssl_transport_without_ssl_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_ssl_transport_without_ssl_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_make_ssl_transport</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_close"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ssock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_ssock</span>
        <span class="n">ssock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">csock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_csock</span>
        <span class="n">csock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">remove_reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span> <span class="o">=</span> <span class="n">selector</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">is_closed</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">is_closed</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_csock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_ssock</span><span class="p">)</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="n">ssock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="n">csock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="n">remove_reader</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

        <span class="c"># it should be possible to call close() more than once</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># operation blocked when the loop is closed</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_forever</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">def</span> <span class="nf">callback</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_close_no_selector"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_close_no_selector">[docs]</a>    <span class="k">def</span> <span class="nf">test_close_no_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_socketpair"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_socketpair">[docs]</a>    <span class="k">def</span> <span class="nf">test_socketpair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_socketpair</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_read_from_self_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_read_from_self_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_from_self_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_ssock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_read_from_self</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_read_from_self_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_read_from_self_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_from_self_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_ssock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_read_from_self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_write_to_self_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_write_to_self_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_to_self_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_csock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">disable_logger</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_write_to_self</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_write_to_self_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_write_to_self_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_to_self_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># _write_to_self() swallows OSError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_csock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_write_to_self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_sock_recv"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_sock_recv">[docs]</a>    <span class="k">def</span> <span class="nf">test_sock_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">mock_nonblocking_socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">sock_recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_recv_canceled_fut"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_recv_canceled_fut">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_recv_canceled_fut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_recv_unregister"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_recv_unregister">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_recv_unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">10</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_recv_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_recv_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_recv_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_recv_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_recv_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_recv_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_recv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_sock_sendall"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_sock_sendall">[docs]</a>    <span class="k">def</span> <span class="nf">test_sock_sendall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">mock_nonblocking_socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">sock_sendall</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_sock_sendall_nodata"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_sock_sendall_nodata">[docs]</a>    <span class="k">def</span> <span class="nf">test_sock_sendall_nodata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">mock_nonblocking_socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">sock_sendall</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_canceled_fut"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_canceled_fut">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_canceled_fut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_unregister"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_unregister">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">10</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_interrupted"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_interrupted">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_interrupted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">InterruptedError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exception</span><span class="p">(),</span> <span class="n">err</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_partial"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;ta&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_sendall_none"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_sendall_none">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_sendall_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_sendall</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_sock_connect"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_sock_connect">[docs]</a>    <span class="k">def</span> <span class="nf">test_sock_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">mock_nonblocking_socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">sock_connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_sock_connect_timeout"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_sock_connect_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">test_sock_connect_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Tulip issue #205: sock_connect() must unregister the socket on</span>
        <span class="c"># timeout error</span>

        <span class="c"># prepare mocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">mock_nonblocking_socket</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="c"># first call to sock_connect() registers the socket</span>
        <span class="n">fut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">sock_connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fut</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># on timeout, the socket must be unregistered</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="n">fut</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">fut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_connect"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_connect">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>

        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_connect_cb_cancelled_fut"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_connect_cb_cancelled_fut">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_connect_cb_cancelled_fut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect_cb</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">getsockopt</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_connect_writer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_connect_writer">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_connect_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># check that the fd is registered and then unregistered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_process_events</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">getsockopt</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect_cb</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="c"># need to run the event loop to execute _sock_connect_done() callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">10</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_connect_cb_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_connect_cb_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_connect_cb_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">getsockopt</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span>

        <span class="c"># check that the exception is handled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect_cb</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_connect_cb_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_connect_cb_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_connect_cb_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">getsockopt</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOTCONN</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_connect_cb</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exception</span><span class="p">(),</span> <span class="ne">OSError</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_sock_accept"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_sock_accept">[docs]</a>    <span class="k">def</span> <span class="nf">test_sock_accept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">mock_nonblocking_socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">sock_accept</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_accept"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_accept">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_accept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">conn</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)),</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="bp">False</span><span class="p">,),</span> <span class="n">conn</span><span class="o">.</span><span class="n">setblocking</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_accept_canceled_fut"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_accept_canceled_fut">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_accept_canceled_fut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_accept_unregister"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_accept_unregister">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_accept_unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">10</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_accept_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_accept_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_accept_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">sock</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test__sock_accept_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test__sock_accept_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test__sock_accept_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_sock_accept</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_add_reader"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_add_reader">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">KeyError</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_add_reader_existing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_add_reader_existing">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_reader_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">))</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">cancel</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span> <span class="o">|</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_add_reader_existing_writer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_add_reader_existing_writer">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_reader_existing_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">writer</span><span class="p">))</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span> <span class="o">|</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_remove_reader"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_remove_reader">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">unregister</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_remove_reader_read_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_remove_reader_read_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_reader_read_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span> <span class="o">|</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span>
            <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">unregister</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">writer</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_remove_reader_unknown"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_remove_reader_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_reader_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">KeyError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_add_writer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_add_writer">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">KeyError</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">_callback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_add_writer_existing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_add_writer_existing">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_writer_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">))</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">cancel</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span> <span class="o">|</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">_callback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_remove_writer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_remove_writer">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">unregister</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_remove_writer_read_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_remove_writer_read_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_writer_read_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span> <span class="o">|</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span>
            <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">unregister</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">None</span><span class="p">)),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">modify</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_remove_writer_unknown"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_remove_writer_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove_writer_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_selector</span><span class="o">.</span><span class="n">get_key</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">KeyError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_process_events_read"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_process_events_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_process_events_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">_cancelled</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_add_callback</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_process_events</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">None</span><span class="p">)),</span>
              <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_add_callback</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_add_callback</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_process_events_read_cancelled"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_process_events_read_cancelled">[docs]</a>    <span class="k">def</span> <span class="nf">test_process_events_read_cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">cancelled</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_process_events</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">,</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">None</span><span class="p">)),</span>
             <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_READ</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_process_events_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_process_events_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_process_events_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">_cancelled</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_add_callback</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_process_events</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span>
                                    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">writer</span><span class="p">)),</span>
              <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_add_callback</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSelectorEventLoopTests.test_process_events_write_cancelled"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.BaseSelectorEventLoopTests.test_process_events_write_cancelled">[docs]</a>    <span class="k">def</span> <span class="nf">test_process_events_write_cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">cancelled</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">_process_events</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">selectors</span><span class="o">.</span><span class="n">SelectorKey</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">,</span>
                                    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">writer</span><span class="p">)),</span>
              <span class="n">selectors</span><span class="o">.</span><span class="n">EVENT_WRITE</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SelectorTransportTests"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests">[docs]</a><span class="k">class</span> <span class="nc">SelectorTransportTests</span><span class="p">(</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="SelectorTransportTests.setUp"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_test_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">make_test_protocol</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">7</span>
</div>
<div class="viewcode-block" id="SelectorTransportTests.test_ctor"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_ctor">[docs]</a>    <span class="k">def</span> <span class="nf">test_ctor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_sock_fd</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorTransportTests.test_abort"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_abort">[docs]</a>    <span class="k">def</span> <span class="nf">test_abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_force_close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">tr</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_force_close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorTransportTests.test_close"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_closing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader_count</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader_count</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SelectorTransportTests.test_close_write_buffer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_close_write_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">test_close_write_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">readers</span><span class="p">)</span>
        <span class="n">test_utils</span><span class="o">.</span><span class="n">run_briefly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorTransportTests.test_force_close"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_force_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_force_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">sentinel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">sentinel</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_force_close</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_closing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">list_to_buffer</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">readers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>

        <span class="c"># second close should not remove reader</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_force_close</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">readers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader_count</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.log.logger.error&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorTransportTests.test_fatal_error"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_fatal_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_fatal_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_exc</span><span class="p">):</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_force_close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_fatal_error</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

        <span class="n">m_exc</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="n">test_utils</span><span class="o">.</span><span class="n">MockPattern</span><span class="p">(</span>
                <span class="s">&#39;Fatal error on transport</span><span class="se">\n</span><span class="s">protocol:.*</span><span class="se">\n</span><span class="s">transport:.*&#39;</span><span class="p">),</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">MOCK_ANY</span><span class="p">,</span> <span class="n">MOCK_ANY</span><span class="p">))</span>

        <span class="n">tr</span><span class="o">.</span><span class="n">_force_close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorTransportTests.test_connection_lost"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorTransportTests.test_connection_lost">[docs]</a>    <span class="k">def</span> <span class="nf">test_connection_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_loop</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_call_connection_lost</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_sock</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_loop</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SelectorSocketTransportTests"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests">[docs]</a><span class="k">class</span> <span class="nc">SelectorSocketTransportTests</span><span class="p">(</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="SelectorSocketTransportTests.setUp"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_test_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">make_test_protocol</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock_fd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">7</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_ctor"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_ctor">[docs]</a>    <span class="k">def</span> <span class="nf">test_ctor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
        <span class="n">test_utils</span><span class="o">.</span><span class="n">run_briefly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_made</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_ctor_with_waiter"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_ctor_with_waiter">[docs]</a>    <span class="k">def</span> <span class="nf">test_ctor_with_waiter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fut</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>

        <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">fut</span><span class="p">)</span>
        <span class="n">test_utils</span><span class="o">.</span><span class="n">run_briefly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_pause_resume_reading"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_pause_resume_reading">[docs]</a>    <span class="k">def</span> <span class="nf">test_pause_resume_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">pause_reading</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="mi">7</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">readers</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">resume_reading</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">tr</span><span class="o">.</span><span class="n">resume_reading</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready_eof"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">eof_received</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready_eof_keep_open"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready_eof_keep_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_eof_keep_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">eof_received</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">eof_received</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;logging.exception&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_exc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;logging.exception&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready_tryagain_interrupted"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready_tryagain_interrupted">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_tryagain_interrupted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_exc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">InterruptedError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;logging.exception&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready_conn_reset"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready_conn_reset">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_conn_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_exc</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ConnectionResetError</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_force_close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">disable_logger</span><span class="p">():</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_force_close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;logging.exception&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_read_ready_err"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_read_ready_err">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_exc</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal read error on socket transport&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_bytearray"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_bytearray">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_bytearray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">))</span>  <span class="c"># Hasn&#39;t been mutated.</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_memoryview"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_memoryview">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_memoryview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_no_data"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_no_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_buffer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">]),</span>
                         <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_partial"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;ta&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_partial_bytearray"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_partial_bytearray">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_partial_bytearray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;ta&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">))</span>  <span class="c"># Hasn&#39;t been mutated.</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_partial_memoryview"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_partial_memoryview">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_partial_memoryview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;ta&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_partial_none"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_partial_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_partial_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.selector_events.logger&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_log</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal write error on socket transport&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">m_log</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s">&#39;socket.send() raised exception.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_str"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_str">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_closing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_closing">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_closing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_closing">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_closing</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_no_data"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_no_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="c"># This is an internal error.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_partial"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;ta&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_partial_none"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_partial_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_partial_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1data2&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal write error on socket transport&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.base_events.logger&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_ready_exception_and_close"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_ready_exception_and_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_exception_and_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_log</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>
        <span class="n">remove_writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="n">remove_writer</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock_fd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_eof"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">can_write_eof</span><span class="p">())</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">write_eof</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_WR</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">write_eof</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SelectorSocketTransportTests.test_write_eof_buffer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSocketTransportTests.test_write_eof_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_eof_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorSocketTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">write_eof</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_eof</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="mi">4</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_WR</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">ssl</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;No ssl module&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSslTransportTests"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests">[docs]</a><span class="k">class</span> <span class="nc">SelectorSslTransportTests</span><span class="p">(</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="SelectorSslTransportTests.setUp"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_test_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">make_test_protocol</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="o">.</span><span class="n">wrap_socket</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span>
</div>
    <span class="k">def</span> <span class="nf">_make_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">create_waiter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSslTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">reset_counters</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">transport</span>

<div class="viewcode-block" id="SelectorSslTransportTests.test_on_handshake"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_on_handshake">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_handshake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">waiter</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">_SelectorSslTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">,</span>
            <span class="n">waiter</span><span class="o">=</span><span class="n">waiter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">do_handshake</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
        <span class="n">test_utils</span><span class="o">.</span><span class="n">run_briefly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">waiter</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_on_handshake_reader_retry"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_on_handshake_reader_retry">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_handshake_reader_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">do_handshake</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLWantReadError</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSslTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_on_handshake</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_on_handshake_writer_retry"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_on_handshake_writer_retry">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_handshake_writer_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">do_handshake</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLWantWriteError</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSslTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_on_handshake</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_on_handshake_exc"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_on_handshake_exc">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_handshake_exc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">do_handshake</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">exc</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">disable_logger</span><span class="p">():</span>
            <span class="n">waiter</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
            <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSslTransport</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">,</span> <span class="n">waiter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">waiter</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">waiter</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_on_handshake_base_exc"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_on_handshake_base_exc">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_handshake_base_exc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorSslTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_waiter</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="ne">BaseException</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">do_handshake</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">exc</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">disable_logger</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">BaseException</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_on_handshake</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_waiter</span><span class="o">.</span><span class="n">done</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_waiter</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_pause_resume_reading"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_pause_resume_reading">[docs]</a>    <span class="k">def</span> <span class="nf">test_pause_resume_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">pause_reading</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">readers</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">resume_reading</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_reader</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">tr</span><span class="o">.</span><span class="n">resume_reading</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_bytearray"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_bytearray">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_bytearray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">))</span>  <span class="c"># Hasn&#39;t been mutated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>  <span class="c"># Hasn&#39;t been incorporated.</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_memoryview"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_memoryview">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_memoryview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_no_data"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_no_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_str"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_str">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_closing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_closing">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.selector_events.logger&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_log</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">list_to_buffer</span><span class="p">())</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">m_log</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s">&#39;socket.send() raised exception.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_recv"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_recv">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_write_wants_read"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_write_wants_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_write_wants_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_wants_read</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_write_wants_read</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">_sock_fd</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_recv_eof"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_recv_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_recv_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">eof_received</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_recv_conn_reset"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_recv_conn_reset">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_recv_conn_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ConnectionResetError</span><span class="p">()</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_force_close</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">disable_logger</span><span class="p">():</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_force_close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_recv_retry"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_recv_retry">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_recv_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLWantReadError</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">InterruptedError</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_recv_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_recv_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_recv_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLWantWriteError</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_read_wants_write</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_sock_fd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">_sock_fd</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_read_ready_recv_exc"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_read_ready_recv_exc">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_recv_exc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">recv</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal read error on SSL transport&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">(),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_none"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">])</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1data2&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_partial"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">])</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;ta1data2&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_closing_partial"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_closing_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_closing_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">])</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_closing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_closing">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_closing_empty_buffer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_closing_empty_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_closing_empty_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_retry"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_retry">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLWantWriteError</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">]),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_read"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLWantReadError</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_write_wants_read</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_writer</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_sock_fd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_send_exc"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_send_exc">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_send_exc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">list_to_buffer</span><span class="p">([</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal write error on SSL transport&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">list_to_buffer</span><span class="p">(),</span> <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_ready_read_wants_write"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_ready_read_wants_write">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_ready_read_wants_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslsock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_wants_write</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_write_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_read_wants_write</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_reader</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">_sock_fd</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_write_eof"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_write_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">can_write_eof</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">write_eof</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorSslTransportTests.test_close"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_one</span><span class="p">()</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_closing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader_count</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">tr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">remove_reader_count</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">ssl</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ssl</span><span class="o">.</span><span class="n">HAS_SNI</span><span class="p">,</span> <span class="s">&#39;No SNI support&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSslTransportTests.test_server_hostname"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslTransportTests.test_server_hostname">[docs]</a>    <span class="k">def</span> <span class="nf">test_server_hostname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_SelectorSslTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="p">,</span>
            <span class="n">server_hostname</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sslcontext</span><span class="o">.</span><span class="n">wrap_socket</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">do_handshake_on_connect</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">server_hostname</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SelectorSslWithoutSslTransportTests"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslWithoutSslTransportTests">[docs]</a><span class="k">class</span> <span class="nc">SelectorSslWithoutSslTransportTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.selector_events.ssl&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorSslWithoutSslTransportTests.test_ssl_transport_requires_ssl_module"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorSslWithoutSslTransportTests.test_ssl_transport_requires_ssl_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_ssl_transport_requires_ssl_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Mock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">_SelectorSslTransport</span><span class="p">(</span><span class="n">Mock</span><span class="p">(),</span> <span class="n">Mock</span><span class="p">(),</span> <span class="n">Mock</span><span class="p">(),</span> <span class="n">Mock</span><span class="p">())</span>

</div></div>
<div class="viewcode-block" id="SelectorDatagramTransportTests"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests">[docs]</a><span class="k">class</span> <span class="nc">SelectorDatagramTransportTests</span><span class="p">(</span><span class="n">test_utils</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="SelectorDatagramTransportTests.setUp"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_test_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">make_test_protocol</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">DatagramProtocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">spec_set</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">7</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_read_ready"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_read_ready">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">datagram_received</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_read_ready_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_read_ready_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_read_ready_err"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_read_ready_err">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>

        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal read error on datagram transport&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_read_ready_oserr"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_read_ready_oserr">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_ready_oserr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>

        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_read_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">error_received</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_bytearray"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_bytearray">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_bytearray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_memoryview"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_memoryview">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_memoryview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_no_data"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_no_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))],</span> <span class="nb">list</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_buffer"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)),</span>
             <span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))],</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_buffer_bytearray"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_buffer_bytearray">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_buffer_bytearray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">)</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)),</span>
             <span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))],</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_buffer_memoryview"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_buffer_memoryview">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_buffer_memoryview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">)</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)),</span>
             <span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))],</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))],</span> <span class="nb">list</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">))</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.selector_events.logger&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_log</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal write error on datagram transport&#39;</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">transport</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;123&#39;</span><span class="p">,)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">m_log</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s">&#39;socket.send() raised exception.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_error_received"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_error_received">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_error_received</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ConnectionRefusedError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_error_received_connected"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_error_received_connected">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_error_received_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ConnectionRefusedError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">error_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_str"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_str">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="p">())</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_connected_addr"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_connected_addr">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_connected_addr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_closing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_closing">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_conn_lost</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready_closing"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready_closing">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;data&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_closing</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">connection_lost</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready_no_data"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready_no_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">writers</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready_tryagain"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready_tryagain">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready_tryagain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">BlockingIOError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">()),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">,</span> <span class="p">())])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">assert_writer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;data1&#39;</span><span class="p">,</span> <span class="p">()),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;data2&#39;</span><span class="p">,</span> <span class="p">())],</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready_exception"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">()</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">()))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>

        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
                                   <span class="n">err</span><span class="p">,</span>
                                   <span class="s">&#39;Fatal write error on datagram transport&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready_error_received"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready_error_received">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready_error_received</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ConnectionRefusedError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">()))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_sendto_ready_error_received_connection"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_sendto_ready_error_received_connection">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendto_ready_error_received_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">ConnectionRefusedError</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">()))</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_sendto_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">error_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</div>
    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;asyncio.base_events.logger.error&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="SelectorDatagramTransportTests.test_fatal_error_connected"><a class="viewcode-back" href="../../../test.test_asyncio.html#test.test_asyncio.test_selector_events.SelectorDatagramTransportTests.test_fatal_error_connected">[docs]</a>    <span class="k">def</span> <span class="nf">test_fatal_error_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m_exc</span><span class="p">):</span>
        <span class="n">transport</span> <span class="o">=</span> <span class="n">_SelectorDatagramTransport</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">ConnectionRefusedError</span><span class="p">()</span>
        <span class="n">transport</span><span class="o">.</span><span class="n">_fatal_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">error_received</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="n">m_exc</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
            <span class="n">test_utils</span><span class="o">.</span><span class="n">MockPattern</span><span class="p">(</span>
                <span class="s">&#39;Fatal error on transport</span><span class="se">\n</span><span class="s">protocol:.*</span><span class="se">\n</span><span class="s">transport:.*&#39;</span><span class="p">),</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="p">(</span><span class="n">ConnectionRefusedError</span><span class="p">,</span> <span class="n">MOCK_ANY</span><span class="p">,</span> <span class="n">MOCK_ANY</span><span class="p">))</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>