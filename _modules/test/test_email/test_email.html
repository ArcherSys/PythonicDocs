

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_email.test_email &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../../index.html"/>
        <link rel="up" title="test.test_email" href="../test_email.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../test_email.html">test.test_email</a> &raquo;</li>
      
    <li>test.test_email.test_email</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_email.test_email</h1><div class="highlight"><pre>
<span class="c"># Copyright (C) 2001-2010 Python Software Foundation</span>
<span class="c"># Contact: email-sig@python.org</span>
<span class="c"># email package unit tests</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="kn">import</span> <span class="nn">email</span>
<span class="kn">import</span> <span class="nn">email.policy</span>

<span class="kn">from</span> <span class="nn">email.charset</span> <span class="kn">import</span> <span class="n">Charset</span>
<span class="kn">from</span> <span class="nn">email.header</span> <span class="kn">import</span> <span class="n">Header</span><span class="p">,</span> <span class="n">decode_header</span><span class="p">,</span> <span class="n">make_header</span>
<span class="kn">from</span> <span class="nn">email.parser</span> <span class="kn">import</span> <span class="n">Parser</span><span class="p">,</span> <span class="n">HeaderParser</span>
<span class="kn">from</span> <span class="nn">email.generator</span> <span class="kn">import</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">DecodedGenerator</span><span class="p">,</span> <span class="n">BytesGenerator</span>
<span class="kn">from</span> <span class="nn">email.message</span> <span class="kn">import</span> <span class="n">Message</span>
<span class="kn">from</span> <span class="nn">email.mime.application</span> <span class="kn">import</span> <span class="n">MIMEApplication</span>
<span class="kn">from</span> <span class="nn">email.mime.audio</span> <span class="kn">import</span> <span class="n">MIMEAudio</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.mime.image</span> <span class="kn">import</span> <span class="n">MIMEImage</span>
<span class="kn">from</span> <span class="nn">email.mime.base</span> <span class="kn">import</span> <span class="n">MIMEBase</span>
<span class="kn">from</span> <span class="nn">email.mime.message</span> <span class="kn">import</span> <span class="n">MIMEMessage</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">encoders</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">iterators</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">base64mime</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">quoprimime</span>

<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="n">unlink</span>
<span class="kn">from</span> <span class="nn">test.test_email</span> <span class="kn">import</span> <span class="n">openfile</span><span class="p">,</span> <span class="n">TestEmailBase</span>

<span class="c"># These imports are documented to work, but we are testing them using a</span>
<span class="c"># different path, so we import them here just to make sure they are importable.</span>
<span class="kn">from</span> <span class="nn">email.parser</span> <span class="kn">import</span> <span class="n">FeedParser</span><span class="p">,</span> <span class="n">BytesFeedParser</span>

<span class="n">NL</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
<span class="n">EMPTYSTRING</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">SPACE</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>


<span class="c"># Test various aspects of the Message class&#39;s API</span>
<div class="viewcode-block" id="TestMessageAPI"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI">[docs]</a><span class="k">class</span> <span class="nc">TestMessageAPI</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMessageAPI.test_get_all"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_all">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_20.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s">&#39;cc&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s">&#39;ccc@zzz.org&#39;</span><span class="p">,</span> <span class="s">&#39;ddd@zzz.org&#39;</span><span class="p">,</span> <span class="s">&#39;eee@zzz.org&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s">&#39;xx&#39;</span><span class="p">,</span> <span class="s">&#39;n/a&#39;</span><span class="p">),</span> <span class="s">&#39;n/a&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_getset_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_getset_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_getset_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_charset</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;mime-version&#39;</span><span class="p">],</span> <span class="s">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;iso-8859-1&quot;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">),</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;quoted-printable&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span><span class="o">.</span><span class="n">input_charset</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="c"># Remove the charset</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_charset</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="c"># Try adding a charset when there&#39;s already MIME headers present</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;MIME-Version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;2.0&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/x-weird&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Transfer-Encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;quinted-puntable&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_charset</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;mime-version&#39;</span><span class="p">],</span> <span class="s">&#39;2.0&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/x-weird; charset=&quot;iso-8859-1&quot;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;quinted-puntable&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_charset_from_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_charset_from_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_charset_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_charset</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span><span class="o">.</span><span class="n">input_charset</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;us-ascii&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_payload_with_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_payload_with_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_payload_with_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;This is a string payload&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span><span class="o">.</span><span class="n">input_charset</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_payload_with_8bit_data_and_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_payload_with_8bit_data_and_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_payload_with_8bit_data_and_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xd0\x90\xd0\x91\xd0\x92</span><span class="s">&#39;</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">charset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;base64&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0JDQkdCS</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_payload_with_non_ascii_and_charset_body_encoding_none"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_payload_with_non_ascii_and_charset_body_encoding_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_payload_with_non_ascii_and_charset_body_encoding_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xd0\x90\xd0\x91\xd0\x92</span><span class="s">&#39;</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">charset</span><span class="o">.</span><span class="n">body_encoding</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Disable base64 encoding</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">charset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;8bit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_payload_with_8bit_data_and_charset_body_encoding_none"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_payload_with_8bit_data_and_charset_body_encoding_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_payload_with_8bit_data_and_charset_body_encoding_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xd0\x90\xd0\x91\xd0\x92</span><span class="s">&#39;</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">charset</span><span class="o">.</span><span class="n">body_encoding</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Disable base64 encoding</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">charset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;8bit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_payload_to_list"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_payload_to_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_payload_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_attach_when_payload_is_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_attach_when_payload_is_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_attach_when_payload_is_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;multipart/mixed&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;string payload&#39;</span><span class="p">)</span>
        <span class="n">sub_msg</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">Message</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;[Aa]ttach.*non-multipart&quot;</span><span class="p">,</span>
                               <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">,</span> <span class="n">sub_msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_charsets"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_charsets">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_charsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_08.txt&#39;</span><span class="p">)</span>
        <span class="n">charsets</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_charsets</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charsets</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-2&#39;</span><span class="p">,</span> <span class="s">&#39;koi8-r&#39;</span><span class="p">])</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_09.txt&#39;</span><span class="p">)</span>
        <span class="n">charsets</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_charsets</span><span class="p">(</span><span class="s">&#39;dingbat&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charsets</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;dingbat&#39;</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="s">&#39;dingbat&#39;</span><span class="p">,</span>
                      <span class="s">&#39;koi8-r&#39;</span><span class="p">])</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_12.txt&#39;</span><span class="p">)</span>
        <span class="n">charsets</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_charsets</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charsets</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;iso-8859-2&#39;</span><span class="p">,</span>
                      <span class="s">&#39;iso-8859-3&#39;</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;koi8-r&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_04.txt&#39;</span><span class="p">)</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()]</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;msg.txt&#39;</span><span class="p">,</span> <span class="s">&#39;msg.txt&#39;</span><span class="p">])</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_07.txt&#39;</span><span class="p">)</span>
        <span class="n">subpart</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span> <span class="s">&#39;dingusfish.gif&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_filename_with_name_parameter"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_filename_with_name_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_filename_with_name_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_44.txt&#39;</span><span class="p">)</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()]</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;msg.txt&#39;</span><span class="p">,</span> <span class="s">&#39;msg.txt&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_07.txt&#39;</span><span class="p">)</span>
        <span class="c"># No quotes!</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_boundary</span><span class="p">(),</span> <span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># This one has no existing boundary parameter, but the Content-Type:</span>
        <span class="c"># header appears fifth.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s">&#39;content-type&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;text/plain; charset=&quot;us-ascii&quot;; boundary=&quot;BOUNDARY&quot;&#39;</span><span class="p">)</span>
        <span class="c"># This one has a Content-Type: header, with a boundary, stuck in the</span>
        <span class="c"># middle of its headers.  Make sure the order is preserved; it should</span>
        <span class="c"># be fifth.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_04.txt&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s">&#39;content-type&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;multipart/mixed; boundary=&quot;BOUNDARY&quot;&#39;</span><span class="p">)</span>
        <span class="c"># And this one has no Content-Type: header at all.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_03.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HeaderParseError</span><span class="p">,</span>
                          <span class="n">msg</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">,</span> <span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_make_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_make_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">(</span><span class="s">&#39;form-data&#39;</span><span class="p">)</span>
        <span class="c"># Note that when the boundary gets created is an implementation</span>
        <span class="c"># detail and might change.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;multipart/form-data&#39;</span><span class="p">)</span>
        <span class="c"># Trigger creation of boundary</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="mi">33</span><span class="p">],</span>
                        <span class="s">&#39;multipart/form-data; boundary=&quot;==&#39;</span><span class="p">)</span>
        <span class="c"># XXX: there ought to be tests of the uniqueness of the boundary, too.</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_message_rfc822_only"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_message_rfc822_only">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_rfc822_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 7970: message/rfc822 not in multipart parsed by</span>
        <span class="c"># HeaderParser caused an exception when flattened.</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_46.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msgdata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">HeaderParser</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parsestr</span><span class="p">(</span><span class="n">msgdata</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">msgdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_byte_message_rfc822_only"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_byte_message_rfc822_only">[docs]</a>    <span class="k">def</span> <span class="nf">test_byte_message_rfc822_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Make sure new bytes header parser also passes this.</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_46.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msgdata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">BytesHeaderParser</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parsebytes</span><span class="p">(</span><span class="n">msgdata</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">msgdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_decoded_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_decoded_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_decoded_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_10.txt&#39;</span><span class="p">)</span>
        <span class="c"># The outer message is a multipart</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="c"># Subpart 1 is 7bit encoded</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
           <span class="n">b</span><span class="s">&#39;This is a 7bit encoded message.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Subpart 2 is quopri</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
           <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa1</span><span class="s">This is a Quoted Printable encoded message!</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Subpart 3 is base64</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
           <span class="n">b</span><span class="s">&#39;This is a Base64 encoded message.&#39;</span><span class="p">)</span>
        <span class="c"># Subpart 4 is base64 with a trailing newline, which</span>
        <span class="c"># used to be stripped (issue 7143).</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
           <span class="n">b</span><span class="s">&#39;This is a Base64 encoded message.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Subpart 5 has no Content-Transfer-Encoding: header.</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
           <span class="n">b</span><span class="s">&#39;This has no Content-Transfer-Encoding: header.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_decoded_uu_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_decoded_uu_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_decoded_uu_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;begin 666 -</span><span class="se">\n</span><span class="s">+:&amp;5L;&amp;</span><span class="se">\\</span><span class="s">@=V]R;&amp;0 </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">end</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cte</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;x-uuencode&#39;</span><span class="p">,</span> <span class="s">&#39;uuencode&#39;</span><span class="p">,</span> <span class="s">&#39;uue&#39;</span><span class="p">,</span> <span class="s">&#39;x-uue&#39;</span><span class="p">):</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cte</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="c"># Now try some bogus data</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_payload_n_raises_on_non_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_payload_n_raises_on_non_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_payload_n_raises_on_non_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_decoded_generator"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_decoded_generator">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoded_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_07.txt&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_17.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">DecodedGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test__contains__"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test__contains__">[docs]</a>    <span class="k">def</span> <span class="nf">test__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Me&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;You&#39;</span>
        <span class="c"># Check for case insensitivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;from&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;FROM&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;to&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;To&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;TO&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_as_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_as_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="n">fullrepr</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">unixfrom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fullrepr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;From &#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">NL</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_as_string_policy"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_as_string_policy">[docs]</a>    <span class="k">def</span> <span class="nf">test_as_string_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">newpolicy</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fullrepr</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">newpolicy</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="n">newpolicy</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fullrepr</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_as_bytes"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_as_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_as_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="n">fullrepr</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_bytes</span><span class="p">(</span><span class="n">unixfrom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fullrepr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;From &#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_as_bytes_policy"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_as_bytes_policy">[docs]</a>    <span class="k">def</span> <span class="nf">test_as_bytes_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">newpolicy</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fullrepr</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_bytes</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">newpolicy</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">policy</span><span class="o">=</span><span class="n">newpolicy</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fullrepr</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.bad_params</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_bad_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_bad_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;Content-Type: blarg; baz; boo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_missing_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_missing_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;From: foo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_bogus_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_bogus_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_bogus_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
        <span class="s">&quot;Content-Disposition: blarg; filename</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_missing_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_missing_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;From: foo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_boundary</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_params"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_params">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&#39;X-Header: foo=one; bar=two; baz=three</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">)])</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&#39;X-Header: foo; bar=one; baz=two</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&#39;X-Header: foo; bar=&quot;one&quot;; baz=two</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">)])</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.spaces_around_param_equals</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_get_param_liberal"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_param_liberal">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_param_liberal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Content-Type: Multipart/mixed; boundary = &quot;CPIMSSMTPC06p5f3tG&quot;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;boundary&#39;</span><span class="p">),</span> <span class="s">&#39;CPIMSSMTPC06p5f3tG&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&quot;X-Header: foo=one; bar=two; baz=three</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;quuz&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;quuz&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&#39;X-Header: foo; bar=&quot;one&quot;; baz=two</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="c"># XXX: We are not RFC-2045 compliant!  We cannot parse:</span>
        <span class="c"># msg[&quot;Content-Type&quot;] = &#39;text/plain; weird=&quot;hey; dolly? [you] @ &lt;\\&quot;home\\&quot;&gt;?&quot;&#39;</span>
        <span class="c"># msg.get_param(&quot;weird&quot;)</span>
        <span class="c"># yet.</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.spaces_around_semis</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_get_param_funky_continuation_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_param_funky_continuation_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_param_funky_continuation_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_22.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">),</span> <span class="s">&#39;wibble.JPG&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.semis_inside_quotes</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_get_param_with_semis_in_quotes"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_param_with_semis_in_quotes">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_param_with_semis_in_quotes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&#39;Content-Type: image/pjpeg; name=&quot;Jim&amp;amp;&amp;amp;Jill&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">),</span> <span class="s">&#39;Jim&amp;amp;&amp;amp;Jill&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">unquote</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                         <span class="s">&#39;&quot;Jim&amp;amp;&amp;amp;Jill&quot;&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.quotes_inside_rfc2231_value</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_get_param_with_quotes"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_param_with_quotes">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_param_with_quotes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&#39;Content-Type: foo; bar*0=&quot;baz</span><span class="se">\\</span><span class="s">&quot;foobar&quot;; bar*1=&quot;</span><span class="se">\\</span><span class="s">&quot;baz&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">),</span> <span class="s">&#39;baz&quot;foobar&quot;baz&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span>
            <span class="s">&quot;Content-Type: foo; bar*0=</span><span class="se">\&quot;</span><span class="s">baz</span><span class="se">\\\&quot;</span><span class="s">foobar</span><span class="se">\&quot;</span><span class="s">; bar*1=</span><span class="se">\&quot;\\\&quot;</span><span class="s">baz</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">),</span> <span class="s">&#39;baz&quot;foobar&quot;baz&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_field_containment"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_field_containment">[docs]</a>    <span class="k">def</span> <span class="nf">test_field_containment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&#39;Header: exists&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;header&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;Header&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;HEADER&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;headerx&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;iso-2022-jp&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">),</span> <span class="s">&#39;iso-2022-jp&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;importance&#39;</span><span class="p">,</span> <span class="s">&#39;high value&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;importance&#39;</span><span class="p">),</span> <span class="s">&#39;high value&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;importance&#39;</span><span class="p">,</span> <span class="n">unquote</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="s">&#39;&quot;high value&quot;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;iso-2022-jp&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s">&#39;importance&#39;</span><span class="p">,</span> <span class="s">&#39;high value&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">unquote</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="p">[(</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;iso-2022-jp&quot;&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s">&#39;importance&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;high value&quot;&#39;</span><span class="p">)])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;iso-9999-xx&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;X-Jimmy&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;X-Jimmy&#39;</span><span class="p">),</span> <span class="s">&#39;iso-9999-xx&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_del_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_del_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_del_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_05.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span>
           <span class="p">[(</span><span class="s">&#39;multipart/report&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;report-type&#39;</span><span class="p">,</span> <span class="s">&#39;delivery-status&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;boundary&#39;</span><span class="p">,</span> <span class="s">&#39;D1690A7AC1.996856090/mail.example.com&#39;</span><span class="p">)])</span>
        <span class="n">old_val</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&quot;report-type&quot;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">del_param</span><span class="p">(</span><span class="s">&quot;report-type&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span>
           <span class="p">[(</span><span class="s">&#39;multipart/report&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;boundary&#39;</span><span class="p">,</span> <span class="s">&#39;D1690A7AC1.996856090/mail.example.com&#39;</span><span class="p">)])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&quot;report-type&quot;</span><span class="p">,</span> <span class="n">old_val</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span>
           <span class="p">[(</span><span class="s">&#39;multipart/report&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;boundary&#39;</span><span class="p">,</span> <span class="s">&#39;D1690A7AC1.996856090/mail.example.com&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;report-type&#39;</span><span class="p">,</span> <span class="n">old_val</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_del_param_on_other_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_del_param_on_other_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_del_param_on_other_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&#39;bud.gif&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">del_param</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;content-disposition&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-disposition&#39;</span><span class="p">],</span> <span class="s">&#39;attachment&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_del_param_on_nonexistent_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_del_param_on_nonexistent_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_del_param_on_nonexistent_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="c"># Deleting param on empty msg should not raise exception.</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">del_param</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;content-disposition&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_del_nonexistent_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_del_nonexistent_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_del_nonexistent_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">existing_header</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">del_param</span><span class="p">(</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;Content-Type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">],</span> <span class="n">existing_header</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">set_type</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;us-ascii&quot;&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="s">&#39;text/html&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/html; charset=&quot;us-ascii&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_set_type_on_other_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_set_type_on_other_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_type_on_other_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;X-Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="s">&#39;application/octet-stream&#39;</span><span class="p">,</span> <span class="s">&#39;X-Content-Type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;x-content-type&#39;</span><span class="p">],</span> <span class="s">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_type_missing"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_type_missing">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_type_missing_with_default_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_type_missing_with_default_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_missing_with_default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_default_type</span><span class="p">(</span><span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_type_from_message_implicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_type_from_message_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_from_message_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_30.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span>
                         <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_type_from_message_explicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_type_from_message_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_from_message_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_28.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span>
                         <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_type_from_message_text_plain_implicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_type_from_message_text_plain_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_from_message_text_plain_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_03.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_type_from_message_text_plain_explicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_type_from_message_text_plain_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_from_message_text_plain_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_missing"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_missing">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_missing_with_default_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_missing_with_default_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_missing_with_default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_default_type</span><span class="p">(</span><span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;message&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_from_message_implicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_from_message_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_from_message_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_30.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;message&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_from_message_explicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_from_message_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_from_message_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_28.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;message&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_from_message_text_plain_implicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_from_message_text_plain_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_from_message_text_plain_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_03.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_from_message_text_plain_explicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_from_message_text_plain_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_from_message_text_plain_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_missing"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_missing">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_missing_with_default_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_missing_with_default_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_missing_with_default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_default_type</span><span class="p">(</span><span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;rfc822&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_from_message_implicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_from_message_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_from_message_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_30.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;rfc822&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_from_message_explicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_from_message_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_from_message_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_28.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;rfc822&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_from_message_text_plain_implicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_from_message_text_plain_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_from_message_text_plain_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_03.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_from_message_text_plain_explicit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_from_message_text_plain_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_from_message_text_plain_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_maintype_error"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_maintype_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_maintype_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;no-slash-in-this-string&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_get_content_subtype_error"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_get_content_subtype_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_subtype_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;no-slash-in-this-string&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_replace_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_replace_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_replace_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="s">&#39;One&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Second&#39;</span><span class="p">,</span> <span class="s">&#39;Two&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Third&#39;</span><span class="p">,</span> <span class="s">&#39;Three&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="s">&#39;Second&#39;</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;One&#39;</span><span class="p">,</span> <span class="s">&#39;Two&#39;</span><span class="p">,</span> <span class="s">&#39;Three&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">replace_header</span><span class="p">(</span><span class="s">&#39;Second&#39;</span><span class="p">,</span> <span class="s">&#39;Twenty&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="s">&#39;Second&#39;</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;One&#39;</span><span class="p">,</span> <span class="s">&#39;Twenty&#39;</span><span class="p">,</span> <span class="s">&#39;Three&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="s">&#39;Eleven&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">replace_header</span><span class="p">(</span><span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="s">&#39;One Hundred&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="s">&#39;Second&#39;</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">,</span> <span class="s">&#39;First&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;One Hundred&#39;</span><span class="p">,</span> <span class="s">&#39;Twenty&#39;</span><span class="p">,</span> <span class="s">&#39;Three&#39;</span><span class="p">,</span> <span class="s">&#39;Eleven&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">replace_header</span><span class="p">,</span> <span class="s">&#39;Fourth&#39;</span><span class="p">,</span> <span class="s">&#39;Missing&#39;</span><span class="p">)</span>

    <span class="c"># test_defect_handling:test_invalid_chars_in_base64_payload</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_broken_base64_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_broken_base64_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_base64_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;AwDp0P7//y6LwKEAcPa/6Q=9&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;audio/x-midi&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;base64&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x03\x00\xe9\xd0\xfe\xff\xff</span><span class="s">.</span><span class="se">\x8b\xc0</span><span class="s">&#39;</span>
                          <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa1\x00</span><span class="s">p</span><span class="se">\xf6\xbf\xe9\x0f</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">InvalidBase64CharactersDefect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_broken_unicode_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_broken_unicode_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_unicode_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This test improves coverage but is not a compliance test.</span>
        <span class="c"># The behavior in this situation is currently undefined by the API.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;this is a br</span><span class="se">\xf6</span><span class="s">ken thing to do&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;8bit&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;raw-unicode-escape&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_questionable_bytes_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_questionable_bytes_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_questionable_bytes_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This test improves coverage but is not a compliance test,</span>
        <span class="c"># since it involves poking inside the black box.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;this is a quéstionable thing to do&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain; charset=&quot;utf-8&quot;&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;8bit&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">_payload</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>

    <span class="c"># Issue 1078919</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_ascii_add_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_ascii_add_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_ascii_add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="s">&#39;bud.gif&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;attachment; filename=&quot;bud.gif&quot;&#39;</span><span class="p">,</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_noascii_add_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_noascii_add_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_noascii_add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s">&quot;Fußballer.ppt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&#39;attachment; filename*=utf-8</span><span class="se">\&#39;\&#39;</span><span class="s">Fu%C3</span><span class="si">%9F</span><span class="s">baller.ppt&#39;</span><span class="p">,</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_nonascii_add_header_via_triple"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_nonascii_add_header_via_triple">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonascii_add_header_via_triple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Fußballer.ppt&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&#39;attachment; filename*=iso-8859-1</span><span class="se">\&#39;\&#39;</span><span class="s">Fu%DFballer.ppt&#39;</span><span class="p">,</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_ascii_add_header_with_tspecial"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_ascii_add_header_with_tspecial">[docs]</a>    <span class="k">def</span> <span class="nf">test_ascii_add_header_with_tspecial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s">&quot;windows [filename].ppt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&#39;attachment; filename=&quot;windows [filename].ppt&quot;&#39;</span><span class="p">,</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_nonascii_add_header_with_tspecial"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_nonascii_add_header_with_tspecial">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonascii_add_header_with_tspecial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s">&quot;Fußballer [filename].ppt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;attachment; filename*=utf-8&#39;&#39;Fu%C3</span><span class="si">%9F</span><span class="s">baller</span><span class="si">%20%</span><span class="s">5Bfilename%5D.ppt&quot;</span><span class="p">,</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_binary_quopri_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_binary_quopri_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_quopri_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">charset</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain; charset=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">charset</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;quoted-printable&#39;</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;foo=e6=96=87bar&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xe6\x96\x87</span><span class="s">bar&#39;</span><span class="p">,</span>
                <span class="s">&#39;get_payload returns wrong result with charset </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">charset</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_binary_base64_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_binary_base64_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_base64_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">charset</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain; charset=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">charset</span>
            <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;base64&#39;</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;Zm9v5paHYmFy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xe6\x96\x87</span><span class="s">bar&#39;</span><span class="p">,</span>
                <span class="s">&#39;get_payload returns wrong result with charset </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">charset</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_binary_uuencode_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_binary_uuencode_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_uuencode_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">charset</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;x-uuencode&#39;</span><span class="p">,</span> <span class="s">&#39;uuencode&#39;</span><span class="p">,</span> <span class="s">&#39;uue&#39;</span><span class="p">,</span> <span class="s">&#39;x-uue&#39;</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
                <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain; charset=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">charset</span>
                <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;begin 666 -</span><span class="se">\n</span><span class="s">)9F]OYI:&#39;8F%R</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">end</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                    <span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xe6\x96\x87</span><span class="s">bar&#39;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">((</span><span class="s">&#39;get_payload returns wrong result &#39;</span><span class="p">,</span>
                         <span class="s">&#39;with charset {0} and encoding {1}.&#39;</span><span class="p">))</span><span class="o">.</span>\
                        <span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="n">encoding</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_add_header_with_name_only_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_add_header_with_name_only_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_header_with_name_only_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;inline&#39;</span><span class="p">,</span> <span class="n">foo_bar</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;inline; foo-bar&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_add_header_with_no_value"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_add_header_with_no_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_header_with_no_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;X-Status&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;X-Status&#39;</span><span class="p">])</span>

    <span class="c"># Issue 5871: reject an attempt to embed a header inside a header value</span>
    <span class="c"># (header injection attack).</span></div>
<div class="viewcode-block" id="TestMessageAPI.test_embeded_header_via_Header_rejected"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_embeded_header_via_Header_rejected">[docs]</a>    <span class="k">def</span> <span class="nf">test_embeded_header_via_Header_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;dummy</span><span class="se">\n</span><span class="s">X-Injected-Header: test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HeaderParseError</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_embeded_header_via_string_rejected"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_embeded_header_via_string_rejected">[docs]</a>    <span class="k">def</span> <span class="nf">test_embeded_header_via_string_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;dummy</span><span class="se">\n</span><span class="s">X-Injected-Header: test&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HeaderParseError</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_unicode_header_defaults_to_utf8_encoding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_unicode_header_defaults_to_utf8_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_header_defaults_to_utf8_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14291</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;abc</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;É test&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Transfer-Encoding: 7bit</span>
<span class="s">            Subject: =?utf-8?q?=C3=89_test?=</span>

<span class="s">            abc</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMessageAPI.test_unicode_body_defaults_to_utf8_encoding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMessageAPI.test_unicode_body_defaults_to_utf8_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_body_defaults_to_utf8_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14291</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;É testabc</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/plain; charset=&quot;utf-8&quot;</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Transfer-Encoding: base64</span>

<span class="s">            w4kgdGVzdGFiYwo=</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>


<span class="c"># Test the email.encoders module</span></div></div>
<div class="viewcode-block" id="TestEncoders"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders">[docs]</a><span class="k">class</span> <span class="nc">TestEncoders</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestEncoders.test_EncodersEncode_base64"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders.test_EncodersEncode_base64">[docs]</a>    <span class="k">def</span> <span class="nf">test_EncodersEncode_base64</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;PyBanner048.gif&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">bindata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">mimed</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">mime</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">MIMEImage</span><span class="p">(</span><span class="n">bindata</span><span class="p">)</span>
        <span class="n">base64ed</span> <span class="o">=</span> <span class="n">mimed</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="c"># the transfer-encoded body lines should all be &lt;=76 characters</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">base64ed</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span> <span class="p">]),</span> <span class="mi">76</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestEncoders.test_encode_empty_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders.test_encode_empty_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_empty_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_charset</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;7bit&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestEncoders.test_default_cte"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders.test_default_cte">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_cte</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># 7bit data and the default us-ascii _charset</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;7bit&#39;</span><span class="p">)</span>
        <span class="c"># Similar, but with 8bit data</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello </span><span class="se">\xf8</span><span class="s"> world&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;base64&#39;</span><span class="p">)</span>
        <span class="c"># And now with a different charset</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello </span><span class="se">\xf8</span><span class="s"> world&#39;</span><span class="p">,</span> <span class="n">_charset</span><span class="o">=</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;quoted-printable&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestEncoders.test_encode7or8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders.test_encode7or8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode7or8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Make sure a charset whose input character set is 8bit but</span>
        <span class="c"># whose output character set is 7bit gets a transfer-encoding</span>
        <span class="c"># of 7bit.</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;文</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">_charset</span><span class="o">=</span><span class="s">&#39;euc-jp&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;7bit&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Type: text/plain; charset=&quot;iso-2022-jp&quot;</span>
<span class="s">            Content-Transfer-Encoding: 7bit</span>

<span class="s">            </span><span class="se">\x1b</span><span class="s">$BJ8</span><span class="se">\x1b</span><span class="s">(B</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestEncoders.test_qp_encode_latin1"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders.test_qp_encode_latin1">[docs]</a>    <span class="k">def</span> <span class="nf">test_qp_encode_latin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\xe1\xf6\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="s">&#39;ISO-8859-1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Type: text/text; charset=&quot;iso-8859-1&quot;</span>
<span class="s">            Content-Transfer-Encoding: quoted-printable</span>

<span class="s">            =E1=F6</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestEncoders.test_qp_encode_non_latin1"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestEncoders.test_qp_encode_non_latin1">[docs]</a>    <span class="k">def</span> <span class="nf">test_qp_encode_non_latin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 16948</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u017c\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="s">&#39;ISO-8859-2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Type: text/text; charset=&quot;iso-8859-2&quot;</span>
<span class="s">            Content-Transfer-Encoding: quoted-printable</span>

<span class="s">            =BF</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>


<span class="c"># Test long header wrapping</span></div></div>
<div class="viewcode-block" id="TestLongHeaders"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders">[docs]</a><span class="k">class</span> <span class="nc">TestLongHeaders</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

    <span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="TestLongHeaders.test_split_long_continuation"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_split_long_continuation">[docs]</a>    <span class="k">def</span> <span class="nf">test_split_long_continuation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Subject: bug demonstration</span>
<span class="se">\t</span><span class="s">12345678911234567892123456789312345678941234567895123456789612345678971234567898112345678911234567892123456789112345678911234567892123456789</span>
<span class="se">\t</span><span class="s">more text</span>

<span class="s">test</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Subject: bug demonstration</span>
<span class="se">\t</span><span class="s">12345678911234567892123456789312345678941234567895123456789612345678971234567898112345678911234567892123456789112345678911234567892123456789</span>
<span class="se">\t</span><span class="s">more text</span>

<span class="s">test</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_another_long_almost_unsplittable_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_another_long_almost_unsplittable_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_another_long_almost_unsplittable_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">hstr</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">bug demonstration</span>
<span class="se">\t</span><span class="s">12345678911234567892123456789312345678941234567895123456789612345678971234567898112345678911234567892123456789112345678911234567892123456789</span>
<span class="se">\t</span><span class="s">more text&quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">,</span> <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">bug demonstration</span>
<span class="se">\t</span><span class="s">12345678911234567892123456789312345678941234567895123456789612345678971234567898112345678911234567892123456789112345678911234567892123456789</span>
<span class="se">\t</span><span class="s">more text&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">bug demonstration</span>
<span class="s"> 12345678911234567892123456789312345678941234567895123456789612345678971234567898112345678911234567892123456789112345678911234567892123456789</span>
<span class="s"> more text&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_nonstring"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_nonstring">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_nonstring</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&quot;iso-8859-1&quot;</span><span class="p">)</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&quot;iso-8859-2&quot;</span><span class="p">)</span>
        <span class="n">utf8</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">g_head</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;Die Mieter treten hier ein werden mit einem Foerderband &#39;</span>
                  <span class="n">b</span><span class="s">&#39;komfortabel den Korridor entlang, an s</span><span class="se">\xfc</span><span class="s">dl</span><span class="se">\xfc</span><span class="s">ndischen &#39;</span>
                  <span class="n">b</span><span class="s">&#39;Wandgem</span><span class="se">\xe4</span><span class="s">lden vorbei, gegen die rotierenden Klingen &#39;</span>
                  <span class="n">b</span><span class="s">&#39;bef</span><span class="se">\xf6</span><span class="s">rdert. &#39;</span><span class="p">)</span>
        <span class="n">cz_head</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;Finan</span><span class="se">\xe8</span><span class="s">ni metropole se hroutily pod tlakem jejich &#39;</span>
                   <span class="n">b</span><span class="s">&#39;d</span><span class="se">\xf9</span><span class="s">vtipu.. &#39;</span><span class="p">)</span>
        <span class="n">utf8_head</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\u6b63\u78ba\u306b\u8a00\u3046\u3068\u7ffb\u8a33\u306f</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4e00</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u90e8\u306f\u30c9\u30a4\u30c4\u8a9e\u3067\u3059\u304c</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3001\u3042\u3068\u306f\u3067\u305f\u3089\u3081\u3067</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3059\u3002\u5b9f\u969b\u306b\u306f\u300c</span><span class="s">Wenn ist das &#39;</span>
                     <span class="s">&#39;Nunstuck git und Slotermeyer? Ja! Beiherhund das Oder &#39;</span>
                     <span class="s">&#39;die Flipperwaldt gersput.</span><span class="se">\u300d\u3068\u8a00\u3063\u3066</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3044\u307e\u3059\u3002</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">g_head</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cz_head</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utf8_head</span><span class="p">,</span> <span class="n">utf8</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Subject: =?iso-8859-1?q?Die_Mieter_treten_hier_ein_werden_mit_einem_Foerderb?=</span>
<span class="s"> =?iso-8859-1?q?and_komfortabel_den_Korridor_entlang=2C_an_s=FCdl=FCndischen?=</span>
<span class="s"> =?iso-8859-1?q?_Wandgem=E4lden_vorbei=2C_gegen_die_rotierenden_Klingen_bef?=</span>
<span class="s"> =?iso-8859-1?q?=F6rdert=2E_?= =?iso-8859-2?q?Finan=E8ni_metropole_se_hrouti?=</span>
<span class="s"> =?iso-8859-2?q?ly_pod_tlakem_jejich_d=F9vtipu=2E=2E_?= =?utf-8?b?5q2j56K6?=</span>
<span class="s"> =?utf-8?b?44Gr6KiA44GG44Go57+76Kiz44Gv44GV44KM44Gm44GE44G+44Gb44KT44CC5LiA?=</span>
<span class="s"> =?utf-8?b?6YOo44Gv44OJ44Kk44OE6Kqe44Gn44GZ44GM44CB44GC44Go44Gv44Gn44Gf44KJ?=</span>
<span class="s"> =?utf-8?b?44KB44Gn44GZ44CC5a6f6Zqb44Gr44Gv44CMV2VubiBpc3QgZGFzIE51bnN0dWNr?=</span>
<span class="s"> =?utf-8?b?IGdpdCB1bmQgU2xvdGVybWV5ZXI/IEphISBCZWloZXJodW5kIGRhcyBPZGVyIGRp?=</span>
<span class="s"> =?utf-8?b?ZSBGbGlwcGVyd2FsZHQgZ2Vyc3B1dC7jgI3jgajoqIDjgaPjgabjgYTjgb7jgZk=?=</span>
<span class="s"> =?utf-8?b?44CC?=</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-8859-1?q?Die_Mieter_treten_hier_ein_werden_mit_einem_Foerde?=</span>
<span class="s"> =?iso-8859-1?q?rband_komfortabel_den_Korridor_entlang=2C_an_s=FCdl=FCndis?=</span>
<span class="s"> =?iso-8859-1?q?chen_Wandgem=E4lden_vorbei=2C_gegen_die_rotierenden_Klinge?=</span>
<span class="s"> =?iso-8859-1?q?n_bef=F6rdert=2E_?= =?iso-8859-2?q?Finan=E8ni_metropole_se?=</span>
<span class="s"> =?iso-8859-2?q?_hroutily_pod_tlakem_jejich_d=F9vtipu=2E=2E_?=</span>
<span class="s"> =?utf-8?b?5q2j56K644Gr6KiA44GG44Go57+76Kiz44Gv44GV44KM44Gm44GE44G+44Gb?=</span>
<span class="s"> =?utf-8?b?44KT44CC5LiA6YOo44Gv44OJ44Kk44OE6Kqe44Gn44GZ44GM44CB44GC44Go?=</span>
<span class="s"> =?utf-8?b?44Gv44Gn44Gf44KJ44KB44Gn44GZ44CC5a6f6Zqb44Gr44Gv44CMV2VubiBp?=</span>
<span class="s"> =?utf-8?b?c3QgZGFzIE51bnN0dWNrIGdpdCB1bmQgU2xvdGVybWV5ZXI/IEphISBCZWlo?=</span>
<span class="s"> =?utf-8?b?ZXJodW5kIGRhcyBPZGVyIGRpZSBGbGlwcGVyd2FsZHQgZ2Vyc3B1dC7jgI0=?=</span>
<span class="s"> =?utf-8?b?44Go6KiA44Gj44Gm44GE44G+44GZ44CC?=&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_header_encode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_header_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;wasnipoop; giraffes=&quot;very-long-necked-animals&quot;; &#39;</span>
                   <span class="s">&#39;spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;</span><span class="p">,</span>
                   <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;X-Foobar-Spoink-Defrobnit&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">wasnipoop; giraffes=&quot;very-long-necked-animals&quot;;</span>
<span class="s"> spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_header_encode_with_tab_continuation_is_just_a_hint"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_header_encode_with_tab_continuation_is_just_a_hint">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header_encode_with_tab_continuation_is_just_a_hint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;wasnipoop; giraffes=&quot;very-long-necked-animals&quot;; &#39;</span>
                   <span class="s">&#39;spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;</span><span class="p">,</span>
                   <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;X-Foobar-Spoink-Defrobnit&#39;</span><span class="p">,</span>
                   <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">wasnipoop; giraffes=&quot;very-long-necked-animals&quot;;</span>
<span class="s"> spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_header_encode_with_tab_continuation"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_header_encode_with_tab_continuation">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header_encode_with_tab_continuation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;wasnipoop; giraffes=&quot;very-long-necked-animals&quot;;</span><span class="se">\t</span><span class="s">&#39;</span>
                   <span class="s">&#39;spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;</span><span class="p">,</span>
                   <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;X-Foobar-Spoink-Defrobnit&#39;</span><span class="p">,</span>
                   <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">wasnipoop; giraffes=&quot;very-long-necked-animals&quot;;</span>
<span class="se">\t</span><span class="s">spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_header_encode_with_different_output_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_header_encode_with_different_output_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode_with_different_output_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;文&#39;</span><span class="p">,</span> <span class="s">&#39;euc-jp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;=?iso-2022-jp?b?GyRCSjgbKEI=?=&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_header_encode_with_different_output_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_header_encode_with_different_output_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header_encode_with_different_output_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;test-ja </span><span class="se">\xa4\xd8\xc5\xea\xb9\xc6\xa4\xb5\xa4\xec\xa4</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xbf\xa5\xe1\xa1\xbc\xa5\xeb\xa4\xcf\xbb\xca\xb2\xf1\xbc\xd4</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa4\xce\xbe\xb5\xc7\xa7\xa4\xf2\xc2\xd4\xa4\xc3\xa4\xc6\xa4</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa4\xa4\xde\xa4\xb9</span><span class="s">&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;euc-jp&#39;</span><span class="p">),</span> <span class="s">&#39;euc-jp&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-2022-jp?b?dGVzdC1qYSAbJEIkWEVqOUYkNSRsJD8lYSE8JWskTztKMnE8VCROPjUbKEI=?=</span>
<span class="s"> =?iso-2022-jp?b?GyRCRyckckJUJEMkRiQkJF4kORsoQg==?=&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_header_splitter"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_header_splitter">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_splitter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># It&#39;d be great if we could use add_header() here, but that doesn&#39;t</span>
        <span class="c"># guarantee an order of the parameters.</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;X-Foobar-Spoink-Defrobnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;wasnipoop; giraffes=&quot;very-long-necked-animals&quot;; &#39;</span>
            <span class="s">&#39;spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>
<span class="s">X-Foobar-Spoink-Defrobnit: wasnipoop; giraffes=&quot;very-long-necked-animals&quot;;</span>
<span class="s"> spooge=&quot;yummy&quot;; hippos=&quot;gargantuan&quot;; marshmallows=&quot;gooey&quot;</span>

<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_no_semis_header_splitter"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_no_semis_header_splitter">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_semis_header_splitter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;test@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;References&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPACE</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;&lt;</span><span class="si">%d</span><span class="s">@dom.ain&gt;&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;Test&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: test@dom.ain</span>
<span class="s">References: &lt;0@dom.ain&gt; &lt;1@dom.ain&gt; &lt;2@dom.ain&gt; &lt;3@dom.ain&gt; &lt;4@dom.ain&gt;</span>
<span class="s"> &lt;5@dom.ain&gt; &lt;6@dom.ain&gt; &lt;7@dom.ain&gt; &lt;8@dom.ain&gt; &lt;9@dom.ain&gt;</span>

<span class="s">Test&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_last_split_chunk_does_not_fit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_last_split_chunk_does_not_fit">[docs]</a>    <span class="k">def</span> <span class="nf">test_last_split_chunk_does_not_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;Subject: the first part of this is short, but_the_second&#39;</span>
            <span class="s">&#39;_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line&#39;</span>
            <span class="s">&#39;_all_by_itself&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Subject: the first part of this is short,</span>
<span class="s"> but_the_second_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_splittable_leading_char_followed_by_overlong_unsplitable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_splittable_leading_char_followed_by_overlong_unsplitable">[docs]</a>    <span class="k">def</span> <span class="nf">test_splittable_leading_char_followed_by_overlong_unsplitable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;, but_the_second&#39;</span>
            <span class="s">&#39;_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line&#39;</span>
            <span class="s">&#39;_all_by_itself&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">,</span>
<span class="s"> but_the_second_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_multiple_splittable_leading_char_followed_by_overlong_unsplitable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_multiple_splittable_leading_char_followed_by_overlong_unsplitable">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_splittable_leading_char_followed_by_overlong_unsplitable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;, , but_the_second&#39;</span>
            <span class="s">&#39;_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line&#39;</span>
            <span class="s">&#39;_all_by_itself&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">, ,</span>
<span class="s"> but_the_second_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_trailing_splitable_on_overlong_unsplitable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_trailing_splitable_on_overlong_unsplitable">[docs]</a>    <span class="k">def</span> <span class="nf">test_trailing_splitable_on_overlong_unsplitable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;this_part_does_not_fit_within_maxlinelen_and_thus_should_&#39;</span>
            <span class="s">&#39;be_on_a_line_all_by_itself;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;this_part_does_not_fit_within_maxlinelen_and_thus_should_&quot;</span>
            <span class="s">&quot;be_on_a_line_all_by_itself;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_trailing_splitable_on_overlong_unsplitable_with_leading_splitable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_trailing_splitable_on_overlong_unsplitable_with_leading_splitable">[docs]</a>    <span class="k">def</span> <span class="nf">test_trailing_splitable_on_overlong_unsplitable_with_leading_splitable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;; &#39;</span>
            <span class="s">&#39;this_part_does_not_fit_within_maxlinelen_and_thus_should_&#39;</span>
            <span class="s">&#39;be_on_a_line_all_by_itself; &#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">;</span>
<span class="s"> this_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself; &quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_header_with_multiple_sequential_split_chars"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_header_with_multiple_sequential_split_chars">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header_with_multiple_sequential_split_chars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;This is a long line that has two whitespaces  in a row.  &#39;</span>
            <span class="s">&#39;This used to cause truncation of the header when folded&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">This is a long line that has two whitespaces  in a row.  This used to cause</span>
<span class="s"> truncation of the header when folded&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_splitter_split_on_punctuation_only_if_fws_with_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_splitter_split_on_punctuation_only_if_fws_with_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_splitter_split_on_punctuation_only_if_fws_with_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;thisverylongheaderhas;semicolons;and,commas,but&#39;</span>
            <span class="s">&#39;they;arenotlegal;fold,points&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;thisverylongheaderhas;semicolons;and,commas,butthey;&quot;</span>
                        <span class="s">&quot;arenotlegal;fold,points&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_leading_splittable_in_the_middle_just_before_overlong_last_part"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_leading_splittable_in_the_middle_just_before_overlong_last_part">[docs]</a>    <span class="k">def</span> <span class="nf">test_leading_splittable_in_the_middle_just_before_overlong_last_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;this is a  test where we need to have more than one line &#39;</span>
            <span class="s">&#39;before; our final line that is just too big to fit;; &#39;</span>
            <span class="s">&#39;this_part_does_not_fit_within_maxlinelen_and_thus_should_&#39;</span>
            <span class="s">&#39;be_on_a_line_all_by_itself;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">this is a  test where we need to have more than one line before;</span>
<span class="s"> our final line that is just too big to fit;;</span>
<span class="s"> this_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself;&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_overlong_last_part_followed_by_split_point"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_overlong_last_part_followed_by_split_point">[docs]</a>    <span class="k">def</span> <span class="nf">test_overlong_last_part_followed_by_split_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;this_part_does_not_fit_within_maxlinelen_and_thus_should_&#39;</span>
            <span class="s">&#39;be_on_a_line_all_by_itself &#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;this_part_does_not_fit_within_maxlinelen_and_thus_&quot;</span>
                        <span class="s">&quot;should_be_on_a_line_all_by_itself &quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_multiline_with_overlong_parts_separated_by_two_split_points"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_multiline_with_overlong_parts_separated_by_two_split_points">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiline_with_overlong_parts_separated_by_two_split_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;this_is_a__test_where_we_need_to_have_more_than_one_line_&#39;</span>
            <span class="s">&#39;before_our_final_line_; ; &#39;</span>
            <span class="s">&#39;this_part_does_not_fit_within_maxlinelen_and_thus_should_&#39;</span>
            <span class="s">&#39;be_on_a_line_all_by_itself; &#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">this_is_a__test_where_we_need_to_have_more_than_one_line_before_our_final_line_;</span>
<span class="s"> ;</span>
<span class="s"> this_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself; &quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_multiline_with_overlong_last_part_followed_by_split_point"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_multiline_with_overlong_last_part_followed_by_split_point">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiline_with_overlong_last_part_followed_by_split_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;this is a test where we need to have more than one line &#39;</span>
            <span class="s">&#39;before our final line; ; &#39;</span>
            <span class="s">&#39;this_part_does_not_fit_within_maxlinelen_and_thus_should_&#39;</span>
            <span class="s">&#39;be_on_a_line_all_by_itself; &#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">this is a test where we need to have more than one line before our final line;</span>
<span class="s"> ;</span>
<span class="s"> this_part_does_not_fit_within_maxlinelen_and_thus_should_be_on_a_line_all_by_itself; &quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_header_with_whitespace_runs"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_header_with_whitespace_runs">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header_with_whitespace_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;test@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;References&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPACE</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;&lt;foo@dom.ain&gt;  &#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;Test&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: test@dom.ain</span>
<span class="s">References: &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;</span>
<span class="s">   &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;</span>
<span class="s">   &lt;foo@dom.ain&gt;   &lt;foo@dom.ain&gt;</span><span class="se">\x20\x20</span><span class="s"></span>

<span class="s">Test&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_run_with_semi_header_splitter"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_run_with_semi_header_splitter">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_run_with_semi_header_splitter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;test@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;References&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPACE</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;&lt;foo@dom.ain&gt;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;; abc&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;Test&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: test@dom.ain</span>
<span class="s">References: &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt;</span>
<span class="s"> &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt; &lt;foo@dom.ain&gt;</span>
<span class="s"> &lt;foo@dom.ain&gt;; abc</span>

<span class="s">Test&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_splitter_split_on_punctuation_only_if_fws"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_splitter_split_on_punctuation_only_if_fws">[docs]</a>    <span class="k">def</span> <span class="nf">test_splitter_split_on_punctuation_only_if_fws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;test@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;References&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;thisverylongheaderhas;semicolons;and,commas,but&#39;</span>
            <span class="s">&#39;they;arenotlegal;fold,points&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;Test&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c"># XXX the space after the header should not be there.</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: test@dom.ain</span>
<span class="s">References:</span><span class="se">\x20</span><span class="s"></span>
<span class="s"> thisverylongheaderhas;semicolons;and,commas,butthey;arenotlegal;fold,points</span>

<span class="s">Test&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_no_split_long_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_no_split_long_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_split_long_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">hstr</span> <span class="o">=</span> <span class="s">&#39;References: &#39;</span> <span class="o">+</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">80</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">)</span>
        <span class="c"># These come on two lines because Headers are really field value</span>
        <span class="c"># classes and don&#39;t really know about their field names.</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">References:</span>
<span class="s"> xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_splitting_multiple_long_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_splitting_multiple_long_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_splitting_multiple_long_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">hstr</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">from babylon.socal-raves.org (localhost [127.0.0.1]); by babylon.socal-raves.org (Postfix) with ESMTP id B570E51B81; for &lt;mailman-admin@babylon.socal-raves.org&gt;; Sat, 2 Feb 2002 17:00:06 -0800 (PST)</span>
<span class="se">\t</span><span class="s">from babylon.socal-raves.org (localhost [127.0.0.1]); by babylon.socal-raves.org (Postfix) with ESMTP id B570E51B81; for &lt;mailman-admin@babylon.socal-raves.org&gt;; Sat, 2 Feb 2002 17:00:06 -0800 (PST)</span>
<span class="se">\t</span><span class="s">from babylon.socal-raves.org (localhost [127.0.0.1]); by babylon.socal-raves.org (Postfix) with ESMTP id B570E51B81; for &lt;mailman-admin@babylon.socal-raves.org&gt;; Sat, 2 Feb 2002 17:00:06 -0800 (PST)</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">,</span> <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">from babylon.socal-raves.org (localhost [127.0.0.1]);</span>
<span class="s"> by babylon.socal-raves.org (Postfix) with ESMTP id B570E51B81;</span>
<span class="s"> for &lt;mailman-admin@babylon.socal-raves.org&gt;;</span>
<span class="s"> Sat, 2 Feb 2002 17:00:06 -0800 (PST)</span>
<span class="se">\t</span><span class="s">from babylon.socal-raves.org (localhost [127.0.0.1]);</span>
<span class="s"> by babylon.socal-raves.org (Postfix) with ESMTP id B570E51B81;</span>
<span class="s"> for &lt;mailman-admin@babylon.socal-raves.org&gt;;</span>
<span class="s"> Sat, 2 Feb 2002 17:00:06 -0800 (PST)</span>
<span class="se">\t</span><span class="s">from babylon.socal-raves.org (localhost [127.0.0.1]);</span>
<span class="s"> by babylon.socal-raves.org (Postfix) with ESMTP id B570E51B81;</span>
<span class="s"> for &lt;mailman-admin@babylon.socal-raves.org&gt;;</span>
<span class="s"> Sat, 2 Feb 2002 17:00:06 -0800 (PST)&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_splitting_first_line_only_is_long"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_splitting_first_line_only_is_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_splitting_first_line_only_is_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">hstr</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">from modemcable093.139-201-24.que.mc.videotron.ca ([24.201.139.93] helo=cthulhu.gerg.ca)</span>
<span class="se">\t</span><span class="s">by kronos.mems-exchange.org with esmtp (Exim 4.05)</span>
<span class="se">\t</span><span class="s">id 17k4h5-00034i-00</span>
<span class="se">\t</span><span class="s">for test@mems-exchange.org; Wed, 28 Aug 2002 11:25:20 -0400&quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">78</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Received&#39;</span><span class="p">,</span>
                   <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">from modemcable093.139-201-24.que.mc.videotron.ca ([24.201.139.93]</span>
<span class="s"> helo=cthulhu.gerg.ca)</span>
<span class="se">\t</span><span class="s">by kronos.mems-exchange.org with esmtp (Exim 4.05)</span>
<span class="se">\t</span><span class="s">id 17k4h5-00034i-00</span>
<span class="se">\t</span><span class="s">for test@mems-exchange.org; Wed, 28 Aug 2002 11:25:20 -0400&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_8bit_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_8bit_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_8bit_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;Britische Regierung gibt&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span>
                    <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;gr</span><span class="se">\xfc</span><span class="s">nes Licht f</span><span class="se">\xfc</span><span class="s">r Offshore-Windkraftprojekte&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-8859-1?q?Britische_Regierung_gibt_gr=FCnes_Licht_f=FCr_Offs?=</span>
<span class="s"> =?iso-8859-1?q?hore-Windkraftprojekte?=&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Subject: =?iso-8859-1?q?Britische_Regierung_gibt_gr=FCnes_Licht_f=FCr_Offs?=</span>
<span class="s"> =?iso-8859-1?q?hore-Windkraftprojekte?=</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Subject: =?iso-8859-1?q?Britische_Regierung_gibt_gr=FCnes_Licht_f=FCr_Offshore-Windkraftprojekte?=</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_8bit_header_no_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_8bit_header_no_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_8bit_header_no_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">header_string</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Britische Regierung gibt gr</span><span class="se">\xfc</span><span class="s">nes Licht &#39;</span>
                         <span class="s">&#39;f</span><span class="se">\xfc</span><span class="s">r Offshore-Windkraftprojekte &#39;</span>
                         <span class="s">&#39;&lt;a-very-long-address@example.com&gt;&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Reply-To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_string</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Reply-To: =?utf-8?q?Britische_Regierung_gibt_gr=C3=BCnes_Licht_f=C3=BCr_Offs?=</span>
<span class="s"> =?utf-8?q?hore-Windkraftprojekte_=3Ca-very-long-address=40example=2Ecom=3E?=</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Reply-To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span>
                                 <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Reply-To&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Reply-To: =?utf-8?q?Britische_Regierung_gibt_gr=C3=BCnes_Licht_f=C3=BCr_Offs?=</span>
<span class="s"> =?utf-8?q?hore-Windkraftprojekte_=3Ca-very-long-address=40example=2Ecom=3E?=</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_to_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_to_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_to_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">to</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&quot;Someone Test #A&quot; &lt;someone@eecs.umich.edu&gt;,&#39;</span>
              <span class="s">&#39;&lt;someone@eecs.umich.edu&gt;, &#39;</span>
              <span class="s">&#39;&quot;Someone Test #B&quot; &lt;someone@umich.edu&gt;, &#39;</span>
              <span class="s">&#39;&quot;Someone Test #C&quot; &lt;someone@eecs.umich.edu&gt;, &#39;</span>
              <span class="s">&#39;&quot;Someone Test #D&quot; &lt;someone@eecs.umich.edu&gt;&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">To: &quot;Someone Test #A&quot; &lt;someone@eecs.umich.edu&gt;,&lt;someone@eecs.umich.edu&gt;,</span>
<span class="s"> &quot;Someone Test #B&quot; &lt;someone@umich.edu&gt;,</span>
<span class="s"> &quot;Someone Test #C&quot; &lt;someone@eecs.umich.edu&gt;,</span>
<span class="s"> &quot;Someone Test #D&quot; &lt;someone@eecs.umich.edu&gt;</span>

<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_line_after_append"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_line_after_append">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_line_after_append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;This is an example of string which has almost the limit of header length.&#39;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Add another line.&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">This is an example of string which has almost the limit of header length.</span>
<span class="s"> Add another line.&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_shorter_line_with_append"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_shorter_line_with_append">[docs]</a>    <span class="k">def</span> <span class="nf">test_shorter_line_with_append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;This is a shorter line.&#39;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Add another sentence. (Surprise?)&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
           <span class="s">&#39;This is a shorter line. Add another sentence. (Surprise?)&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_field_name"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_field_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="s">&#39;X-Very-Very-Very-Long-Header-Name&#39;</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Die Mieter treten hier ein werden mit einem Foerderband &#39;</span>
              <span class="s">&#39;komfortabel den Korridor entlang, an s</span><span class="se">\xfc</span><span class="s">dl</span><span class="se">\xfc</span><span class="s">ndischen &#39;</span>
              <span class="s">&#39;Wandgem</span><span class="se">\xe4</span><span class="s">lden vorbei, gegen die rotierenden Klingen &#39;</span>
              <span class="s">&#39;bef</span><span class="se">\xf6</span><span class="s">rdert. &#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
        <span class="c"># BAW: this seems broken because the first line is too long</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-8859-1?q?Die_Mieter_treten_hier_e?=</span>
<span class="s"> =?iso-8859-1?q?in_werden_mit_einem_Foerderband_komfortabel_den_Korridor_e?=</span>
<span class="s"> =?iso-8859-1?q?ntlang=2C_an_s=FCdl=FCndischen_Wandgem=E4lden_vorbei=2C_ge?=</span>
<span class="s"> =?iso-8859-1?q?gen_die_rotierenden_Klingen_bef=F6rdert=2E_?=&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_received_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_received_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_received_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;from FOO.TLD (vizworld.acl.foo.tld [123.452.678.9]) &#39;</span>
             <span class="s">&#39;by hrothgar.la.mastaler.com (tmda-ofmipd) with ESMTP; &#39;</span>
             <span class="s">&#39;Wed, 05 Mar 2003 18:10:18 -0700&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Received-1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Received-2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="c"># This should be splitting on spaces not semicolons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Received-1: from FOO.TLD (vizworld.acl.foo.tld [123.452.678.9]) by</span>
<span class="s"> hrothgar.la.mastaler.com (tmda-ofmipd) with ESMTP;</span>
<span class="s"> Wed, 05 Mar 2003 18:10:18 -0700</span>
<span class="s">Received-2: from FOO.TLD (vizworld.acl.foo.tld [123.452.678.9]) by</span>
<span class="s"> hrothgar.la.mastaler.com (tmda-ofmipd) with ESMTP;</span>
<span class="s"> Wed, 05 Mar 2003 18:10:18 -0700</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_string_headerinst_eq"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_string_headerinst_eq">[docs]</a>    <span class="k">def</span> <span class="nf">test_string_headerinst_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&lt;15975.17901.207240.414604@sgigritzmann1.mathematik.&#39;</span>
             <span class="s">&#39;tu-muenchen.de&gt; (David Bremner</span><span class="se">\&#39;</span><span class="s">s message of &#39;</span>
             <span class="s">&#39;&quot;Thu, 6 Mar 2003 13:58:21 +0100&quot;)&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Received-1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Received-1&#39;</span><span class="p">,</span>
                                   <span class="n">continuation_ws</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Received-2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="c"># XXX The space after the &#39;:&#39; should not be there.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Received-1:</span><span class="se">\x20</span><span class="s"></span>
<span class="s"> &lt;15975.17901.207240.414604@sgigritzmann1.mathematik.tu-muenchen.de&gt; (David</span>
<span class="s"> Bremner&#39;s message of </span><span class="se">\&quot;</span><span class="s">Thu, 6 Mar 2003 13:58:21 +0100</span><span class="se">\&quot;</span><span class="s">)</span>
<span class="s">Received-2:</span><span class="se">\x20</span><span class="s"></span>
<span class="s"> &lt;15975.17901.207240.414604@sgigritzmann1.mathematik.tu-muenchen.de&gt; (David</span>
<span class="s"> Bremner&#39;s message of </span><span class="se">\&quot;</span><span class="s">Thu, 6 Mar 2003 13:58:21 +0100</span><span class="se">\&quot;</span><span class="s">)</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_unbreakable_lines_with_continuation"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_unbreakable_lines_with_continuation">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_unbreakable_lines_with_continuation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAGFBMVEUAAAAkHiJeRUIcGBi9</span>
<span class="s"> locQDQ4zJykFBAXJfWDjAAACYUlEQVR4nF2TQY/jIAyFc6lydlG5x8Nyp1Y69wj1PN2I5gzp&quot;&quot;&quot;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Face-1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Face-2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Face-2&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Face-3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">t</span>
        <span class="c"># XXX This splitting is all wrong.  It the first value line should be</span>
        <span class="c"># snug against the field name or the space after the header not there.</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Face-1:</span><span class="se">\x20</span><span class="s"></span>
<span class="s"> iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAGFBMVEUAAAAkHiJeRUIcGBi9</span>
<span class="s"> locQDQ4zJykFBAXJfWDjAAACYUlEQVR4nF2TQY/jIAyFc6lydlG5x8Nyp1Y69wj1PN2I5gzp</span>
<span class="s">Face-2:</span><span class="se">\x20</span><span class="s"></span>
<span class="s"> iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAGFBMVEUAAAAkHiJeRUIcGBi9</span>
<span class="s"> locQDQ4zJykFBAXJfWDjAAACYUlEQVR4nF2TQY/jIAyFc6lydlG5x8Nyp1Y69wj1PN2I5gzp</span>
<span class="s">Face-3:</span><span class="se">\x20</span><span class="s"></span>
<span class="s"> iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAGFBMVEUAAAAkHiJeRUIcGBi9</span>
<span class="s"> locQDQ4zJykFBAXJfWDjAAACYUlEQVR4nF2TQY/jIAyFc6lydlG5x8Nyp1Y69wj1PN2I5gzp</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_another_long_multiline_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_another_long_multiline_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_another_long_multiline_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Received: from siimage.com &#39;</span>
             <span class="s">&#39;([172.25.1.3]) by zima.siliconimage.com with &#39;</span>
             <span class="s">&#39;Microsoft SMTPSVC(5.0.2195.4905); &#39;</span>
             <span class="s">&#39;Wed, 16 Oct 2002 07:41:11 -0700&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Received: from siimage.com ([172.25.1.3]) by zima.siliconimage.com with</span>
<span class="s"> Microsoft SMTPSVC(5.0.2195.4905); Wed, 16 Oct 2002 07:41:11 -0700</span>

<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_lines_with_different_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_lines_with_different_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_lines_with_different_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;List-Unsubscribe: &#39;</span>
             <span class="s">&#39;&lt;http://lists.sourceforge.net/lists/listinfo/spamassassin-talk&gt;,&#39;</span>
             <span class="s">&#39;        &lt;mailto:spamassassin-talk-request@lists.sourceforge.net&#39;</span>
             <span class="s">&#39;?subject=unsubscribe&gt;&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;List&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;List&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;List&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">List: List-Unsubscribe:</span>
<span class="s"> &lt;http://lists.sourceforge.net/lists/listinfo/spamassassin-talk&gt;,</span>
<span class="s">        &lt;mailto:spamassassin-talk-request@lists.sourceforge.net?subject=unsubscribe&gt;</span>
<span class="s">List: List-Unsubscribe:</span>
<span class="s"> &lt;http://lists.sourceforge.net/lists/listinfo/spamassassin-talk&gt;,</span>
<span class="s">        &lt;mailto:spamassassin-talk-request@lists.sourceforge.net?subject=unsubscribe&gt;</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLongHeaders.test_long_rfc2047_header_with_embedded_fws"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestLongHeaders.test_long_rfc2047_header_with_embedded_fws">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_rfc2047_header_with_embedded_fws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            We&#39;re going to pretend this header is in a non-ascii character set</span>
<span class="s">            </span><span class="se">\t</span><span class="s">to see if line wrapping with encoded words and embedded</span>
<span class="s">               folding white space works&quot;&quot;&quot;</span><span class="p">),</span>
                   <span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                   <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            =?utf-8?q?We=27re_going_to_pretend_this_header_is_in_a_non-ascii_chara?=</span>
<span class="s">             =?utf-8?q?cter_set?=</span>
<span class="s">             =?utf-8?q?_to_see_if_line_wrapping_with_encoded_words_and_embedded?=</span>
<span class="s">             =?utf-8?q?_folding_white_space_works?=&quot;&quot;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>



<span class="c"># Test mangling of &quot;From &quot; lines in the body of a message</span></div></div>
<div class="viewcode-block" id="TestFromMangling"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFromMangling">[docs]</a><span class="k">class</span> <span class="nc">TestFromMangling</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestFromMangling.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFromMangling.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aaa@bbb.org&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From the desk of A.A.A.:</span>
<span class="s">Blah blah blah</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFromMangling.test_mangled_from"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFromMangling.test_mangled_from">[docs]</a>    <span class="k">def</span> <span class="nf">test_mangled_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mangle_from_</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: aaa@bbb.org</span>

<span class="s">&gt;From the desk of A.A.A.:</span>
<span class="s">Blah blah blah</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFromMangling.test_dont_mangle_from"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFromMangling.test_dont_mangle_from">[docs]</a>    <span class="k">def</span> <span class="nf">test_dont_mangle_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mangle_from_</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: aaa@bbb.org</span>

<span class="s">From the desk of A.A.A.:</span>
<span class="s">Blah blah blah</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFromMangling.test_mangle_from_in_preamble_and_epilog"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFromMangling.test_mangle_from_in_preamble_and_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">test_mangle_from_in_preamble_and_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mangle_from_</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            From: foo@bar.com</span>
<span class="s">            Mime-Version: 1.0</span>
<span class="s">            Content-Type: multipart/mixed; boundary=XXX</span>

<span class="s">            From somewhere unknown</span>

<span class="s">            --XXX</span>
<span class="s">            Content-Type: text/plain</span>

<span class="s">            foo</span>

<span class="s">            --XXX--</span>

<span class="s">            From somewhere unknowable</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                  <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;&gt;From &#39;</span><span class="p">)]),</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFromMangling.test_mangled_from_with_bad_bytes"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFromMangling.test_mangled_from_with_bad_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_mangled_from_with_bad_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/plain; charset=&quot;utf-8&quot;</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Transfer-Encoding: 8bit</span>
<span class="s">            From: aaa@bbb.org</span>

<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">source</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;From R</span><span class="se">\xc3\xb6</span><span class="s">lli</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">mangle_from_</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">source</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;&gt;From R</span><span class="se">\xc3\xb6</span><span class="s">lli</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>


<span class="c"># Test the basic MIMEAudio class</span></div></div>
<div class="viewcode-block" id="TestMIMEAudio"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEAudio">[docs]</a><span class="k">class</span> <span class="nc">TestMIMEAudio</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMIMEAudio.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEAudio.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;audiotest.au&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_audiodata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_au</span> <span class="o">=</span> <span class="n">MIMEAudio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_audiodata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEAudio.test_guess_minor_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEAudio.test_guess_minor_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_guess_minor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;audio/basic&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEAudio.test_encoding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEAudio.test_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">decodebytes</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_audiodata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEAudio.test_checkSetMinor"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEAudio.test_checkSetMinor">[docs]</a>    <span class="k">def</span> <span class="nf">test_checkSetMinor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">au</span> <span class="o">=</span> <span class="n">MIMEAudio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_audiodata</span><span class="p">,</span> <span class="s">&#39;fish&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">au</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;audio/fish&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEAudio.test_add_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEAudio.test_add_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
                            <span class="n">filename</span><span class="o">=</span><span class="s">&#39;audiotest.au&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="p">[</span><span class="s">&#39;content-disposition&#39;</span><span class="p">],</span>
           <span class="s">&#39;attachment; filename=&quot;audiotest.au&quot;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;audiotest.au&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span>
           <span class="s">&#39;audiotest.au&#39;</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">failobj</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                                         <span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>
        <span class="c"># Try some missing stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="n">missing</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_au</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span>
                                         <span class="n">header</span><span class="o">=</span><span class="s">&#39;foobar&#39;</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>



<span class="c"># Test the basic MIMEImage class</span></div></div>
<div class="viewcode-block" id="TestMIMEImage"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEImage">[docs]</a><span class="k">class</span> <span class="nc">TestMIMEImage</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMIMEImage.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEImage.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;PyBanner048.gif&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imgdata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_im</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imgdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEImage.test_guess_minor_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEImage.test_guess_minor_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_guess_minor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;image/gif&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEImage.test_encoding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEImage.test_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">decodebytes</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imgdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEImage.test_checkSetMinor"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEImage.test_checkSetMinor">[docs]</a>    <span class="k">def</span> <span class="nf">test_checkSetMinor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imgdata</span><span class="p">,</span> <span class="s">&#39;fish&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;image/fish&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEImage.test_add_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEImage.test_add_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
                            <span class="n">filename</span><span class="o">=</span><span class="s">&#39;dingusfish.gif&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="p">[</span><span class="s">&#39;content-disposition&#39;</span><span class="p">],</span>
           <span class="s">&#39;attachment; filename=&quot;dingusfish.gif&quot;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;dingusfish.gif&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span>
           <span class="s">&#39;dingusfish.gif&#39;</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">failobj</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                                         <span class="n">header</span><span class="o">=</span><span class="s">&#39;content-disposition&#39;</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>
        <span class="c"># Try some missing stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="n">missing</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span>
                                         <span class="n">header</span><span class="o">=</span><span class="s">&#39;foobar&#39;</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>



<span class="c"># Test the basic MIMEApplication class</span></div></div>
<div class="viewcode-block" id="TestMIMEApplication"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication">[docs]</a><span class="k">class</span> <span class="nc">TestMIMEApplication</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMIMEApplication.test_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication.test_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;application/octet-stream&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;base64&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEApplication.test_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication.test_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">)</span>
        <span class="c"># whitespace in the cte encoded block is RFC-irrelevant.</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s">&#39;+vv8/f7/&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEApplication.test_binary_body_with_encode_7or8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication.test_binary_body_with_encode_7or8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_body_with_encode_7or8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 17171.</span>
        <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">,</span> <span class="n">_encoder</span><span class="o">=</span><span class="n">encoders</span><span class="o">.</span><span class="n">encode_7or8bit</span><span class="p">)</span>
        <span class="c"># Treated as a string, this will be invalid code points.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;</span><span class="se">\uFFFD</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Transfer-Encoding&#39;</span><span class="p">],</span> <span class="s">&#39;8bit&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">wireform</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">wireform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;</span><span class="se">\uFFFD</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="p">[</span><span class="s">&#39;Content-Transfer-Encoding&#39;</span><span class="p">],</span> <span class="s">&#39;8bit&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEApplication.test_binary_body_with_encode_noop"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication.test_binary_body_with_encode_noop">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_body_with_encode_noop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 16564: This does not produce an RFC valid message, since to be</span>
        <span class="c"># valid it should have a CTE of binary.  But the below works in</span>
        <span class="c"># Python2, and is documented as working this way.</span>
        <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">,</span> <span class="n">_encoder</span><span class="o">=</span><span class="n">encoders</span><span class="o">.</span><span class="n">encode_noop</span><span class="p">)</span>
        <span class="c"># Treated as a string, this will be invalid code points.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;</span><span class="se">\uFFFD</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">wireform</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">wireform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;</span><span class="se">\uFFFD</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEApplication.test_binary_body_with_encode_quopri"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication.test_binary_body_with_encode_quopri">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_body_with_encode_quopri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14360.</span>
        <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s"> &#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">,</span> <span class="n">_encoder</span><span class="o">=</span><span class="n">encoders</span><span class="o">.</span><span class="n">encode_quopri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;=FA=FB=FC=FD=FE=FF=20&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Transfer-Encoding&#39;</span><span class="p">],</span> <span class="s">&#39;quoted-printable&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">wireform</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">wireform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;=FA=FB=FC=FD=FE=FF=20&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="p">[</span><span class="s">&#39;Content-Transfer-Encoding&#39;</span><span class="p">],</span> <span class="s">&#39;quoted-printable&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEApplication.test_binary_body_with_encode_base64"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEApplication.test_binary_body_with_encode_base64">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_body_with_encode_base64</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">,</span> <span class="n">_encoder</span><span class="o">=</span><span class="n">encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;+vv8/f7/</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">wireform</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">wireform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;+vv8/f7/</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">bytesdata</span><span class="p">)</span>


<span class="c"># Test the basic MIMEText class</span></div></div>
<div class="viewcode-block" id="TestMIMEText"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText">[docs]</a><span class="k">class</span> <span class="nc">TestMIMEText</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMIMEText.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello there&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEText.test_types"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_types">[docs]</a>    <span class="k">def</span> <span class="nf">test_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">),</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="n">missing</span><span class="p">),</span> <span class="n">missing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;foobar&#39;</span><span class="p">),</span>
                      <span class="n">missing</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEText.test_payload"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_payload">[docs]</a>    <span class="k">def</span> <span class="nf">test_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;hello there&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMIMEText.test_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello there&#39;</span><span class="p">,</span> <span class="n">_charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span><span class="o">.</span><span class="n">input_charset</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;us-ascii&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEText.test_7bit_input"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_7bit_input">[docs]</a>    <span class="k">def</span> <span class="nf">test_7bit_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello there&#39;</span><span class="p">,</span> <span class="n">_charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span><span class="o">.</span><span class="n">input_charset</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;us-ascii&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEText.test_7bit_input_no_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_7bit_input_no_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_7bit_input_no_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello there&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">(),</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;us-ascii&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;hello there&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMIMEText.test_utf8_input"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_utf8_input">[docs]</a>    <span class="k">def</span> <span class="nf">test_utf8_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">teststr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\u043a\u0438\u0440\u0438\u043b\u0438\u0446\u0430</span><span class="s">&#39;</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">teststr</span><span class="p">,</span> <span class="n">_charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span><span class="o">.</span><span class="n">output_charset</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=&quot;utf-8&quot;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">teststr</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
</div>
    <span class="nd">@unittest.skip</span><span class="p">(</span><span class="s">&quot;can&#39;t fix because of backward compat in email5, &quot;</span>
        <span class="s">&quot;will fix in email6&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestMIMEText.test_utf8_input_no_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEText.test_utf8_input_no_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_utf8_input_no_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">teststr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\u043a\u0438\u0440\u0438\u043b\u0438\u0446\u0430</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="n">MIMEText</span><span class="p">,</span> <span class="n">teststr</span><span class="p">)</span>



<span class="c"># Test complicated multipart/* messages</span></div></div>
<div class="viewcode-block" id="TestMultipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart">[docs]</a><span class="k">class</span> <span class="nc">TestMultipart</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMultipart.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;PyBanner048.gif&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;dingusfish.gif&#39;</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;content-disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
                         <span class="n">filename</span><span class="o">=</span><span class="s">&#39;dingusfish.gif&#39;</span><span class="p">)</span>
        <span class="n">intro</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Hi there,</span>

<span class="s">This is the dingus fish.</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">container</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Barry &lt;barry@digicool.com&gt;&#39;</span>
        <span class="n">container</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Dingus Lovers &lt;cravindogs@cravindogs.com&gt;&#39;</span>
        <span class="n">container</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Here is your dingus fish&#39;</span>

        <span class="n">now</span> <span class="o">=</span> <span class="mf">987809702.54848599</span>
        <span class="n">timetuple</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timetuple</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tzsecs</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tzsecs</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">altzone</span>
        <span class="k">if</span> <span class="n">tzsecs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
        <span class="n">tzoffset</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%s%04d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="n">tzsecs</span> <span class="o">/</span> <span class="mi">36</span><span class="p">)</span>
        <span class="n">container</span><span class="p">[</span><span class="s">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="s">&#39;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">now</span><span class="p">))</span> <span class="o">+</span> <span class="n">tzoffset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_im</span> <span class="o">=</span> <span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txt</span> <span class="o">=</span> <span class="n">intro</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_hierarchy"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_hierarchy">[docs]</a>    <span class="k">def</span> <span class="nf">test_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># convenience</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">raises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span>
        <span class="c"># tests</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;multipart/mixed&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">raises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_im</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="p">[</span><span class="n">m0</span><span class="p">,</span> <span class="n">m1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">m0</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_empty_multipart_idempotent"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_empty_multipart_idempotent">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_multipart_idempotent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>


<span class="s">--BOUNDARY</span>


<span class="s">--BOUNDARY--</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parsestr</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_no_parts_in_a_multipart_with_none_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_no_parts_in_a_multipart_with_none_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_parts_in_a_multipart_with_none_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>

<span class="s">--BOUNDARY</span>

<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_no_parts_in_a_multipart_with_empty_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_no_parts_in_a_multipart_with_empty_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_parts_in_a_multipart_with_empty_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>


<span class="s">--BOUNDARY</span>

<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_one_part_in_a_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_one_part_in_a_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_one_part_in_a_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">hello world</span>
<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_seq_parts_in_a_multipart_with_empty_preamble"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_seq_parts_in_a_multipart_with_empty_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_parts_in_a_multipart_with_empty_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>


<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">hello world</span>
<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMultipart.test_seq_parts_in_a_multipart_with_none_preamble"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_seq_parts_in_a_multipart_with_none_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_parts_in_a_multipart_with_none_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">hello world</span>
<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMultipart.test_seq_parts_in_a_multipart_with_none_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_seq_parts_in_a_multipart_with_none_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_parts_in_a_multipart_with_none_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">hello world</span>
<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMultipart.test_seq_parts_in_a_multipart_with_empty_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_seq_parts_in_a_multipart_with_empty_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_parts_in_a_multipart_with_empty_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">hello world</span>
<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMultipart.test_seq_parts_in_a_multipart_with_nl_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_seq_parts_in_a_multipart_with_nl_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_seq_parts_in_a_multipart_with_nl_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s">&#39;multipart&#39;</span><span class="p">,</span> <span class="s">&#39;mixed&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A subject&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: A subject</span>
<span class="s">To: aperson@dom.ain</span>
<span class="s">From: bperson@dom.ain</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">hello world</span>
<span class="s">--BOUNDARY--</span>

<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_message_external_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_message_external_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_external_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_36.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;multipart/alternative&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">msg1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/external-body&#39;</span><span class="p">)</span>
            <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">subsubpart</span> <span class="o">=</span> <span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">subsubpart</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_double_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_double_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_double_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># msg_37.txt is a multipart that contains two dash-boundary&#39;s in a</span>
        <span class="c"># row.  Our interpretation of RFC 2046 calls for ignoring the second</span>
        <span class="c"># and subsequent boundaries.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_37.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_nested_inner_contains_outer_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_nested_inner_contains_outer_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested_inner_contains_outer_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="c"># msg_38.txt has an inner part that contains outer boundaries.  My</span>
        <span class="c"># interpretation of RFC 2046 (based on sections 5.1 and 5.1.2) say</span>
        <span class="c"># these are illegal and should be interpreted as unterminated inner</span>
        <span class="c"># parts.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_38.txt&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">iterators</span><span class="o">.</span><span class="n">_structure</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">sfp</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">multipart/mixed</span>
<span class="s">    multipart/mixed</span>
<span class="s">        multipart/alternative</span>
<span class="s">            text/plain</span>
<span class="s">        text/plain</span>
<span class="s">    text/plain</span>
<span class="s">    text/plain</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_nested_with_same_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_nested_with_same_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested_with_same_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="c"># msg 39.txt is similarly evil in that it&#39;s got inner parts that use</span>
        <span class="c"># the same boundary as outer parts.  Again, I believe the way this is</span>
        <span class="c"># parsed is closest to the spirit of RFC 2046</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_39.txt&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">iterators</span><span class="o">.</span><span class="n">_structure</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">sfp</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">multipart/mixed</span>
<span class="s">    multipart/mixed</span>
<span class="s">        multipart/alternative</span>
<span class="s">        application/octet-stream</span>
<span class="s">        application/octet-stream</span>
<span class="s">    text/plain</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_boundary_in_non_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_boundary_in_non_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_boundary_in_non_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_40.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Type: text/html; boundary=&quot;--961284236552522269&quot;</span>

<span class="s">----961284236552522269</span>
<span class="s">Content-Type: text/html;</span>
<span class="s">Content-Transfer-Encoding: 7Bit</span>

<span class="s">&lt;html&gt;&lt;/html&gt;</span>

<span class="s">----961284236552522269--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_boundary_with_leading_space"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_boundary_with_leading_space">[docs]</a>    <span class="k">def</span> <span class="nf">test_boundary_with_leading_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;    XXXX&quot;</span>

<span class="s">--    XXXX</span>
<span class="s">Content-Type: text/plain</span>


<span class="s">--    XXXX</span>
<span class="s">Content-Type: text/plain</span>

<span class="s">--    XXXX--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_boundary</span><span class="p">(),</span> <span class="s">&#39;    XXXX&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMultipart.test_boundary_without_trailing_newline"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMultipart.test_boundary_without_trailing_newline">[docs]</a>    <span class="k">def</span> <span class="nf">test_boundary_without_trailing_newline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parsestr</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;===============0012394164==&quot;</span>
<span class="s">MIME-Version: 1.0</span>

<span class="s">--===============0012394164==</span>
<span class="s">Content-Type: image/file1.jpg</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: base64</span>

<span class="s">YXNkZg==</span>
<span class="s">--===============0012394164==--&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;YXNkZg==&#39;</span><span class="p">)</span>



<span class="c"># Test some badly formatted messages</span></div></div>
<div class="viewcode-block" id="TestNonConformant"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant">[docs]</a><span class="k">class</span> <span class="nc">TestNonConformant</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

<div class="viewcode-block" id="TestNonConformant.test_parse_missing_minor_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_parse_missing_minor_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_missing_minor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_14.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_same_boundary_inner_outer"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_same_boundary_inner_outer">[docs]</a>    <span class="k">def</span> <span class="nf">test_same_boundary_inner_outer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_15.txt&#39;</span><span class="p">)</span>
        <span class="c"># XXX We can probably eventually do better</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="s">&#39;defects&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inner</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">inner</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">StartBoundaryNotFoundDefect</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_multipart_no_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_multipart_no_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_no_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_25.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">NoBoundaryInMultipartDefect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">MultipartInvariantViolationDefect</span><span class="p">)</span>
</div>
    <span class="n">multipart_msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        Date: Wed, 14 Nov 2007 12:56:23 GMT</span>
<span class="s">        From: foo@bar.invalid</span>
<span class="s">        To: foo@bar.invalid</span>
<span class="s">        Subject: Content-Transfer-Encoding: base64 and multipart</span>
<span class="s">        MIME-Version: 1.0</span>
<span class="s">        Content-Type: multipart/mixed;</span>
<span class="s">            boundary=&quot;===============3344438784458119861==&quot;{}</span>

<span class="s">        --===============3344438784458119861==</span>
<span class="s">        Content-Type: text/plain</span>

<span class="s">        Test message</span>

<span class="s">        --===============3344438784458119861==</span>
<span class="s">        Content-Type: application/octet-stream</span>
<span class="s">        Content-Transfer-Encoding: base64</span>

<span class="s">        YWJj</span>

<span class="s">        --===============3344438784458119861==--</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span>
<div class="viewcode-block" id="TestNonConformant.test_multipart_invalid_cte"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_multipart_invalid_cte">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_invalid_cte</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_msg</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multipart_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Content-Transfer-Encoding: base64&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">InvalidMultipartContentTransferEncodingDefect</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_multipart_no_cte_no_defect"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_multipart_no_cte_no_defect">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_no_cte_no_defect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multipart_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_multipart_valid_cte_no_defect"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_multipart_valid_cte_no_defect">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_valid_cte_no_defect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cte</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;7bit&#39;</span><span class="p">,</span> <span class="s">&#39;8bit&#39;</span><span class="p">,</span> <span class="s">&#39;BINary&#39;</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_msg</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multipart_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">Content-Transfer-Encoding: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cte</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTyopeHeader invalid_1 and invalid_2.</span></div>
<div class="viewcode-block" id="TestNonConformant.test_invalid_content_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_invalid_content_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">neq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="c"># RFC 2045, $5.2 says invalid yields text/plain</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text&#39;</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="c"># Clear the old value and try something /really/ invalid</span>
        <span class="k">del</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="c"># Still, make sure that the message is idempotently generated</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">neq</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&#39;Content-Type: foo</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestNonConformant.test_no_start_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_no_start_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_start_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_31.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain</span>

<span class="s">message 1</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain</span>

<span class="s">message 2</span>

<span class="s">--BOUNDARY--</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestNonConformant.test_no_separating_blank_line"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_no_separating_blank_line">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_separating_blank_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_35.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: aperson@dom.ain</span>
<span class="s">To: bperson@dom.ain</span>
<span class="s">Subject: here&#39;s something interesting</span>

<span class="s">counter to RFC 2822, there&#39;s no separating newline here</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_lying_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_lying_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_lying_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_41.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;defects&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">NoBoundaryInMultipartDefect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">MultipartInvariantViolationDefect</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_missing_start_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_missing_start_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_start_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_42.txt&#39;</span><span class="p">)</span>
        <span class="c"># The message structure is:</span>
        <span class="c">#</span>
        <span class="c"># multipart/mixed</span>
        <span class="c">#    text/plain</span>
        <span class="c">#    message/rfc822</span>
        <span class="c">#        multipart/mixed [*]</span>
        <span class="c">#</span>
        <span class="c"># [*] This message is missing its start boundary</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="n">outer</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bad</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">bad</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">StartBoundaryNotFoundDefect</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_first_line_is_continuation_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_first_line_is_continuation_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_first_line_is_continuation_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39; Line 1</span><span class="se">\n</span><span class="s">Subject: test</span><span class="se">\n\n</span><span class="s">body&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;body&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertDefectsEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">,</span>
                                 <span class="p">[</span><span class="n">errors</span><span class="o">.</span><span class="n">FirstHeaderLineIsContinuationDefect</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="s">&#39; Line 1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c"># test_defect_handling</span></div>
<div class="viewcode-block" id="TestNonConformant.test_missing_header_body_separator"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestNonConformant.test_missing_header_body_separator">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_header_body_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Our heuristic if we see a line that doesn&#39;t look like a header (no</span>
        <span class="c"># leading whitespace but no &#39;:&#39;) is to assume that the blank line that</span>
        <span class="c"># separates the header from the body is missing, and to stop parsing</span>
        <span class="c"># headers and start parsing the body.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_msg</span><span class="p">(</span><span class="s">&#39;Subject: test</span><span class="se">\n</span><span class="s">not a header</span><span class="se">\n</span><span class="s">To: abc</span><span class="se">\n\n</span><span class="s">b</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;not a header</span><span class="se">\n</span><span class="s">To: abc</span><span class="se">\n\n</span><span class="s">b</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertDefectsEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">errors</span><span class="o">.</span><span class="n">MissingHeaderBodySeparatorDefect</span><span class="p">])</span>


<span class="c"># Test RFC 2047 header encoding and decoding</span></div></div>
<div class="viewcode-block" id="TestRFC2047"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047">[docs]</a><span class="k">class</span> <span class="nc">TestRFC2047</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_multiline"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_multiline">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_multiline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Re: =?mac-iceland?q?r=8Aksm=9Arg=8Cs?= baz</span>
<span class="s"> foo bar =?mac-iceland?q?r=8Aksm=9Arg=8Cs?=&quot;&quot;&quot;</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dh</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;Re: &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;r</span><span class="se">\x8a</span><span class="s">ksm</span><span class="se">\x9a</span><span class="s">rg</span><span class="se">\x8c</span><span class="s">s&#39;</span><span class="p">,</span> <span class="s">&#39;mac-iceland&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39; baz foo bar &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;r</span><span class="se">\x8a</span><span class="s">ksm</span><span class="se">\x9a</span><span class="s">rg</span><span class="se">\x8c</span><span class="s">s&#39;</span><span class="p">,</span> <span class="s">&#39;mac-iceland&#39;</span><span class="p">)])</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">make_header</span><span class="p">(</span><span class="n">dh</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">header</span><span class="p">),</span>
           <span class="s">&#39;Re: r</span><span class="se">\xe4</span><span class="s">ksm</span><span class="se">\xf6</span><span class="s">rg</span><span class="se">\xe5</span><span class="s">s baz foo bar r</span><span class="se">\xe4</span><span class="s">ksm</span><span class="se">\xf6</span><span class="s">rg</span><span class="se">\xe5</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Re: =?mac-iceland?q?r=8Aksm=9Arg=8Cs?= baz foo bar =?mac-iceland?q?r=8Aksm?=</span>
<span class="s"> =?mac-iceland?q?=9Arg=8Cs?=&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_whitespace_keeper_unicode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_whitespace_keeper_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">test_whitespace_keeper_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;=?ISO-8859-1?Q?Andr=E9?= Pirard &lt;pirard@dom.ain&gt;&#39;</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dh</span><span class="p">,</span> <span class="p">[(</span><span class="n">b</span><span class="s">&#39;Andr</span><span class="se">\xe9</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">b</span><span class="s">&#39; Pirard &lt;pirard@dom.ain&gt;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="n">header</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">dh</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s">&#39;Andr</span><span class="se">\xe9</span><span class="s"> Pirard &lt;pirard@dom.ain&gt;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_whitespace_keeper_unicode_2"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_whitespace_keeper_unicode_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_whitespace_keeper_unicode_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;The =?iso-8859-1?b?cXVpY2sgYnJvd24gZm94?= jumped over the =?iso-8859-1?b?bGF6eSBkb2c=?=&#39;</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dh</span><span class="p">,</span> <span class="p">[(</span><span class="n">b</span><span class="s">&#39;The &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;quick brown fox&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">b</span><span class="s">&#39; jumped over the &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;lazy dog&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)])</span>
        <span class="n">hu</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">dh</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">hu</span><span class="p">,</span> <span class="s">&#39;The quick brown fox jumped over the lazy dog&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_missing_whitespace"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_missing_whitespace">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_missing_whitespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Sm=?ISO-8859-1?B?9g==?=rg=?ISO-8859-1?B?5Q==?=sbord&#39;</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dh</span><span class="p">,</span> <span class="p">[(</span><span class="n">b</span><span class="s">&#39;Sm&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf6</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">b</span><span class="s">&#39;rg&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe5</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">b</span><span class="s">&#39;sbord&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_with_whitespace"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_with_whitespace">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_with_whitespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Sm =?ISO-8859-1?B?9g==?= rg =?ISO-8859-1?B?5Q==?= sbord&#39;</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dh</span><span class="p">,</span> <span class="p">[(</span><span class="n">b</span><span class="s">&#39;Sm &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf6</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">b</span><span class="s">&#39; rg &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe5</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">b</span><span class="s">&#39; sbord&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_B_bad_padding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_B_bad_padding">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_B_bad_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;=?iso-8859-1?B?</span><span class="si">%s</span><span class="s">?=&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>                                <span class="c"># only test complete bytes</span>
            <span class="p">(</span><span class="s">&#39;dm==&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;v&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;dm=&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;v&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;dm&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;v&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;dmk=&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;vi&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;dmk&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;vi&#39;</span><span class="p">)</span>
          <span class="p">]</span>
        <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">dh</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="n">q</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dh</span><span class="p">,</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_Q_invalid_digits"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_Q_invalid_digits">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_Q_invalid_digits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 10004.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;=?iso-8659-1?Q?andr=e9=zz?=&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
                        <span class="p">[(</span><span class="n">b</span><span class="s">&#39;andr</span><span class="se">\xe9</span><span class="s">=zz&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8659-1&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_1"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 1st testcase at end of rfc2047</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_2"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 2nd testcase at end of rfc2047</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?= b)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39; b)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_3"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 3rd testcase at end of rfc2047</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?= =?ISO-8859-1?Q?b?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;ab&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_4"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_4">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 4th testcase at end of rfc2047</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?=  =?ISO-8859-1?Q?b?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;ab&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_5a"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_5a">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_5a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 5th testcase at end of rfc2047 newline is \r\n</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?=</span><span class="se">\r\n</span><span class="s">    =?ISO-8859-1?Q?b?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;ab&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_5b"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_5b">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_5b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 5th testcase at end of rfc2047 newline is \n</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?=</span><span class="se">\n</span><span class="s">    =?ISO-8859-1?Q?b?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;ab&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_6"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_6">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 6th testcase at end of rfc2047</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a_b?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;a b&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_rfc2047_rfc2047_7"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_rfc2047_rfc2047_7">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2047_rfc2047_7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 7th testcase at end of rfc2047</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(=?ISO-8859-1?Q?a?= =?ISO-8859-2?Q?_b?=)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39; b&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-2&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="n">b</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))),</span> <span class="s">&#39;(a b)&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2047.test_multiline_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2047.test_multiline_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiline_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;=?windows-1252?q?=22M=FCller_T=22?=</span><span class="se">\r\n</span><span class="s"> &lt;T.Mueller@xxx.com&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">b</span><span class="s">&#39;&quot;M</span><span class="se">\xfc</span><span class="s">ller T&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;windows-1252&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="n">b</span><span class="s">&#39;&lt;T.Mueller@xxx.com&gt;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
                         <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))),</span>
                         <span class="s">&#39;&quot;Müller T&quot; &lt;T.Mueller@xxx.com&gt;&#39;</span><span class="p">)</span>


<span class="c"># Test the MIMEMessage class</span></div></div>
<div class="viewcode-block" id="TestMIMEMessage"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage">[docs]</a><span class="k">class</span> <span class="nc">TestMIMEMessage</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMIMEMessage.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_11.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_type_error"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_type_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_type_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">MIMEMessage</span><span class="p">,</span> <span class="s">&#39;a plain string&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_valid_argument"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_valid_argument">[docs]</a>    <span class="k">def</span> <span class="nf">test_valid_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="s">&#39;A sub-message&#39;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">subpart</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">subpart</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="p">[</span><span class="s">&#39;subject&#39;</span><span class="p">],</span> <span class="n">subject</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_bad_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_bad_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg1</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;subpart 1&#39;</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg2</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;subpart 2&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">MultipartConversionError</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">attach</span><span class="p">,</span> <span class="n">msg2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_generate"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_generate">[docs]</a>    <span class="k">def</span> <span class="nf">test_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># First craft the message to be encapsulated</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;An enclosed message&#39;</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;Here is the body of the message.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">r</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The enclosing message&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: message/rfc822</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Subject: The enclosing message</span>

<span class="s">Subject: An enclosed message</span>

<span class="s">Here is the body of the message.</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_parse_message_rfc822"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_parse_message_rfc822">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_message_rfc822</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_11.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">submsg</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">submsg</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">submsg</span><span class="p">[</span><span class="s">&#39;subject&#39;</span><span class="p">],</span> <span class="s">&#39;An enclosed message&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">submsg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;Here is the body of the message.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_dsn"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_dsn">[docs]</a>    <span class="k">def</span> <span class="nf">test_dsn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># msg 16 is a Delivery Status Notification, see RFC 1894</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_16.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;multipart/report&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c"># Subpart 1 is a text/plain, human readable section</span>
        <span class="n">subpart</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">This report relates to a message you sent with the following header fields:</span>

<span class="s">  Message-id: &lt;002001c144a6$8752e060$56104586@oxy.edu&gt;</span>
<span class="s">  Date: Sun, 23 Sep 2001 20:10:55 -0700</span>
<span class="s">  From: &quot;Ian T. Henry&quot; &lt;henryi@oxy.edu&gt;</span>
<span class="s">  To: SoCal Raves &lt;scr@socal-raves.org&gt;</span>
<span class="s">  Subject: [scr] yeah for Ians!!</span>

<span class="s">Your message cannot be delivered to the following recipients:</span>

<span class="s">  Recipient address: jangel1@cougar.noc.ucla.edu</span>
<span class="s">  Reason: recipient reached disk quota</span>

<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c"># Subpart 2 contains the machine parsable DSN information.  It</span>
        <span class="c"># consists of two blocks of headers, represented by two nested Message</span>
        <span class="c"># objects.</span>
        <span class="n">subpart</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/delivery-status&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c"># message/delivery-status should treat each block as a bunch of</span>
        <span class="c"># headers, i.e. a bunch of Message objects.</span>
        <span class="n">dsn1</span> <span class="o">=</span> <span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">dsn1</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dsn1</span><span class="p">[</span><span class="s">&#39;original-envelope-id&#39;</span><span class="p">],</span> <span class="s">&#39;0GK500B4HD0888@cougar.noc.ucla.edu&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dsn1</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;dns&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;reporting-mta&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># Try a missing one &lt;wink&gt;</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dsn1</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;nsd&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;reporting-mta&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">dsn2</span> <span class="o">=</span> <span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">dsn2</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dsn2</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">],</span> <span class="s">&#39;failed&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dsn2</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;original-recipient&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;rfc822&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;jangel1@cougar.noc.ucla.edu&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">dsn2</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;rfc822&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;final-recipient&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># Subpart 3 is the original message</span>
        <span class="n">subpart</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">subsubpart</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">subsubpart</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subsubpart</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subsubpart</span><span class="p">[</span><span class="s">&#39;message-id&#39;</span><span class="p">],</span>
           <span class="s">&#39;&lt;002001c144a6$8752e060$56104586@oxy.edu&gt;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_21.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Test&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="s">&#39;MIME message&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="s">&#39;End of MIME message</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;One&#39;</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;Two&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s">&#39;multipart/mixed&#39;</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg2</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">sfp</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_no_nl_preamble"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_no_nl_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_nl_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;aperson@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bperson@dom.ain&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Test&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="s">&#39;MIME message&#39;</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;One&#39;</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;Two&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s">&#39;multipart/mixed&#39;</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: aperson@dom.ain</span>
<span class="s">To: bperson@dom.ain</span>
<span class="s">Subject: Test</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;BOUNDARY&quot;</span>

<span class="s">MIME message</span>
<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">One</span>
<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">Two</span>
<span class="s">--BOUNDARY--</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_default_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_default_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_30.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">container1</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">container2</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">container1a</span> <span class="o">=</span> <span class="n">container1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1a</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1a</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">container2a</span> <span class="o">=</span> <span class="n">container2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2a</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2a</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_default_type_with_explicit_container_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_default_type_with_explicit_container_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_type_with_explicit_container_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_28.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">container1</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">container2</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">container1a</span> <span class="o">=</span> <span class="n">container1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1a</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container1a</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">container2a</span> <span class="o">=</span> <span class="n">container2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2a</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">container2a</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_default_type_non_parsed"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_default_type_non_parsed">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_type_non_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">neq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="c"># Set up container</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">(</span><span class="s">&#39;digest&#39;</span><span class="p">,</span> <span class="s">&#39;BOUNDARY&#39;</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">epilogue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c"># Set up subparts</span>
        <span class="n">subpart1a</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;message 1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">subpart2a</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;message 2</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">subpart1</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">subpart1a</span><span class="p">)</span>
        <span class="n">subpart2</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">subpart2a</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">subpart1</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">subpart2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart1</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart2</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">neq</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/digest; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: message/rfc822</span>
<span class="s">MIME-Version: 1.0</span>

<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">message 1</span>

<span class="s">--BOUNDARY</span>
<span class="s">Content-Type: message/rfc822</span>
<span class="s">MIME-Version: 1.0</span>

<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">message 2</span>

<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">subpart1</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">subpart1</span><span class="p">[</span><span class="s">&#39;mime-version&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">subpart2</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">subpart2</span><span class="p">[</span><span class="s">&#39;mime-version&#39;</span><span class="p">]</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart1</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subpart2</span><span class="o">.</span><span class="n">get_default_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">neq</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/digest; boundary=&quot;BOUNDARY&quot;</span>
<span class="s">MIME-Version: 1.0</span>

<span class="s">--BOUNDARY</span>

<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">message 1</span>

<span class="s">--BOUNDARY</span>

<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>

<span class="s">message 2</span>

<span class="s">--BOUNDARY--</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_mime_attachments_in_constructor"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_mime_attachments_in_constructor">[docs]</a>    <span class="k">def</span> <span class="nf">test_mime_attachments_in_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">text1</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">text2</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">(</span><span class="n">_subparts</span><span class="o">=</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">text1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">text2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMIMEMessage.test_default_multipart_constructor"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMIMEMessage.test_default_multipart_constructor">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_multipart_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>


<span class="c"># A general test of parser-&gt;model-&gt;generator idempotency.  IOW, read a message</span>
<span class="c"># in, parse it into a message object tree, then without touching the tree,</span>
<span class="c"># regenerate the plain text.  The original text and the transformed text</span>
<span class="c"># should be identical.  Note: that we ignore the Unix-From since that may</span>
<span class="c"># contain a changed date.</span></div></div>
<div class="viewcode-block" id="TestIdempotent"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent">[docs]</a><span class="k">class</span> <span class="nc">TestIdempotent</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

    <span class="n">linesep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">_msgobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span><span class="p">,</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_idempotent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">unixfrom</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">unixfrom</span><span class="o">=</span><span class="n">unixfrom</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<div class="viewcode-block" id="TestIdempotent.test_parse_text_message"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_parse_text_message">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_text_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">),</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">preamble</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">epilogue</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_parse_untyped_message"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_parse_untyped_message">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_untyped_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_03.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_simple_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_simple_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_04.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_MIME_digest"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_MIME_digest">[docs]</a>    <span class="k">def</span> <span class="nf">test_MIME_digest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_long_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_long_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_27.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_MIME_digest_with_part_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_MIME_digest_with_part_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_MIME_digest_with_part_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_28.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_mixed_with_image"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_mixed_with_image">[docs]</a>    <span class="k">def</span> <span class="nf">test_mixed_with_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_06.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_multipart_report"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_multipart_report">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_05.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_dsn"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_dsn">[docs]</a>    <span class="k">def</span> <span class="nf">test_dsn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_16.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_preamble_epilogue"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_preamble_epilogue">[docs]</a>    <span class="k">def</span> <span class="nf">test_preamble_epilogue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_21.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_multipart_one_part"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_multipart_one_part">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_one_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_23.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_multipart_no_parts"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_multipart_no_parts">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_no_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_24.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_no_start_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_no_start_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_start_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_31.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_rfc2231_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_rfc2231_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_32.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_more_rfc2231_parameters"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_more_rfc2231_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">test_more_rfc2231_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_33.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_text_plain_in_a_multipart_digest"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_text_plain_in_a_multipart_digest">[docs]</a>    <span class="k">def</span> <span class="nf">test_text_plain_in_a_multipart_digest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_34.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_nested_multipart_mixeds"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_nested_multipart_mixeds">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested_multipart_mixeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_12a.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_message_external_body_idempotent"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_message_external_body_idempotent">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_external_body_idempotent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_36.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_message_delivery_status"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_message_delivery_status">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_delivery_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_43.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">unixfrom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_message_signed_idempotent"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_message_signed_idempotent">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_signed_idempotent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_45.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idempotent</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_content_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_content_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># Get a message object and reset the seek pointer for other tests</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_05.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;multipart/report&#39;</span><span class="p">)</span>
        <span class="c"># Test the Content-Type: parameters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;report-type&#39;</span><span class="p">],</span> <span class="s">&#39;delivery-status&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;boundary&#39;</span><span class="p">],</span> <span class="s">&#39;D1690A7AC1.996856090/mail.example.com&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">preamble</span><span class="p">,</span> <span class="s">&#39;This is a MIME-encapsulated message.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">epilogue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c"># Make sure the subparts are what we expect</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;Yadda yadda yadda&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;Yadda yadda yadda&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
        <span class="n">msg3</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg3</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg3</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">msg3</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">msg4</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg4</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg4</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;Yadda yadda yadda&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIdempotent.test_parser"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIdempotent.test_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_06.txt&#39;</span><span class="p">)</span>
        <span class="c"># Check some of the outer headers</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="c"># Make sure the payload is a list of exactly one sub-Message, and that</span>
        <span class="c"># that submessage has a type of text/plain</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg1</span><span class="p">,</span> <span class="n">Message</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>



<span class="c"># Test various other bits of the package&#39;s functionality</span></div></div>
<div class="viewcode-block" id="TestMiscellaneous"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous">[docs]</a><span class="k">class</span> <span class="nc">TestMiscellaneous</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMiscellaneous.test_message_from_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_message_from_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="c"># Don&#39;t wrap/continue long headers since we&#39;re trying to test</span>
        <span class="c"># idempotency.</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_message_from_file"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_message_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
            <span class="c"># Don&#39;t wrap/continue long headers since we&#39;re trying to test</span>
            <span class="c"># idempotency.</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_message_from_string_with_class"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_message_from_string_with_class">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_from_string_with_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c"># Create a subclass</span>
        <span class="k">class</span> <span class="nc">MyMessage</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="c"># Try something more complicated</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">subpart</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_message_from_file_with_class"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_message_from_file_with_class">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_from_file_with_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Create a subclass</span>
        <span class="k">class</span> <span class="nc">MyMessage</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="c"># Try something more complicated</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">subpart</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_custom_message_does_not_require_arguments"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_custom_message_does_not_require_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">test_custom_message_does_not_require_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MyMessage</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_msg</span><span class="p">(</span><span class="s">&quot;Subject: test</span><span class="se">\n\n</span><span class="s">test&quot;</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">MyMessage</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test__all__"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test__all__">[docs]</a>    <span class="k">def</span> <span class="nf">test__all__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__all__</span><span class="p">),</span> <span class="p">[</span>
            <span class="s">&#39;base64mime&#39;</span><span class="p">,</span> <span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;encoders&#39;</span><span class="p">,</span> <span class="s">&#39;errors&#39;</span><span class="p">,</span> <span class="s">&#39;feedparser&#39;</span><span class="p">,</span>
            <span class="s">&#39;generator&#39;</span><span class="p">,</span> <span class="s">&#39;header&#39;</span><span class="p">,</span> <span class="s">&#39;iterators&#39;</span><span class="p">,</span> <span class="s">&#39;message&#39;</span><span class="p">,</span>
            <span class="s">&#39;message_from_binary_file&#39;</span><span class="p">,</span> <span class="s">&#39;message_from_bytes&#39;</span><span class="p">,</span>
            <span class="s">&#39;message_from_file&#39;</span><span class="p">,</span> <span class="s">&#39;message_from_string&#39;</span><span class="p">,</span> <span class="s">&#39;mime&#39;</span><span class="p">,</span> <span class="s">&#39;parser&#39;</span><span class="p">,</span>
            <span class="s">&#39;quoprimime&#39;</span><span class="p">,</span> <span class="s">&#39;utils&#39;</span><span class="p">,</span>
            <span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_formatdate"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_formatdate">[docs]</a>    <span class="k">def</span> <span class="nf">test_formatdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">now</span><span class="p">))[:</span><span class="mi">6</span><span class="p">],</span>
                         <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">now</span><span class="p">)[:</span><span class="mi">6</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_formatdate_localtime"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_formatdate_localtime">[docs]</a>    <span class="k">def</span> <span class="nf">test_formatdate_localtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="bp">True</span><span class="p">))[:</span><span class="mi">6</span><span class="p">],</span>
            <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">now</span><span class="p">)[:</span><span class="mi">6</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_formatdate_usegmt"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_formatdate_usegmt">[docs]</a>    <span class="k">def</span> <span class="nf">test_formatdate_usegmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
            <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S -0000&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">now</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">usegmt</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S GMT&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">now</span><span class="p">)))</span>

    <span class="c"># parsedate and parsedate_tz will become deprecated interfaces someday</span></div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_returns_None_for_invalid_strings"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_returns_None_for_invalid_strings">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_returns_None_for_invalid_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="s">&#39;A Complete Waste of Time&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;A Complete Waste of Time&#39;</span><span class="p">))</span>
        <span class="c"># Not a part of the spec but, but this has historically worked:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_compact"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_compact">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_compact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The FWS after the comma is optional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="s">&#39;Wed,3 Apr 2002 14:58:26 +0800&#39;</span><span class="p">),</span>
                         <span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="s">&#39;Wed, 3 Apr 2002 14:58:26 +0800&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_no_dayofweek"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_no_dayofweek">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_no_dayofweek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;25 Feb 2003 13:47:26 -0800&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">28800</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_compact_no_dayofweek"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_compact_no_dayofweek">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_compact_no_dayofweek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;5 Feb 2003 13:47:26 -0800&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">28800</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_no_space_before_positive_offset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_no_space_before_positive_offset">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_no_space_before_positive_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;Wed, 3 Apr 2002 14:58:26+0800&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28800</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_no_space_before_negative_offset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_no_space_before_negative_offset">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_no_space_before_negative_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 1155362: we already handled &#39;+&#39; for this case.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;Wed, 3 Apr 2002 14:58:26-0800&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">28800</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_accepts_time_with_dots"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_accepts_time_with_dots">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_accepts_time_with_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;5 Feb 2003 13.47.26 -0800&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">28800</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;5 Feb 2003 13.47 -0800&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">28800</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_acceptable_to_time_functions"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_acceptable_to_time_functions">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_acceptable_to_time_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">timetup</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="s">&#39;5 Feb 2003 13:47:26 -0800&#39;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timetup</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[:</span><span class="mi">6</span><span class="p">],</span> <span class="n">timetup</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">,</span> <span class="n">timetup</span><span class="p">)),</span> <span class="mi">2003</span><span class="p">)</span>
        <span class="n">timetup</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;5 Feb 2003 13:47:26 -0800&#39;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">timetup</span><span class="p">[:</span><span class="mi">9</span><span class="p">]))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[:</span><span class="mi">6</span><span class="p">],</span> <span class="n">timetup</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">,</span> <span class="n">timetup</span><span class="p">[:</span><span class="mi">9</span><span class="p">])),</span> <span class="mi">2003</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_mktime_tz"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_mktime_tz">[docs]</a>    <span class="k">def</span> <span class="nf">test_mktime_tz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">mktime_tz</span><span class="p">((</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">mktime_tz</span><span class="p">((</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1234</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parsedate_y2k"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parsedate_y2k">[docs]</a>    <span class="k">def</span> <span class="nf">test_parsedate_y2k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test for parsing a date with a two-digit year.</span>

<span class="sd">        Parsing a date with a two-digit year should return the correct</span>
<span class="sd">        four-digit year. RFC822 allows two-digit years, but RFC2822 (which</span>
<span class="sd">        obsoletes RFC822) requires four-digit years.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;25 Feb 03 13:47:26 -0800&#39;</span><span class="p">),</span>
                         <span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;25 Feb 2003 13:47:26 -0800&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;25 Feb 71 13:47:26 -0800&#39;</span><span class="p">),</span>
                         <span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="s">&#39;25 Feb 1971 13:47:26 -0800&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parseaddr_empty"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parseaddr_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_parseaddr_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;&lt;&gt;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;&lt;&gt;&#39;</span><span class="p">)),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_noquote_dump"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_noquote_dump">[docs]</a>    <span class="k">def</span> <span class="nf">test_noquote_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s">&#39;A Silly Person&#39;</span><span class="p">,</span> <span class="s">&#39;person@dom.ain&#39;</span><span class="p">)),</span>
            <span class="s">&#39;A Silly Person &lt;person@dom.ain&gt;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_escape_dump"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_escape_dump">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s">&#39;A (Very) Silly Person&#39;</span><span class="p">,</span> <span class="s">&#39;person@dom.ain&#39;</span><span class="p">)),</span>
            <span class="s">r&#39;&quot;A (Very) Silly Person&quot; &lt;person@dom.ain&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">r&#39;&quot;A \(Very\) Silly Person&quot; &lt;person@dom.ain&gt;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;A (Very) Silly Person&#39;</span><span class="p">,</span> <span class="s">&#39;person@dom.ain&#39;</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="s">r&#39;A \(Special\) Person&#39;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="s">&#39;person@dom.ain&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_escape_backslashes"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_escape_backslashes">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_backslashes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s">&#39;Arthur \Backslash\ Foobar&#39;</span><span class="p">,</span> <span class="s">&#39;person@dom.ain&#39;</span><span class="p">)),</span>
            <span class="s">r&#39;&quot;Arthur </span><span class="se">\\</span><span class="s">Backslash</span><span class="se">\\</span><span class="s"> Foobar&quot; &lt;person@dom.ain&gt;&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="s">r&#39;Arthur \Backslash\ Foobar&#39;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="s">&#39;person@dom.ain&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_quotes_unicode_names"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_quotes_unicode_names">[docs]</a>    <span class="k">def</span> <span class="nf">test_quotes_unicode_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 1690608.  email.utils.formataddr() should be rfc2047 aware.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;H</span><span class="se">\u00e4</span><span class="s">ns W</span><span class="se">\u00fc</span><span class="s">rst&quot;</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;person@dom.ain&#39;</span>
        <span class="n">utf8_base64</span> <span class="o">=</span> <span class="s">&quot;=?utf-8?b?SMOkbnMgV8O8cnN0?= &lt;person@dom.ain&gt;&quot;</span>
        <span class="n">latin1_quopri</span> <span class="o">=</span> <span class="s">&quot;=?iso-8859-1?q?H=E4ns_W=FCrst?= &lt;person@dom.ain&gt;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">)),</span> <span class="n">utf8_base64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">),</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">),</span>
            <span class="n">latin1_quopri</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_accepts_any_charset_like_object"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_accepts_any_charset_like_object">[docs]</a>    <span class="k">def</span> <span class="nf">test_accepts_any_charset_like_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 1690608.  email.utils.formataddr() should be rfc2047 aware.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;H</span><span class="se">\u00e4</span><span class="s">ns W</span><span class="se">\u00fc</span><span class="s">rst&quot;</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;person@dom.ain&#39;</span>
        <span class="n">utf8_base64</span> <span class="o">=</span> <span class="s">&quot;=?utf-8?b?SMOkbnMgV8O8cnN0?= &lt;person@dom.ain&gt;&quot;</span>
        <span class="n">foobar</span> <span class="o">=</span> <span class="s">&quot;FOOBAR&quot;</span>
        <span class="k">class</span> <span class="nc">CharsetMock</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">header_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">foobar</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="n">CharsetMock</span><span class="p">()</span>
        <span class="n">mock_expected</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> &lt;</span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">foobar</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">),</span> <span class="n">mock</span><span class="p">),</span> <span class="n">mock_expected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">),</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)),</span>
            <span class="n">utf8_base64</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_invalid_charset_like_object_raises_error"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_invalid_charset_like_object_raises_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_charset_like_object_raises_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 1690608.  email.utils.formataddr() should be rfc2047 aware.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;H</span><span class="se">\u00e4</span><span class="s">ns W</span><span class="se">\u00fc</span><span class="s">rst&quot;</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;person@dom.ain&#39;</span>
        <span class="c"># A object without a header_encode method:</span>
        <span class="n">bad_charset</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">),</span>
            <span class="n">bad_charset</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_unicode_address_raises_error"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_unicode_address_raises_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_address_raises_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 1690608.  email.utils.formataddr() should be rfc2047 aware.</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&#39;pers</span><span class="se">\u00f6</span><span class="s">n@dom.in&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_name_with_dot"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_name_with_dot">[docs]</a>    <span class="k">def</span> <span class="nf">test_name_with_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;John X. Doe &lt;jxd@example.com&gt;&#39;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="s">&#39;&quot;John X. Doe&quot; &lt;jxd@example.com&gt;&#39;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;John X. Doe&#39;</span><span class="p">,</span> <span class="s">&#39;jxd@example.com&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="c"># formataddr() quotes the name if there&#39;s a dot in it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)),</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parseaddr_preserves_quoted_pairs_in_addresses"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parseaddr_preserves_quoted_pairs_in_addresses">[docs]</a>    <span class="k">def</span> <span class="nf">test_parseaddr_preserves_quoted_pairs_in_addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 10005.  Note that in the third test the second pair of</span>
        <span class="c"># backslashes is not actually a quoted pair because it is not inside a</span>
        <span class="c"># comment or quoted string: the address being parsed has a quoted</span>
        <span class="c"># string containing a quoted backslash, followed by &#39;example&#39; and two</span>
        <span class="c"># backslashes, followed by another quoted string containing a space and</span>
        <span class="c"># the word &#39;example&#39;.  parseaddr copies those two backslashes</span>
        <span class="c"># literally.  Per rfc5322 this is not technically correct since a \ may</span>
        <span class="c"># not appear in an address outside of a quoted string.  It is probably</span>
        <span class="c"># a sensible Postel interpretation, though.</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;&quot;&quot;example&quot; example&quot;@example.com&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&quot;example&quot; example&quot;@example.com&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="se">\\</span><span class="s">&quot;example</span><span class="se">\\</span><span class="s">&quot; example&quot;@example.com&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;</span><span class="se">\\</span><span class="s">&quot;example</span><span class="se">\\</span><span class="s">&quot; example&quot;@example.com&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="se">\\\\</span><span class="s">&quot;example</span><span class="se">\\\\</span><span class="s">&quot; example&quot;@example.com&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;</span><span class="se">\\\\</span><span class="s">&quot;example</span><span class="se">\\\\</span><span class="s">&quot; example&quot;@example.com&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_parseaddr_preserves_spaces_in_local_part"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_parseaddr_preserves_spaces_in_local_part">[docs]</a>    <span class="k">def</span> <span class="nf">test_parseaddr_preserves_spaces_in_local_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 9286.  A normal RFC5322 local part should not contain any</span>
        <span class="c"># folding white space, but legacy local parts can (they are a sequence</span>
        <span class="c"># of atoms, not dotatoms).  On the other hand we strip whitespace from</span>
        <span class="c"># before the @ and around dots, on the assumption that the whitespace</span>
        <span class="c"># around the punctuation is a mistake in what would otherwise be</span>
        <span class="c"># an RFC5322 local part.  Leading whitespace is, usual, stripped as well.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&quot;merwok wok@xample.com&quot;</span><span class="p">),</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&quot;merwok wok@xample.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&quot;merwok  wok@xample.com&quot;</span><span class="p">),</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&quot;merwok  wok@xample.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&quot;merwok  wok@xample.com&quot;</span><span class="p">),</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&quot; merwok  wok  @xample.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;merwok&quot;wok&quot;  wok@xample.com&#39;</span><span class="p">),</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;merwok&quot;wok&quot;  wok@xample.com&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;merwok.wok.wok@xample.com&#39;</span><span class="p">),</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="s">&#39;merwok. wok .  wok@xample.com&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_formataddr_does_not_quote_parens_in_quoted_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_formataddr_does_not_quote_parens_in_quoted_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_formataddr_does_not_quote_parens_in_quoted_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&#39;foo@example.com&#39; (foo@example.com)&quot;</span><span class="p">,</span>
                <span class="s">&#39;foo@example.com&#39;</span><span class="p">)</span>
        <span class="n">addrstr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&quot;</span><span class="se">\&#39;</span><span class="s">foo@example.com</span><span class="se">\&#39;</span><span class="s"> &#39;</span>
                            <span class="s">&#39;(foo@example.com)&quot; &lt;foo@example.com&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">addrstr</span><span class="p">),</span> <span class="n">addr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span> <span class="n">addrstr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMiscellaneous.test_multiline_from_comment"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_multiline_from_comment">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiline_from_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Foo</span>
<span class="se">\t</span><span class="s">Bar &lt;foo@example.com&gt;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Foo Bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo@example.com&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_quote_dump"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_quote_dump">[docs]</a>    <span class="k">def</span> <span class="nf">test_quote_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s">&#39;A Silly; Person&#39;</span><span class="p">,</span> <span class="s">&#39;person@dom.ain&#39;</span><span class="p">)),</span>
            <span class="s">r&#39;&quot;A Silly; Person&quot; &lt;person@dom.ain&gt;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_charset_richcomparisons"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_charset_richcomparisons">[docs]</a>    <span class="k">def</span> <span class="nf">test_charset_richcomparisons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span>
        <span class="n">cset1</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">()</span>
        <span class="n">cset2</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="s">&#39;US-ASCII&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="s">&#39;Us-AsCiI&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;US-ASCII&#39;</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;Us-AsCiI&#39;</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="s">&#39;usascii&#39;</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="s">&#39;USASCII&#39;</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="s">&#39;UsAsCiI&#39;</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">(</span><span class="s">&#39;usascii&#39;</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">(</span><span class="s">&#39;USASCII&#39;</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">(</span><span class="s">&#39;UsAsCiI&#39;</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">cset1</span><span class="p">,</span> <span class="n">cset2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">cset2</span><span class="p">,</span> <span class="n">cset1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_getaddresses"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_getaddresses">[docs]</a>    <span class="k">def</span> <span class="nf">test_getaddresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getaddresses</span><span class="p">([</span><span class="s">&#39;aperson@dom.ain (Al Person)&#39;</span><span class="p">,</span>
                               <span class="s">&#39;Bud Person &lt;bperson@dom.ain&gt;&#39;</span><span class="p">]),</span>
           <span class="p">[(</span><span class="s">&#39;Al Person&#39;</span><span class="p">,</span> <span class="s">&#39;aperson@dom.ain&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Bud Person&#39;</span><span class="p">,</span> <span class="s">&#39;bperson@dom.ain&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_getaddresses_nasty"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_getaddresses_nasty">[docs]</a>    <span class="k">def</span> <span class="nf">test_getaddresses_nasty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getaddresses</span><span class="p">([</span><span class="s">&#39;foo: ;&#39;</span><span class="p">]),</span> <span class="p">[(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getaddresses</span><span class="p">(</span>
           <span class="p">[</span><span class="s">&#39;[]*-- =~$&#39;</span><span class="p">]),</span>
           <span class="p">[(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;*--&#39;</span><span class="p">)])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getaddresses</span><span class="p">(</span>
           <span class="p">[</span><span class="s">&#39;foo: ;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;Jason R. Mastaler&quot; &lt;jason@dom.ain&gt;&#39;</span><span class="p">]),</span>
           <span class="p">[(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Jason R. Mastaler&#39;</span><span class="p">,</span> <span class="s">&#39;jason@dom.ain&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_getaddresses_embedded_comment"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_getaddresses_embedded_comment">[docs]</a>    <span class="k">def</span> <span class="nf">test_getaddresses_embedded_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test proper handling of a nested comment&quot;&quot;&quot;</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">addrs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getaddresses</span><span class="p">([</span><span class="s">&#39;User ((nested comment)) &lt;foo@bar.com&gt;&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">addrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;foo@bar.com&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_utils_quote_unquote"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_utils_quote_unquote">[docs]</a>    <span class="k">def</span> <span class="nf">test_utils_quote_unquote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;content-disposition&#39;</span><span class="p">,</span> <span class="s">&#39;attachment&#39;</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="s">&#39;foo</span><span class="se">\\</span><span class="s">wacky&quot;name&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span> <span class="s">&#39;foo</span><span class="se">\\</span><span class="s">wacky&quot;name&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_get_body_encoding_with_bogus_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_get_body_encoding_with_bogus_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_body_encoding_with_bogus_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;not a charset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">charset</span><span class="o">.</span><span class="n">get_body_encoding</span><span class="p">(),</span> <span class="s">&#39;base64&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_get_body_encoding_with_uppercase_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_get_body_encoding_with_uppercase_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_body_encoding_with_uppercase_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain; charset=UTF-8&#39;</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; charset=UTF-8&#39;</span><span class="p">)</span>
        <span class="n">charsets</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_charsets</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charsets</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="n">charsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charset</span><span class="o">.</span><span class="n">get_body_encoding</span><span class="p">(),</span> <span class="s">&#39;base64&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="n">charset</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;aGVsbG8gd29ybGQ=</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;base64&#39;</span><span class="p">)</span>
        <span class="c"># Try another one</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain; charset=&quot;US-ASCII&quot;&#39;</span>
        <span class="n">charsets</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_charsets</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charsets</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="n">charsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charset</span><span class="o">.</span><span class="n">get_body_encoding</span><span class="p">(),</span> <span class="n">encoders</span><span class="o">.</span><span class="n">encode_7or8bit</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="n">charset</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;hello world&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-transfer-encoding&#39;</span><span class="p">],</span> <span class="s">&#39;7bit&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_charsets_case_insensitive"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_charsets_case_insensitive">[docs]</a>    <span class="k">def</span> <span class="nf">test_charsets_case_insensitive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">uc</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;US-ASCII&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">get_body_encoding</span><span class="p">(),</span> <span class="n">uc</span><span class="o">.</span><span class="n">get_body_encoding</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_partial_falls_inside_message_delivery_status"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_partial_falls_inside_message_delivery_status">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial_falls_inside_message_delivery_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="c"># The Parser interface provides chunks of data to FeedParser in 8192</span>
        <span class="c"># byte gulps.  SF bug #1076485 found one of those chunks inside</span>
        <span class="c"># message/delivery-status header block, which triggered an</span>
        <span class="c"># unreadline() of NeedMoreData.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_43.txt&#39;</span><span class="p">)</span>
        <span class="n">sfp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">iterators</span><span class="o">.</span><span class="n">_structure</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">sfp</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">sfp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">multipart/report</span>
<span class="s">    text/plain</span>
<span class="s">    message/delivery-status</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">        text/plain</span>
<span class="s">    text/rfc822-headers</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_make_msgid_domain"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_make_msgid_domain">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_msgid_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">make_msgid</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="s">&#39;testdomain-string&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">19</span><span class="p">:],</span>
            <span class="s">&#39;@testdomain-string&gt;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_Generator_linend"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_Generator_linend">[docs]</a>    <span class="k">def</span> <span class="nf">test_Generator_linend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14645.</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_26.txt&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">msgtxt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msgtxt_nl</span> <span class="o">=</span> <span class="n">msgtxt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">msgtxt</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">msgtxt_nl</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_BytesGenerator_linend"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_BytesGenerator_linend">[docs]</a>    <span class="k">def</span> <span class="nf">test_BytesGenerator_linend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14645.</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_26.txt&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">msgtxt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msgtxt_nl</span> <span class="o">=</span> <span class="n">msgtxt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">msgtxt_nl</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">),</span> <span class="n">msgtxt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMiscellaneous.test_BytesGenerator_linend_with_non_ascii"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestMiscellaneous.test_BytesGenerator_linend_with_non_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">test_BytesGenerator_linend_with_non_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14645.</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_26.txt&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">msgtxt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msgtxt</span> <span class="o">=</span> <span class="n">msgtxt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;with attachment&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;fo</span><span class="se">\xf6</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msgtxt_nl</span> <span class="o">=</span> <span class="n">msgtxt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">msgtxt_nl</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">msgtxt</span><span class="p">)</span>


<span class="c"># Test the iterator/generators</span></div></div>
<div class="viewcode-block" id="TestIterators"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIterators">[docs]</a><span class="k">class</span> <span class="nc">TestIterators</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestIterators.test_body_line_iterator"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIterators.test_body_line_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">test_body_line_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">neq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="c"># First a simple non-multipart message</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">iterators</span><span class="o">.</span><span class="n">body_line_iterator</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">neq</span><span class="p">(</span><span class="n">EMPTYSTRING</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
        <span class="c"># Now a more complicated multipart</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">)</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">iterators</span><span class="o">.</span><span class="n">body_line_iterator</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">43</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_19.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">neq</span><span class="p">(</span><span class="n">EMPTYSTRING</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestIterators.test_typed_subpart_iterator"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIterators.test_typed_subpart_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">test_typed_subpart_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_04.txt&#39;</span><span class="p">)</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">iterators</span><span class="o">.</span><span class="n">typed_subpart_iterator</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subparts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">subparts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subparts</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">EMPTYSTRING</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">a simple kind of mirror</span>
<span class="s">to reflect upon our own</span>
<span class="s">a simple kind of mirror</span>
<span class="s">to reflect upon our own</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIterators.test_typed_subpart_iterator_default_type"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIterators.test_typed_subpart_iterator_default_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_typed_subpart_iterator_default_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_03.txt&#39;</span><span class="p">)</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">iterators</span><span class="o">.</span><span class="n">typed_subpart_iterator</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="s">&#39;plain&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subparts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">subparts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subpart</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">subparts</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">EMPTYSTRING</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>

<span class="s">Hi,</span>

<span class="s">Do you like this message?</span>

<span class="s">-Me</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIterators.test_pushCR_LF"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIterators.test_pushCR_LF">[docs]</a>    <span class="k">def</span> <span class="nf">test_pushCR_LF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;FeedParser BufferedSubFile.push() assumed it received complete</span>
<span class="sd">           line endings.  A CR ending one push() followed by a LF starting</span>
<span class="sd">           the next push() added an empty line.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">imt</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;a</span><span class="se">\r</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>  <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>     <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span>        <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;d</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span>   <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;e</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span>     <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">f&quot;</span><span class="p">,</span>     <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span>    <span class="mi">1</span><span class="p">),</span>
          <span class="p">]</span>
        <span class="kn">from</span> <span class="nn">email.feedparser</span> <span class="kn">import</span> <span class="n">BufferedSubFile</span><span class="p">,</span> <span class="n">NeedMoreData</span>
        <span class="n">bsf</span> <span class="o">=</span> <span class="n">BufferedSubFile</span><span class="p">()</span>
        <span class="n">om</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">imt</span><span class="p">:</span>
            <span class="n">bsf</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">il</span><span class="p">)</span>
            <span class="n">nt</span> <span class="o">+=</span> <span class="n">n</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">bsf</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="n">NeedMoreData</span><span class="p">):</span>
                <span class="n">om</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ol</span><span class="p">)</span>
                <span class="n">n1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">om</span><span class="p">),</span> <span class="n">nt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">il</span> <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">imt</span><span class="p">]),</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">om</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestIterators.test_push_random"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestIterators.test_push_random">[docs]</a>    <span class="k">def</span> <span class="nf">test_push_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">email.feedparser</span> <span class="kn">import</span> <span class="n">BufferedSubFile</span><span class="p">,</span> <span class="n">NeedMoreData</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">chunksize</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="s">&#39;abcd </span><span class="se">\t\r\n</span><span class="s">&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">bsf</span> <span class="o">=</span> <span class="n">BufferedSubFile</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">chunksize</span><span class="p">):</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunksize</span><span class="p">]</span>
            <span class="n">bsf</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">bsf</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="n">NeedMoreData</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestFeedParsers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFeedParsers">[docs]</a><span class="k">class</span> <span class="nc">TestFeedParsers</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

<div class="viewcode-block" id="TestFeedParsers.parse"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFeedParsers.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">email.feedparser</span> <span class="kn">import</span> <span class="n">FeedParser</span>
        <span class="n">feedparser</span> <span class="o">=</span> <span class="n">FeedParser</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">feedparser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestFeedParsers.test_newlines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFeedParsers.test_newlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_newlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\n</span><span class="s">b:</span><span class="se">\r</span><span class="s">c:</span><span class="se">\r\n</span><span class="s">d:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\n</span><span class="s">b:</span><span class="se">\r</span><span class="s">c:</span><span class="se">\r\n</span><span class="s">d:&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\r</span><span class="s">b&#39;</span><span class="p">,</span> <span class="s">&#39;c:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;bc&#39;</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;b:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">b:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\x85</span><span class="s">b:</span><span class="se">\u2028</span><span class="s">c:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x85</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\u2028</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;b:</span><span class="se">\x85</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;c:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x85</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestFeedParsers.test_long_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestFeedParsers.test_long_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Expected peak memory use on 32-bit platform: 6*N*M bytes.</span>
        <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">20000</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:b</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:b</span><span class="se">\r\r</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:b</span><span class="se">\r\r</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\x85</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\x85</span><span class="s">&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">([</span><span class="s">&#39;a:</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;b: &#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)])</span>

</div></div>
<div class="viewcode-block" id="TestParsers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers">[docs]</a><span class="k">class</span> <span class="nc">TestParsers</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

<div class="viewcode-block" id="TestParsers.test_header_parser"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_header_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># Parse only the headers of a complex multipart MIME document</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">HeaderParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;ppp-request@zzz.org&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">],</span> <span class="s">&#39;ppp@zzz.org&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;multipart/mixed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="nb">str</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_bytes_header_parser"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_bytes_header_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_header_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># Parse only the headers of a complex multipart MIME document</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">BytesHeaderParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;ppp-request@zzz.org&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">],</span> <span class="s">&#39;ppp@zzz.org&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;multipart/mixed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_bytes_parser_does_not_close_file"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_bytes_parser_does_not_close_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_parser_does_not_close_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">BytesParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_bytes_parser_on_exception_does_not_close_file"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_bytes_parser_on_exception_does_not_close_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_parser_on_exception_does_not_close_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_15.txt&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">bytesParser</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">BytesParser</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">StartBoundaryNotFoundDefect</span><span class="p">,</span>
                              <span class="n">bytesParser</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">strict</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span>
                              <span class="n">fp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_parser_does_not_close_file"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_parser_does_not_close_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_parser_does_not_close_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_02.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_parser_on_exception_does_not_close_file"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_parser_on_exception_does_not_close_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_parser_on_exception_does_not_close_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_15.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">Parser</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">StartBoundaryNotFoundDefect</span><span class="p">,</span>
                              <span class="n">parser</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">strict</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_whitespace_continuation"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_whitespace_continuation">[docs]</a>    <span class="k">def</span> <span class="nf">test_whitespace_continuation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># This message contains a line after the Subject: header that has only</span>
        <span class="c"># whitespace, but it is not empty!</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: aperson@dom.ain</span>
<span class="s">To: bperson@dom.ain</span>
<span class="s">Subject: the next line has a space on it</span>
<span class="se">\x20</span><span class="s"></span>
<span class="s">Date: Mon, 8 Apr 2002 15:09:19 -0400</span>
<span class="s">Message-ID: spam</span>

<span class="s">Here&#39;s the message body</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;subject&#39;</span><span class="p">],</span> <span class="s">&#39;the next line has a space on it</span><span class="se">\n</span><span class="s"> &#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;message-id&#39;</span><span class="p">],</span> <span class="s">&#39;spam&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&quot;Here&#39;s the message body</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_whitespace_continuation_last_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_whitespace_continuation_last_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_whitespace_continuation_last_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># Like the previous test, but the subject line is the last</span>
        <span class="c"># header.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: aperson@dom.ain</span>
<span class="s">To: bperson@dom.ain</span>
<span class="s">Date: Mon, 8 Apr 2002 15:09:19 -0400</span>
<span class="s">Message-ID: spam</span>
<span class="s">Subject: the next line has a space on it</span>
<span class="se">\x20</span><span class="s"></span>

<span class="s">Here&#39;s the message body</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;subject&#39;</span><span class="p">],</span> <span class="s">&#39;the next line has a space on it</span><span class="se">\n</span><span class="s"> &#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;message-id&#39;</span><span class="p">],</span> <span class="s">&#39;spam&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&quot;Here&#39;s the message body</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_crlf_separation"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_crlf_separation">[docs]</a>    <span class="k">def</span> <span class="nf">test_crlf_separation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_26.txt&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;Simple email with attachment.</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;application/riscos&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_crlf_flatten"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_crlf_flatten">[docs]</a>    <span class="k">def</span> <span class="nf">test_crlf_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Using newline=&#39;\n&#39; preserves the crlfs in this input file.</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_26.txt&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">text</span><span class="p">)</span>
</div>
    <span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="TestParsers.test_multipart_digest_with_extra_mime_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_multipart_digest_with_extra_mime_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_multipart_digest_with_extra_mime_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">neq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_28.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="c"># Structure is:</span>
        <span class="c"># multipart/digest</span>
        <span class="c">#   message/rfc822</span>
        <span class="c">#     text/plain</span>
        <span class="c">#   message/rfc822</span>
        <span class="c">#     text/plain</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part1</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part1</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">part1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">part1a</span> <span class="o">=</span> <span class="n">part1</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part1a</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part1a</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">neq</span><span class="p">(</span><span class="n">part1a</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;message 1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># next message/rfc822</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part2</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;message/rfc822&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part2</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">part2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">part2a</span> <span class="o">=</span> <span class="n">part2</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part2a</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">part2a</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&#39;text/plain&#39;</span><span class="p">)</span>
        <span class="n">neq</span><span class="p">(</span><span class="n">part2a</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;message 2</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_three_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_three_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_three_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A bug report by Andrew McNamara</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;From: Andrew Person &lt;aperson@dom.ain&#39;</span><span class="p">,</span>
                 <span class="s">&#39;Subject: Test&#39;</span><span class="p">,</span>
                 <span class="s">&#39;Date: Tue, 20 Aug 2002 16:43:45 +1000&#39;</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">NL</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">],</span> <span class="s">&#39;Tue, 20 Aug 2002 16:43:45 +1000&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_strip_line_feed_and_carriage_return_in_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_strip_line_feed_and_carriage_return_in_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_strip_line_feed_and_carriage_return_in_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># For [ 1002475 ] email message parser doesn&#39;t handle \r\n correctly</span>
        <span class="n">value1</span> <span class="o">=</span> <span class="s">&#39;text&#39;</span>
        <span class="n">value2</span> <span class="o">=</span> <span class="s">&#39;more text&#39;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;Header: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s">Next-Header: </span><span class="si">%s</span><span class="se">\r\n\r\n</span><span class="s">Body</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Header&#39;</span><span class="p">),</span> <span class="n">value1</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Next-Header&#39;</span><span class="p">),</span> <span class="n">value2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_rfc2822_header_syntax"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_rfc2822_header_syntax">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2822_header_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&gt;From: foo</span><span class="se">\n</span><span class="s">From: bar</span><span class="se">\n</span><span class="s">!&quot;#QUX;~: zoo</span><span class="se">\n\n</span><span class="s">body&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">),</span> <span class="p">[</span><span class="s">&#39;!&quot;#QUX;~&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;From&#39;</span><span class="p">,</span> <span class="s">&#39;From&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;body&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_rfc2822_space_not_allowed_in_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_rfc2822_space_not_allowed_in_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2822_space_not_allowed_in_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&gt;From foo@example.com 11:25:53</span><span class="se">\n</span><span class="s">From: bar</span><span class="se">\n</span><span class="s">!&quot;#QUX;~: zoo</span><span class="se">\n\n</span><span class="s">body&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_rfc2822_one_character_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_rfc2822_one_character_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2822_one_character_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;A: first header</span><span class="se">\n</span><span class="s">B: second header</span><span class="se">\n</span><span class="s">CC: third header</span><span class="se">\n\n</span><span class="s">body&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;CC&#39;</span><span class="p">])</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;body&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestParsers.test_CRLFLF_at_end_of_part"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestParsers.test_CRLFLF_at_end_of_part">[docs]</a>    <span class="k">def</span> <span class="nf">test_CRLFLF_at_end_of_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 5610: feedparser should not eat two chars from body part ending</span>
        <span class="c"># with &quot;\r\n\n&quot;.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;From: foo@bar.com</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;To: baz</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;Mime-Version: 1.0</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;Content-Type: multipart/mixed; boundary=BOUNDARY</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;--BOUNDARY</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;Content-Type: text/plain</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;body ending with CRLF newline</span><span class="se">\r\n</span><span class="s">&quot;</span>
            <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;--BOUNDARY--</span><span class="se">\n</span><span class="s">&quot;</span>
          <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="Test8BitBytesHandling"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling">[docs]</a><span class="k">class</span> <span class="nc">Test8BitBytesHandling</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
    <span class="c"># In Python3 all input is string, but that doesn&#39;t work if the actual input</span>
    <span class="c"># uses an 8bit transfer encoding.  To hack around that, in email 5.1 we</span>
    <span class="c"># decode byte streams using the surrogateescape error handler, and</span>
    <span class="c"># reconvert to binary at appropriate places if we detect surrogates.  This</span>
    <span class="c"># doesn&#39;t allow us to transform headers with 8bit bytes (they get munged),</span>
    <span class="c"># but it does allow us to parse and preserve them, and to decode body</span>
    <span class="c"># parts that use an 8bit CTE.</span>

    <span class="n">bodytest_msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: foo@bar.com</span>
<span class="s">        To: baz</span>
<span class="s">        Mime-Version: 1.0</span>
<span class="s">        Content-Type: text/plain; charset={charset}</span>
<span class="s">        Content-Transfer-Encoding: {cte}</span>

<span class="s">        {bodyline}</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Test8BitBytesHandling.test_known_8bit_CTE"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_known_8bit_CTE">[docs]</a>    <span class="k">def</span> <span class="nf">test_known_8bit_CTE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodytest_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                                     <span class="n">cte</span><span class="o">=</span><span class="s">&#39;8bit&#39;</span><span class="p">,</span>
                                     <span class="n">bodyline</span><span class="o">=</span><span class="s">&#39;pöstal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&quot;pöstal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="s">&quot;pöstal</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_unknown_8bit_CTE"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_unknown_8bit_CTE">[docs]</a>    <span class="k">def</span> <span class="nf">test_unknown_8bit_CTE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodytest_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;notavalidcharset&#39;</span><span class="p">,</span>
                                     <span class="n">cte</span><span class="o">=</span><span class="s">&#39;8bit&#39;</span><span class="p">,</span>
                                     <span class="n">bodyline</span><span class="o">=</span><span class="s">&#39;pöstal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&quot;p</span><span class="se">\uFFFD\uFFFD</span><span class="s">stal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="s">&quot;pöstal</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_8bit_in_quopri_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_8bit_in_quopri_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_8bit_in_quopri_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This is non-RFC compliant data...without &#39;decode&#39; the library code</span>
        <span class="c"># decodes the body using the charset from the headers, and because the</span>
        <span class="c"># source byte really is utf-8 this works.  This is likely to fail</span>
        <span class="c"># against real dirty data (ie: produce mojibake), but the data is</span>
        <span class="c"># invalid anyway so it is as good a guess as any.  But this means that</span>
        <span class="c"># this test just confirms the current behavior; that behavior is not</span>
        <span class="c"># necessarily the best possible behavior.  With &#39;decode&#39; it is</span>
        <span class="c"># returning the raw bytes, so that test should be of correct behavior,</span>
        <span class="c"># or at least produce the same result that email4 did.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodytest_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                                     <span class="n">cte</span><span class="o">=</span><span class="s">&#39;quoted-printable&#39;</span><span class="p">,</span>
                                     <span class="n">bodyline</span><span class="o">=</span><span class="s">&#39;p=C3=B6stál&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;p=C3=B6stál</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="s">&#39;pöstál</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_invalid_8bit_in_non_8bit_cte_uses_replace"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_invalid_8bit_in_non_8bit_cte_uses_replace">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_8bit_in_non_8bit_cte_uses_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This is similar to the previous test, but proves that if the 8bit</span>
        <span class="c"># byte is undecodeable in the specified charset, it gets replaced</span>
        <span class="c"># by the unicode &#39;unknown&#39; character.  Again, this may or may not</span>
        <span class="c"># be the ideal behavior.  Note that if decode=False none of the</span>
        <span class="c"># decoders will get involved, so this is the only test we need</span>
        <span class="c"># for this behavior.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodytest_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span>
                                     <span class="n">cte</span><span class="o">=</span><span class="s">&#39;quoted-printable&#39;</span><span class="p">,</span>
                                     <span class="n">bodyline</span><span class="o">=</span><span class="s">&#39;p=C3=B6stál&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;p=C3=B6st</span><span class="se">\uFFFD\uFFFD</span><span class="s">l</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                        <span class="s">&#39;pöstál</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c"># test_defect_handling:test_invalid_chars_in_base64_payload</span></div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_8bit_in_base64_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_8bit_in_base64_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_8bit_in_base64_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If we get 8bit bytes in a base64 body, we can just ignore them</span>
        <span class="c"># as being outside the base64 alphabet and decode anyway.  But</span>
        <span class="c"># we register a defect.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodytest_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                                     <span class="n">cte</span><span class="o">=</span><span class="s">&#39;base64&#39;</span><span class="p">,</span>
                                     <span class="n">bodyline</span><span class="o">=</span><span class="s">&#39;cMO2c3RhbAá=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="s">&#39;pöstal&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">defects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">errors</span><span class="o">.</span><span class="n">InvalidBase64CharactersDefect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_8bit_in_uuencode_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_8bit_in_uuencode_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_8bit_in_uuencode_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Sticking an 8bit byte in a uuencode block makes it undecodable by</span>
        <span class="c"># normal means, so the block is returned undecoded, but as bytes.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodytest_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                                     <span class="n">cte</span><span class="o">=</span><span class="s">&#39;uuencode&#39;</span><span class="p">,</span>
                                     <span class="n">bodyline</span><span class="o">=</span><span class="s">&#39;&lt;,.V&lt;W1A; á &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="s">&#39;&lt;,.V&lt;W1A; á </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>

</div>
    <span class="n">headertest_headers</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">&#39;From: foo@bar.com&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="s">&#39;foo@bar.com&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s">&#39;To: báz&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;To&#39;</span><span class="p">,</span> <span class="s">&#39;=?unknown-8bit?q?b=C3=A1z?=&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s">&#39;Subject: Maintenant je vous présente mon collègue, le pouf célèbre</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;</span><span class="se">\t</span><span class="s">Jean de Baddie&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s">&#39;Subject&#39;</span><span class="p">,</span> <span class="s">&#39;=?unknown-8bit?q?Maintenant_je_vous_pr=C3=A9sente_mon_&#39;</span>
                <span class="s">&#39;coll=C3=A8gue=2C_le_pouf_c=C3=A9l=C3=A8bre?=</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39; =?unknown-8bit?q?_Jean_de_Baddie?=&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s">&#39;From: göst&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="s">&#39;=?unknown-8bit?b?Z8O2c3Q=?=&#39;</span><span class="p">)),</span>
        <span class="p">)</span>
    <span class="n">headertest_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">src</span> <span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">headertest_headers</span><span class="p">])</span> <span class="o">+</span>
        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Yes, they are flying.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Test8BitBytesHandling.test_get_8bit_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_get_8bit_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_8bit_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headertest_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;to&#39;</span><span class="p">)),</span> <span class="s">&#39;b</span><span class="se">\uFFFD\uFFFD</span><span class="s">z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;to&#39;</span><span class="p">]),</span> <span class="s">&#39;b</span><span class="se">\uFFFD\uFFFD</span><span class="s">z&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_print_8bit_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_print_8bit_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_print_8bit_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headertest_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span>
                         <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                            From: {}</span>
<span class="s">                            To: {}</span>
<span class="s">                            Subject: {}</span>
<span class="s">                            From: {}</span>

<span class="s">                            Yes, they are flying.</span>
<span class="s">                            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">expected</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span> <span class="ow">in</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">headertest_headers</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_values_with_8bit_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_values_with_8bit_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_values_with_8bit_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headertest_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
                              <span class="p">[</span><span class="s">&#39;foo@bar.com&#39;</span><span class="p">,</span>
                               <span class="s">&#39;b</span><span class="se">\uFFFD\uFFFD</span><span class="s">z&#39;</span><span class="p">,</span>
                               <span class="s">&#39;Maintenant je vous pr</span><span class="se">\uFFFD\uFFFD</span><span class="s">sente mon &#39;</span>
                                   <span class="s">&#39;coll</span><span class="se">\uFFFD\uFFFD</span><span class="s">gue, le pouf &#39;</span>
                                   <span class="s">&#39;c</span><span class="se">\uFFFD\uFFFD</span><span class="s">l</span><span class="se">\uFFFD\uFFFD</span><span class="s">bre</span><span class="se">\n</span><span class="s">&#39;</span>
                                   <span class="s">&#39;</span><span class="se">\t</span><span class="s">Jean de Baddie&#39;</span><span class="p">,</span>
                               <span class="s">&quot;g</span><span class="se">\uFFFD\uFFFD</span><span class="s">st&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_items_with_8bit_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_items_with_8bit_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_items_with_8bit_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headertest_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
                              <span class="p">[(</span><span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="s">&#39;foo@bar.com&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;To&#39;</span><span class="p">,</span> <span class="s">&#39;b</span><span class="se">\uFFFD\uFFFD</span><span class="s">z&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;Subject&#39;</span><span class="p">,</span> <span class="s">&#39;Maintenant je vous &#39;</span>
                                  <span class="s">&#39;pr</span><span class="se">\uFFFD\uFFFD</span><span class="s">sente &#39;</span>
                                  <span class="s">&#39;mon coll</span><span class="se">\uFFFD\uFFFD</span><span class="s">gue, le pouf &#39;</span>
                                  <span class="s">&#39;c</span><span class="se">\uFFFD\uFFFD</span><span class="s">l</span><span class="se">\uFFFD\uFFFD</span><span class="s">bre</span><span class="se">\n</span><span class="s">&#39;</span>
                                  <span class="s">&#39;</span><span class="se">\t</span><span class="s">Jean de Baddie&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="s">&#39;g</span><span class="se">\uFFFD\uFFFD</span><span class="s">st&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_get_all_with_8bit_headers"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_get_all_with_8bit_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_all_with_8bit_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headertest_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s">&#39;from&#39;</span><span class="p">)],</span>
                              <span class="p">[</span><span class="s">&#39;foo@bar.com&#39;</span><span class="p">,</span>
                               <span class="s">&#39;g</span><span class="se">\uFFFD\uFFFD</span><span class="s">st&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_get_content_type_with_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_get_content_type_with_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_content_type_with_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/pl</span><span class="se">\xA7</span><span class="s">in; charset=utf-8</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="s">&quot;text/pl</span><span class="se">\uFFFD</span><span class="s">in&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&quot;text&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">(),</span> <span class="s">&quot;pl</span><span class="se">\uFFFD</span><span class="s">in&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.non_ascii_in_params</span></div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_get_params_with_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_get_params_with_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_params_with_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span>
            <span class="s">&#39;X-Header: foo=</span><span class="se">\xa7</span><span class="s">ne; b</span><span class="se">\xa7</span><span class="s">r=two; baz=three</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span>
           <span class="p">[(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\uFFFD</span><span class="s">ne&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;b</span><span class="se">\uFFFD</span><span class="s">r&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\uFFFd</span><span class="s">ne&#39;</span><span class="p">)</span>
        <span class="c"># XXX: someday you might be able to get &#39;b\xa7r&#39;, for now you can&#39;t.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;b</span><span class="se">\xa7</span><span class="s">r&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;x-header&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.non_ascii_in_rfc2231_value</span></div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_get_rfc2231_params_with_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_get_rfc2231_params_with_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_rfc2231_params_with_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/plain; charset=us-ascii;</span>
<span class="s">             title*=us-ascii&#39;en&#39;This</span><span class="si">%20i</span><span class="s">s%20not</span><span class="si">%20f</span><span class="se">\xa7</span><span class="s">n&quot;&quot;&quot;</span>
             <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="s">&#39;This is not f</span><span class="se">\uFFFD</span><span class="s">n&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_set_rfc2231_params_with_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_set_rfc2231_params_with_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_rfc2231_params_with_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/plain; charset=us-ascii;</span>
<span class="s">             title*=us-ascii&#39;en&#39;This</span><span class="si">%20i</span><span class="s">s%20not</span><span class="si">%20f</span><span class="se">\xa7</span><span class="s">n&quot;&quot;&quot;</span>
             <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span> <span class="s">&#39;test&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_del_rfc2231_params_with_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_del_rfc2231_params_with_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_del_rfc2231_params_with_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Type: text/plain; charset=us-ascii;</span>
<span class="s">             title*=us-ascii&#39;en&#39;This</span><span class="si">%20i</span><span class="s">s%20not</span><span class="si">%20f</span><span class="se">\xa7</span><span class="s">n&quot;&quot;&quot;</span>
             <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">del_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">(),</span> <span class="s">&#39;text&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_get_payload_with_8bit_cte_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_get_payload_with_8bit_cte_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_payload_with_8bit_cte_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Content-Transfer-Encoding: b</span><span class="se">\xa7</span><span class="s">se64</span>
<span class="s">            Content-Type: text/plain; charset=latin-1</span>

<span class="s">            payload</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;payload</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;payload</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
    <span class="n">non_latin_bin_msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: foo@bar.com</span>
<span class="s">        To: báz</span>
<span class="s">        Subject: Maintenant je vous présente mon collègue, le pouf célèbre</span>
<span class="s">        </span><span class="se">\t</span><span class="s">Jean de Baddie</span>
<span class="s">        Mime-Version: 1.0</span>
<span class="s">        Content-Type: text/plain; charset=&quot;utf-8&quot;</span>
<span class="s">        Content-Transfer-Encoding: 8bit</span>

<span class="s">        Да, они летят.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Test8BitBytesHandling.test_bytes_generator"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_bytes_generator">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_bytes_generator_handles_None_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_bytes_generator_handles_None_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_generator_handles_None_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#Issue 11019</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
    <span class="n">non_latin_bin_msg_as7bit_wrapped</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: foo@bar.com</span>
<span class="s">        To: =?unknown-8bit?q?b=C3=A1z?=</span>
<span class="s">        Subject: =?unknown-8bit?q?Maintenant_je_vous_pr=C3=A9sente_mon_coll=C3=A8gue?=</span>
<span class="s">         =?unknown-8bit?q?=2C_le_pouf_c=C3=A9l=C3=A8bre?=</span>
<span class="s">         =?unknown-8bit?q?_Jean_de_Baddie?=</span>
<span class="s">        Mime-Version: 1.0</span>
<span class="s">        Content-Type: text/plain; charset=&quot;utf-8&quot;</span>
<span class="s">        Content-Transfer-Encoding: base64</span>

<span class="s">        0JTQsCwg0L7QvdC4INC70LXRgtGP0YIuCg==</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Test8BitBytesHandling.test_generator_handles_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_generator_handles_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_generator_handles_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg_as7bit_wrapped</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_str_generator_should_not_mutate_msg_when_handling_8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_str_generator_should_not_mutate_msg_when_handling_8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_str_generator_should_not_mutate_msg_when_handling_8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">orig_value</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">Generator</span><span class="p">(</span><span class="n">StringIO</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="c"># Should not mutate msg!</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">BytesGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">orig_value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_bytes_generator_with_unix_from"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_bytes_generator_with_unix_from">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_generator_with_unix_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The unixfrom contains a current date, so we can&#39;t check it</span>
        <span class="c"># literally.  Just make sure the first word is &#39;From&#39; and the</span>
        <span class="c"># rest of the message matches the input.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">unixfrom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;From&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
</div>
    <span class="n">non_latin_bin_msg_as7bit</span> <span class="o">=</span> <span class="n">non_latin_bin_msg_as7bit_wrapped</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">non_latin_bin_msg_as7bit</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&#39;Subject: =?unknown-8bit?q?Maintenant_je_vous_pr=C3=A9sente_mon_&#39;</span>
         <span class="s">&#39;coll=C3=A8gue=2C_le_pouf_c=C3=A9l=C3=A8bre?=&#39;</span><span class="p">]</span>
    <span class="n">non_latin_bin_msg_as7bit</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_latin_bin_msg_as7bit</span><span class="p">)</span>

<div class="viewcode-block" id="Test8BitBytesHandling.test_message_from_binary_file"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_message_from_binary_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_from_binary_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="s">&#39;test.msg&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">unlink</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">testfile</span><span class="p">:</span>
            <span class="n">testfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">testfile</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">BytesParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">testfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_latin_bin_msg_as7bit</span><span class="p">)</span>
</div>
    <span class="n">latin_bin_msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: foo@bar.com</span>
<span class="s">        To: Dinsdale</span>
<span class="s">        Subject: Nudge nudge, wink, wink</span>
<span class="s">        Mime-Version: 1.0</span>
<span class="s">        Content-Type: text/plain; charset=&quot;latin-1&quot;</span>
<span class="s">        Content-Transfer-Encoding: 8bit</span>

<span class="s">        oh là là, know what I mean, know what I mean?</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span>

    <span class="n">latin_bin_msg_as7bit</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: foo@bar.com</span>
<span class="s">        To: Dinsdale</span>
<span class="s">        Subject: Nudge nudge, wink, wink</span>
<span class="s">        Mime-Version: 1.0</span>
<span class="s">        Content-Type: text/plain; charset=&quot;iso-8859-1&quot;</span>
<span class="s">        Content-Transfer-Encoding: quoted-printable</span>

<span class="s">        oh l=E0 l=E0, know what I mean, know what I mean?</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Test8BitBytesHandling.test_string_generator_reencodes_to_quopri_when_appropriate"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_string_generator_reencodes_to_quopri_when_appropriate">[docs]</a>    <span class="k">def</span> <span class="nf">test_string_generator_reencodes_to_quopri_when_appropriate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg_as7bit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_decoded_generator_emits_unicode_body"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_decoded_generator_emits_unicode_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoded_generator_emits_unicode_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">DecodedGenerator</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="c">#DecodedHeader output contains an extra blank line compared</span>
        <span class="c">#to the input message.  RDM: not sure if this is a bug or not,</span>
        <span class="c">#but it is not specific to the 8bit-&gt;7bit conversion.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_bytes_feedparser"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_bytes_feedparser">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_feedparser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bfp</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">feedparser</span><span class="o">.</span><span class="n">BytesFeedParser</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg</span><span class="p">),</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">bfp</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">bfp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">latin_bin_msg_as7bit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_crlf_flatten"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_crlf_flatten">[docs]</a>    <span class="k">def</span> <span class="nf">test_crlf_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="s">&#39;msg_26.txt&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_8bit_multipart"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_8bit_multipart">[docs]</a>    <span class="k">def</span> <span class="nf">test_8bit_multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 11605</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            Date: Fri, 18 Mar 2011 17:15:43 +0100</span>
<span class="s">            To: foo@example.com</span>
<span class="s">            From: foodwatch-Newsletter &lt;bar@example.com&gt;</span>
<span class="s">            Subject: Aktuelles zu Japan, Klonfleisch und Smiley-System</span>
<span class="s">            Message-ID: &lt;76a486bee62b0d200f33dc2ca08220ad@localhost.localdomain&gt;</span>
<span class="s">            MIME-Version: 1.0</span>
<span class="s">            Content-Type: multipart/alternative;</span>
<span class="s">                    boundary=&quot;b1_76a486bee62b0d200f33dc2ca08220ad&quot;</span>

<span class="s">            --b1_76a486bee62b0d200f33dc2ca08220ad</span>
<span class="s">            Content-Type: text/plain; charset=&quot;utf-8&quot;</span>
<span class="s">            Content-Transfer-Encoding: 8bit</span>

<span class="s">            Guten Tag, ,</span>

<span class="s">            mit großer Betroffenheit verfolgen auch wir im foodwatch-Team die</span>
<span class="s">            Nachrichten aus Japan.</span>


<span class="s">            --b1_76a486bee62b0d200f33dc2ca08220ad</span>
<span class="s">            Content-Type: text/html; charset=&quot;utf-8&quot;</span>
<span class="s">            Content-Transfer-Encoding: 8bit</span>

<span class="s">            &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span>
<span class="s">                &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span>
<span class="s">            &lt;html lang=&quot;de&quot;&gt;</span>
<span class="s">            &lt;head&gt;</span>
<span class="s">                    &lt;title&gt;foodwatch - Newsletter&lt;/title&gt;</span>
<span class="s">            &lt;/head&gt;</span>
<span class="s">            &lt;body&gt;</span>
<span class="s">              &lt;p&gt;mit gro&amp;szlig;er Betroffenheit verfolgen auch wir im foodwatch-Team</span>
<span class="s">                 die Nachrichten aus Japan.&lt;/p&gt;</span>
<span class="s">            &lt;/body&gt;</span>
<span class="s">            &lt;/html&gt;</span>
<span class="s">            --b1_76a486bee62b0d200f33dc2ca08220ad--</span>

<span class="s">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_bytes_generator_b_encoding_linesep"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_bytes_generator_b_encoding_linesep">[docs]</a>    <span class="k">def</span> <span class="nf">test_bytes_generator_b_encoding_linesep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 14062: b encoding was tacking on an extra \n.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="c"># This has enough non-ascii that it should always end up b encoded.</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;žluťoučký kůň&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
            <span class="n">b</span><span class="s">&#39;Subject: =?utf-8?b?xb5sdcWlb3XEjWvDvSBrxa/FiA==?=</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Test8BitBytesHandling.test_generator_b_encoding_linesep"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.Test8BitBytesHandling.test_generator_b_encoding_linesep">[docs]</a>    <span class="k">def</span> <span class="nf">test_generator_b_encoding_linesep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Since this broke in ByteGenerator, test Generator for completeness.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="c"># This has enough non-ascii that it should always end up b encoded.</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;žluťoučký kůň&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
            <span class="s">&#39;Subject: =?utf-8?b?xb5sdcWlb3XEjWvDvSBrxa/FiA==?=</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
    <span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="BaseTestBytesGeneratorIdempotent"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.BaseTestBytesGeneratorIdempotent">[docs]</a><span class="k">class</span> <span class="nc">BaseTestBytesGeneratorIdempotent</span><span class="p">:</span>

    <span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_msgobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_linesep_regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blinesep</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span><span class="p">,</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_idempotent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unixfrom</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">unixfrom</span><span class="o">=</span><span class="n">unixfrom</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="TestBytesGeneratorIdempotentNL"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBytesGeneratorIdempotentNL">[docs]</a><span class="k">class</span> <span class="nc">TestBytesGeneratorIdempotentNL</span><span class="p">(</span><span class="n">BaseTestBytesGeneratorIdempotent</span><span class="p">,</span>
                                    <span class="n">TestIdempotent</span><span class="p">):</span>
    <span class="n">linesep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">blinesep</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">normalize_linesep_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">br</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestBytesGeneratorIdempotentCRLF"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBytesGeneratorIdempotentCRLF">[docs]</a><span class="k">class</span> <span class="nc">TestBytesGeneratorIdempotentCRLF</span><span class="p">(</span><span class="n">BaseTestBytesGeneratorIdempotent</span><span class="p">,</span>
                                       <span class="n">TestIdempotent</span><span class="p">):</span>
    <span class="n">linesep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
    <span class="n">blinesep</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
    <span class="n">normalize_linesep_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">br</span><span class="s">&#39;(?&lt;!</span><span class="se">\r</span><span class="s">)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestBase64"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBase64">[docs]</a><span class="k">class</span> <span class="nc">TestBase64</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestBase64.test_len"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBase64.test_len">[docs]</a>    <span class="k">def</span> <span class="nf">test_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">),</span>
           <span class="nb">len</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
            <span class="k">if</span>   <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">bsize</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">bsize</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="p">:</span> <span class="n">bsize</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="k">elif</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">9</span> <span class="p">:</span> <span class="n">bsize</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="k">elif</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">:</span> <span class="n">bsize</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="k">else</span>           <span class="p">:</span> <span class="n">bsize</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="n">size</span><span class="p">),</span> <span class="n">bsize</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestBase64.test_decode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBase64.test_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;aGVsbG8=&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestBase64.test_encode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBase64.test_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">),</span> <span class="s">&#39;aGVsbG8=</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Test the binary flag</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;aGVsbG8K</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># Test the maxlinelen arg</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">eHh4eCB4eHh4IHh4eHggeHh4eCB4eHh4IHh4eHgg</span>
<span class="s">eHh4eCB4eHh4IHh4eHggeHh4eCB4eHh4IHh4eHgg</span>
<span class="s">eHh4eCB4eHh4IHh4eHggeHh4eCB4eHh4IHh4eHgg</span>
<span class="s">eHh4eCB4eHh4IA==</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c"># Test the eol argument</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">base64mime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">),</span>
           <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">eHh4eCB4eHh4IHh4eHggeHh4eCB4eHh4IHh4eHgg\r</span>
<span class="sd">eHh4eCB4eHh4IHh4eHggeHh4eCB4eHh4IHh4eHgg\r</span>
<span class="sd">eHh4eCB4eHh4IHh4eHggeHh4eCB4eHh4IHh4eHgg\r</span>
<span class="sd">eHh4eCB4eHh4IA==\r</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestBase64.test_header_encode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestBase64.test_header_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">he</span> <span class="o">=</span> <span class="n">base64mime</span><span class="o">.</span><span class="n">header_encode</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">he</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">),</span> <span class="s">&#39;=?iso-8859-1?b?aGVsbG8=?=&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">he</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">world&#39;</span><span class="p">),</span> <span class="s">&#39;=?iso-8859-1?b?aGVsbG8NCndvcmxk?=&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">he</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world&#39;</span><span class="p">),</span> <span class="s">&#39;=?iso-8859-1?b?aGVsbG8Kd29ybGQ=?=&#39;</span><span class="p">)</span>
        <span class="c"># Test the charset option</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">he</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;iso-8859-2&#39;</span><span class="p">),</span> <span class="s">&#39;=?iso-8859-2?b?aGVsbG8=?=&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">he</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world&#39;</span><span class="p">),</span> <span class="s">&#39;=?iso-8859-1?b?aGVsbG8Kd29ybGQ=?=&#39;</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="TestQuopri"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri">[docs]</a><span class="k">class</span> <span class="nc">TestQuopri</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestQuopri.setUp"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Set of characters (as byte integers) that don&#39;t need to be encoded</span>
        <span class="c"># in headers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlit</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;9&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&#39;!*+-/&#39;</span><span class="p">)))</span>
        <span class="c"># Set of characters (as byte integers) that do need to be encoded in</span>
        <span class="c"># headers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hnon</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlit</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hlit</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hnon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">256</span>
        <span class="c"># Set of characters (as byte integers) that don&#39;t need to be encoded</span>
        <span class="c"># in bodies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blit</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blit</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">))</span>
        <span class="c"># Set of characters (as byte integers) that do need to be encoded in</span>
        <span class="c"># bodies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bnon</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blit</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blit</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bnon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">256</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_quopri_header_check"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_quopri_header_check">[docs]</a>    <span class="k">def</span> <span class="nf">test_quopri_header_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_check</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                        <span class="s">&#39;Should not be header quopri encoded: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hnon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_check</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                            <span class="s">&#39;Should be header quopri encoded: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_quopri_body_check"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_quopri_body_check">[docs]</a>    <span class="k">def</span> <span class="nf">test_quopri_body_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_check</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                        <span class="s">&#39;Should not be body quopri encoded: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_check</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                            <span class="s">&#39;Should be body quopri encoded: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_quopri_len"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_quopri_len">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_quopri_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c"># RFC 2047 chrome is not included in header_length().</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;xxx&#39;</span><span class="p">)),</span>
           <span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">)</span> <span class="o">+</span>
           <span class="c"># =?xxx?q?...?= means 10 extra characters</span>
           <span class="mi">10</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;h@e@l@l@o@&#39;</span><span class="p">),</span> <span class="mi">20</span><span class="p">)</span>
        <span class="c"># RFC 2047 chrome is not included in header_length().</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;h@e@l@l@o@&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;xxx&#39;</span><span class="p">)),</span>
           <span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;h@e@l@l@o@&#39;</span><span class="p">)</span> <span class="o">+</span>
           <span class="c"># =?xxx?q?...?= means 10 extra characters</span>
           <span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlit</span><span class="p">:</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])),</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s">&#39;expected length 1 for </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hnon</span><span class="p">:</span>
            <span class="c"># Space is special; it&#39;s encoded to _</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])),</span> <span class="mi">3</span><span class="p">,</span>
               <span class="s">&#39;expected length 3 for </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_length</span><span class="p">(</span><span class="n">b</span><span class="s">&#39; &#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_body_quopri_len"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_body_quopri_len">[docs]</a>    <span class="k">def</span> <span class="nf">test_body_quopri_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blit</span><span class="p">:</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_length</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnon</span><span class="p">:</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_length</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])),</span> <span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_quote_unquote_idempotent"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_quote_unquote_idempotent">[docs]</a>    <span class="k">def</span> <span class="nf">test_quote_unquote_idempotent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">c</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_header_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">expected_encoded_header</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">charset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">encoded_header</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">header_encode</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">encoded_header</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">header_encode</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">charset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoded_header</span><span class="p">,</span> <span class="n">expected_encoded_header</span><span class="p">)</span>

<div class="viewcode-block" id="TestQuopri.test_header_encode_null"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_encode_null">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_encode_one_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_encode_one_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode_one_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;=?iso-8859-1?q?hello?=&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_encode_two_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_encode_two_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode_two_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world&#39;</span><span class="p">,</span>
                                <span class="s">&#39;=?iso-8859-1?q?hello=0Aworld?=&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_encode_non_ascii"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_encode_non_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode_non_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello</span><span class="se">\xc7</span><span class="s">there&#39;</span><span class="p">,</span>
                                <span class="s">&#39;=?iso-8859-1?q?hello=C7there?=&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_encode_alt_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_encode_alt_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_encode_alt_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;=?iso-8859-2?q?hello?=&#39;</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s">&#39;iso-8859-2&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_header_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoded_header</span><span class="p">,</span> <span class="n">expected_decoded_header</span><span class="p">):</span>
        <span class="n">decoded_header</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">header_decode</span><span class="p">(</span><span class="n">encoded_header</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded_header</span><span class="p">,</span> <span class="n">expected_decoded_header</span><span class="p">)</span>

<div class="viewcode-block" id="TestQuopri.test_header_decode_null"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_decode_null">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_decode_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_decode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_decode_one_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_decode_one_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_decode_one_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_decode</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;hello&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_decode_two_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_decode_two_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_decode_two_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_decode</span><span class="p">(</span><span class="s">&#39;hello=0Aworld&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_decode_non_ascii"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_decode_non_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_decode_non_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_header_decode</span><span class="p">(</span><span class="s">&#39;hello=C7there&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\xc7</span><span class="s">there&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_header_decode_re_bug_18380"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_header_decode_re_bug_18380">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_decode_re_bug_18380</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 18380: Call re.sub with a positional argument for flags in the wrong position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">header_decode</span><span class="p">(</span><span class="s">&#39;=30&#39;</span> <span class="o">*</span> <span class="mi">257</span><span class="p">),</span> <span class="s">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">257</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoded</span><span class="p">,</span> <span class="n">expected_decoded</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">decoded</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decoded</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="n">eol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="n">expected_decoded</span><span class="p">)</span>

<div class="viewcode-block" id="TestQuopri.test_decode_null_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_null_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_null_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_null_line_null_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_null_line_null_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_null_line_null_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;hello&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_word_eol"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_word_eol">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_word_eol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_lf"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_lf">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_lf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_cr"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_cr">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_cr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_nl"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_nl">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_nl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;helloX&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_crnl"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_crnl">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_crnl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;helloX&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_one_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_one_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_one_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">world&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_one_word_eol"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_one_word_eol">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_one_word_eol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">world&#39;</span><span class="p">,</span> <span class="s">&#39;helloXworld&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_two_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_two_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_two_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">world</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_two_lines_eol"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_two_lines_eol">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_two_lines_eol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">world</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;helloXworldX&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_long_line"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_long_line">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_long_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;Spam&#39;</span> <span class="o">*</span> <span class="mi">250</span><span class="p">,</span> <span class="s">&#39;Spam&#39;</span> <span class="o">*</span> <span class="mi">250</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_space"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_space">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_multiple_spaces"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_multiple_spaces">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_multiple_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_one_line_trailing_spaces"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_one_line_trailing_spaces">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_one_line_trailing_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello    </span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_two_lines_trailing_spaces"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_two_lines_trailing_spaces">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_two_lines_trailing_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;hello    </span><span class="se">\r\n</span><span class="s">world   </span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_quoted_word"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_quoted_word">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_quoted_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;=22quoted=20words=22&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;quoted words&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_uppercase_quoting"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_uppercase_quoting">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_uppercase_quoting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;ab=CD=EF&#39;</span><span class="p">,</span> <span class="s">&#39;ab</span><span class="se">\xcd\xef</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_lowercase_quoting"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_lowercase_quoting">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_lowercase_quoting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;ab=cd=ef&#39;</span><span class="p">,</span> <span class="s">&#39;ab</span><span class="se">\xcd\xef</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_soft_line_break"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_soft_line_break">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_soft_line_break</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;soft line=</span><span class="se">\r\n</span><span class="s">break&#39;</span><span class="p">,</span> <span class="s">&#39;soft linebreak&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_decode_false_quoting"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_decode_false_quoting">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_false_quoting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_decode</span><span class="p">(</span><span class="s">&#39;A=1,B=A ==&gt; A+B==2&#39;</span><span class="p">,</span> <span class="s">&#39;A=1,B=A ==&gt; A+B==2&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">expected_encoded_body</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">maxlinelen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Use body_encode&#39;s default.</span>
            <span class="n">maxlinelen</span> <span class="o">=</span> <span class="mi">76</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;maxlinelen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlinelen</span>
        <span class="k">if</span> <span class="n">eol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Use body_encode&#39;s default.</span>
            <span class="n">eol</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;eol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eol</span>
        <span class="n">encoded_body</span> <span class="o">=</span> <span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoded_body</span><span class="p">,</span> <span class="n">expected_encoded_body</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eol</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="ow">or</span> <span class="n">eol</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="c"># We know how to split the result back into lines, so maxlinelen</span>
            <span class="c"># can be checked.</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">encoded_body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">maxlinelen</span><span class="p">)</span>

<div class="viewcode-block" id="TestQuopri.test_encode_null"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_null">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_null_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_null_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_null_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line_crlf"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line_crlf">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line_crlf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line_eol"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line_eol">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line_eol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line_eol_after_non_ascii"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line_eol_after_non_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line_eol_after_non_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># issue 20206; see changeset 0cf700464177 for why the encode/decode.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\u03c5\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;latin1&#39;</span><span class="p">),</span>
                          <span class="s">&#39;hello=CF=85</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_space"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_space">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;=20&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line_one_space"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line_one_space">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line_one_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;=20</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

<span class="c"># XXX: body_encode() expect strings, but uses ord(char) from these strings</span>
<span class="c"># to index into a 256-entry list.  For code points above 255, this will fail.</span>
<span class="c"># Should there be a check for 8-bit only ord() values in body, or at least</span>
<span class="c"># a comment about the expected input?</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_two_lines_one_space"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_two_lines_one_space">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_two_lines_one_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39; </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;=20</span><span class="se">\n</span><span class="s">=20</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_word_trailing_spaces"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_word_trailing_spaces">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_word_trailing_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello   &#39;</span><span class="p">,</span> <span class="s">&#39;hello  =20&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line_trailing_spaces"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line_trailing_spaces">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line_trailing_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello   </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello  =20</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_word_trailing_tab"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_word_trailing_tab">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_word_trailing_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello  </span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello  =09&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_line_trailing_tab"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_line_trailing_tab">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_line_trailing_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;hello  </span><span class="se">\t\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hello  =09</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_trailing_space_before_maxlinelen"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_trailing_space_before_maxlinelen">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_trailing_space_before_maxlinelen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;abcd </span><span class="se">\n</span><span class="s">1234&#39;</span><span class="p">,</span> <span class="s">&#39;abcd =</span><span class="se">\n\n</span><span class="s">1234&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_trailing_space_at_maxlinelen"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_trailing_space_at_maxlinelen">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_trailing_space_at_maxlinelen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;abcd </span><span class="se">\n</span><span class="s">1234&#39;</span><span class="p">,</span> <span class="s">&#39;abcd=</span><span class="se">\n</span><span class="s">=20</span><span class="se">\n</span><span class="s">1234&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_trailing_space_beyond_maxlinelen"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_trailing_space_beyond_maxlinelen">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_trailing_space_beyond_maxlinelen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;abcd </span><span class="se">\n</span><span class="s">1234&#39;</span><span class="p">,</span> <span class="s">&#39;abc=</span><span class="se">\n</span><span class="s">d=20</span><span class="se">\n</span><span class="s">1234&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_whitespace_lines"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_whitespace_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_whitespace_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;=20</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_quoted_equals"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_quoted_equals">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_quoted_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;a = b&#39;</span><span class="p">,</span> <span class="s">&#39;a =3D b&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_long_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_long_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_long_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">+</span> <span class="s">&#39;=</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_long_line"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_long_line">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_long_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">+</span> <span class="s">&#39;=</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">25</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_one_very_long_line"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_one_very_long_line">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_one_very_long_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">200</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">+</span> <span class="s">&#39;=</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">50</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_shortest_maxlinelen"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_shortest_maxlinelen">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_shortest_maxlinelen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">(</span><span class="s">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;=3D=</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="s">&#39;=3D&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode_maxlinelen_too_small"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode_maxlinelen_too_small">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_maxlinelen_too_small</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_encode</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestQuopri.test_encode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestQuopri.test_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">),</span> <span class="s">&#39;hello&#39;</span><span class="p">)</span>
        <span class="c"># Test the binary flag</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;hello</span><span class="se">\r\n</span><span class="s">world&#39;</span><span class="p">),</span> <span class="s">&#39;hello</span><span class="se">\n</span><span class="s">world&#39;</span><span class="p">)</span>
        <span class="c"># Test the maxlinelen arg</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx=</span>
<span class="s"> xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxx=</span>
<span class="s">x xxxx xxxx xxxx xxxx=20&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c"># Test the eol argument</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">eol</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">),</span>
           <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx=\r</span>
<span class="sd"> xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxx=\r</span>
<span class="sd">x xxxx xxxx xxxx xxxx=20&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">quoprimime</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">one line</span>

<span class="s">two line&quot;&quot;&quot;</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">one line</span>

<span class="s">two line&quot;&quot;&quot;</span><span class="p">)</span>



<span class="c"># Test the Charset class</span></div></div>
<div class="viewcode-block" id="TestCharset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestCharset">[docs]</a><span class="k">class</span> <span class="nc">TestCharset</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestCharset.tearDown"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestCharset.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">charset</span> <span class="k">as</span> <span class="n">CharsetModule</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">CharsetModule</span><span class="o">.</span><span class="n">CHARSETS</span><span class="p">[</span><span class="s">&#39;fake&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TestCharset.test_codec_encodeable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestCharset.test_codec_encodeable">[docs]</a>    <span class="k">def</span> <span class="nf">test_codec_encodeable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># Make sure us-ascii = no Unicode conversion</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">header_encode</span><span class="p">(</span><span class="s">&#39;Hello World!&#39;</span><span class="p">),</span> <span class="s">&#39;Hello World!&#39;</span><span class="p">)</span>
        <span class="c"># Test 8-bit idempotency with us-ascii</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\xa4\xa2\xa4\xa4\xa4\xa6\xa4\xa8\xa4\xaa</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">header_encode</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">header_encode</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&#39;=?utf-8?b?wqTCosKkwqTCpMKmwqTCqMKkwqo=?=&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestCharset.test_body_encode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestCharset.test_body_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_body_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="c"># Try a charset with QP body encoding</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;hello w=F6rld&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;hello w</span><span class="se">\xf6</span><span class="s">rld&#39;</span><span class="p">))</span>
        <span class="c"># Try a charset with Base64 body encoding</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;aGVsbG8gd29ybGQ=</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">))</span>
        <span class="c"># Try a charset with None body encoding</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">))</span>
        <span class="c"># Try the convert argument, where input codec != output codec</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;euc-jp&#39;</span><span class="p">)</span>
        <span class="c"># With apologies to Tokio Kikuchi ;)</span>
        <span class="c"># XXX FIXME</span>
<span class="c">##         try:</span>
<span class="c">##             eq(&#39;\x1b$B5FCO;~IW\x1b(B&#39;,</span>
<span class="c">##                c.body_encode(&#39;\xb5\xc6\xc3\xcf\xbb\xfe\xc9\xd7&#39;))</span>
<span class="c">##             eq(&#39;\xb5\xc6\xc3\xcf\xbb\xfe\xc9\xd7&#39;,</span>
<span class="c">##                c.body_encode(&#39;\xb5\xc6\xc3\xcf\xbb\xfe\xc9\xd7&#39;, False))</span>
<span class="c">##         except LookupError:</span>
<span class="c">##             # We probably don&#39;t have the Japanese codecs installed</span>
<span class="c">##             pass</span>
        <span class="c"># Testing SF bug #625509, which we have to fake, since there are no</span>
        <span class="c"># built-in encodings where the header encoding is QP but the body</span>
        <span class="c"># encoding is not.</span>
        <span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">charset</span> <span class="k">as</span> <span class="n">CharsetModule</span>
        <span class="n">CharsetModule</span><span class="o">.</span><span class="n">add_charset</span><span class="p">(</span><span class="s">&#39;fake&#39;</span><span class="p">,</span> <span class="n">CharsetModule</span><span class="o">.</span><span class="n">QP</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;fake&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">body_encode</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestCharset.test_unicode_charset_name"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestCharset.test_unicode_charset_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_charset_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">charset</span><span class="p">),</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">CharsetError</span><span class="p">,</span> <span class="n">Charset</span><span class="p">,</span> <span class="s">&#39;asc</span><span class="se">\xff</span><span class="s">ii&#39;</span><span class="p">)</span>



<span class="c"># Test multilingual MIME headers.</span></div></div>
<div class="viewcode-block" id="TestHeader"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader">[docs]</a><span class="k">class</span> <span class="nc">TestHeader</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>
<div class="viewcode-block" id="TestHeader.test_simple"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_simple">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;Hello World!&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;Hello World!&#39;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; Goodbye World!&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;Hello World!  Goodbye World!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_simple_surprise"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_simple_surprise">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_surprise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;Hello World!&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;Hello World!&#39;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Goodbye World!&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;Hello World! Goodbye World!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_header_needs_no_decoding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_header_needs_no_decoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_needs_no_decoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&#39;no decoding needed&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="p">[(</span><span class="n">h</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestHeader.test_long"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&quot;I am the very model of a modern Major-General; I&#39;ve information vegetable, animal, and mineral; I know the kings of England, and I quote the fights historical from Marathon to Waterloo, in order categorical; I&#39;m very well acquainted, too, with matters mathematical; I understand equations, both the simple and quadratical; about binomial theorem I&#39;m teeming with a lot o&#39; news, with many cheerful facts about the square of the hypotenuse.&quot;</span><span class="p">,</span>
                   <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">splitchars</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> &#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="mi">76</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_multilingual"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_multilingual">[docs]</a>    <span class="k">def</span> <span class="nf">test_multilingual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&quot;iso-8859-1&quot;</span><span class="p">)</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&quot;iso-8859-2&quot;</span><span class="p">)</span>
        <span class="n">utf8</span> <span class="o">=</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">g_head</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;Die Mieter treten hier ein werden mit einem &#39;</span>
                  <span class="n">b</span><span class="s">&#39;Foerderband komfortabel den Korridor entlang, &#39;</span>
                  <span class="n">b</span><span class="s">&#39;an s</span><span class="se">\xfc</span><span class="s">dl</span><span class="se">\xfc</span><span class="s">ndischen Wandgem</span><span class="se">\xe4</span><span class="s">lden vorbei, &#39;</span>
                  <span class="n">b</span><span class="s">&#39;gegen die rotierenden Klingen bef</span><span class="se">\xf6</span><span class="s">rdert. &#39;</span><span class="p">)</span>
        <span class="n">cz_head</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;Finan</span><span class="se">\xe8</span><span class="s">ni metropole se hroutily pod tlakem jejich &#39;</span>
                   <span class="n">b</span><span class="s">&#39;d</span><span class="se">\xf9</span><span class="s">vtipu.. &#39;</span><span class="p">)</span>
        <span class="n">utf8_head</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\u6b63\u78ba\u306b\u8a00\u3046\u3068\u7ffb\u8a33\u306f</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4e00</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u90e8\u306f\u30c9\u30a4\u30c4\u8a9e\u3067\u3059\u304c</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3001\u3042\u3068\u306f\u3067\u305f\u3089\u3081\u3067</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3059\u3002\u5b9f\u969b\u306b\u306f\u300c</span><span class="s">Wenn ist das &#39;</span>
                     <span class="s">&#39;Nunstuck git und Slotermeyer? Ja! Beiherhund das Oder &#39;</span>
                     <span class="s">&#39;die Flipperwaldt gersput.</span><span class="se">\u300d\u3068\u8a00\u3063\u3066</span><span class="s">&#39;</span>
                     <span class="s">&#39;</span><span class="se">\u3044\u307e\u3059\u3002</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">g_head</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cz_head</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utf8_head</span><span class="p">,</span> <span class="n">utf8</span><span class="p">)</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">maxlinelen</span><span class="o">=</span><span class="mi">76</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-8859-1?q?Die_Mieter_treten_hier_ein_werden_mit_einem_Foerderband_kom?=</span>
<span class="s"> =?iso-8859-1?q?fortabel_den_Korridor_entlang=2C_an_s=FCdl=FCndischen_Wand?=</span>
<span class="s"> =?iso-8859-1?q?gem=E4lden_vorbei=2C_gegen_die_rotierenden_Klingen_bef=F6r?=</span>
<span class="s"> =?iso-8859-1?q?dert=2E_?= =?iso-8859-2?q?Finan=E8ni_metropole_se_hroutily?=</span>
<span class="s"> =?iso-8859-2?q?_pod_tlakem_jejich_d=F9vtipu=2E=2E_?= =?utf-8?b?5q2j56K6?=</span>
<span class="s"> =?utf-8?b?44Gr6KiA44GG44Go57+76Kiz44Gv44GV44KM44Gm44GE44G+44Gb44KT44CC?=</span>
<span class="s"> =?utf-8?b?5LiA6YOo44Gv44OJ44Kk44OE6Kqe44Gn44GZ44GM44CB44GC44Go44Gv44Gn?=</span>
<span class="s"> =?utf-8?b?44Gf44KJ44KB44Gn44GZ44CC5a6f6Zqb44Gr44Gv44CMV2VubiBpc3QgZGFz?=</span>
<span class="s"> =?utf-8?b?IE51bnN0dWNrIGdpdCB1bmQgU2xvdGVybWV5ZXI/IEphISBCZWloZXJodW5k?=</span>
<span class="s"> =?utf-8?b?IGRhcyBPZGVyIGRpZSBGbGlwcGVyd2FsZHQgZ2Vyc3B1dC7jgI3jgajoqIA=?=</span>
<span class="s"> =?utf-8?b?44Gj44Gm44GE44G+44GZ44CC?=&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decoded</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">decoded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">g_head</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">decoded</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">cz_head</span><span class="p">,</span> <span class="s">&#39;iso-8859-2&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">decoded</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">utf8_head</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">ustr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">ustr</span><span class="p">,</span>
           <span class="p">(</span><span class="n">b</span><span class="s">&#39;Die Mieter treten hier ein werden mit einem Foerderband &#39;</span>
            <span class="n">b</span><span class="s">&#39;komfortabel den Korridor entlang, an s</span><span class="se">\xc3\xbc</span><span class="s">dl</span><span class="se">\xc3\xbc</span><span class="s">ndischen &#39;</span>
            <span class="n">b</span><span class="s">&#39;Wandgem</span><span class="se">\xc3\xa4</span><span class="s">lden vorbei, gegen die rotierenden Klingen &#39;</span>
            <span class="n">b</span><span class="s">&#39;bef</span><span class="se">\xc3\xb6</span><span class="s">rdert. Finan</span><span class="se">\xc4\x8d</span><span class="s">ni metropole se hroutily pod &#39;</span>
            <span class="n">b</span><span class="s">&#39;tlakem jejich d</span><span class="se">\xc5\xaf</span><span class="s">vtipu.. </span><span class="se">\xe6\xad\xa3\xe7\xa2\xba\xe3\x81</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xab\xe8\xa8\x80\xe3\x81\x86\xe3\x81\xa8\xe7\xbf\xbb\xe8\xa8\xb3</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe3\x81\xaf\xe3\x81\x95\xe3\x82\x8c\xe3\x81\xa6\xe3\x81\x84\xe3</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\xbe\xe3\x81\x9b\xe3\x82\x93\xe3\x80\x82\xe4\xb8\x80\xe9\x83</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa8\xe3\x81\xaf\xe3\x83\x89\xe3\x82\xa4\xe3\x83\x84\xe8\xaa\x9e</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe3\x81\xa7\xe3\x81\x99\xe3\x81\x8c\xe3\x80\x81\xe3\x81\x82\xe3</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\xa8\xe3\x81\xaf\xe3\x81\xa7\xe3\x81\x9f\xe3\x82\x89\xe3\x82</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\xe3\x81\xa7\xe3\x81\x99\xe3\x80\x82\xe5\xae\x9f\xe9\x9a\x9b</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe3\x81\xab\xe3\x81\xaf\xe3\x80\x8c</span><span class="s">Wenn ist das Nunstuck git &#39;</span>
            <span class="n">b</span><span class="s">&#39;und Slotermeyer? Ja! Beiherhund das Oder die Flipperwaldt &#39;</span>
            <span class="n">b</span><span class="s">&#39;gersput.</span><span class="se">\xe3\x80\x8d\xe3\x81\xa8\xe8\xa8\x80\xe3\x81\xa3\xe3\x81</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa6\xe3\x81\x84\xe3\x81\xbe\xe3\x81\x99\xe3\x80\x82</span><span class="s">&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="c"># Test make_header()</span>
        <span class="n">newh</span> <span class="o">=</span> <span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">enc</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">newh</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_empty_header_encode"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_empty_header_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_header_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_header_ctor_default_args"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_header_ctor_default_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_ctor_default_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">Charset</span><span class="p">(</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_explicit_maxlinelen"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_explicit_maxlinelen">[docs]</a>    <span class="k">def</span> <span class="nf">test_explicit_maxlinelen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">hstr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;A very long line that must get split to something other &#39;</span>
                <span class="s">&#39;than at the 76th character boundary to test the non-default &#39;</span>
                <span class="s">&#39;behavior&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">A very long line that must get split to something other than at the 76th</span>
<span class="s"> character boundary to test the non-default behavior&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">hstr</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">A very long line that must get split to something other than at the</span>
<span class="s"> 76th character boundary to test the non-default behavior&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">hstr</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">hstr</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">header_name</span><span class="o">=</span><span class="s">&#39;Subject&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hstr</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">hstr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_quopri_splittable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_quopri_splittable">[docs]</a>    <span class="k">def</span> <span class="nf">test_quopri_splittable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-8859-1?q?xxx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_x?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?x_?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?xx?=</span>
<span class="s"> =?iso-8859-1?q?_?=&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;iso-8859-1&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?iso-8859-1?q?xxxx_xxxx_xxxx_xxxx_xxx?=</span>
<span class="s"> =?iso-8859-1?q?x_xxxx_xxxx_xxxx_xxxx_?=</span>
<span class="s"> =?iso-8859-1?q?xxxx_xxxx_xxxx_xxxx_xx?=</span>
<span class="s"> =?iso-8859-1?q?xx_xxxx_xxxx_xxxx_xxxx?=</span>
<span class="s"> =?iso-8859-1?q?_xxxx_xxxx_?=&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))))</span>
</div>
<div class="viewcode-block" id="TestHeader.test_base64_splittable"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_base64_splittable">[docs]</a>    <span class="k">def</span> <span class="nf">test_base64_splittable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;koi8-r&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;xxxx &#39;</span> <span class="o">*</span> <span class="mi">20</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4?=</span>
<span class="s"> =?koi8-r?b?eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4?=</span>
<span class="s"> =?koi8-r?b?eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4?=</span>
<span class="s"> =?koi8-r?b?eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4?=</span>
<span class="s"> =?koi8-r?b?eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4?=</span>
<span class="s"> =?koi8-r?b?eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4?=</span>
<span class="s"> =?koi8-r?b?eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4?=</span>
<span class="s"> =?koi8-r?b?IA==?=&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">charset</span><span class="o">=</span><span class="s">&#39;koi8-r&#39;</span><span class="p">,</span> <span class="n">maxlinelen</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">=?koi8-r?b?eHh4eCB4eHh4IHh4eHggeHh4?=</span>
<span class="s"> =?koi8-r?b?eCB4eHh4IHh4eHggeHh4eCB4?=</span>
<span class="s"> =?koi8-r?b?eHh4IHh4eHggeHh4eCB4eHh4?=</span>
<span class="s"> =?koi8-r?b?IHh4eHggeHh4eCB4eHh4IHh4?=</span>
<span class="s"> =?koi8-r?b?eHggeHh4eCB4eHh4IHh4eHgg?=</span>
<span class="s"> =?koi8-r?b?eHh4eCB4eHh4IA==?=&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))))</span>
</div>
<div class="viewcode-block" id="TestHeader.test_us_ascii_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_us_ascii_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_us_ascii_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;hello&#39;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">make_header</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestHeader.test_string_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_string_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_string_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s">&#39;hello&#39;</span><span class="p">)</span>

<span class="c">##    def test_unicode_error(self):</span>
<span class="c">##        raises = self.assertRaises</span>
<span class="c">##        raises(UnicodeError, Header, u&#39;[P\xf6stal]&#39;, &#39;us-ascii&#39;)</span>
<span class="c">##        raises(UnicodeError, Header, &#39;[P\xf6stal]&#39;, &#39;us-ascii&#39;)</span>
<span class="c">##        h = Header()</span>
<span class="c">##        raises(UnicodeError, h.append, u&#39;[P\xf6stal]&#39;, &#39;us-ascii&#39;)</span>
<span class="c">##        raises(UnicodeError, h.append, &#39;[P\xf6stal]&#39;, &#39;us-ascii&#39;)</span>
<span class="c">##        raises(UnicodeError, Header, u&#39;\u83ca\u5730\u6642\u592b&#39;, &#39;iso-8859-1&#39;)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_utf8_shortest"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_utf8_shortest">[docs]</a>    <span class="k">def</span> <span class="nf">test_utf8_shortest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;p</span><span class="se">\xf6</span><span class="s">stal&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;=?utf-8?q?p=C3=B6stal?=&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u83ca\u5730\u6642\u592b</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;=?utf-8?b?6I+K5Zyw5pmC5aSr?=&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_bad_8bit_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_bad_8bit_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_8bit_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\x96</span><span class="s"> Earn Big&#39;</span>
        <span class="n">raises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">()</span>
        <span class="n">raises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)),</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_escaped_8bit_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_escaped_8bit_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_escaped_8bit_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\x96</span><span class="s"> Earn Big&#39;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;surrogateescape&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">charset</span><span class="o">.</span><span class="n">UNKNOWN8BIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
                        <span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\uFFFD</span><span class="s"> Earn Big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;unknown-8bit&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestHeader.test_header_handles_binary_unknown8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_header_handles_binary_unknown8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_header_handles_binary_unknown8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\x96</span><span class="s"> Earn Big&#39;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">charset</span><span class="o">.</span><span class="n">UNKNOWN8BIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
                        <span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\uFFFD</span><span class="s"> Earn Big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;unknown-8bit&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestHeader.test_make_header_handles_binary_unknown8bit"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_make_header_handles_binary_unknown8bit">[docs]</a>    <span class="k">def</span> <span class="nf">test_make_header_handles_binary_unknown8bit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\x96</span><span class="s"> Earn Big&#39;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="n">email</span><span class="o">.</span><span class="n">charset</span><span class="o">.</span><span class="n">UNKNOWN8BIT</span><span class="p">)</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">make_header</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>
                        <span class="s">&#39;Ynwp4dUEbay Auction Semiar- No Charge </span><span class="se">\uFFFD</span><span class="s"> Earn Big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;unknown-8bit&#39;</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="TestHeader.test_modify_returned_list_does_not_change_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_modify_returned_list_does_not_change_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_modify_returned_list_does_not_change_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;test2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="s">&#39;test&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_encoded_adjacent_nonencoded"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_encoded_adjacent_nonencoded">[docs]</a>    <span class="k">def</span> <span class="nf">test_encoded_adjacent_nonencoded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;iso-8859-1&#39;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;world&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;=?iso-8859-1?q?hello?= world&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">make_header</span><span class="p">(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_whitespace_keeper"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_whitespace_keeper">[docs]</a>    <span class="k">def</span> <span class="nf">test_whitespace_keeper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Subject: =?koi8-r?b?8NLP18XSy8EgzsEgxsnOwczYztk=?= =?koi8-r?q?=CA?= zz.&#39;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="p">[(</span><span class="n">b</span><span class="s">&#39;Subject: &#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf0\xd2\xcf\xd7\xc5\xd2\xcb\xc1</span><span class="s"> </span><span class="se">\xce\xc1</span><span class="s"> </span><span class="se">\xc6\xc9\xce\xc1\xcc\xd8\xce\xd9\xca</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;koi8-r&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39; zz.&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)])</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">make_header</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
           <span class="s">&#39;Subject: =?koi8-r?b?8NLP18XSy8EgzsEgxsnOwczYztnK?= zz.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_broken_base64_header"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_broken_base64_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_base64_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Subject: =?EUC-KR?B?CSixpLDtKSC/7Liuvsax4iC6uLmwMcijIKHaILzSwd/H0SC8+LCjwLsgv7W/+Mj3I ?=&#39;</span>
        <span class="n">raises</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HeaderParseError</span><span class="p">,</span> <span class="n">decode_header</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_shift_jis_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_shift_jis_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_shift_jis_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="s">&#39;文&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;shift_jis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s">&#39;=?iso-2022-jp?b?GyRCSjgbKEI=?=&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_flatten_header_with_no_value"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_flatten_header_with_no_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_flatten_header_with_no_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 11401 (regression from email 4.x)  Note that the space after</span>
        <span class="c"># the header doesn&#39;t reflect the input, but this is also the way</span>
        <span class="c"># email 4.x behaved.  At some point it would be nice to fix that.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;EmptyHeader:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="s">&quot;EmptyHeader: </span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestHeader.test_encode_preserves_leading_ws_on_value"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestHeader.test_encode_preserves_leading_ws_on_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_preserves_leading_ws_on_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">[</span><span class="s">&#39;SomeHeader&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;   value with leading ws&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="s">&quot;SomeHeader:    value with leading ws</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>



<span class="c"># Test RFC 2231 header parameters (en/de)coding</span></div></div>
<div class="viewcode-block" id="TestRFC2231"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231">[docs]</a><span class="k">class</span> <span class="nc">TestRFC2231</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_encoded_with_double_quotes</span>
    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_single_quote_inside_double_quotes</span>
<div class="viewcode-block" id="TestRFC2231.test_get_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_get_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_29.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">unquote</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&quot;&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_set_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_set_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span>
           <span class="p">(</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Return-Path: &lt;bbb@zzz.org&gt;</span>
<span class="s">Delivered-To: bbb@zzz.org</span>
<span class="s">Received: by mail.zzz.org (Postfix, from userid 889)</span>
<span class="se">\t</span><span class="s">id 27CEAD38CC; Fri,  4 May 2001 14:05:44 -0400 (EDT)</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>
<span class="s">Message-ID: &lt;15090.61304.110929.45684@aaa.zzz.org&gt;</span>
<span class="s">From: bbb@ddd.com (John X. Doe)</span>
<span class="s">To: bbb@zzz.org</span>
<span class="s">Subject: This is a test message</span>
<span class="s">Date: Fri, 4 May 2001 14:05:44 -0400</span>
<span class="s">Content-Type: text/plain; charset=us-ascii;</span>
<span class="s"> title*=us-ascii&#39;en&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more</span><span class="si">%20%</span><span class="s">2A%2A%2Afun%2A%2A%2A</span><span class="si">%20i</span><span class="s">sn%27t</span><span class="si">%20i</span><span class="s">t%21</span>


<span class="s">Hi,</span>

<span class="s">Do you like this message?</span>

<span class="s">-Me</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_set_param_requote"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_set_param_requote">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_param_requote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; title=&quot;foo&quot;&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">requote</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; title=bar&#39;</span><span class="p">)</span>
        <span class="c"># tspecial is still quoted.</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&quot;(bar)bell&quot;</span><span class="p">,</span> <span class="n">requote</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">],</span> <span class="s">&#39;text/plain; title=&quot;(bar)bell&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_del_param"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_del_param">[docs]</a>    <span class="k">def</span> <span class="nf">test_del_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndiffAssertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_01.txt&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;This is even more ***fun*** isn</span><span class="se">\&#39;</span><span class="s">t it!&#39;</span><span class="p">,</span>
            <span class="n">charset</span><span class="o">=</span><span class="s">&#39;us-ascii&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">del_param</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;Content-Type&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">78</span><span class="p">),</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Return-Path: &lt;bbb@zzz.org&gt;</span>
<span class="s">Delivered-To: bbb@zzz.org</span>
<span class="s">Received: by mail.zzz.org (Postfix, from userid 889)</span>
<span class="se">\t</span><span class="s">id 27CEAD38CC; Fri,  4 May 2001 14:05:44 -0400 (EDT)</span>
<span class="s">MIME-Version: 1.0</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>
<span class="s">Message-ID: &lt;15090.61304.110929.45684@aaa.zzz.org&gt;</span>
<span class="s">From: bbb@ddd.com (John X. Doe)</span>
<span class="s">To: bbb@zzz.org</span>
<span class="s">Subject: This is a test message</span>
<span class="s">Date: Fri, 4 May 2001 14:05:44 -0400</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;;</span>
<span class="s"> title*=us-ascii&#39;en&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more</span><span class="si">%20%</span><span class="s">2A%2A%2Afun%2A%2A%2A</span><span class="si">%20i</span><span class="s">sn%27t</span><span class="si">%20i</span><span class="s">t%21</span>


<span class="s">Hi,</span>

<span class="s">Do you like this message?</span>

<span class="s">-Me</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_encoded_charset</span>
    <span class="c"># I changed the charset name, though, because the one in the file isn&#39;t</span>
    <span class="c"># a legal charset name.  Should add a test for an illegal charset.</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_get_content_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_get_content_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_get_content_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgobj</span><span class="p">(</span><span class="s">&#39;msg_32.txt&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_charset</span><span class="p">(),</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_encoded_no_double_quotes</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_parse_rfc_quoting"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_parse_rfc_quoting">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_parse_rfc_quoting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">            Content-Disposition: inline;</span>
<span class="s">            </span><span class="se">\t</span><span class="s">filename*0*=&#39;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20;</span>
<span class="s">            </span><span class="se">\t</span><span class="s">filename*1*=%2A%2A%2Afun%2A%2A%2A%20;</span>
<span class="s">            </span><span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">            &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_encoded_with_double_quotes</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_parse_extra_quoting"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_parse_extra_quoting">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_parse_extra_quoting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">            Content-Disposition: inline;</span>
<span class="s">            </span><span class="se">\t</span><span class="s">filename*0*=&quot;&#39;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="s">            </span><span class="se">\t</span><span class="s">filename*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="s">            </span><span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">            &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_no_language_or_charset</span>
    <span class="c"># but new test uses *0* because otherwise lang/charset is not valid.</span>
    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_segmented_normal_values</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_no_language_or_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_no_language_or_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_no_language_or_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Transfer-Encoding: 8bit</span>
<span class="s">Content-Disposition: inline; filename=&quot;file____C__DOCUMENTS_20AND_20SETTINGS_FABIEN_LOCAL_20SETTINGS_TEMP_nsmail.htm&quot;</span>
<span class="s">Content-Type: text/html; NAME*0=file____C__DOCUMENTS_20AND_20SETTINGS_FABIEN_LOCAL_20SETTINGS_TEM; NAME*1=P_nsmail.htm</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;NAME&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">param</span><span class="p">,</span>
            <span class="s">&#39;file____C__DOCUMENTS_20AND_20SETTINGS_FABIEN_LOCAL_20SETTINGS_TEMP_nsmail.htm&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_encoded_no_charset</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_no_language_or_charset_in_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_no_language_or_charset_in_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_no_language_or_charset_in_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0*=&quot;&#39;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>

    <span class="c"># Duplicate of previous test?</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_no_language_or_charset_in_filename_encoded"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_no_language_or_charset_in_filename_encoded">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_no_language_or_charset_in_filename_encoded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0*=&quot;&#39;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_partly_encoded,</span>
    <span class="c"># but the test below is wrong (the first part should be decoded).</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_partly_encoded"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_partly_encoded">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_partly_encoded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0=&quot;&#39;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
            <span class="s">&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20***fun*** is it not.pdf&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_partly_nonencoded"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_partly_nonencoded">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_partly_nonencoded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0=&quot;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*1=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
            <span class="s">&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more</span><span class="si">%20%</span><span class="s">2A%2A%2Afun%2A%2A%2A</span><span class="si">%20i</span><span class="s">s it not.pdf&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_no_language_or_charset_in_boundary"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_no_language_or_charset_in_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_no_language_or_charset_in_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: multipart/alternative;</span>
<span class="se">\t</span><span class="s">boundary*0*=&quot;&#39;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">boundary*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">boundary*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_boundary</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_no_language_or_charset_in_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_no_language_or_charset_in_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_no_language_or_charset_in_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This is a nonsensical charset value, but tests the code anyway</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Type: text/plain;</span>
<span class="se">\t</span><span class="s">charset*0*=&quot;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">charset*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">charset*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_charset</span><span class="p">(),</span>
                         <span class="s">&#39;this is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_unknown_charset_treated_as_ascii</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_bad_encoding_in_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_bad_encoding_in_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_bad_encoding_in_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0*=&quot;bogus&#39;xx&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*2=&quot;is it not.pdf&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_bad_encoding_in_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_bad_encoding_in_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_bad_encoding_in_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: text/plain; charset*=bogus&#39;&#39;utf-8</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">9D</span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="c"># This should return None because non-ascii characters in the charset</span>
        <span class="c"># are not allowed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_charset</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_bad_character_in_charset"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_bad_character_in_charset">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_bad_character_in_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: text/plain; charset*=ascii&#39;&#39;utf-8</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">9D</span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="c"># This should return None because non-ascii characters in the charset</span>
        <span class="c"># are not allowed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_content_charset</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_bad_character_in_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_bad_character_in_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_bad_character_in_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0*=&quot;ascii&#39;xx&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%20e</span><span class="s">ven%20more%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*1*=&quot;%2A%2A%2Afun%2A%2A%2A%20&quot;;</span>
<span class="se">\t</span><span class="s">filename*2*=&quot;is it not.pdf</span><span class="si">%E</span><span class="s">2&quot;</span>

<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
                         <span class="s">&#39;This is even more ***fun*** is it not.pdf</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_unknown_encoding"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_unknown_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_unknown_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Transfer-Encoding: 8bit</span>
<span class="s">Content-Disposition: inline; filename*=X-UNKNOWN&#39;&#39;myfile.txt</span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span> <span class="s">&#39;myfile.txt&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_single_tick_in_filename_extended"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_single_tick_in_filename_extended">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_single_tick_in_filename_extended</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo;</span>
<span class="se">\t</span><span class="s">name*0*=</span><span class="se">\&quot;</span><span class="s">Frank&#39;s</span><span class="se">\&quot;</span><span class="s">; name*1*=</span><span class="se">\&quot;</span><span class="s"> Document</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">charset</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;Frank&#39;s Document&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_single_quote_inside_double_quotes</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_single_tick_in_filename"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_single_tick_in_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_single_tick_in_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo; name*0=</span><span class="se">\&quot;</span><span class="s">Frank&#39;s</span><span class="se">\&quot;</span><span class="s">; name*1=</span><span class="se">\&quot;</span><span class="s"> Document</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s">&quot;Frank&#39;s Document&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_missing_tick"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_missing_tick">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_missing_tick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0*=&quot;&#39;This</span><span class="si">%20i</span><span class="s">s%20broken&quot;;</span>
<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
            <span class="s">&quot;&#39;This is broken&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_missing_tick_with_encoded_non_ascii"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_missing_tick_with_encoded_non_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_missing_tick_with_encoded_non_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Content-Disposition: inline;</span>
<span class="se">\t</span><span class="s">filename*0*=&quot;&#39;This</span><span class="si">%20i</span><span class="s">s</span><span class="si">%E</span><span class="s">2broken&quot;;</span>
<span class="s">&#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(),</span>
            <span class="s">&quot;&#39;This is</span><span class="se">\ufffd</span><span class="s">broken&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_single_quote_in_value_with_charset_and_lang</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_tick_attack_extended"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_tick_attack_extended">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_tick_attack_extended</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo;</span>
<span class="se">\t</span><span class="s">name*0*=</span><span class="se">\&quot;</span><span class="s">us-ascii&#39;en-us&#39;Frank&#39;s</span><span class="se">\&quot;</span><span class="s">; name*1*=</span><span class="se">\&quot;</span><span class="s"> Document</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">charset</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="s">&#39;en-us&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;Frank&#39;s Document&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_single_quote_in_non_encoded_value</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_tick_attack"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_tick_attack">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_tick_attack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo;</span>
<span class="se">\t</span><span class="s">name*0=</span><span class="se">\&quot;</span><span class="s">us-ascii&#39;en-us&#39;Frank&#39;s</span><span class="se">\&quot;</span><span class="s">; name*1=</span><span class="se">\&quot;</span><span class="s"> Document</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s">&quot;us-ascii&#39;en-us&#39;Frank&#39;s Document&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_single_quotes_inside_quotes</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_no_extended_values"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_no_extended_values">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_no_extended_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo; name=</span><span class="se">\&quot;</span><span class="s">Frank&#39;s Document</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">),</span> <span class="s">&quot;Frank&#39;s Document&quot;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_encoded_then_unencoded_segments</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_encoded_then_unencoded_segments"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_encoded_then_unencoded_segments">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_encoded_then_unencoded_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo;</span>
<span class="se">\t</span><span class="s">name*0*=</span><span class="se">\&quot;</span><span class="s">us-ascii&#39;en-us&#39;My</span><span class="se">\&quot;</span><span class="s">;</span>
<span class="se">\t</span><span class="s">name*1=</span><span class="se">\&quot;</span><span class="s"> Document</span><span class="se">\&quot;</span><span class="s">;</span>
<span class="se">\t</span><span class="s">name*2*=</span><span class="se">\&quot;</span><span class="s"> For You</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">charset</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="s">&#39;en-us&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;My Document For You&#39;</span><span class="p">)</span>

    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_unencoded_then_encoded_segments</span>
    <span class="c"># test_headerregistry.TestContentTypeHeader.rfc2231_quoted_unencoded_then_encoded_segments</span></div>
<div class="viewcode-block" id="TestRFC2231.test_rfc2231_unencoded_then_encoded_segments"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestRFC2231.test_rfc2231_unencoded_then_encoded_segments">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2231_unencoded_then_encoded_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Content-Type: application/x-foo;</span>
<span class="se">\t</span><span class="s">name*0=</span><span class="se">\&quot;</span><span class="s">us-ascii&#39;en-us&#39;My</span><span class="se">\&quot;</span><span class="s">;</span>
<span class="se">\t</span><span class="s">name*1*=</span><span class="se">\&quot;</span><span class="s"> Document</span><span class="se">\&quot;</span><span class="s">;</span>
<span class="se">\t</span><span class="s">name*2*=</span><span class="se">\&quot;</span><span class="s"> For You</span><span class="se">\&quot;</span><span class="s"></span>

<span class="s">&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">charset</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">charset</span><span class="p">,</span> <span class="s">&#39;us-ascii&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="s">&#39;en-us&#39;</span><span class="p">)</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;My Document For You&#39;</span><span class="p">)</span>



<span class="c"># Tests to ensure that signed parts of an email are completely preserved, as</span>
<span class="c"># required by RFC1847 section 2.1.  Note that these are incomplete, because the</span>
<span class="c"># email package does not currently always preserve the body.  See issue 1670765.</span></div></div>
<div class="viewcode-block" id="TestSigned"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestSigned">[docs]</a><span class="k">class</span> <span class="nc">TestSigned</span><span class="p">(</span><span class="n">TestEmailBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_msg_and_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">openfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">original</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">original</span><span class="p">,</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">_signed_parts_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="c"># Extract the first mime part of each message</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="n">repart</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^--([^\n]+)\n(.*?)\n--\1$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="n">inpart</span> <span class="o">=</span> <span class="n">repart</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">original</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">outpart</span> <span class="o">=</span> <span class="n">repart</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">outpart</span><span class="p">,</span> <span class="n">inpart</span><span class="p">)</span>

<div class="viewcode-block" id="TestSigned.test_long_headers_as_string"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestSigned.test_long_headers_as_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_headers_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_and_obj</span><span class="p">(</span><span class="s">&#39;msg_45.txt&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signed_parts_eq</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSigned.test_long_headers_as_string_maxheaderlen"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestSigned.test_long_headers_as_string_maxheaderlen">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_headers_as_string_maxheaderlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_and_obj</span><span class="p">(</span><span class="s">&#39;msg_45.txt&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">(</span><span class="n">maxheaderlen</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signed_parts_eq</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSigned.test_long_headers_flatten"><a class="viewcode-back" href="../../../test.test_email.html#test.test_email.test_email.TestSigned.test_long_headers_flatten">[docs]</a>    <span class="k">def</span> <span class="nf">test_long_headers_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">original</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_and_obj</span><span class="p">(</span><span class="s">&#39;msg_45.txt&#39;</span><span class="p">)</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">Generator</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signed_parts_eq</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>


</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>