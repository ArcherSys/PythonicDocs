

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_imp &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_imp</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_imp</h1><div class="highlight"><pre>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">_thread</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_thread</span> <span class="o">=</span> <span class="bp">None</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">PendingDeprecationWarning</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">imp</span>


<div class="viewcode-block" id="requires_load_dynamic"><a class="viewcode-back" href="../../test.html#test.test_imp.requires_load_dynamic">[docs]</a><span class="k">def</span> <span class="nf">requires_load_dynamic</span><span class="p">(</span><span class="n">meth</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator to skip a test if not running under CPython or lacking</span>
<span class="sd">    imp.load_dynamic().&quot;&quot;&quot;</span>
    <span class="n">meth</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">cpython_only</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">imp</span><span class="p">,</span> <span class="s">&#39;load_dynamic&#39;</span><span class="p">),</span>
                           <span class="s">&#39;imp.load_dynamic() required&#39;</span><span class="p">)(</span><span class="n">meth</span><span class="p">)</span>

</div>
<span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">_thread</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;_thread module is required&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="LockTests"><a class="viewcode-back" href="../../test.html#test.test_imp.LockTests">[docs]</a><span class="k">class</span> <span class="nc">LockTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Very basic test of import lock functions.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LockTests.verify_lock_state"><a class="viewcode-back" href="../../test.html#test.test_imp.LockTests.verify_lock_state">[docs]</a>    <span class="k">def</span> <span class="nf">verify_lock_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">lock_held</span><span class="p">(),</span> <span class="n">expected</span><span class="p">,</span>
                             <span class="s">&quot;expected imp.lock_held() to be </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">expected</span><span class="p">)</span></div>
<div class="viewcode-block" id="LockTests.testLock"><a class="viewcode-back" href="../../test.html#test.test_imp.LockTests.testLock">[docs]</a>    <span class="k">def</span> <span class="nf">testLock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOOPS</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="c"># The import lock may already be held, e.g. if the test suite is run</span>
        <span class="c"># via &quot;import test.autotest&quot;.</span>
        <span class="n">lock_held_at_start</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">lock_held</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_lock_state</span><span class="p">(</span><span class="n">lock_held_at_start</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LOOPS</span><span class="p">):</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">acquire_lock</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_lock_state</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LOOPS</span><span class="p">):</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">release_lock</span><span class="p">()</span>

        <span class="c"># The original state should be restored now.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_lock_state</span><span class="p">(</span><span class="n">lock_held_at_start</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lock_held_at_start</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">imp</span><span class="o">.</span><span class="n">release_lock</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;release_lock() without lock should raise &quot;</span>
                            <span class="s">&quot;RuntimeError&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ImportTests"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests">[docs]</a><span class="k">class</span> <span class="nc">ImportTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="ImportTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;test.encoded_modules&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_strings</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">test_strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_path</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">__path__</span>
</div>
<div class="viewcode-block" id="ImportTests.test_import_encoded_module"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_import_encoded_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_import_encoded_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">teststr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_strings</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;test.encoded_modules.&#39;</span>
                                          <span class="s">&#39;module_&#39;</span> <span class="o">+</span> <span class="n">modname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">teststr</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_find_module_encoding"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_find_module_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_module_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_strings</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;module_&#39;</span> <span class="o">+</span> <span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">):</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;badsyntax_pep3120&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_issue1267"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_issue1267">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue1267</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_strings</span><span class="p">:</span>
            <span class="n">fp</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span>  <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;module_&#39;</span> <span class="o">+</span> <span class="n">mod</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">test_path</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">fp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="s">&#39;# test </span><span class="si">%s</span><span class="s"> encoding</span><span class="se">\n</span><span class="s">&#39;</span>
                                 <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>

        <span class="n">fp</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&quot;tokenize&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span>
                             <span class="s">&#39;&quot;&quot;&quot;Tokenization help for Python programs.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_issue3594"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_issue3594">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue3594</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">temp_mod_name</span> <span class="o">=</span> <span class="s">&#39;test_imp_helper&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;# coding: cp1252</span><span class="se">\n</span><span class="s">u = &#39;test.test_imp&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="nb">file</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">temp_mod_name</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&#39;cp1252&#39;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span><span class="p">)</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.pyc&#39;</span><span class="p">)</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.pyo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_issue5604"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_issue5604">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue5604</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test cannot cover imp.load_compiled function.</span>
        <span class="c"># Martin von Loewis note what shared library cannot have non-ascii</span>
        <span class="c"># character because init_xxx function cannot be compiled</span>
        <span class="c"># and issue never happens for dynamic modules.</span>
        <span class="c"># But sources modified to follow generic way for processing pathes.</span>

        <span class="c"># the return encoding could be uppercase or None</span>
        <span class="n">fs_encoding</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getfilesystemencoding</span><span class="p">()</span>

        <span class="c"># covers utf-8 and Windows ANSI code pages</span>
        <span class="c"># one non-space symbol from every page</span>
        <span class="c"># (http://en.wikipedia.org/wiki/Code_page)</span>
        <span class="n">known_locales</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;utf-8&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc3\xa4</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1250&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x8C</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1251&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1252&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1253&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc1</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1254&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1255&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1256&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1257&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;cp1258&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc0</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fs_encoding</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="c"># Mac OS X uses the Normal Form D decomposition</span>
            <span class="c"># http://developer.apple.com/mac/library/qa/qa2001/qa1173.html</span>
            <span class="n">special_char</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;a</span><span class="se">\xcc\x88</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">special_char</span> <span class="o">=</span> <span class="n">known_locales</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fs_encoding</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">special_char</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;can&#39;t run this test with </span><span class="si">%s</span><span class="s"> as filesystem encoding&quot;</span>
                          <span class="o">%</span> <span class="n">fs_encoding</span><span class="p">)</span>
        <span class="n">decoded_char</span> <span class="o">=</span> <span class="n">special_char</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">fs_encoding</span><span class="p">)</span>
        <span class="n">temp_mod_name</span> <span class="o">=</span> <span class="s">&#39;test_imp_helper_&#39;</span> <span class="o">+</span> <span class="n">decoded_char</span>
        <span class="n">test_package_name</span> <span class="o">=</span> <span class="s">&#39;test_imp_helper_package_&#39;</span> <span class="o">+</span> <span class="n">decoded_char</span>
        <span class="n">init_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_package_name</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># if the curdir is not in sys.path the test fails when run with</span>
            <span class="c"># ./python ./Lib/test/regrtest.py test_imp</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;a = 1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">temp_mod_name</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">temp_mod_name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;.py&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">imp</span><span class="o">.</span><span class="n">PY_SOURCE</span><span class="p">)</span>

                <span class="n">mod</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">temp_mod_name</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="n">temp_mod_name</span><span class="p">,</span> <span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span><span class="p">:</span>
                    <span class="n">mod</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_compiled</span><span class="p">(</span>
                        <span class="n">temp_mod_name</span><span class="p">,</span>
                        <span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_package_name</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">test_package_name</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_file_name</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;b = 2</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="n">package</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_package</span><span class="p">(</span><span class="n">test_package_name</span><span class="p">,</span> <span class="n">test_package_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">,</span> <span class="s">&#39;.pyc&#39;</span><span class="p">,</span> <span class="s">&#39;.pyo&#39;</span><span class="p">):</span>
                <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_mod_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
                <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">init_file_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">test_package_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_issue9319"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_issue9319">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue9319</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span>
                          <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">,</span> <span class="s">&quot;badsyntax_pep3120&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTests.test_load_from_source"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_load_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that the imp module can correctly load and find .py files</span>
        <span class="c"># XXX (ncoghlan): It would be nice to use support.CleanImport</span>
        <span class="c"># here, but that breaks because the os module registers some</span>
        <span class="c"># handlers in copy_reg on import. Since CleanImport doesn&#39;t</span>
        <span class="c"># revert that registration, the module is left in a broken</span>
        <span class="c"># state after reversion. Reinitialising the module contents</span>
        <span class="c"># and just reverting os.environ to its previous state is an OK</span>
        <span class="c"># workaround</span>
        <span class="n">orig_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span>
        <span class="n">orig_getenv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">EnvironmentVarGuard</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&quot;os&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">new_os</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s">&quot;os&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">new_os</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">orig_path</span><span class="p">,</span> <span class="n">new_os</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">orig_getenv</span><span class="p">,</span> <span class="n">new_os</span><span class="o">.</span><span class="n">getenv</span><span class="p">)</span>
</div>
    <span class="nd">@requires_load_dynamic</span>
<div class="viewcode-block" id="ImportTests.test_issue15828_load_extensions"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_issue15828_load_extensions">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue15828_load_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 15828 picked up that the adapter between the old imp API</span>
        <span class="c"># and importlib couldn&#39;t handle C extensions</span>
        <span class="n">example</span> <span class="o">=</span> <span class="s">&quot;_heapq&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
        <span class="n">file_</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">file_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">file_</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">example</span><span class="p">)</span>
</div>
    <span class="nd">@requires_load_dynamic</span>
<div class="viewcode-block" id="ImportTests.test_issue16421_multiple_modules_in_one_dll"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_issue16421_multiple_modules_in_one_dll">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue16421_multiple_modules_in_one_dll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 16421: loading several modules from the same compiled file fails</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;_testimportmultiple&#39;</span>
        <span class="n">fileobj</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">fileobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mod0</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_dynamic</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span>
        <span class="n">mod1</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_dynamic</span><span class="p">(</span><span class="s">&#39;_testimportmultiple_foo&#39;</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span>
        <span class="n">mod2</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_dynamic</span><span class="p">(</span><span class="s">&#39;_testimportmultiple_bar&#39;</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod0</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod1</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;_testimportmultiple_foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod2</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;_testimportmultiple_bar&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">load_dynamic</span><span class="p">(</span><span class="s">&#39;nonexistent&#39;</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span>
</div>
    <span class="nd">@requires_load_dynamic</span>
<div class="viewcode-block" id="ImportTests.test_load_dynamic_ImportError_path"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_load_dynamic_ImportError_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_dynamic_ImportError_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #1559549 added `name` and `path` attributes to ImportError</span>
        <span class="c"># in order to provide better detail. Issue #10854 implemented those</span>
        <span class="c"># attributes on import failures of extensions on Windows.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;bogus file path&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;extension&#39;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">load_dynamic</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
    <span class="nd">@requires_load_dynamic</span>
<div class="viewcode-block" id="ImportTests.test_load_module_extension_file_is_None"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_load_module_extension_file_is_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_module_extension_file_is_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When loading an extension module and the file is None, open one</span>
        <span class="c"># on the behalf of imp.load_dynamic().</span>
        <span class="c"># Issue #15902</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;_testimportmultiple&#39;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">imp</span><span class="o">.</span><span class="n">C_EXTENSION</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;found module doesn&#39;t appear to be a C extension&quot;</span><span class="p">)</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">found</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span><span class="p">,</span>
        <span class="s">&quot;test meaningful only when writing bytecode&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="ImportTests.test_bug7732"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_bug7732">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug7732</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">temp_cwd</span><span class="p">():</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="s">&#39;^No module&#39;</span><span class="p">,</span>
                <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">,</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;.&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTests.test_multiple_calls_to_get_data"><a class="viewcode-back" href="../../test.html#test.test_imp.ImportTests.test_multiple_calls_to_get_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_calls_to_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #18755: make sure multiple calls to get_data() can succeed.</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">_LoadSourceCompatibility</span><span class="p">(</span><span class="s">&#39;imp&#39;</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span>
                                              <span class="nb">open</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">__file__</span><span class="p">))</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>  <span class="c"># File should be closed</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>  <span class="c"># Will need to create a newly opened file</span>

</div></div>
<div class="viewcode-block" id="ReloadTests"><a class="viewcode-back" href="../../test.html#test.test_imp.ReloadTests">[docs]</a><span class="k">class</span> <span class="nc">ReloadTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Very basic tests to make sure that imp.reload() operates just like</span>
<span class="sd">    reload().&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ReloadTests.test_source"><a class="viewcode-back" href="../../test.html#test.test_imp.ReloadTests.test_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># XXX (ncoghlan): It would be nice to use test.support.CleanImport</span>
        <span class="c"># here, but that breaks because the os module registers some</span>
        <span class="c"># handlers in copy_reg on import. Since CleanImport doesn&#39;t</span>
        <span class="c"># revert that registration, the module is left in a broken</span>
        <span class="c"># state after reversion. Reinitialising the module contents</span>
        <span class="c"># and just reverting os.environ to its previous state is an OK</span>
        <span class="c"># workaround</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">EnvironmentVarGuard</span><span class="p">():</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReloadTests.test_extension"><a class="viewcode-back" href="../../test.html#test.test_imp.ReloadTests.test_extension">[docs]</a>    <span class="k">def</span> <span class="nf">test_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">CleanImport</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">time</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReloadTests.test_builtin"><a class="viewcode-back" href="../../test.html#test.test_imp.ReloadTests.test_builtin">[docs]</a>    <span class="k">def</span> <span class="nf">test_builtin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">CleanImport</span><span class="p">(</span><span class="s">&#39;marshal&#39;</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">marshal</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">marshal</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReloadTests.test_with_deleted_parent"><a class="viewcode-back" href="../../test.html#test.test_imp.ReloadTests.test_with_deleted_parent">[docs]</a>    <span class="k">def</span> <span class="nf">test_with_deleted_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># see #18681</span>
        <span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">parser</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;html&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">cleanup</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="s">&#39;html&#39;</span><span class="p">):</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PEP3147Tests"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests">[docs]</a><span class="k">class</span> <span class="nc">PEP3147Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests of PEP 3147.&quot;&quot;&quot;</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">get_tag</span><span class="p">()</span>

    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">cache_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="s">&#39;requires sys.implementation.cache_tag not be None&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_cache_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given the path to a .py file, return the path to its PEP 3147</span>
        <span class="c"># defined .pyc file (i.e. under __pycache__).</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;qux.py&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                              <span class="s">&#39;qux.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_no_cache_tag"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_cache_from_source_no_cache_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_no_cache_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Non cache tag means NotImplementedError.</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">swap_attr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="p">,</span> <span class="s">&#39;cache_tag&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
                <span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s">&#39;whatever.py&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_no_dot"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_cache_from_source_no_dot">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_no_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Directory with a dot, filename without dot.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;file&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                              <span class="s">&#39;file{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_optimized"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_cache_from_source_optimized">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_optimized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given the path to a .py file, return the path to its PEP 3147</span>
        <span class="c"># defined .pyo file (i.e. under __pycache__).</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;qux.py&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                              <span class="s">&#39;qux.{}.pyo&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_cwd"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_cache_from_source_cwd">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;foo.py&#39;</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s">&#39;foo.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_override"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_cache_from_source_override">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When debug_override is not None, it can be any true-ish or false-ish</span>
        <span class="c"># value.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz.py&#39;</span><span class="p">)</span>
        <span class="n">partial_expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;baz.{}.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[]),</span> <span class="n">partial_expect</span> <span class="o">+</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="mi">17</span><span class="p">]),</span>
                         <span class="n">partial_expect</span> <span class="o">+</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="c"># However if the bool-ishness can&#39;t be determined, the exception</span>
        <span class="c"># propagates.</span>
        <span class="k">class</span> <span class="nc">Bearish</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">RuntimeError</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s">&#39;/foo/bar/baz.py&#39;</span><span class="p">,</span> <span class="n">Bearish</span><span class="p">())</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
                     <span class="s">&#39;test meaningful only where os.altsep is defined&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PEP3147Tests.test_sep_altsep_and_sep_cache_from_source"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_sep_altsep_and_sep_cache_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_sep_altsep_and_sep_cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Windows path and PEP 3147 where sep is right of altsep.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">foo</span><span class="se">\\</span><span class="s">bar</span><span class="se">\\</span><span class="s">baz/qux.py&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="s">&#39;</span><span class="se">\\</span><span class="s">foo</span><span class="se">\\</span><span class="s">bar</span><span class="se">\\</span><span class="s">baz</span><span class="se">\\</span><span class="s">__pycache__</span><span class="se">\\</span><span class="s">qux.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">cache_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="s">&#39;requires sys.implementation.cache_tag to not be &#39;</span>
                         <span class="s">&#39;None&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given the path to a PEP 3147 defined .pyc file, return the path to</span>
        <span class="c"># its source.  This tests the good path.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                            <span class="s">&#39;qux.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;qux.py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_no_cache_tag"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache_no_cache_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_no_cache_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If sys.implementation.cache_tag is None, raise NotImplementedError.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s">&#39;whatever.pyc&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">swap_attr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="p">,</span> <span class="s">&#39;cache_tag&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
                <span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_bad_path"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache_bad_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_bad_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When the path to a pyc file is not in PEP 3147 format, a ValueError</span>
        <span class="c"># is raised.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span> <span class="s">&#39;/foo/bar/bazqux.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_no_slash"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache_no_slash">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_no_slash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No slashes at all in path -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span> <span class="s">&#39;foo.cpython-32.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_too_few_dots"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache_too_few_dots">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_too_few_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Too few dots in final path component -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span> <span class="s">&#39;__pycache__/foo.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_too_many_dots"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache_too_many_dots">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_too_many_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Too many dots in final path component -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span>
            <span class="s">&#39;__pycache__/foo.cpython-32.foo.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_no__pycache__"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_source_from_cache_no__pycache__">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_no__pycache__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Another problem with the path -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span>
            <span class="s">&#39;/foo/bar/foo.cpython-32.foo.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_package___file__"><a class="viewcode-back" href="../../test.html#test.test_imp.PEP3147Tests.test_package___file__">[docs]</a>    <span class="k">def</span> <span class="nf">test_package___file__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;pep3147 module already exists: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,))</span>
        <span class="c"># Test that a package&#39;s __file__ points to the right source directory.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">cleanup</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>
        <span class="c"># Touch the __init__.py file.</span>
        <span class="n">support</span><span class="o">.</span><span class="n">create_empty_file</span><span class="p">(</span><span class="s">&#39;pep3147/__init__.py&#39;</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">expected___file__</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span> <span class="n">expected___file__</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">__path__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="p">))</span>
        <span class="c"># Ensure we load the pyc file.</span>
        <span class="n">support</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="n">support</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span> <span class="n">expected___file__</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">__path__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="NullImporterTests"><a class="viewcode-back" href="../../test.html#test.test_imp.NullImporterTests">[docs]</a><span class="k">class</span> <span class="nc">NullImporterTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN_UNENCODABLE</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&quot;Need an undecodeable filename&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="NullImporterTests.test_unencodeable"><a class="viewcode-back" href="../../test.html#test.test_imp.NullImporterTests.test_unencodeable">[docs]</a>    <span class="k">def</span> <span class="nf">test_unencodeable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN_UNENCODABLE</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">NullImporter</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>