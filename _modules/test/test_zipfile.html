

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_zipfile &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_zipfile</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_zipfile</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">unittest</span>


<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryFile</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">getrandbits</span>

<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">findfile</span><span class="p">,</span> <span class="n">unlink</span><span class="p">,</span> <span class="n">rmtree</span><span class="p">,</span>
                          <span class="n">requires_zlib</span><span class="p">,</span> <span class="n">requires_bz2</span><span class="p">,</span> <span class="n">requires_lzma</span><span class="p">,</span>
                          <span class="n">captured_stdout</span><span class="p">,</span> <span class="n">check_warnings</span><span class="p">)</span>

<span class="n">TESTFN2</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;2&quot;</span>
<span class="n">TESTFNDIR</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;d&quot;</span>
<span class="n">FIXEDTEST_SIZE</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">DATAFILES_DIR</span> <span class="o">=</span> <span class="s">&#39;zipfile_datafiles&#39;</span>

<span class="n">SMALL_TEST_DATA</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;_ziptest1&#39;</span><span class="p">,</span> <span class="s">&#39;1q2w3e4r5t&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s">&#39;ziptest2dir/_ziptest2&#39;</span><span class="p">,</span> <span class="s">&#39;qawsedrftg&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s">&#39;ziptest2dir/ziptest3dir/_ziptest3&#39;</span><span class="p">,</span> <span class="s">&#39;azsxdcfvgb&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s">&#39;ziptest2dir/ziptest3dir/ziptest4dir/_ziptest3&#39;</span><span class="p">,</span> <span class="s">&#39;6y7u8i9o0p&#39;</span><span class="p">)]</span>

<div class="viewcode-block" id="get_files"><a class="viewcode-back" href="../../test.html#test.test_zipfile.get_files">[docs]</a><span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">test</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">TESTFN2</span>
    <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">f</span>
        <span class="n">test</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">f</span>
        <span class="n">test</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="openU"><a class="viewcode-back" href="../../test.html#test.test_zipfile.openU">[docs]</a><span class="k">def</span> <span class="nf">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;rU&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile">[docs]</a><span class="k">class</span> <span class="nc">AbstractTestsWithSourceFile</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.setUpClass"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.setUpClass">[docs]</a>    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">line_gen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&quot;Zipfile test line </span><span class="si">%d</span><span class="s">. random float: </span><span class="si">%f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">random</span><span class="p">()),</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)]</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">line_gen</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Make a source file with some lines</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.make_test_archive"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.make_test_archive">[docs]</a>    <span class="k">def</span> <span class="nf">make_test_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c"># Print the ZIP directory</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">printdir</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="c"># Number of files + header</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;File Name&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;Modified&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;Size&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">fn</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time_</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;another.name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time_</span><span class="p">,</span> <span class="s">&#39;%H:%M:%S&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>

            <span class="c"># Check the namelist</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

            <span class="c"># Check infolist</span>
            <span class="n">infos</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

            <span class="c"># check getinfo</span>
            <span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="s">&quot;strfile&quot;</span><span class="p">):</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">nm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

            <span class="c"># Check that testzip doesn&#39;t raise an exception</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">testzip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_basic"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_basic">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_open_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_open_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_open_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipdata1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen1</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">zipdata1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

            <span class="n">zipdata2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen2</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">zipdata2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_open"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_open_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_random_open_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_random_open_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_random_open_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipdata1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen1</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">zipdata1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_random_open"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_random_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_random_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_random_open_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_read1_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_read1_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_read1_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">,</span> \
             <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
            <span class="n">zipdata</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read1</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">zipdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_read1"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_read1">[docs]</a>    <span class="k">def</span> <span class="nf">test_read1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_read1_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_read1_10_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_read1_10_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_read1_10_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">,</span> \
             <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
            <span class="n">zipdata</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read1</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">read_data</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">zipdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_read1_10"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_read1_10">[docs]</a>    <span class="k">def</span> <span class="nf">test_read1_10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_read1_10_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_readline_read_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_readline_read_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_readline_read_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">,</span> \
             <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">read</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">read</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">read</span>

                <span class="n">read</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">read</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">read</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_readline_read"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_readline_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #7610: calls to readline() interleaved with calls to read().</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_readline_read_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_readline_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_readline_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_readline_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_gen</span><span class="p">:</span>
                    <span class="n">linedata</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">linedata</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_readline"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_readline_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_readlines_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_readlines_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_readlines_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="n">ziplines</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">zipline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_gen</span><span class="p">,</span> <span class="n">ziplines</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipline</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_readlines"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_readlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_readlines_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.zip_iterlines_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.zip_iterlines_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_iterlines_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">zipline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_gen</span><span class="p">,</span> <span class="n">zipopen</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipline</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_iterlines"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_iterlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_iterlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_iterlines_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_low_compression"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_low_compression">[docs]</a>    <span class="k">def</span> <span class="nf">test_low_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check for cases where compressed data is larger than original.&quot;&quot;&quot;</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="s">&#39;12&#39;</span><span class="p">)</span>

        <span class="c"># Get an open object for strfile</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">openobj</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">openobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">openobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;2&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_writestr_compression"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_writestr_compression">[docs]</a>    <span class="k">def</span> <span class="nf">test_writestr_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zipfp</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;b.txt&quot;</span><span class="p">,</span> <span class="s">&quot;hello world&quot;</span><span class="p">,</span> <span class="n">compress_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="s">&#39;b.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">compress_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_read_return_size"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_read_return_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_return_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #9837: ZipExtFile.read() shouldn&#39;t return more bytes</span>
        <span class="c"># than requested.</span>
        <span class="k">for</span> <span class="n">test_size</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="mi">4097</span><span class="p">,</span> <span class="mi">16384</span><span class="p">):</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">test_size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">junk</span> <span class="o">=</span> <span class="n">getrandbits</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">file_size</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">file_size</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
                <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">junk</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">buf</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">test_size</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">test_size</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.test_truncated_zipfile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.test_truncated_zipfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_truncated_zipfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;strfile&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">compress_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
            <span class="n">end_offset</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">zipfiledata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipfiledata</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;strfile&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">end_offset</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">EOFError</span><span class="p">):</span>
                    <span class="n">zipopen</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipfiledata</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;strfile&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">end_offset</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">EOFError</span><span class="p">):</span>
                    <span class="k">while</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
                        <span class="k">pass</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipfiledata</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;strfile&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">end_offset</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">EOFError</span><span class="p">):</span>
                    <span class="k">while</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read1</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
                        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithSourceFile.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithSourceFile.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="StoredTestsWithSourceFile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile">[docs]</a><span class="k">class</span> <span class="nc">StoredTestsWithSourceFile</span><span class="p">(</span><span class="n">AbstractTestsWithSourceFile</span><span class="p">,</span>
                                <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>
    <span class="n">test_low_compression</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="StoredTestsWithSourceFile.zip_test_writestr_permissions"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.zip_test_writestr_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">zip_test_writestr_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="c"># Make sure that writestr creates files with mode 0600,</span>
        <span class="c"># when it is passed a name rather than a ZipInfo instance.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zinfo</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="s">&#39;strfile&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zinfo</span><span class="o">.</span><span class="n">external_attr</span><span class="p">,</span> <span class="mi">0</span><span class="n">o600</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_writestr_permissions"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_writestr_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">test_writestr_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_test_writestr_permissions</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_absolute_arcnames"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_absolute_arcnames">[docs]</a>    <span class="k">def</span> <span class="nf">test_absolute_arcnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;/absolute&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">(),</span> <span class="p">[</span><span class="s">&quot;absolute&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_append_to_zip_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_append_to_zip_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_append_to_zip_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test appending to an existing zipfile.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">(),</span> <span class="p">[</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;strfile&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_append_to_non_zip_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_append_to_non_zip_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_append_to_non_zip_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test appending to an existing file that is not a zipfile.&quot;&quot;&quot;</span>
        <span class="c"># NOTE: this test fails if len(d) &lt; 22 because of the first</span>
        <span class="c"># line &quot;fpin.seek(-22, 2)&quot; in _EndRecData</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;I am not a ZipFile!&#39;</span><span class="o">*</span><span class="mi">10</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">(),</span> <span class="p">[</span><span class="n">TESTFN</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_ignores_newline_at_end"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_ignores_newline_at_end">[docs]</a>    <span class="k">def</span> <span class="nf">test_ignores_newline_at_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n\00\00\00</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_ignores_stuff_appended_past_comments"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_ignores_stuff_appended_past_comments">[docs]</a>    <span class="k">def</span> <span class="nf">test_ignores_stuff_appended_past_comments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;this is a comment&quot;</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;abcdef</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;this is a comment&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_write_default_name"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_write_default_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_default_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that calling ZipFile.write without arcname specified</span>
<span class="sd">        produces the expected result.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_write_to_readonly"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_write_to_readonly">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_to_readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that trying to call write() on a readonly ZipFile object</span>
<span class="sd">        raises a RuntimeError.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;somefile.txt&quot;</span><span class="p">,</span> <span class="s">&quot;bogus&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestsWithSourceFile.test_add_file_before_1980"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithSourceFile.test_add_file_before_1980">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_file_before_1980</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Set atime and mtime to 1970-01-01</span>
        <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>

</div></div>
<span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="DeflateTestsWithSourceFile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DeflateTestsWithSourceFile">[docs]</a><span class="k">class</span> <span class="nc">DeflateTestsWithSourceFile</span><span class="p">(</span><span class="n">AbstractTestsWithSourceFile</span><span class="p">,</span>
                                 <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>

<div class="viewcode-block" id="DeflateTestsWithSourceFile.test_per_file_compression"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DeflateTestsWithSourceFile.test_per_file_compression">[docs]</a>    <span class="k">def</span> <span class="nf">test_per_file_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that files within a Zip archive can have different</span>
<span class="sd">        compression options.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;storeme&#39;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;deflateme&#39;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span>
            <span class="n">sinfo</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="s">&#39;storeme&#39;</span><span class="p">)</span>
            <span class="n">dinfo</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="s">&#39;deflateme&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sinfo</span><span class="o">.</span><span class="n">compress_type</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dinfo</span><span class="o">.</span><span class="n">compress_type</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span>
</div></div>
<span class="nd">@requires_bz2</span>
<div class="viewcode-block" id="Bzip2TestsWithSourceFile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.Bzip2TestsWithSourceFile">[docs]</a><span class="k">class</span> <span class="nc">Bzip2TestsWithSourceFile</span><span class="p">(</span><span class="n">AbstractTestsWithSourceFile</span><span class="p">,</span>
                               <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_BZIP2</span>
</div>
<span class="nd">@requires_lzma</span>
<div class="viewcode-block" id="LzmaTestsWithSourceFile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.LzmaTestsWithSourceFile">[docs]</a><span class="k">class</span> <span class="nc">LzmaTestsWithSourceFile</span><span class="p">(</span><span class="n">AbstractTestsWithSourceFile</span><span class="p">,</span>
                              <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_LZMA</span>

</div>
<div class="viewcode-block" id="AbstractTestZip64InSmallFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestZip64InSmallFiles">[docs]</a><span class="k">class</span> <span class="nc">AbstractTestZip64InSmallFiles</span><span class="p">:</span>
    <span class="c"># These tests test the ZIP64 functionality without using large files,</span>
    <span class="c"># see test_zipfile64 for proper tests.</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AbstractTestZip64InSmallFiles.setUpClass"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestZip64InSmallFiles.setUpClass">[docs]</a>    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">line_gen</span> <span class="o">=</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&quot;Test of zipfile line </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FIXEDTEST_SIZE</span><span class="p">))</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_gen</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestZip64InSmallFiles.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestZip64InSmallFiles.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP64_LIMIT</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP64_LIMIT</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="c"># Make a source file with some lines</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestZip64InSmallFiles.zip_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestZip64InSmallFiles.zip_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">allowZip64</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c"># Print the ZIP directory</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">printdir</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

            <span class="n">directory</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="c"># Number of files + header</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;File Name&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;Modified&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;Size&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">fn</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time_</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;another.name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time_</span><span class="p">,</span> <span class="s">&#39;%H:%M:%S&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>

            <span class="c"># Check the namelist</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

            <span class="c"># Check infolist</span>
            <span class="n">infos</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;strfile&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

            <span class="c"># check getinfo</span>
            <span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="s">&quot;strfile&quot;</span><span class="p">):</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">nm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

            <span class="c"># Check that testzip doesn&#39;t raise an exception</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">testzip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AbstractTestZip64InSmallFiles.test_basic"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestZip64InSmallFiles.test_basic">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestZip64InSmallFiles.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestZip64InSmallFiles.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP64_LIMIT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="StoredTestZip64InSmallFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestZip64InSmallFiles">[docs]</a><span class="k">class</span> <span class="nc">StoredTestZip64InSmallFiles</span><span class="p">(</span><span class="n">AbstractTestZip64InSmallFiles</span><span class="p">,</span>
                                  <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>

<div class="viewcode-block" id="StoredTestZip64InSmallFiles.large_file_exception_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestZip64InSmallFiles.large_file_exception_test">[docs]</a>    <span class="k">def</span> <span class="nf">large_file_exception_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">allowZip64</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">LargeZipFile</span><span class="p">,</span>
                              <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestZip64InSmallFiles.large_file_exception_test2"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestZip64InSmallFiles.large_file_exception_test2">[docs]</a>    <span class="k">def</span> <span class="nf">large_file_exception_test2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">allowZip64</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">LargeZipFile</span><span class="p">,</span>
                              <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestZip64InSmallFiles.test_large_file_exception"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestZip64InSmallFiles.test_large_file_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_large_file_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">large_file_exception_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">large_file_exception_test2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StoredTestZip64InSmallFiles.test_absolute_arcnames"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestZip64InSmallFiles.test_absolute_arcnames">[docs]</a>    <span class="k">def</span> <span class="nf">test_absolute_arcnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">,</span>
                             <span class="n">allowZip64</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;/absolute&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">(),</span> <span class="p">[</span><span class="s">&quot;absolute&quot;</span><span class="p">])</span>
</div></div>
<span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="DeflateTestZip64InSmallFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DeflateTestZip64InSmallFiles">[docs]</a><span class="k">class</span> <span class="nc">DeflateTestZip64InSmallFiles</span><span class="p">(</span><span class="n">AbstractTestZip64InSmallFiles</span><span class="p">,</span>
                                   <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>
</div>
<span class="nd">@requires_bz2</span>
<div class="viewcode-block" id="Bzip2TestZip64InSmallFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.Bzip2TestZip64InSmallFiles">[docs]</a><span class="k">class</span> <span class="nc">Bzip2TestZip64InSmallFiles</span><span class="p">(</span><span class="n">AbstractTestZip64InSmallFiles</span><span class="p">,</span>
                                 <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_BZIP2</span>
</div>
<span class="nd">@requires_lzma</span>
<div class="viewcode-block" id="LzmaTestZip64InSmallFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.LzmaTestZip64InSmallFiles">[docs]</a><span class="k">class</span> <span class="nc">LzmaTestZip64InSmallFiles</span><span class="p">(</span><span class="n">AbstractTestZip64InSmallFiles</span><span class="p">,</span>
                                <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_LZMA</span>

</div>
<div class="viewcode-block" id="PyZipFileTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests">[docs]</a><span class="k">class</span> <span class="nc">PyZipFileTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="PyZipFileTests.assertCompiledIn"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.assertCompiledIn">[docs]</a>    <span class="k">def</span> <span class="nf">assertCompiledIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">namelist</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;o&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">namelist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">namelist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_pyfile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_pyfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_pyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">__file__</span>
            <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pyc&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pyo&#39;</span><span class="p">):</span>
                <span class="n">path_split</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">path_split</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">altsep</span><span class="p">))</span>
                <span class="k">if</span> <span class="s">&#39;__pycache__&#39;</span> <span class="ow">in</span> <span class="n">path_split</span><span class="p">:</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

            <span class="n">bn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>

        <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">__file__</span>
            <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s">&#39;.pyc&#39;</span><span class="p">,</span> <span class="s">&#39;.pyo&#39;</span><span class="p">)):</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&quot;testpackage&quot;</span><span class="p">)</span>

            <span class="n">bn</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;testpackage&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_python_package"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_python_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_python_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">email</span>
        <span class="n">packagedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">packagedir</span><span class="p">)</span>

            <span class="c"># Check for a couple of modules at different levels of the</span>
            <span class="c"># hierarchy</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="s">&#39;email/__init__.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="s">&#39;email/mime/text.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_filtered_python_package"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_filtered_python_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_filtered_python_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">test</span>
        <span class="n">packagedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>

            <span class="c"># first make sure that the test folder gives error messages</span>
            <span class="c"># (on the badsyntax_... files)</span>
            <span class="k">with</span> <span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">reportSIO</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">packagedir</span><span class="p">)</span>
            <span class="n">reportStr</span> <span class="o">=</span> <span class="n">reportSIO</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;SyntaxError&#39;</span> <span class="ow">in</span> <span class="n">reportStr</span><span class="p">)</span>

            <span class="c"># then check that the filter works on the whole package</span>
            <span class="k">with</span> <span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">reportSIO</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">packagedir</span><span class="p">,</span> <span class="n">filterfunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">whatever</span><span class="p">:</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">reportStr</span> <span class="o">=</span> <span class="n">reportSIO</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;SyntaxError&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reportStr</span><span class="p">)</span>

            <span class="c"># then check that the filter works on individual files</span>
            <span class="k">with</span> <span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">reportSIO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">packagedir</span><span class="p">,</span> <span class="n">filterfunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">fn</span><span class="p">:</span>
                                                     <span class="s">&#39;bad&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fn</span><span class="p">)</span>
            <span class="n">reportStr</span> <span class="o">=</span> <span class="n">reportSIO</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">reportStr</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">reportStr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;SyntaxError&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reportStr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_with_optimization"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_with_optimization">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_with_optimization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">email</span>
        <span class="n">packagedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
        <span class="c"># use .pyc if running test in optimization mode,</span>
        <span class="c"># use .pyo if running test in debug mode</span>
        <span class="n">optlevel</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">__debug__</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s">&#39;.pyo&#39;</span> <span class="k">if</span> <span class="n">optlevel</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&#39;.pyc&#39;</span>

        <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> \
             <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="n">optlevel</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">packagedir</span><span class="p">)</span>

            <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;email/__init__&#39;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;email/mime/text&#39;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_python_directory"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_python_directory">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_python_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod1.py&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;print(42)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod2.py&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;print(42 * 42)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod2.txt&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;bla bla bla</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

                <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="s">&#39;mod1.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="s">&#39;mod2.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;mod2.txt&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_python_directory_filtered"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_python_directory_filtered">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_python_directory_filtered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod1.py&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;print(42)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod2.py&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;print(42 * 42)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="n">filterfunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">fn</span><span class="p">:</span>
                                                  <span class="ow">not</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;mod2.py&#39;</span><span class="p">))</span>

                <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertCompiledIn</span><span class="p">(</span><span class="s">&#39;mod1.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;mod2.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_non_pyfile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_non_pyfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_non_pyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;most definitely not a python file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PyZipFileTests.test_write_pyfile_bad_syntax"><a class="viewcode-back" href="../../test.html#test.test_zipfile.PyZipFileTests.test_write_pyfile_bad_syntax">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_pyfile_bad_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod1.py&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Bad syntax in python file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">TemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">PyZipFile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="c"># syntax errors are printed to stdout</span>
                <span class="k">with</span> <span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">zipfp</span><span class="o">.</span><span class="n">writepy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;mod1.py&quot;</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;SyntaxError&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

                <span class="c"># as it will not have compiled the python file, it will</span>
                <span class="c"># include the .py file not .pyc or .pyo</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;mod1.py&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;mod1.pyc&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;mod1.pyo&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ExtractTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests">[docs]</a><span class="k">class</span> <span class="nc">ExtractTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="ExtractTests.test_extract"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.test_extract">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span> <span class="ow">in</span> <span class="n">SMALL_TEST_DATA</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span> <span class="ow">in</span> <span class="n">SMALL_TEST_DATA</span><span class="p">:</span>
                <span class="n">writtenfile</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

                <span class="c"># make sure it was written to the right place</span>
                <span class="n">correctfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">fpath</span><span class="p">)</span>
                <span class="n">correctfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">correctfile</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">writtenfile</span><span class="p">,</span> <span class="n">correctfile</span><span class="p">)</span>

                <span class="c"># make sure correct data is in correct file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">writtenfile</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

                <span class="n">unlink</span><span class="p">(</span><span class="n">writtenfile</span><span class="p">)</span>

        <span class="c"># remove the test file subdirectories</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&#39;ziptest2dir&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ExtractTests.test_extract_all"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.test_extract_all">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span> <span class="ow">in</span> <span class="n">SMALL_TEST_DATA</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span> <span class="ow">in</span> <span class="n">SMALL_TEST_DATA</span><span class="p">:</span>
                <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">fpath</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

                <span class="n">unlink</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>

        <span class="c"># remove the test file subdirectories</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&#39;ziptest2dir&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ExtractTests.check_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.check_file">[docs]</a>    <span class="k">def</span> <span class="nf">check_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">content</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExtractTests.test_sanitize_windows_name"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.test_sanitize_windows_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_sanitize_windows_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">san</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="o">.</span><span class="n">_sanitize_windows_name</span>
        <span class="c"># Passing pathsep in allows this test to work regardless of platform.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">san</span><span class="p">(</span><span class="s">r&#39;,,?,C:,foo,bar/z&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">),</span> <span class="s">r&#39;_,C_,foo,bar/z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">san</span><span class="p">(</span><span class="s">r&#39;a\b,c&lt;d&gt;e|f&quot;g?h*i&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">),</span> <span class="s">r&#39;a\b,c_d_e_f_g_h_i&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">san</span><span class="p">(</span><span class="s">&#39;../../foo../../ba..r&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="s">r&#39;foo/ba..r&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExtractTests.test_extract_hackers_arcnames_common_cases"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.test_extract_hackers_arcnames_common_cases">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_hackers_arcnames_common_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">common_hacknames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;../foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;foo/../bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;foo/../../bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;foo/bar/..&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;./../foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;/foo/../bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;/foo/../../bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_extract_hackers_arcnames</span><span class="p">(</span><span class="n">common_hacknames</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;Requires </span><span class="se">\\</span><span class="s"> as path separator.&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="ExtractTests.test_extract_hackers_arcnames_windows_only"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.test_extract_hackers_arcnames_windows_only">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_hackers_arcnames_windows_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test combination of path fixing and windows name sanitization.&quot;&quot;&quot;</span>
        <span class="n">windows_hacknames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">r&#39;..\foo\bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;..\/foo\/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;foo/\..\/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;foo\/../\bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;C:foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;C:/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;C://foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;C:\foo\bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;//conky/mountpoint/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">conky\mountpoint\foo\bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;///conky/mountpoint/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;conky/mountpoint/foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">\conky\mountpoint\foo\bar&#39;</span><span class="p">,</span> <span class="s">&#39;conky/mountpoint/foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;//conky//mountpoint/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;conky/mountpoint/foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">conky</span><span class="se">\\</span><span class="s">mountpoint\foo\bar&#39;</span><span class="p">,</span> <span class="s">&#39;conky/mountpoint/foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;//?/C:/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">?\C:\foo\bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;C:/../C:/foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;C_/foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;a:b\c&lt;d&gt;e|f&quot;g?h*i&#39;</span><span class="p">,</span> <span class="s">&#39;b/c_d_e_f_g_h_i&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;../../foo../../ba..r&#39;</span><span class="p">,</span> <span class="s">&#39;foo/ba..r&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_extract_hackers_arcnames</span><span class="p">(</span><span class="n">windows_hacknames</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">!=</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">r&#39;Requires / as path separator.&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="ExtractTests.test_extract_hackers_arcnames_posix_only"><a class="viewcode-back" href="../../test.html#test.test_zipfile.ExtractTests.test_extract_hackers_arcnames_posix_only">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_hackers_arcnames_posix_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">posix_hacknames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;//foo/bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo/bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;../../foo../../ba..r&#39;</span><span class="p">,</span> <span class="s">&#39;foo../ba..r&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;foo/..\bar&#39;</span><span class="p">,</span> <span class="s">r&#39;foo/..\bar&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_extract_hackers_arcnames</span><span class="p">(</span><span class="n">posix_hacknames</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_extract_hackers_arcnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hacknames</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arcname</span><span class="p">,</span> <span class="n">fixedname</span> <span class="ow">in</span> <span class="n">hacknames</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;foobar&#39;</span> <span class="o">+</span> <span class="n">arcname</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">zinfo</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">()</span>
                <span class="c"># preserve backslashes</span>
                <span class="n">zinfo</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">arcname</span>
                <span class="n">zinfo</span><span class="o">.</span><span class="n">external_attr</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o600</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">zinfo</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

            <span class="n">arcname</span> <span class="o">=</span> <span class="n">arcname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">targetpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;target&#39;</span><span class="p">,</span> <span class="s">&#39;subdir&#39;</span><span class="p">,</span> <span class="s">&#39;subsub&#39;</span><span class="p">)</span>
            <span class="n">correctfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">targetpath</span><span class="p">,</span> <span class="o">*</span><span class="n">fixedname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">))</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">writtenfile</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">targetpath</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">writtenfile</span><span class="p">,</span> <span class="n">correctfile</span><span class="p">,</span>
                                 <span class="n">msg</span><span class="o">=</span><span class="s">&#39;extract </span><span class="si">%r</span><span class="s">: </span><span class="si">%r</span><span class="s"> != </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">writtenfile</span><span class="p">,</span> <span class="n">correctfile</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_file</span><span class="p">(</span><span class="n">correctfile</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;target&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">targetpath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_file</span><span class="p">(</span><span class="n">correctfile</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;target&#39;</span><span class="p">)</span>

            <span class="n">correctfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">*</span><span class="n">fixedname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">))</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">writtenfile</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">arcname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">writtenfile</span><span class="p">,</span> <span class="n">correctfile</span><span class="p">,</span>
                                 <span class="n">msg</span><span class="o">=</span><span class="s">&quot;extract </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">arcname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_file</span><span class="p">(</span><span class="n">correctfile</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">fixedname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_file</span><span class="p">(</span><span class="n">correctfile</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">fixedname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OtherTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests">[docs]</a><span class="k">class</span> <span class="nc">OtherTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="OtherTests.test_open_via_zip_info"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_open_via_zip_info">[docs]</a>    <span class="k">def</span> <span class="nf">test_open_via_zip_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">(),</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">infos</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">infolist</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="n">b</span><span class="s">&quot;foobar&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;barfoo&quot;</span><span class="p">})</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="n">b</span><span class="s">&quot;foobar&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;barfoo&quot;</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="OtherTests.test_universal_deprecation"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_universal_deprecation">[docs]</a>    <span class="k">def</span> <span class="nf">test_universal_deprecation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;spam.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;ababagalamaga&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="s">&#39;rU&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
                    <span class="n">zipopen</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;spam.txt&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
                <span class="n">zipopen</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="OtherTests.test_universal_readaheads"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_universal_readaheads">[docs]</a>    <span class="k">def</span> <span class="nf">test_universal_readaheads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;a</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="n">data2</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">,</span> \
             <span class="n">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">zipopen</span><span class="p">:</span>
                <span class="n">data2</span> <span class="o">+=</span> <span class="n">line</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="OtherTests.test_writestr_extended_local_header_issue1202"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_writestr_extended_local_header_issue1202">[docs]</a>    <span class="k">def</span> <span class="nf">test_writestr_extended_local_header_issue1202</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">orig_zip</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="s">&#39;abcdefghijklmnop&#39;</span><span class="p">:</span>
                <span class="n">zinfo</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">zinfo</span><span class="o">.</span><span class="n">flag_bits</span> <span class="o">|=</span> <span class="mh">0x08</span>  <span class="c"># Include an extended local header.</span>
                <span class="n">orig_zip</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">zinfo</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_close"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that the zipfile is closed after the &#39;with&#39; block.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span> <span class="ow">in</span> <span class="n">SMALL_TEST_DATA</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;zipfp is not open&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;zipfp is not closed&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;zipfp is not open&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;zipfp is not closed&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_close_on_exception"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_close_on_exception">[docs]</a>    <span class="k">def</span> <span class="nf">test_close_on_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that the zipfile is closed if an exception is raised in the</span>
<span class="sd">        &#39;with&#39; block.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span> <span class="ow">in</span> <span class="n">SMALL_TEST_DATA</span><span class="p">:</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">fdata</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">zipfp2</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;zipfp is not closed&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_unsupported_version"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_unsupported_version">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsupported_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># File has an extract_version of 120</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04</span><span class="s">x</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">!p</span><span class="se">\xa1</span><span class="s">@</span><span class="se">\x00\x00\x00\x00\x00\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00</span><span class="s">xPK</span><span class="se">\x01\x02</span><span class="s">x</span><span class="se">\x03</span><span class="s">x</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">!p</span><span class="se">\xa1</span><span class="s">@</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x01\x00\x00\x00\x00</span><span class="s">xPK</span><span class="se">\x05\x06</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x01\x00\x01\x00</span><span class="s">/</span><span class="se">\x00\x00\x00\x1f\x00\x00\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span>
                          <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="OtherTests.test_read_unicode_filenames"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_read_unicode_filenames">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_unicode_filenames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bug #10801</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">findfile</span><span class="p">(</span><span class="s">&#39;zip_cp437_header.zip&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="OtherTests.test_write_unicode_filenames"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_write_unicode_filenames">[docs]</a>    <span class="k">def</span> <span class="nf">test_write_unicode_filenames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
            <span class="n">zf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;Test for unicode filename&quot;</span><span class="p">)</span>
            <span class="n">zf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xf6</span><span class="s">.txt&quot;</span><span class="p">,</span> <span class="s">&quot;Test for unicode filename&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">infolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">filelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;foo.txt&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">filelist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xf6</span><span class="s">.txt&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_create_non_existent_file_for_append"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_create_non_existent_file_for_append">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_non_existent_file_for_append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;testfile.txt&#39;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;hello, world. this is some content.&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
                <span class="n">zf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Could not append data to a non-existent zip file.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">content</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_close_erroneous_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_close_erroneous_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_close_erroneous_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This test checks that the ZipFile constructor closes the file object</span>
        <span class="c"># it opens if there&#39;s an error in the file.  If it doesn&#39;t, the</span>
        <span class="c"># traceback holds a reference to the ZipFile object and, indirectly,</span>
        <span class="c"># the file object.</span>
        <span class="c"># On Windows, this causes the os.unlink() call to fail because the</span>
        <span class="c"># underlying file is still open.  This is SF bug #412214.</span>
        <span class="c">#</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;this is not a legal zip file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="OtherTests.test_is_zip_erroneous_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_is_zip_erroneous_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_zip_erroneous_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that is_zipfile() correctly identifies non-zip files.&quot;&quot;&quot;</span>
        <span class="c"># - passing a filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;this is not a legal zip file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">))</span>
        <span class="c"># - passing a file object</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
        <span class="c"># - passing a file-like object</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;this is not a legal zip file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="OtherTests.test_damaged_zipfile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_damaged_zipfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_damaged_zipfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that zipfiles with missing bytes at the end raise BadZipFile.&quot;&quot;&quot;</span>
        <span class="c"># - Create a valid zip file</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
        <span class="n">zipfiledata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="c"># - Now create copies of it missing the last N bytes and make sure</span>
        <span class="c">#   a BadZipFile exception is raised when we try to open it</span>
        <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zipfiledata</span><span class="p">)):</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipfiledata</span><span class="p">[:</span><span class="n">N</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_is_zip_valid_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_is_zip_valid_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_zip_valid_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that is_zipfile() correctly identifies zip files.&quot;&quot;&quot;</span>
        <span class="c"># - passing a filename</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">))</span>
        <span class="c"># - passing a file object</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">zip_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c"># - passing a file-like object</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zip_contents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="OtherTests.test_non_existent_file_raises_OSError"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_non_existent_file_raises_OSError">[docs]</a>    <span class="k">def</span> <span class="nf">test_non_existent_file_raises_OSError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># make sure we don&#39;t raise an AttributeError when a partially-constructed</span>
        <span class="c"># ZipFile instance is finalized; this tests for regression on SF tracker</span>
        <span class="c"># bug #403871.</span>

        <span class="c"># The bug we&#39;re testing for caused an AttributeError to be raised</span>
        <span class="c"># when a ZipFile instance was created for a file that did not</span>
        <span class="c"># exist; the .fp member was not initialized but was needed by the</span>
        <span class="c"># __del__() method.  Since the AttributeError is in the __del__(),</span>
        <span class="c"># it is ignored, but the user should be sufficiently annoyed by</span>
        <span class="c"># the message on the output that regression will be noticed</span>
        <span class="c"># quickly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_empty_file_raises_BadZipFile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_empty_file_raises_BadZipFile">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_file_raises_BadZipFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;short file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_closed_zip_raises_RuntimeError"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_closed_zip_raises_RuntimeError">[docs]</a>    <span class="k">def</span> <span class="nf">test_closed_zip_raises_RuntimeError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify that testzip() doesn&#39;t swallow inappropriate exceptions.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>

        <span class="c"># This is correct; calling .read on a closed ZipFile should raise</span>
        <span class="c"># a RuntimeError, and so should calling .testzip.  An earlier</span>
        <span class="c"># version of .testzip would swallow this exception (and any other)</span>
        <span class="c"># and report that the first file in the archive was corrupt.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&quot;foo.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&quot;foo.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">testzip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">,</span> <span class="s">&quot;bogus.txt&quot;</span><span class="p">,</span> <span class="s">&quot;bogus&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;zipfile test data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_bad_constructor_mode"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_bad_constructor_mode">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_constructor_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that bad modes passed to ZipFile constructor are caught.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;q&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_bad_open_mode"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_bad_open_mode">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_open_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that bad modes passed to ZipFile.open are caught.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
        <span class="c"># read the data to make sure the file is there</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;q&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_read0"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_read0">[docs]</a>    <span class="k">def</span> <span class="nf">test_read0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that calling read(0) on a ZipExtFile object returns an empty</span>
<span class="sd">        string and doesn&#39;t advance file pointer.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
            <span class="c"># read the data to make sure the file is there</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FIXEDTEST_SIZE</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_open_non_existent_item"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_open_non_existent_item">[docs]</a>    <span class="k">def</span> <span class="nf">test_open_non_existent_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that attempting to call open() for an item that doesn&#39;t</span>
<span class="sd">        exist in the archive raises a RuntimeError.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_bad_compression_mode"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_bad_compression_mode">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_compression_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that bad compression methods passed to ZipFile.open are</span>
<span class="sd">        caught.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_unsupported_compression"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_unsupported_compression">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsupported_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># data is declared as shrunk, but actually deflated</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04</span><span class="s">.</span><span class="se">\x00\x00\x00\x01\x00\xe4</span><span class="s">C</span><span class="se">\xa1</span><span class="s">@</span><span class="se">\x00\x00\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x02\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00</span><span class="s">x</span><span class="se">\x03\x00</span><span class="s">PK</span><span class="se">\x01</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x02</span><span class="s">.</span><span class="se">\x03</span><span class="s">.</span><span class="se">\x00\x00\x00\x01\x00\xe4</span><span class="s">C</span><span class="se">\xa1</span><span class="s">@</span><span class="se">\x00\x00\x00\x00\x02\x00\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x01\x00\x00\x00\x00</span><span class="s">xPK</span><span class="se">\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00</span><span class="s">&#39;</span>
                <span class="n">b</span><span class="s">&#39;/</span><span class="se">\x00\x00\x00</span><span class="s">!</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_null_byte_in_filename"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_null_byte_in_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_null_byte_in_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that a filename containing a null byte is properly</span>
<span class="sd">        terminated.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt</span><span class="se">\x00</span><span class="s">qqq&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">namelist</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;foo.txt&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="OtherTests.test_struct_sizes"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_struct_sizes">[docs]</a>    <span class="k">def</span> <span class="nf">test_struct_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that ZIP internal structure sizes are calculated correctly.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">sizeEndCentDir</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">sizeCentralDir</span><span class="p">,</span> <span class="mi">46</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">sizeEndCentDir64</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">sizeEndCentDir64Locator</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_comments"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_comments">[docs]</a>    <span class="k">def</span> <span class="nf">test_comments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that comments on the archive are handled properly.&quot;&quot;&quot;</span>

        <span class="c"># check default comment is empty</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfr</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># check a simple short comment</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;Bravely taking to his feet, he beat a very brave retreat.&#39;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>

        <span class="c"># check a comment of max length</span>
        <span class="n">comment2</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">3</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">comment2</span> <span class="o">=</span> <span class="n">comment2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment2</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfr</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">comment2</span><span class="p">)</span>

        <span class="c"># check a comment that is too long is truncated</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
                <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment2</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;oops&#39;</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfr</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">comment2</span><span class="p">)</span>

        <span class="c"># check that comments are correctly modified in append mode</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;original comment&quot;</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;an updated comment&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;an updated comment&quot;</span><span class="p">)</span>

        <span class="c"># check that comments are correctly shortened in append mode</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;original comment that&#39;s longer&quot;</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;shorter comment&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;shorter comment&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_unicode_comment"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_unicode_comment">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;this is an error&quot;</span>
</div>
<div class="viewcode-block" id="OtherTests.test_change_comment_in_empty_archive"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_change_comment_in_empty_archive">[docs]</a>    <span class="k">def</span> <span class="nf">test_change_comment_in_empty_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">filelist</span><span class="p">)</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;this is a comment&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;this is a comment&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_change_comment_in_nonempty_archive"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_change_comment_in_nonempty_archive">[docs]</a>    <span class="k">def</span> <span class="nf">test_change_comment_in_nonempty_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&quot;foo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;O, for a Muse of Fire!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">filelist</span><span class="p">)</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;this is a comment&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;this is a comment&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_empty_zipfile"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_empty_zipfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_zipfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check that creating a file in &#39;w&#39; or &#39;a&#39; mode and closing without</span>
        <span class="c"># adding any files to the archives creates a valid empty ZIP file</span>
        <span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">zipf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;Unable to create empty ZIP file in &#39;w&#39; mode&quot;</span><span class="p">)</span>

        <span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">zipf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;Unable to create empty ZIP file in &#39;a&#39; mode&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_open_empty_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_open_empty_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_open_empty_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 1710703: Check that opening a file with less than 22 bytes</span>
        <span class="c"># raises a BadZipFile exception (rather than the previously unhelpful</span>
        <span class="c"># OSError)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OtherTests.test_create_zipinfo_before_1980"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_create_zipinfo_before_1980">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_zipinfo_before_1980</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span>
                          <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">,</span> <span class="s">&#39;seventies&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="OtherTests.test_zipfile_with_short_extra_field"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.test_zipfile_with_short_extra_field">[docs]</a>    <span class="k">def</span> <span class="nf">test_zipfile_with_short_extra_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If an extra field in the header is less than 4 bytes, skip it.&quot;&quot;&quot;</span>
        <span class="n">zipdata</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04\x14\x00\x00\x00\x00\x00\x93\x9b\xad</span><span class="s">@</span><span class="se">\x8b\x9e</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xd9\xd3\x01\x00\x00\x00\x01\x00\x00\x00\x03\x00\x03\x00</span><span class="s">ab&#39;</span>
            <span class="n">b</span><span class="s">&#39;c</span><span class="se">\x00\x00\x00</span><span class="s">APK</span><span class="se">\x01\x02\x14\x03\x14\x00\x00\x00\x00</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x93\x9b\xad</span><span class="s">@</span><span class="se">\x8b\x9e\xd9\xd3\x01\x00\x00\x00\x01\x00\x00</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x03\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa4\x81\x00</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00</span><span class="s">abc</span><span class="se">\x00\x00</span><span class="s">PK</span><span class="se">\x05\x06\x00\x00\x00\x00</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00\x01\x00</span><span class="s">3</span><span class="se">\x00\x00\x00</span><span class="s">%</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="c"># testzip returns the name of the first corrupt file, or None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">testzip</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="OtherTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.OtherTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AbstractBadCrcTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractBadCrcTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractBadCrcTests</span><span class="p">:</span>
<div class="viewcode-block" id="AbstractBadCrcTests.test_testzip_with_bad_crc"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractBadCrcTests.test_testzip_with_bad_crc">[docs]</a>    <span class="k">def</span> <span class="nf">test_testzip_with_bad_crc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests that files with bad CRCs return their name from testzip.&quot;&quot;&quot;</span>
        <span class="n">zipdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_with_bad_crc</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="c"># testzip returns the name of the first corrupt file, or None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;afile&#39;</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">testzip</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="AbstractBadCrcTests.test_read_with_bad_crc"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractBadCrcTests.test_read_with_bad_crc">[docs]</a>    <span class="k">def</span> <span class="nf">test_read_with_bad_crc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests that files with bad CRCs raise a BadZipFile exception when read.&quot;&quot;&quot;</span>
        <span class="n">zipdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_with_bad_crc</span>

        <span class="c"># Using ZipFile.read()</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&#39;afile&#39;</span><span class="p">)</span>

        <span class="c"># Using ZipExtFile.read()</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;afile&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">corrupt_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">corrupt_file</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>

        <span class="c"># Same with small reads (in order to exercise the buffering logic)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipdata</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;afile&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">corrupt_file</span><span class="p">:</span>
                <span class="n">corrupt_file</span><span class="o">.</span><span class="n">MIN_READ_SIZE</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">):</span>
                    <span class="k">while</span> <span class="n">corrupt_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="StoredBadCrcTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredBadCrcTests">[docs]</a><span class="k">class</span> <span class="nc">StoredBadCrcTests</span><span class="p">(</span><span class="n">AbstractBadCrcTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>
    <span class="n">zip_with_bad_crc</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\003\004\024\0\0\0\0\0</span><span class="s"> </span><span class="se">\213\212</span><span class="s">;:r&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\253\377\f\0\0\0\f\0\0\0\005\0\0\000</span><span class="s">af&#39;</span>
        <span class="n">b</span><span class="s">&#39;ilehello,AworldP&#39;</span>
        <span class="n">b</span><span class="s">&#39;K</span><span class="se">\001\002\024\003\024\0\0\0\0\0</span><span class="s"> </span><span class="se">\213\212</span><span class="s">;:&#39;</span>
        <span class="n">b</span><span class="s">&#39;r</span><span class="se">\253\377\f\0\0\0\f\0\0\0\005\0\0\0\0</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\0\0\0\0\0\0\0\200\001\0\0\0\000</span><span class="s">afi&#39;</span>
        <span class="n">b</span><span class="s">&#39;lePK</span><span class="se">\005\006\0\0\0\0\001\0\001\000</span><span class="s">3</span><span class="se">\000</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\0\0</span><span class="s">/</span><span class="se">\0\0\0\0\0</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="DeflateBadCrcTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DeflateBadCrcTests">[docs]</a><span class="k">class</span> <span class="nc">DeflateBadCrcTests</span><span class="p">(</span><span class="n">AbstractBadCrcTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>
    <span class="n">zip_with_bad_crc</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04\x14\x00\x00\x00\x08\x00</span><span class="s">n}</span><span class="se">\x0c</span><span class="s">=FA&#39;</span>
        <span class="n">b</span><span class="s">&#39;KE</span><span class="se">\x10\x00\x00\x00</span><span class="s">n</span><span class="se">\x00\x00\x00\x05\x00\x00\x00</span><span class="s">af&#39;</span>
        <span class="n">b</span><span class="s">&#39;ile</span><span class="se">\xcb</span><span class="s">H</span><span class="se">\xcd\xc9\xc9</span><span class="s">W(</span><span class="se">\xcf</span><span class="s">/</span><span class="se">\xca</span><span class="s">I</span><span class="se">\xc9\xa0</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;=</span><span class="se">\x13\x00</span><span class="s">PK</span><span class="se">\x01\x02\x14\x03\x14\x00\x00\x00\x08\x00</span><span class="s">n&#39;</span>
        <span class="n">b</span><span class="s">&#39;}</span><span class="se">\x0c</span><span class="s">=FAKE</span><span class="se">\x10\x00\x00\x00</span><span class="s">n</span><span class="se">\x00\x00\x00\x05</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x01\x00\x00\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">afilePK</span><span class="se">\x05\x06\x00\x00\x00\x00\x01\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00</span><span class="s">3</span><span class="se">\x00\x00\x00</span><span class="s">3</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<span class="nd">@requires_bz2</span>
<div class="viewcode-block" id="Bzip2BadCrcTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.Bzip2BadCrcTests">[docs]</a><span class="k">class</span> <span class="nc">Bzip2BadCrcTests</span><span class="p">(</span><span class="n">AbstractBadCrcTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_BZIP2</span>
    <span class="n">zip_with_bad_crc</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04\x14\x03\x00\x00\x0c\x00</span><span class="s">nu</span><span class="se">\x0c</span><span class="s">=FA&#39;</span>
        <span class="n">b</span><span class="s">&#39;KE8</span><span class="se">\x00\x00\x00</span><span class="s">n</span><span class="se">\x00\x00\x00\x05\x00\x00\x00</span><span class="s">af&#39;</span>
        <span class="n">b</span><span class="s">&#39;ileBZh91AY&amp;SY</span><span class="se">\xd4\xa8\xca</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\x00\x00\x0f\x11\x80</span><span class="s">@</span><span class="se">\x00\x06</span><span class="s">D</span><span class="se">\x90\x80</span><span class="s"> </span><span class="se">\x00</span><span class="s"> </span><span class="se">\xa5</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;P</span><span class="se">\xd9</span><span class="s">!</span><span class="se">\x03\x03\x13\x13\x13\x89\xa9\xa9\xc2</span><span class="s">u5:</span><span class="se">\x9f</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x8b\xb9</span><span class="s">&quot;</span><span class="se">\x9c</span><span class="s">(HjTe?</span><span class="se">\x80</span><span class="s">PK</span><span class="se">\x01\x02\x14</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x03\x14\x03\x00\x00\x0c\x00</span><span class="s">nu</span><span class="se">\x0c</span><span class="s">=FAKE8&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00</span><span class="s">n</span><span class="se">\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s"> </span><span class="se">\x80\x80\x81\x00\x00\x00\x00</span><span class="s">afilePK&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00</span><span class="s">3</span><span class="se">\x00\x00\x00</span><span class="s">[</span><span class="se">\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<span class="nd">@requires_lzma</span>
<div class="viewcode-block" id="LzmaBadCrcTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.LzmaBadCrcTests">[docs]</a><span class="k">class</span> <span class="nc">LzmaBadCrcTests</span><span class="p">(</span><span class="n">AbstractBadCrcTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_LZMA</span>
    <span class="n">zip_with_bad_crc</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04\x14\x03\x00\x00\x0e\x00</span><span class="s">nu</span><span class="se">\x0c</span><span class="s">=FA&#39;</span>
        <span class="n">b</span><span class="s">&#39;KE</span><span class="se">\x1b\x00\x00\x00</span><span class="s">n</span><span class="se">\x00\x00\x00\x05\x00\x00\x00</span><span class="s">af&#39;</span>
        <span class="n">b</span><span class="s">&#39;ile</span><span class="se">\t\x04\x05\x00</span><span class="s">]</span><span class="se">\x00\x00\x00\x04\x00</span><span class="s">4</span><span class="se">\x19</span><span class="s">I&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\xee\x8d\xe9\x17\x89</span><span class="s">:3`</span><span class="se">\t</span><span class="s">q!.8</span><span class="se">\x00</span><span class="s">PK&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x02\x14\x03\x14\x03\x00\x00\x0e\x00</span><span class="s">nu</span><span class="se">\x0c</span><span class="s">=FA&#39;</span>
        <span class="n">b</span><span class="s">&#39;KE</span><span class="se">\x1b\x00\x00\x00</span><span class="s">n</span><span class="se">\x00\x00\x00\x05\x00\x00\x00\x00\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s"> </span><span class="se">\x80\x80\x81\x00\x00\x00\x00</span><span class="s">afil&#39;</span>
        <span class="n">b</span><span class="s">&#39;ePK</span><span class="se">\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00</span><span class="s">3</span><span class="se">\x00\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&gt;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DecryptionTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests">[docs]</a><span class="k">class</span> <span class="nc">DecryptionTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that ZIP decryption works. Since the library does not</span>
<span class="sd">    support encryption at the moment, we use a pre-generated encrypted</span>
<span class="sd">    ZIP file.&quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04\x14\x00\x01\x00\x00\x00</span><span class="s">n</span><span class="se">\x92</span><span class="s">i.#y</span><span class="se">\xef</span><span class="s">?&amp;</span><span class="se">\x00\x00\x00\x1a\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x08\x00\x00\x00</span><span class="s">test.txt</span><span class="se">\xfa\x10\xa0</span><span class="s">gly|</span><span class="se">\xfa</span><span class="s">-</span><span class="se">\xc5\xc0</span><span class="s">=</span><span class="se">\xf9</span><span class="s">y&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x18\xe0\xa8</span><span class="s">r</span><span class="se">\xb3</span><span class="s">Z}Lg</span><span class="se">\xbc\xae\xf9</span><span class="s">|</span><span class="se">\x9b\x19\xe4\x8b\xba\xbb</span><span class="s">)</span><span class="se">\x8c\xb0\xdb</span><span class="s">l&#39;</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x01\x02\x14\x00\x14\x00\x01\x00\x00\x00</span><span class="s">n</span><span class="se">\x92</span><span class="s">i.#y</span><span class="se">\xef</span><span class="s">?&amp;</span><span class="se">\x00\x00\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x1a\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x01\x00</span><span class="s"> </span><span class="se">\x00\xb6\x81</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s">test.txtPK</span><span class="se">\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00</span><span class="s">6</span><span class="se">\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">L</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span> <span class="p">)</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x03\x04\x14\x00\t\x00\x08\x00\xcf</span><span class="s">}38xu</span><span class="se">\xaa\xb2\x14\x00\x00\x00\x00\x02</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x04\x00\x15\x00</span><span class="s">zeroUT</span><span class="se">\t\x00\x03\xd6\x8b\x92</span><span class="s">G</span><span class="se">\xda\x8b\x92</span><span class="s">GUx</span><span class="se">\x04</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xe8\x03\xe8\x03\xc7</span><span class="s">&lt;M</span><span class="se">\xb5</span><span class="s">a</span><span class="se">\xce</span><span class="s">X</span><span class="se">\xa3</span><span class="s">Y&amp;</span><span class="se">\x8b</span><span class="s">{oE</span><span class="se">\xd7\x9d\x8c\x98\x02\xc0</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;PK</span><span class="se">\x07\x08</span><span class="s">xu</span><span class="se">\xaa\xb2\x14\x00\x00\x00\x00\x02\x00\x00</span><span class="s">PK</span><span class="se">\x01\x02\x17\x03</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x14\x00\t\x00\x08\x00\xcf</span><span class="s">}38xu</span><span class="se">\xaa\xb2\x14\x00\x00\x00\x00\x02\x00\x00</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x04\x00\r\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa4\x81\x00\x00\x00\x00</span><span class="s">ze&#39;</span>
        <span class="n">b</span><span class="s">&#39;roUT</span><span class="se">\x05\x00\x03\xd6\x8b\x92</span><span class="s">GUx</span><span class="se">\x00\x00</span><span class="s">PK</span><span class="se">\x05\x06\x00\x00\x00\x00\x01</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01\x00</span><span class="s">?</span><span class="se">\x00\x00\x00</span><span class="s">[</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span> <span class="p">)</span>

    <span class="n">plain</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;zipfile.py encryption test&#39;</span>
    <span class="n">plain2</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="o">*</span><span class="mi">512</span>

<div class="viewcode-block" id="DecryptionTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip2</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DecryptionTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DecryptionTests.test_no_password"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests.test_no_password">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Reading the encrypted file without password</span>
        <span class="c"># must generate a RunTime exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&quot;test.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip2</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&quot;zero&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DecryptionTests.test_bad_password"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests.test_bad_password">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">setpassword</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;perl&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&quot;test.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip2</span><span class="o">.</span><span class="n">setpassword</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;perl&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip2</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&quot;zero&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="DecryptionTests.test_good_password"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests.test_good_password">[docs]</a>    <span class="k">def</span> <span class="nf">test_good_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">setpassword</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">plain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip2</span><span class="o">.</span><span class="n">setpassword</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;12345&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zip2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;zero&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">plain2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DecryptionTests.test_unicode_password"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DecryptionTests.test_unicode_password">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">setpassword</span><span class="p">,</span> <span class="s">&quot;unicode&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s">&quot;test.txt&quot;</span><span class="p">,</span> <span class="s">&quot;python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&quot;test.txt&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="s">&quot;python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span> <span class="s">&quot;test.txt&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="s">&quot;python&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles">[docs]</a><span class="k">class</span> <span class="nc">AbstractTestsWithRandomBinaryFiles</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.setUpClass"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.setUpClass">[docs]</a>    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">datacount</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span><span class="o">*</span><span class="mi">1024</span> <span class="o">+</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;&lt;f&#39;</span><span class="p">,</span> <span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">datacount</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Make a source file with some lines</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.make_test_archive"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.make_test_archive">[docs]</a>    <span class="k">def</span> <span class="nf">make_test_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;another.name&quot;</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.zip_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.zip_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">testdata</span> <span class="o">=</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">testdata</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">testdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipfp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.test_read"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.test_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.zip_open_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.zip_open_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_open_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipdata1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen1</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">zipdata1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

            <span class="n">zipdata2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;another.name&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen2</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">zipdata2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

            <span class="n">testdata1</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">testdata1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">testdata1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="n">testdata2</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">testdata2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">testdata2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.test_open"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.test_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_open_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.zip_random_open_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.zip_random_open_test">[docs]</a>    <span class="k">def</span> <span class="nf">zip_random_open_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipdata1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">zipfp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen1</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">zipopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">read_data</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">zipdata1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_data</span><span class="p">)</span>

            <span class="n">testdata</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zipdata1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">testdata</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">testdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractTestsWithRandomBinaryFiles.test_random_open"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractTestsWithRandomBinaryFiles.test_random_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_random_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zip_random_open_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="StoredTestsWithRandomBinaryFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredTestsWithRandomBinaryFiles">[docs]</a><span class="k">class</span> <span class="nc">StoredTestsWithRandomBinaryFiles</span><span class="p">(</span><span class="n">AbstractTestsWithRandomBinaryFiles</span><span class="p">,</span>
                                       <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>
</div>
<span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="DeflateTestsWithRandomBinaryFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DeflateTestsWithRandomBinaryFiles">[docs]</a><span class="k">class</span> <span class="nc">DeflateTestsWithRandomBinaryFiles</span><span class="p">(</span><span class="n">AbstractTestsWithRandomBinaryFiles</span><span class="p">,</span>
                                        <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>
</div>
<span class="nd">@requires_bz2</span>
<div class="viewcode-block" id="Bzip2TestsWithRandomBinaryFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.Bzip2TestsWithRandomBinaryFiles">[docs]</a><span class="k">class</span> <span class="nc">Bzip2TestsWithRandomBinaryFiles</span><span class="p">(</span><span class="n">AbstractTestsWithRandomBinaryFiles</span><span class="p">,</span>
                                      <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_BZIP2</span>
</div>
<span class="nd">@requires_lzma</span>
<div class="viewcode-block" id="LzmaTestsWithRandomBinaryFiles"><a class="viewcode-back" href="../../test.html#test.test_zipfile.LzmaTestsWithRandomBinaryFiles">[docs]</a><span class="k">class</span> <span class="nc">LzmaTestsWithRandomBinaryFiles</span><span class="p">(</span><span class="n">AbstractTestsWithRandomBinaryFiles</span><span class="p">,</span>
                                     <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_LZMA</span>

</div>
<span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="TestsWithMultipleOpens"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestsWithMultipleOpens">[docs]</a><span class="k">class</span> <span class="nc">TestsWithMultipleOpens</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestsWithMultipleOpens.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestsWithMultipleOpens.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;ones&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="o">*</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)</span>
            <span class="n">zipfp</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;twos&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="o">*</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestsWithMultipleOpens.test_same_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestsWithMultipleOpens.test_same_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_same_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that (when the ZipFile is in control of creating file objects)</span>
        <span class="c"># multiple open() calls can be made without interfering with each other.</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;ones&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zopen1</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;ones&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zopen2</span><span class="p">:</span>
                <span class="n">data1</span> <span class="o">=</span> <span class="n">zopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data2</span> <span class="o">=</span> <span class="n">zopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data1</span> <span class="o">+=</span> <span class="n">zopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data2</span> <span class="o">+=</span> <span class="n">zopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestsWithMultipleOpens.test_different_file"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestsWithMultipleOpens.test_different_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_different_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that (when the ZipFile is in control of creating file objects)</span>
        <span class="c"># multiple open() calls can be made without interfering with each other.</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;ones&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zopen1</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;twos&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zopen2</span><span class="p">:</span>
                <span class="n">data1</span> <span class="o">=</span> <span class="n">zopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data2</span> <span class="o">=</span> <span class="n">zopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data1</span> <span class="o">+=</span> <span class="n">zopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data2</span> <span class="o">+=</span> <span class="n">zopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;1&#39;</span><span class="o">*</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;2&#39;</span><span class="o">*</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestsWithMultipleOpens.test_interleaved"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestsWithMultipleOpens.test_interleaved">[docs]</a>    <span class="k">def</span> <span class="nf">test_interleaved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that (when the ZipFile is in control of creating file objects)</span>
        <span class="c"># multiple open() calls can be made without interfering with each other.</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;ones&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zopen1</span><span class="p">,</span> <span class="n">zipf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;twos&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zopen2</span><span class="p">:</span>
                <span class="n">data1</span> <span class="o">=</span> <span class="n">zopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data2</span> <span class="o">=</span> <span class="n">zopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data1</span> <span class="o">+=</span> <span class="n">zopen1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
                <span class="n">data2</span> <span class="o">+=</span> <span class="n">zopen2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;1&#39;</span><span class="o">*</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;2&#39;</span><span class="o">*</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestsWithMultipleOpens.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestsWithMultipleOpens.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestWithDirectory"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestWithDirectory">[docs]</a><span class="k">class</span> <span class="nc">TestWithDirectory</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestWithDirectory.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestWithDirectory.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestWithDirectory.test_extract_dir"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestWithDirectory.test_extract_dir">[docs]</a>    <span class="k">def</span> <span class="nf">test_extract_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">findfile</span><span class="p">(</span><span class="s">&quot;zipdir.zip&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="n">zipf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestWithDirectory.test_bug_6050"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestWithDirectory.test_bug_6050">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug_6050</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Extraction should succeed if directories already exist</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_extract_dir</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestWithDirectory.test_store_dir"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestWithDirectory.test_store_dir">[docs]</a>    <span class="k">def</span> <span class="nf">test_store_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">))</span>
        <span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">zipf</span><span class="o">.</span><span class="n">filelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;x/&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestWithDirectory.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.TestWithDirectory.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">):</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests">[docs]</a><span class="k">class</span> <span class="nc">AbstractUniversalNewlineTests</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.setUpClass"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.setUpClass">[docs]</a>    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">line_gen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&quot;Test of zipfile line </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FIXEDTEST_SIZE</span><span class="p">)]</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">seps</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">arcdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">seps</span><span class="p">):</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">arcdata</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">line_gen</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arcdata</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.make_test_archive"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.make_test_archive">[docs]</a>    <span class="k">def</span> <span class="nf">make_test_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="c"># Create the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">zipfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.read_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.read_test">[docs]</a>    <span class="k">def</span> <span class="nf">read_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sep</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">zipdata</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arcdata</span><span class="p">[</span><span class="n">sep</span><span class="p">],</span> <span class="n">zipdata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.test_read"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.test_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.readline_read_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.readline_read_test">[docs]</a>    <span class="k">def</span> <span class="nf">readline_read_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sep</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
                    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">read</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">read</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">data</span> <span class="o">+=</span> <span class="n">read</span>

                        <span class="n">read</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">read</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">data</span> <span class="o">+=</span> <span class="n">read</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcdata</span><span class="p">[</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.test_readline_read"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.test_readline_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readline_read_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.readline_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.readline_test">[docs]</a>    <span class="k">def</span> <span class="nf">readline_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sep</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipopen</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_gen</span><span class="p">:</span>
                        <span class="n">linedata</span> <span class="o">=</span> <span class="n">zipopen</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">linedata</span><span class="p">,</span> <span class="n">line</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.test_readline"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readline_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.readlines_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.readlines_test">[docs]</a>    <span class="k">def</span> <span class="nf">readlines_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sep</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">ziplines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">zipline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_gen</span><span class="p">,</span> <span class="n">ziplines</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipline</span><span class="p">,</span> <span class="n">line</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.test_readlines"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.test_readlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readlines_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.iterlines_test"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.iterlines_test">[docs]</a>    <span class="k">def</span> <span class="nf">iterlines_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_test_archive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="p">)</span>

        <span class="c"># Read the ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sep</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">openU</span><span class="p">(</span><span class="n">zipfp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">zipline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_gen</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">zipline</span><span class="p">,</span> <span class="n">line</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.test_iterlines"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.test_iterlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_iterlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iterlines_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbstractUniversalNewlineTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_zipfile.AbstractUniversalNewlineTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sep</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcfiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">TESTFN2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="StoredUniversalNewlineTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.StoredUniversalNewlineTests">[docs]</a><span class="k">class</span> <span class="nc">StoredUniversalNewlineTests</span><span class="p">(</span><span class="n">AbstractUniversalNewlineTests</span><span class="p">,</span>
                                  <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>
</div>
<span class="nd">@requires_zlib</span>
<div class="viewcode-block" id="DeflateUniversalNewlineTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.DeflateUniversalNewlineTests">[docs]</a><span class="k">class</span> <span class="nc">DeflateUniversalNewlineTests</span><span class="p">(</span><span class="n">AbstractUniversalNewlineTests</span><span class="p">,</span>
                                   <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>
</div>
<span class="nd">@requires_bz2</span>
<div class="viewcode-block" id="Bzip2UniversalNewlineTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.Bzip2UniversalNewlineTests">[docs]</a><span class="k">class</span> <span class="nc">Bzip2UniversalNewlineTests</span><span class="p">(</span><span class="n">AbstractUniversalNewlineTests</span><span class="p">,</span>
                                 <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_BZIP2</span>
</div>
<span class="nd">@requires_lzma</span>
<div class="viewcode-block" id="LzmaUniversalNewlineTests"><a class="viewcode-back" href="../../test.html#test.test_zipfile.LzmaUniversalNewlineTests">[docs]</a><span class="k">class</span> <span class="nc">LzmaUniversalNewlineTests</span><span class="p">(</span><span class="n">AbstractUniversalNewlineTests</span><span class="p">,</span>
                                <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_LZMA</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>