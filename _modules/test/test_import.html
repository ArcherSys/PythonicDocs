

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_import &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_import</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_import</h1><div class="highlight"><pre>
<span class="c"># We import importlib *ASAP* in order to test #15386</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">from</span> <span class="nn">importlib._bootstrap</span> <span class="kn">import</span> <span class="n">_get_sourcefile</span>
<span class="kn">import</span> <span class="nn">builtins</span>
<span class="kn">import</span> <span class="nn">marshal</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">py_compile</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">unittest.mock</span> <span class="kn">as</span> <span class="nn">mock</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">contextlib</span>

<span class="kn">import</span> <span class="nn">test.support</span>
<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EnvironmentVarGuard</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="n">check_warnings</span><span class="p">,</span> <span class="n">forget</span><span class="p">,</span> <span class="n">is_jython</span><span class="p">,</span>
    <span class="n">make_legacy_pyc</span><span class="p">,</span> <span class="n">rmtree</span><span class="p">,</span> <span class="n">run_unittest</span><span class="p">,</span> <span class="n">swap_attr</span><span class="p">,</span> <span class="n">swap_item</span><span class="p">,</span> <span class="n">temp_umask</span><span class="p">,</span>
    <span class="n">unlink</span><span class="p">,</span> <span class="n">unload</span><span class="p">,</span> <span class="n">create_empty_file</span><span class="p">,</span> <span class="n">cpython_only</span><span class="p">,</span> <span class="n">TESTFN_UNENCODABLE</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">script_helper</span>


<span class="n">skip_if_dont_write_bytecode</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span><span class="p">,</span>
        <span class="s">&quot;test meaningful only when writing bytecode&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="remove_files"><a class="viewcode-back" href="../../test.html#test.test_import.remove_files">[docs]</a><span class="k">def</span> <span class="nf">remove_files</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span><span class="p">,</span>
              <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.pyc&quot;</span><span class="p">,</span>
              <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.pyo&quot;</span><span class="p">,</span>
              <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.pyw&quot;</span><span class="p">,</span>
              <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;$py.class&quot;</span><span class="p">):</span>
        <span class="n">unlink</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">)</span>

</div>
<span class="nd">@contextlib.contextmanager</span>
<span class="k">def</span> <span class="nf">_ready_to_import</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="c"># sets up a temporary directory and removes it</span>
    <span class="c"># creates the module file</span>
    <span class="c"># temporarily clears the module from sys.modules (if any)</span>
    <span class="c"># reverts or removes the module when cleaning up</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="s">&quot;spam&quot;</span>
    <span class="k">with</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">make_script</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">old_module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">old_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_module</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>


<div class="viewcode-block" id="ImportTests"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests">[docs]</a><span class="k">class</span> <span class="nc">ImportTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="ImportTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">remove_files</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="ImportTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unload</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_case_sensitivity"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_case_sensitivity">[docs]</a>    <span class="k">def</span> <span class="nf">test_case_sensitivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Brief digression to test that import is case-sensitive:  if we got</span>
        <span class="c"># this far, we know for sure that &quot;random&quot; exists.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">RAnDoM</span>
</div>
<div class="viewcode-block" id="ImportTests.test_double_const"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_double_const">[docs]</a>    <span class="k">def</span> <span class="nf">test_double_const</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Another brief digression to test the accuracy of manifest float</span>
        <span class="c"># constants.</span>
        <span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">double_const</span>  <span class="c"># don&#39;t blink -- that *was* the test</span>
</div>
<div class="viewcode-block" id="ImportTests.test_import"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_import">[docs]</a>    <span class="k">def</span> <span class="nf">test_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">test_with_extension</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
            <span class="c"># The extension is normally &quot;.py&quot;, perhaps &quot;.pyw&quot;.</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="n">ext</span>
            <span class="n">pyo</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;.pyo&quot;</span>
            <span class="k">if</span> <span class="n">is_jython</span><span class="p">:</span>
                <span class="n">pyc</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;$py.class&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyc</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;.pyc&quot;</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;# This tests Python&#39;s ability to import a&quot;</span><span class="p">,</span>
                      <span class="n">ext</span><span class="p">,</span> <span class="s">&quot;file.&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;a =&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;b =&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">TESTFN</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">TESTFN</span><span class="p">]</span>
            <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;import from </span><span class="si">%s</span><span class="s"> failed: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
                    <span class="s">&quot;module loaded (</span><span class="si">%s</span><span class="s">) but contents invalid&quot;</span> <span class="o">%</span> <span class="n">mod</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span>
                    <span class="s">&quot;module loaded (</span><span class="si">%s</span><span class="s">) but contents invalid&quot;</span> <span class="o">%</span> <span class="n">mod</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">forget</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
                <span class="n">unlink</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="n">unlink</span><span class="p">(</span><span class="n">pyc</span><span class="p">)</span>
                <span class="n">unlink</span><span class="p">(</span><span class="n">pyo</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_with_extension</span><span class="p">(</span><span class="s">&quot;.py&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;win&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;.PY&quot;</span><span class="p">,</span> <span class="s">&quot;.Py&quot;</span><span class="p">,</span> <span class="s">&quot;.pY&quot;</span><span class="p">,</span> <span class="s">&quot;.pyw&quot;</span><span class="p">,</span> <span class="s">&quot;.PYW&quot;</span><span class="p">,</span> <span class="s">&quot;.pYw&quot;</span><span class="p">]:</span>
                    <span class="n">test_with_extension</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ImportTests.test_module_with_large_stack"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_module_with_large_stack">[docs]</a>    <span class="k">def</span> <span class="nf">test_module_with_large_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s">&#39;longlist&#39;</span><span class="p">):</span>
        <span class="c"># Regression test for http://bugs.python.org/issue561858.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">module</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span>

        <span class="c"># Create a file with a list of 65000 elements.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;d = [</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65000</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&quot;&quot;,</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Compile &amp; remove .py file; we only need .pyc (or .pyo).</span>
            <span class="c"># Bytecode must be relocated from the PEP 3147 bytecode-only location.</span>
            <span class="n">py_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c"># Need to be able to load from current dir.</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>

        <span class="n">namespace</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">make_legacy_pyc</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="c"># This used to crash.</span>
            <span class="k">exec</span><span class="p">(</span><span class="s">&#39;import &#39;</span> <span class="o">+</span> <span class="n">module</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c"># Cleanup.</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>

            <span class="c"># Remove references to the module (unload the module)</span>
            <span class="n">namespace</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="ImportTests.test_failing_import_sticks"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_failing_import_sticks">[docs]</a>    <span class="k">def</span> <span class="nf">test_failing_import_sticks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;a = 1/0&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

        <span class="c"># New in 2.4, we shouldn&#39;t be able to import that no matter how often</span>
        <span class="c"># we try.</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">TESTFN</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">TESTFN</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="nb">__import__</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">,</span>
                                 <span class="s">&quot;damaged module in sys.modules on </span><span class="si">%i</span><span class="s"> try&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">remove_files</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_import_name_binding"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_import_name_binding">[docs]</a>    <span class="k">def</span> <span class="nf">test_import_name_binding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># import x.y.z binds x in the current namespace</span>
        <span class="kn">import</span> <span class="nn">test</span> <span class="kn">as</span> <span class="nn">x</span>
        <span class="kn">import</span> <span class="nn">test.support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="p">,</span> <span class="s">&quot;__file__&quot;</span><span class="p">))</span>

        <span class="c"># import x.y.z as w binds z as w</span>
        <span class="kn">import</span> <span class="nn">test.support</span> <span class="kn">as</span> <span class="nn">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_failing_reload"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_failing_reload">[docs]</a>    <span class="k">def</span> <span class="nf">test_failing_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A failing reload should leave the module object in sys.modules.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">extsep</span> <span class="o">+</span> <span class="s">&quot;py&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;a = 1</span><span class="se">\n</span><span class="s">b=2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;module has wrong attribute values&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;module has wrong attribute values&quot;</span><span class="p">)</span>

            <span class="c"># On WinXP, just replacing the .py file wasn&#39;t enough to</span>
            <span class="c"># convince reload() to reparse it.  Maybe the timestamp didn&#39;t</span>
            <span class="c"># move enough.  We force it to get reparsed by removing the</span>
            <span class="c"># compiled file too.</span>
            <span class="n">remove_files</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>

            <span class="c"># Now damage the module.</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;a = 10</span><span class="se">\n</span><span class="s">b=20//0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">,</span> <span class="n">mod</span><span class="p">)</span>
            <span class="c"># But we still expect the module to be in sys.modules.</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s">&quot;expected module to be in sys.modules&quot;</span><span class="p">)</span>

            <span class="c"># We should have replaced a w/ 10, but the old b value should</span>
            <span class="c"># stick.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&quot;module has wrong attribute values&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;module has wrong attribute values&quot;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">remove_files</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="ImportTests.test_file_to_source"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_file_to_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_to_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># check if __file__ points to the source file where available</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;test = None</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__file__</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">TESTFN</span><span class="p">]</span>
            <span class="n">make_legacy_pyc</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;.pyc&#39;</span><span class="p">,</span> <span class="s">&#39;.pyo&#39;</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">remove_files</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">TESTFN</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">TESTFN</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ImportTests.test_import_by_filename"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_import_by_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_import_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getfilesystemencoding</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&#39;path is not encodable to {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encoding</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_import_in_del_does_not_crash"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_import_in_del_does_not_crash">[docs]</a>    <span class="k">def</span> <span class="nf">test_import_in_del_does_not_crash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 4236</span>
        <span class="n">testfn</span> <span class="o">=</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">make_script</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">,</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            import sys</span>
<span class="s">            class C:</span>
<span class="s">               def __del__(self):</span>
<span class="s">                  import importlib</span>
<span class="s">            sys.argv.insert(0, C())</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">))</span>
        <span class="n">script_helper</span><span class="o">.</span><span class="n">assert_python_ok</span><span class="p">(</span><span class="n">testfn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_timestamp_overflow"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_timestamp_overflow">[docs]</a>    <span class="k">def</span> <span class="nf">test_timestamp_overflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A modification timestamp larger than 2**32 should not be a problem</span>
        <span class="c"># when importing a module (issue #11235).</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span>
            <span class="n">compiled</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">33</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">33</span> <span class="o">-</span> <span class="mi">5</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;cannot set modification time to large integer&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">errno</span><span class="p">,</span> <span class="s">&#39;EOVERFLOW&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="k">raise</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;cannot set modification time to large integer ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="c"># The pyc file was created.</span>
            <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">compiled</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">remove_files</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_bogus_fromlist"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_bogus_fromlist">[docs]</a>    <span class="k">def</span> <span class="nf">test_bogus_fromlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;blah&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;fromlist must allow bogus names&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@cpython_only</span>
<div class="viewcode-block" id="ImportTests.test_delete_builtins_import"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_delete_builtins_import">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete_builtins_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-c&quot;</span><span class="p">,</span> <span class="s">&quot;del __builtins__.__import__; import os&quot;</span><span class="p">]</span>
        <span class="n">popen</span> <span class="o">=</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">spawn_python</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">popen</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;ImportError&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTests.test_from_import_message_for_nonexistent_module"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_from_import_message_for_nonexistent_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_import_message_for_nonexistent_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="s">&quot;^No module named &#39;bogus&#39;&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">bogus</span> <span class="kn">import</span> <span class="n">foo</span>
</div>
<div class="viewcode-block" id="ImportTests.test_from_import_message_for_existing_module"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTests.test_from_import_message_for_existing_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_import_message_for_existing_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="s">&quot;^cannot import name &#39;bogus&#39;&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">bogus</span>

</div></div>
<span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="FilePermissionTests"><a class="viewcode-back" href="../../test.html#test.test_import.FilePermissionTests">[docs]</a><span class="k">class</span> <span class="nc">FilePermissionTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># tests for file mode on cached .pyc/.pyo files</span>

    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;posix&#39;</span><span class="p">,</span>
                         <span class="s">&quot;test meaningful only on posix systems&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="FilePermissionTests.test_creation_mode"><a class="viewcode-back" href="../../test.html#test.test_import.FilePermissionTests.test_creation_mode">[docs]</a>    <span class="k">def</span> <span class="nf">test_creation_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o022</span>
        <span class="k">with</span> <span class="n">temp_umask</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span> <span class="n">_ready_to_import</span><span class="p">()</span> <span class="k">as</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="n">cached_path</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cached_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;__import__ did not result in creation of &quot;</span>
                          <span class="s">&quot;either a .pyc or .pyo file&quot;</span><span class="p">)</span>
            <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">cached_path</span><span class="p">)</span>

        <span class="c"># Check that the umask is respected, and the executable bits</span>
        <span class="c"># aren&#39;t set.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">oct</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">S_IMODE</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)),</span>
                         <span class="nb">oct</span><span class="p">(</span><span class="mi">0</span><span class="n">o666</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">))</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;posix&#39;</span><span class="p">,</span>
                         <span class="s">&quot;test meaningful only on posix systems&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="FilePermissionTests.test_cached_mode_issue_2051"><a class="viewcode-back" href="../../test.html#test.test_import.FilePermissionTests.test_cached_mode_issue_2051">[docs]</a>    <span class="k">def</span> <span class="nf">test_cached_mode_issue_2051</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># permissions of .pyc should match those of .py, regardless of mask</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o600</span>
        <span class="k">with</span> <span class="n">temp_umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o022</span><span class="p">),</span> <span class="n">_ready_to_import</span><span class="p">()</span> <span class="k">as</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="n">cached_path</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cached_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;__import__ did not result in creation of &quot;</span>
                          <span class="s">&quot;either a .pyc or .pyo file&quot;</span><span class="p">)</span>
            <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">cached_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">oct</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">S_IMODE</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)),</span> <span class="nb">oct</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;posix&#39;</span><span class="p">,</span>
                         <span class="s">&quot;test meaningful only on posix systems&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="FilePermissionTests.test_cached_readonly"><a class="viewcode-back" href="../../test.html#test.test_import.FilePermissionTests.test_cached_readonly">[docs]</a>    <span class="k">def</span> <span class="nf">test_cached_readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="n">o400</span>
        <span class="k">with</span> <span class="n">temp_umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o022</span><span class="p">),</span> <span class="n">_ready_to_import</span><span class="p">()</span> <span class="k">as</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="n">cached_path</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cached_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;__import__ did not result in creation of &quot;</span>
                          <span class="s">&quot;either a .pyc or .pyo file&quot;</span><span class="p">)</span>
            <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">cached_path</span><span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">|</span> <span class="mi">0</span><span class="n">o200</span> <span class="c"># Account for fix for issue #6074</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">oct</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">S_IMODE</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)),</span> <span class="nb">oct</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="FilePermissionTests.test_pyc_always_writable"><a class="viewcode-back" href="../../test.html#test.test_import.FilePermissionTests.test_pyc_always_writable">[docs]</a>    <span class="k">def</span> <span class="nf">test_pyc_always_writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initially read-only .pyc files on Windows used to cause problems</span>
        <span class="c"># with later updates, see issue #6074 for details</span>
        <span class="k">with</span> <span class="n">_ready_to_import</span><span class="p">()</span> <span class="k">as</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="c"># Write a Python file, make it read-only and import it</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;x = &#39;original&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="c"># Tweak the mtime of the source to ensure pyc gets updated later</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">st_mtime</span><span class="o">-</span><span class="mi">100000000</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="n">o400</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;original&#39;</span><span class="p">)</span>
            <span class="c"># Change the file and then reimport it</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="n">o600</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;x = &#39;rewritten&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;rewritten&#39;</span><span class="p">)</span>
            <span class="c"># Now delete the source file and check the pyc was rewritten</span>
            <span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                <span class="n">bytecode_only</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&quot;c&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bytecode_only</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&quot;o&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">bytecode_only</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;rewritten&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PycRewritingTests"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests">[docs]</a><span class="k">class</span> <span class="nc">PycRewritingTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Test that the `co_filename` attribute on code objects always points</span>
    <span class="c"># to the right file, even when various things happen (e.g. both the .py</span>
    <span class="c"># and the .pyc file are renamed).</span>

    <span class="n">module_name</span> <span class="o">=</span> <span class="s">&quot;unlikely_module_name&quot;</span>
    <span class="n">module_source</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">import sys</span>
<span class="s">code_filename = sys._getframe().f_code.co_filename</span>
<span class="s">module_filename = __file__</span>
<span class="s">constant = 1</span>
<span class="s">def func():</span>
<span class="s">    pass</span>
<span class="s">func_filename = func.__code__.co_filename</span>
<span class="s">&quot;&quot;&quot;</span>
    <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">extsep</span> <span class="o">+</span> <span class="s">&quot;py&quot;</span>
    <span class="n">compiled_name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

<div class="viewcode-block" id="PycRewritingTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_source</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PycRewritingTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_module</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unload</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compiled_name</span><span class="p">)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PycRewritingTests.import_module"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.import_module">[docs]</a>    <span class="k">def</span> <span class="nf">import_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PycRewritingTests.test_basics"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.test_basics">[docs]</a>    <span class="k">def</span> <span class="nf">test_basics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_module</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">module_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">code_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">func_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">]</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_module</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">module_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">code_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">func_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PycRewritingTests.test_incorrect_code_name"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.test_incorrect_code_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_incorrect_code_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">py_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dfile</span><span class="o">=</span><span class="s">&quot;another_module.py&quot;</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_module</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">module_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">code_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">func_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PycRewritingTests.test_module_without_source"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.test_module_without_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_module_without_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">target</span> <span class="o">=</span> <span class="s">&quot;another_module.py&quot;</span>
        <span class="n">py_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dfile</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">pyc_file</span> <span class="o">=</span> <span class="n">make_legacy_pyc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_module</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">module_filename</span><span class="p">,</span> <span class="n">pyc_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">code_filename</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">func_filename</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PycRewritingTests.test_foreign_code"><a class="viewcode-back" href="../../test.html#test.test_import.PycRewritingTests.test_foreign_code">[docs]</a>    <span class="k">def</span> <span class="nf">test_foreign_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">py_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compiled_name</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_consts</span><span class="p">)</span>
        <span class="n">foreign_code</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="o">.</span><span class="n">__code__</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">constants</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">foreign_code</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">)(</span><span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_kwonlyargcount</span><span class="p">,</span>
                          <span class="n">code</span><span class="o">.</span><span class="n">co_nlocals</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_stacksize</span><span class="p">,</span>
                          <span class="n">code</span><span class="o">.</span><span class="n">co_flags</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_code</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">constants</span><span class="p">),</span>
                          <span class="n">code</span><span class="o">.</span><span class="n">co_names</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span>
                          <span class="n">code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_lnotab</span><span class="p">,</span>
                          <span class="n">code</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_cellvars</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compiled_name</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_module</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">constant</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">foreign_code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PathsTests"><a class="viewcode-back" href="../../test.html#test.test_import.PathsTests">[docs]</a><span class="k">class</span> <span class="nc">PathsTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">SAMPLES</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="s">&#39;test</span><span class="se">\u00e4\u00f6\u00fc\u00df</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;test</span><span class="se">\u00e9\u00e8</span><span class="s">&#39;</span><span class="p">,</span>
               <span class="s">&#39;test</span><span class="se">\u00b0\u00b3\u00b2</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">TESTFN</span>

<div class="viewcode-block" id="PathsTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_import.PathsTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>
</div>
<div class="viewcode-block" id="PathsTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.PathsTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span>

    <span class="c"># Regression test for http://bugs.python.org/issue1293.</span></div>
<div class="viewcode-block" id="PathsTests.test_trailing_slash"><a class="viewcode-back" href="../../test.html#test.test_import.PathsTests.test_trailing_slash">[docs]</a>    <span class="k">def</span> <span class="nf">test_trailing_slash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;test_trailing_slash.py&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;testdata = &#39;test_trailing_slash&#39;&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&quot;test_trailing_slash&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">testdata</span><span class="p">,</span> <span class="s">&#39;test_trailing_slash&#39;</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="s">&quot;test_trailing_slash&quot;</span><span class="p">)</span>

    <span class="c"># Regression test for http://bugs.python.org/issue3677.</span></div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;Windows-specific&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PathsTests.test_UNC_path"><a class="viewcode-back" href="../../test.html#test.test_import.PathsTests.test_UNC_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_UNC_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;test_unc_path.py&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;testdata = &#39;test_unc_path&#39;&quot;</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="c"># Create the UNC path, like \\myhost\c$\foo\bar.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">socket</span>
        <span class="n">hn</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
        <span class="n">drive</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unc</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\\\\</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hn</span><span class="p">,</span> <span class="n">drive</span><span class="p">)</span>
        <span class="n">unc</span> <span class="o">+=</span> <span class="n">path</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">unc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="ow">in</span> <span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">EPERM</span><span class="p">,</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">):</span>
                <span class="c"># See issue #15338</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;cannot access administrative share </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unc</span><span class="p">,))</span>
            <span class="k">raise</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">unc</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&quot;test_unc_path&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;could not import &#39;test_unc_path&#39; from </span><span class="si">%r</span><span class="s">: </span><span class="si">%r</span><span class="s">&quot;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">unc</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">testdata</span><span class="p">,</span> <span class="s">&#39;test_unc_path&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__file__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">unc</span><span class="p">),</span> <span class="n">mod</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="s">&quot;test_unc_path&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="RelativeImportTests"><a class="viewcode-back" href="../../test.html#test.test_import.RelativeImportTests">[docs]</a><span class="k">class</span> <span class="nc">RelativeImportTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="RelativeImportTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.RelativeImportTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unload</span><span class="p">(</span><span class="s">&quot;test.relimport&quot;</span><span class="p">)</span></div>
    <span class="n">setUp</span> <span class="o">=</span> <span class="n">tearDown</span>

<div class="viewcode-block" id="RelativeImportTests.test_relimport_star"><a class="viewcode-back" href="../../test.html#test.test_import.RelativeImportTests.test_relimport_star">[docs]</a>    <span class="k">def</span> <span class="nf">test_relimport_star</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This will import * from .test_import.</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">relimport</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">relimport</span><span class="p">,</span> <span class="s">&quot;RelativeImportTests&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="RelativeImportTests.test_issue3221"><a class="viewcode-back" href="../../test.html#test.test_import.RelativeImportTests.test_issue3221">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue3221</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Note for mergers: the &#39;absolute&#39; tests from the 2.x branch</span>
        <span class="c"># are missing in Py3k because implicit relative imports are</span>
        <span class="c"># a thing of the past</span>
        <span class="c">#</span>
        <span class="c"># Regression test for http://bugs.python.org/issue3221.</span>
        <span class="k">def</span> <span class="nf">check_relative</span><span class="p">():</span>
            <span class="k">exec</span><span class="p">(</span><span class="s">&quot;from . import relimport&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>

        <span class="c"># Check relative import OK with __package__ and __name__ correct</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__package__</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="o">=</span><span class="s">&#39;test.notarealmodule&#39;</span><span class="p">)</span>
        <span class="n">check_relative</span><span class="p">()</span>

        <span class="c"># Check relative import OK with only __name__ wrong</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__package__</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="o">=</span><span class="s">&#39;notarealpkg.notarealmodule&#39;</span><span class="p">)</span>
        <span class="n">check_relative</span><span class="p">()</span>

        <span class="c"># Check relative import fails with only __package__ wrong</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__package__</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="o">=</span><span class="s">&#39;test.notarealmodule&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SystemError</span><span class="p">,</span> <span class="n">check_relative</span><span class="p">)</span>

        <span class="c"># Check relative import fails with __package__ and __name__ wrong</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__package__</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="o">=</span><span class="s">&#39;notarealpkg.notarealmodule&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SystemError</span><span class="p">,</span> <span class="n">check_relative</span><span class="p">)</span>

        <span class="c"># Check relative import fails with package set to a non-string</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__package__</span><span class="o">=</span><span class="nb">object</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">check_relative</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RelativeImportTests.test_absolute_import_without_future"><a class="viewcode-back" href="../../test.html#test.test_import.RelativeImportTests.test_absolute_import_without_future">[docs]</a>    <span class="k">def</span> <span class="nf">test_absolute_import_without_future</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If explicit relative import syntax is used, then do not try</span>
        <span class="c"># to perform an absolute import in the face of failure.</span>
        <span class="c"># Issue #7902.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.os</span> <span class="kn">import</span> <span class="n">sep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;explicit relative import triggered an &quot;</span>
                      <span class="s">&quot;implicit absolute import&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="OverridingImportBuiltinTests"><a class="viewcode-back" href="../../test.html#test.test_import.OverridingImportBuiltinTests">[docs]</a><span class="k">class</span> <span class="nc">OverridingImportBuiltinTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="OverridingImportBuiltinTests.test_override_builtin"><a class="viewcode-back" href="../../test.html#test.test_import.OverridingImportBuiltinTests.test_override_builtin">[docs]</a>    <span class="k">def</span> <span class="nf">test_override_builtin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that overriding builtins.__import__ can bypass sys.modules.</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="k">return</span> <span class="n">os</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">(),</span> <span class="n">os</span><span class="p">)</span>  <span class="c"># Quick sanity check.</span>

        <span class="k">with</span> <span class="n">swap_attr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="s">&quot;__import__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c"># Test what happens when we shadow __import__ in globals(); this</span>
        <span class="c"># currently does not impact the import process, but if this changes,</span>
        <span class="c"># other code will need to change, so keep this test as a tripwire.</span>
        <span class="k">with</span> <span class="n">swap_item</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="s">&quot;__import__&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">foo</span><span class="p">(),</span> <span class="n">os</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PycacheTests"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests">[docs]</a><span class="k">class</span> <span class="nc">PycacheTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Test the various PEP 3147 related behaviors.</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">cache_tag</span>

    <span class="k">def</span> <span class="nf">_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">forget</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">)</span>
        <span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

<div class="viewcode-block" id="PycacheTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# This is a test file written by test_import.py&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PycacheTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="s">&#39;Unexpected sys.path[0]&#39;</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="p">()</span>
</div>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="PycacheTests.test_import_pyc_path"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_import_pyc_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_import_pyc_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">))</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s">&#39;{}.{}.py{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">TESTFN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;c&#39;</span> <span class="k">if</span> <span class="n">__debug__</span> <span class="k">else</span> <span class="s">&#39;o&#39;</span><span class="p">))))</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;posix&#39;</span><span class="p">,</span>
                         <span class="s">&quot;test meaningful only on posix systems&quot;</span><span class="p">)</span>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;geteuid&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">geteuid</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&quot;due to varying filesystem permission semantics (issue #11956)&quot;</span><span class="p">)</span>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="PycacheTests.test_unwritable_directory"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_unwritable_directory">[docs]</a>    <span class="k">def</span> <span class="nf">test_unwritable_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When the umask causes the new __pycache__ directory to be</span>
        <span class="c"># unwritable, the import still succeeds but no .pyc file is written.</span>
        <span class="k">with</span> <span class="n">temp_umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o222</span><span class="p">):</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s">&#39;{}.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))))</span>
</div>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="PycacheTests.test_missing_source"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_missing_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># With PEP 3147 cache layout, removing the source but leaving the pyc</span>
        <span class="c"># file does not satisfy the import.</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">pyc_file</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pyc_file</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="n">forget</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="nb">__import__</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="PycacheTests.test_missing_source_legacy"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_missing_source_legacy">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_source_legacy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Like test_missing_source() except that for backward compatibility,</span>
        <span class="c"># when the pyc file lives where the py file would have been (and named</span>
        <span class="c"># without the tag), it is importable.  The __file__ of the imported</span>
        <span class="c"># module is the pyc location.</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="c"># pyc_file gets removed in _clean() via tearDown().</span>
        <span class="n">pyc_file</span> <span class="o">=</span> <span class="n">make_legacy_pyc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pyc_file</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="PycacheTests.test___cached__"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test___cached__">[docs]</a>    <span class="k">def</span> <span class="nf">test___cached__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Modules now also have an __cached__ that points to the pyc file.</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">pyc_file</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">pyc_file</span><span class="p">))</span>
</div>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="PycacheTests.test___cached___legacy_pyc"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test___cached___legacy_pyc">[docs]</a>    <span class="k">def</span> <span class="nf">test___cached___legacy_pyc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Like test___cached__() except that for backward compatibility,</span>
        <span class="c"># when the pyc file lives where the py file would have been (and named</span>
        <span class="c"># without the tag), it is importable.  The __cached__ of the imported</span>
        <span class="c"># module is the pyc location.</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="c"># pyc_file gets removed in _clean() via tearDown().</span>
        <span class="n">pyc_file</span> <span class="o">=</span> <span class="n">make_legacy_pyc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pyc_file</span><span class="p">)))</span>
</div>
    <span class="nd">@skip_if_dont_write_bytecode</span>
<div class="viewcode-block" id="PycacheTests.test_package___cached__"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_package___cached__">[docs]</a>    <span class="k">def</span> <span class="nf">test_package___cached__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Like test___cached__ but for packages.</span>
        <span class="k">def</span> <span class="nf">cleanup</span><span class="p">():</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>
        <span class="c"># Touch the __init__.py</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">)</span>
        <span class="n">init_pyc</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">init_pyc</span><span class="p">))</span>
        <span class="n">foo_pyc</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">foo_pyc</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PycacheTests.test_package___cached___from_pyc"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_package___cached___from_pyc">[docs]</a>    <span class="k">def</span> <span class="nf">test_package___cached___from_pyc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Like test___cached__ but ensuring __cached__ when imported from a</span>
        <span class="c"># PEP 3147 pyc file.</span>
        <span class="k">def</span> <span class="nf">cleanup</span><span class="p">():</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">)</span>
            <span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>
        <span class="c"># Touch the __init__.py</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">)</span>
        <span class="n">init_pyc</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">init_pyc</span><span class="p">))</span>
        <span class="n">foo_pyc</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;pep3147&#39;</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;pep3147.foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">foo_pyc</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PycacheTests.test_recompute_pyc_same_second"><a class="viewcode-back" href="../../test.html#test.test_import.PycacheTests.test_recompute_pyc_same_second">[docs]</a>    <span class="k">def</span> <span class="nf">test_recompute_pyc_same_second</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Even when the source file doesn&#39;t change timestamp, a change in</span>
        <span class="c"># source size is enough to trigger recomputation of the pyc file.</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="n">unload</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;x = 5&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestSymbolicallyLinkedPackage"><a class="viewcode-back" href="../../test.html#test.test_import.TestSymbolicallyLinkedPackage">[docs]</a><span class="k">class</span> <span class="nc">TestSymbolicallyLinkedPackage</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">package_name</span> <span class="o">=</span> <span class="s">&#39;sample&#39;</span>
    <span class="n">tagged</span> <span class="o">=</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s">&#39;-tagged&#39;</span>

<div class="viewcode-block" id="TestSymbolicallyLinkedPackage.setUp"><a class="viewcode-back" href="../../test.html#test.test_import.TestSymbolicallyLinkedPackage.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagged</span><span class="p">)</span>
        <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_sys_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>

        <span class="c"># create a sample package; imagine you have a package with a tag and</span>
        <span class="c">#  you want to symbolically link it from its untagged name.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged</span><span class="p">)</span>
        <span class="n">init_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagged</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">)</span>
        <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">create_empty_file</span><span class="p">(</span><span class="n">init_file</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">init_file</span><span class="p">)</span>

        <span class="c"># now create a symlink to the tagged package</span>
        <span class="c"># sample -&gt; sample-tagged</span>
        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span> <span class="n">target_is_directory</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">),</span> <span class="bp">True</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestSymbolicallyLinkedPackage.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.TestSymbolicallyLinkedPackage.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_sys_path</span>

    <span class="c"># regression test for issue6727</span></div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span>
        <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;getwindowsversion&#39;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">getwindowsversion</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s">&quot;Windows Vista or later required&quot;</span><span class="p">)</span>
    <span class="nd">@test.support.skip_unless_symlink</span>
<div class="viewcode-block" id="TestSymbolicallyLinkedPackage.test_symlinked_dir_importable"><a class="viewcode-back" href="../../test.html#test.test_import.TestSymbolicallyLinkedPackage.test_symlinked_dir_importable">[docs]</a>    <span class="k">def</span> <span class="nf">test_symlinked_dir_importable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># make sure sample can only be imported from the current directory.</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>

        <span class="c"># Try to import the package</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>

</div></div>
<span class="nd">@cpython_only</span>
<div class="viewcode-block" id="ImportlibBootstrapTests"><a class="viewcode-back" href="../../test.html#test.test_import.ImportlibBootstrapTests">[docs]</a><span class="k">class</span> <span class="nc">ImportlibBootstrapTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># These tests check that importlib is bootstrapped.</span>

<div class="viewcode-block" id="ImportlibBootstrapTests.test_frozen_importlib"><a class="viewcode-back" href="../../test.html#test.test_import.ImportlibBootstrapTests.test_frozen_importlib">[docs]</a>    <span class="k">def</span> <span class="nf">test_frozen_importlib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;_frozen_importlib&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportlibBootstrapTests.test_frozen_importlib_is_bootstrap"><a class="viewcode-back" href="../../test.html#test.test_import.ImportlibBootstrapTests.test_frozen_importlib_is_bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">test_frozen_importlib_is_bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">_bootstrap</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;_frozen_importlib&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">_bootstrap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;importlib._bootstrap&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__package__</span><span class="p">,</span> <span class="s">&#39;importlib&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">__file__</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;_bootstrap.py&#39;</span><span class="p">),</span> <span class="n">mod</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportlibBootstrapTests.test_there_can_be_only_one"><a class="viewcode-back" href="../../test.html#test.test_import.ImportlibBootstrapTests.test_there_can_be_only_one">[docs]</a>    <span class="k">def</span> <span class="nf">test_there_can_be_only_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #15386 revealed a tricky loophole in the bootstrapping</span>
        <span class="c"># This test is technically redundant, since the bug caused importing</span>
        <span class="c"># this test module to crash completely, but it helps prove the point</span>
        <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">machinery</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;_frozen_importlib&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">machinery</span><span class="o">.</span><span class="n">FileFinder</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">FileFinder</span><span class="p">)</span>

</div></div>
<span class="nd">@cpython_only</span>
<div class="viewcode-block" id="GetSourcefileTests"><a class="viewcode-back" href="../../test.html#test.test_import.GetSourcefileTests">[docs]</a><span class="k">class</span> <span class="nc">GetSourcefileTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Test importlib._bootstrap._get_sourcefile() as used by the C API.</span>

<span class="sd">    Because of the peculiarities of the need of this function, the tests are</span>
<span class="sd">    knowingly whitebox tests.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GetSourcefileTests.test_get_sourcefile"><a class="viewcode-back" href="../../test.html#test.test_import.GetSourcefileTests.test_get_sourcefile">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_sourcefile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given a valid bytecode path, return the path to the corresponding</span>
        <span class="c"># source file if it exists.</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s">&#39;importlib._bootstrap._path_isfile&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_path_isfile</span><span class="p">:</span>
            <span class="n">_path_isfile</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.pyc&#39;</span>
            <span class="n">expect</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">_get_sourcefile</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSourcefileTests.test_get_sourcefile_no_source"><a class="viewcode-back" href="../../test.html#test.test_import.GetSourcefileTests.test_get_sourcefile_no_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_sourcefile_no_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given a valid bytecode path without a corresponding source path,</span>
        <span class="c"># return the original bytecode path.</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s">&#39;importlib._bootstrap._path_isfile&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_path_isfile</span><span class="p">:</span>
            <span class="n">_path_isfile</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.pyc&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">_get_sourcefile</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSourcefileTests.test_get_sourcefile_bad_ext"><a class="viewcode-back" href="../../test.html#test.test_import.GetSourcefileTests.test_get_sourcefile_bad_ext">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_sourcefile_bad_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given a path with an invalid bytecode extension, return the</span>
        <span class="c"># bytecode path passed as the argument.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">TESTFN</span> <span class="o">+</span> <span class="s">&#39;.bad_ext&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">_get_sourcefile</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ImportTracebackTests"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests">[docs]</a><span class="k">class</span> <span class="nc">ImportTracebackTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="ImportTracebackTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.tearDown"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_path</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.create_module"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.create_module">[docs]</a>    <span class="k">def</span> <span class="nf">create_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s">&quot;.py&quot;</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">mod</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">unload</span><span class="p">,</span> <span class="n">mod</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fname</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.assert_traceback"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.assert_traceback">[docs]</a>    <span class="k">def</span> <span class="nf">assert_traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
        <span class="n">deduped_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">tb</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_frame</span><span class="o">.</span><span class="n">f_code</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_filename</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">deduped_files</span> <span class="ow">or</span> <span class="n">fn</span> <span class="o">!=</span> <span class="n">deduped_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">deduped_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_next</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deduped_files</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">deduped_files</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">pat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">deduped_files</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_nonexistent_module"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_nonexistent_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonexistent_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># assertRaises() clears __traceback__</span>
            <span class="kn">import</span> <span class="nn">nonexistent_xyzzy</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ImportError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_nonexistent_module_nested"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_nonexistent_module_nested">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonexistent_module_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;import nonexistent_xyzzy&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">foo</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ImportError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_exec_failure"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_exec_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_exec_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;1/0&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">foo</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ZeroDivisionError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_exec_failure_nested"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_exec_failure_nested">[docs]</a>    <span class="k">def</span> <span class="nf">test_exec_failure_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;import bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;1/0&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">foo</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ZeroDivisionError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;foo.py&#39;</span><span class="p">,</span> <span class="s">&#39;bar.py&#39;</span><span class="p">])</span>

    <span class="c"># A few more examples from issue #15425</span></div>
<div class="viewcode-block" id="ImportTracebackTests.test_syntax_error"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_syntax_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_syntax_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;invalid syntax is invalid&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">foo</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;SyntaxError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">])</span>
</div>
    <span class="k">def</span> <span class="nf">_setup_broken_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="n">pkg_name</span> <span class="o">=</span> <span class="s">&quot;_parent_foo&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">unload</span><span class="p">,</span> <span class="n">pkg_name</span><span class="p">)</span>
        <span class="n">pkg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="n">pkg_name</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">)</span>
        <span class="c"># Touch the __init__.py</span>
        <span class="n">init_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">bar_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">,</span> <span class="s">&#39;bar.py&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bar_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">init_path</span><span class="p">,</span> <span class="n">bar_path</span>

<div class="viewcode-block" id="ImportTracebackTests.test_broken_submodule"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_broken_submodule">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_submodule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">init_path</span><span class="p">,</span> <span class="n">bar_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_broken_package</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;1/0&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">_parent_foo.bar</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ZeroDivisionError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="n">bar_path</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_broken_from"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_broken_from">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">init_path</span><span class="p">,</span> <span class="n">bar_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_broken_package</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;1/0&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">_parent_foo</span> <span class="kn">import</span> <span class="n">bar</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ImportError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="n">bar_path</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_broken_parent"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_broken_parent">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">init_path</span><span class="p">,</span> <span class="n">bar_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_broken_package</span><span class="p">(</span><span class="s">&quot;1/0&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">_parent_foo.bar</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ZeroDivisionError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="n">init_path</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ImportTracebackTests.test_broken_parent_from"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_broken_parent_from">[docs]</a>    <span class="k">def</span> <span class="nf">test_broken_parent_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">init_path</span><span class="p">,</span> <span class="n">bar_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_broken_package</span><span class="p">(</span><span class="s">&quot;1/0&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">_parent_foo</span> <span class="kn">import</span> <span class="n">bar</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ZeroDivisionError should have been raised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="n">init_path</span><span class="p">])</span>
</div>
    <span class="nd">@cpython_only</span>
<div class="viewcode-block" id="ImportTracebackTests.test_import_bug"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_import_bug">[docs]</a>    <span class="k">def</span> <span class="nf">test_import_bug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># We simulate a bug in importlib and check that it&#39;s not stripped</span>
        <span class="c"># away from the traceback.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_module</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">importlib</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;_frozen_importlib&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;load_module&#39;</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">SourceLoader</span><span class="p">):</span>
            <span class="n">old_exec_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">SourceLoader</span><span class="o">.</span><span class="n">exec_module</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_exec_module</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">exec_module</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
            <span class="n">importlib</span><span class="o">.</span><span class="n">SourceLoader</span><span class="o">.</span><span class="n">exec_module</span> <span class="o">=</span> <span class="n">exec_module</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">foo</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">tb</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;ZeroDivisionError should have been raised&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">[</span><span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;&lt;frozen importlib&#39;</span><span class="p">,</span> <span class="n">__file__</span><span class="p">])</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">old_exec_module</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">importlib</span><span class="o">.</span><span class="n">SourceLoader</span><span class="o">.</span><span class="n">exec_module</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">importlib</span><span class="o">.</span><span class="n">SourceLoader</span><span class="o">.</span><span class="n">exec_module</span> <span class="o">=</span> <span class="n">old_exec_module</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">TESTFN_UNENCODABLE</span><span class="p">,</span> <span class="s">&#39;need TESTFN_UNENCODABLE&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="ImportTracebackTests.test_unencodable_filename"><a class="viewcode-back" href="../../test.html#test.test_import.ImportTracebackTests.test_unencodable_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_unencodable_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #11619: The Python parser and the import machinery must not</span>
        <span class="c"># encode filenames, especially on Windows</span>
        <span class="n">pyname</span> <span class="o">=</span> <span class="n">script_helper</span><span class="o">.</span><span class="n">make_script</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">TESTFN_UNENCODABLE</span><span class="p">,</span> <span class="s">&#39;pass&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">pyname</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">script_helper</span><span class="o">.</span><span class="n">assert_python_ok</span><span class="p">(</span><span class="s">&quot;-c&quot;</span><span class="p">,</span> <span class="s">&quot;mod = __import__(%a)&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                                       <span class="n">__isolated</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Test needs to be a package, so we can do relative imports.</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>