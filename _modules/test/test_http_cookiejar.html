

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_http_cookiejar &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_http_cookiejar</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_http_cookiejar</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Tests for http/cookiejar.py.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">test.support</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="kn">from</span> <span class="nn">http.cookiejar</span> <span class="kn">import</span> <span class="p">(</span><span class="n">time2isoz</span><span class="p">,</span> <span class="n">http2time</span><span class="p">,</span> <span class="n">iso2time</span><span class="p">,</span> <span class="n">time2netscape</span><span class="p">,</span>
     <span class="n">parse_ns_headers</span><span class="p">,</span> <span class="n">join_header_words</span><span class="p">,</span> <span class="n">split_header_words</span><span class="p">,</span> <span class="n">Cookie</span><span class="p">,</span>
     <span class="n">CookieJar</span><span class="p">,</span> <span class="n">DefaultCookiePolicy</span><span class="p">,</span> <span class="n">LWPCookieJar</span><span class="p">,</span> <span class="n">MozillaCookieJar</span><span class="p">,</span>
     <span class="n">LoadError</span><span class="p">,</span> <span class="n">lwp_cookie_str</span><span class="p">,</span> <span class="n">DEFAULT_HTTP_PORT</span><span class="p">,</span> <span class="n">escape_path</span><span class="p">,</span>
     <span class="n">reach</span><span class="p">,</span> <span class="n">is_HDN</span><span class="p">,</span> <span class="n">domain_match</span><span class="p">,</span> <span class="n">user_domain_match</span><span class="p">,</span> <span class="n">request_path</span><span class="p">,</span>
     <span class="n">request_port</span><span class="p">,</span> <span class="n">request_host</span><span class="p">)</span>


<div class="viewcode-block" id="DateTimeTests"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests">[docs]</a><span class="k">class</span> <span class="nc">DateTimeTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="DateTimeTests.test_time2isoz"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_time2isoz">[docs]</a>    <span class="k">def</span> <span class="nf">test_time2isoz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">base</span> <span class="o">=</span> <span class="mi">1019227000</span>
        <span class="n">day</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">3600</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">time2isoz</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="s">&quot;2002-04-19 14:36:40Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">time2isoz</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="n">day</span><span class="p">),</span> <span class="s">&quot;2002-04-20 14:36:40Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">time2isoz</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">day</span><span class="p">),</span> <span class="s">&quot;2002-04-21 14:36:40Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">time2isoz</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">day</span><span class="p">),</span> <span class="s">&quot;2002-04-22 14:36:40Z&quot;</span><span class="p">)</span>

        <span class="n">az</span> <span class="o">=</span> <span class="n">time2isoz</span><span class="p">()</span>
        <span class="n">bz</span> <span class="o">=</span> <span class="n">time2isoz</span><span class="p">(</span><span class="mi">500000</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="p">(</span><span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s">r&quot;^\d{4}-\d\d-\d\d \d\d:\d\d:\d\dZ$&quot;</span><span class="p">,</span>
                             <span class="s">&quot;bad time2isoz format: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DateTimeTests.test_http2time"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_http2time">[docs]</a>    <span class="k">def</span> <span class="nf">test_http2time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">parse_date</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">http2time</span><span class="p">(</span><span class="n">text</span><span class="p">))[:</span><span class="mi">6</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s">&quot;01 Jan 2001&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="c"># this test will break around year 2070</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s">&quot;03-Feb-20&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="c"># this test will break around year 2048</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s">&quot;03-Feb-98&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1998</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DateTimeTests.test_http2time_formats"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_http2time_formats">[docs]</a>    <span class="k">def</span> <span class="nf">test_http2time_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># test http2time for supported dates.  Test cases with 2 digit year</span>
        <span class="c"># will probably break in year 2044.</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
         <span class="s">&#39;Thu, 03 Feb 1994 00:00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># proposed new HTTP format</span>
         <span class="s">&#39;Thursday, 03-Feb-94 00:00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># old rfc850 HTTP format</span>
         <span class="s">&#39;Thursday, 03-Feb-1994 00:00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># broken rfc850 HTTP format</span>

         <span class="s">&#39;03 Feb 1994 00:00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># HTTP format (no weekday)</span>
         <span class="s">&#39;03-Feb-94 00:00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># old rfc850 (no weekday)</span>
         <span class="s">&#39;03-Feb-1994 00:00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># broken rfc850 (no weekday)</span>
         <span class="s">&#39;03-Feb-1994 00:00 GMT&#39;</span><span class="p">,</span>  <span class="c"># broken rfc850 (no weekday, no seconds)</span>
         <span class="s">&#39;03-Feb-1994 00:00&#39;</span><span class="p">,</span>  <span class="c"># broken rfc850 (no weekday, no seconds, no tz)</span>
         <span class="s">&#39;02-Feb-1994 24:00&#39;</span><span class="p">,</span>  <span class="c"># broken rfc850 (no weekday, no seconds,</span>
                               <span class="c"># no tz) using hour 24 with yesterday date</span>

         <span class="s">&#39;03-Feb-94&#39;</span><span class="p">,</span>  <span class="c"># old rfc850 HTTP format (no weekday, no time)</span>
         <span class="s">&#39;03-Feb-1994&#39;</span><span class="p">,</span>  <span class="c"># broken rfc850 HTTP format (no weekday, no time)</span>
         <span class="s">&#39;03 Feb 1994&#39;</span><span class="p">,</span>  <span class="c"># proposed new HTTP format (no weekday, no time)</span>

         <span class="c"># A few tests with extra space at various places</span>
         <span class="s">&#39;  03   Feb   1994  0:00  &#39;</span><span class="p">,</span>
         <span class="s">&#39;  03-Feb-1994  &#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">test_t</span> <span class="o">=</span> <span class="mi">760233600</span>  <span class="c"># assume broken POSIX counting of seconds</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">time2isoz</span><span class="p">(</span><span class="n">test_t</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="s">&quot;1994-02-03 00:00:00Z&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span>
                         <span class="s">&quot;</span><span class="si">%s</span><span class="s">  =&gt;  &#39;</span><span class="si">%s</span><span class="s">&#39; (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test_t</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http2time</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">test_t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http2time</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="n">test_t</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http2time</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">test_t</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="DateTimeTests.test_http2time_garbage"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_http2time_garbage">[docs]</a>    <span class="k">def</span> <span class="nf">test_http2time_garbage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;Garbage&#39;</span><span class="p">,</span>
            <span class="s">&#39;Mandag 16. September 1996&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-00-1980&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-13-1980&#39;</span><span class="p">,</span>
            <span class="s">&#39;00-01-1980&#39;</span><span class="p">,</span>
            <span class="s">&#39;32-01-1980&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-01-1980 25:00:00&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-01-1980 00:61:00&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-01-1980 00:00:62&#39;</span><span class="p">,</span>
            <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">http2time</span><span class="p">(</span><span class="n">test</span><span class="p">),</span>
                              <span class="s">&quot;http2time(</span><span class="si">%s</span><span class="s">) is not None</span><span class="se">\n</span><span class="s">&quot;</span>
                              <span class="s">&quot;http2time(test) </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">http2time</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="DateTimeTests.test_iso2time"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_iso2time">[docs]</a>    <span class="k">def</span> <span class="nf">test_iso2time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">parse_date</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">iso2time</span><span class="p">(</span><span class="n">text</span><span class="p">))[:</span><span class="mi">6</span><span class="p">]</span>

        <span class="c"># ISO 8601 compact format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s">&quot;19940203T141529Z&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1994</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">29</span><span class="p">))</span>

        <span class="c"># ISO 8601 with time behind UTC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s">&quot;1994-02-03 07:15:29 -0700&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1994</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">29</span><span class="p">))</span>

        <span class="c"># ISO 8601 with time ahead of UTC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s">&quot;1994-02-03 19:45:29 +0530&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="mi">1994</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">29</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DateTimeTests.test_iso2time_formats"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_iso2time_formats">[docs]</a>    <span class="k">def</span> <span class="nf">test_iso2time_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># test iso2time for supported dates.</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;1994-02-03 00:00:00 -0000&#39;</span><span class="p">,</span> <span class="c"># ISO 8601 format</span>
            <span class="s">&#39;1994-02-03 00:00:00 +0000&#39;</span><span class="p">,</span> <span class="c"># ISO 8601 format</span>
            <span class="s">&#39;1994-02-03 00:00:00&#39;</span><span class="p">,</span>       <span class="c"># zone is optional</span>
            <span class="s">&#39;1994-02-03&#39;</span><span class="p">,</span>                <span class="c"># only date</span>
            <span class="s">&#39;1994-02-03T00:00:00&#39;</span><span class="p">,</span>       <span class="c"># Use T as separator</span>
            <span class="s">&#39;19940203&#39;</span><span class="p">,</span>                  <span class="c"># only date</span>
            <span class="s">&#39;1994-02-02 24:00:00&#39;</span><span class="p">,</span>       <span class="c"># using hour-24 yesterday date</span>
            <span class="s">&#39;19940203T000000Z&#39;</span><span class="p">,</span>          <span class="c"># ISO 8601 compact format</span>

            <span class="c"># A few tests with extra space at various places</span>
            <span class="s">&#39;  1994-02-03 &#39;</span><span class="p">,</span>
            <span class="s">&#39;  1994-02-03T00:00:00  &#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">test_t</span> <span class="o">=</span> <span class="mi">760233600</span>  <span class="c"># assume broken POSIX counting of seconds</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">iso2time</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">test_t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">iso2time</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="n">test_t</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">iso2time</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">test_t</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="DateTimeTests.test_iso2time_garbage"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.DateTimeTests.test_iso2time_garbage">[docs]</a>    <span class="k">def</span> <span class="nf">test_iso2time_garbage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;Garbage&#39;</span><span class="p">,</span>
            <span class="s">&#39;Thursday, 03-Feb-94 00:00:00 GMT&#39;</span><span class="p">,</span>
            <span class="s">&#39;1980-00-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;1980-13-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;1980-01-00&#39;</span><span class="p">,</span>
            <span class="s">&#39;1980-01-32&#39;</span><span class="p">,</span>
            <span class="s">&#39;1980-01-01 25:00:00&#39;</span><span class="p">,</span>
            <span class="s">&#39;1980-01-01 00:61:00&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-01-1980 00:00:62&#39;</span><span class="p">,</span>
            <span class="s">&#39;01-01-1980T00:00:62&#39;</span><span class="p">,</span>
            <span class="s">&#39;19800101T250000Z&#39;</span>
            <span class="s">&#39;1980-01-01 00:00:00 -2500&#39;</span><span class="p">,</span>
            <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">iso2time</span><span class="p">(</span><span class="n">test</span><span class="p">),</span>
                              <span class="s">&quot;iso2time(</span><span class="si">%s</span><span class="s">) is not None</span><span class="se">\n</span><span class="s">&quot;</span>
                              <span class="s">&quot;iso2time(test) </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">iso2time</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>

</div></div>
<div class="viewcode-block" id="HeaderTests"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests">[docs]</a><span class="k">class</span> <span class="nc">HeaderTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="HeaderTests.test_parse_ns_headers"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests.test_parse_ns_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_ns_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># quotes should be stripped</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[[(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;expires&#39;</span><span class="p">,</span> <span class="mi">2209069412</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)]]</span>
        <span class="k">for</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s">&#39;foo=bar; expires=01 Jan 2040 22:23:32 GMT&#39;</span><span class="p">,</span>
            <span class="s">&#39;foo=bar; expires=&quot;01 Jan 2040 22:23:32 GMT&quot;&#39;</span><span class="p">,</span>
            <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_ns_headers</span><span class="p">([</span><span class="n">hdr</span><span class="p">]),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HeaderTests.test_parse_ns_headers_version"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests.test_parse_ns_headers_version">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_ns_headers_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># quotes should be stripped</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[[(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">)]]</span>
        <span class="k">for</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s">&#39;foo=bar; version=&quot;1&quot;&#39;</span><span class="p">,</span>
            <span class="s">&#39;foo=bar; Version=&quot;1&quot;&#39;</span><span class="p">,</span>
            <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_ns_headers</span><span class="p">([</span><span class="n">hdr</span><span class="p">]),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HeaderTests.test_parse_ns_headers_special_names"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests.test_parse_ns_headers_special_names">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_ns_headers_special_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># names such as &#39;expires&#39; are not special in first name=value pair</span>
        <span class="c"># of Set-Cookie: header</span>
        <span class="c"># Cookie with name &#39;expires&#39;</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="s">&#39;expires=01 Jan 2040 22:23:32 GMT&#39;</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[[(</span><span class="s">&quot;expires&quot;</span><span class="p">,</span> <span class="s">&quot;01 Jan 2040 22:23:32 GMT&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_ns_headers</span><span class="p">([</span><span class="n">hdr</span><span class="p">]),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HeaderTests.test_join_header_words"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests.test_join_header_words">[docs]</a>    <span class="k">def</span> <span class="nf">test_join_header_words</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">joined</span> <span class="o">=</span> <span class="n">join_header_words</span><span class="p">([[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="s">&quot;foo; bar=baz&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">join_header_words</span><span class="p">([[]]),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HeaderTests.test_split_header_words"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests.test_split_header_words">[docs]</a>    <span class="k">def</span> <span class="nf">test_split_header_words</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;foo=bar&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;   foo   &quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;   foo=   &quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;   foo=&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;   foo=   ; &quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;   foo=   ; bar= baz &quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;foo=bar bar=baz&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)]]),</span>
            <span class="c"># doesn&#39;t really matter if this next fails, but it works ATM</span>
            <span class="p">(</span><span class="s">&quot;foo= bar=baz&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar=baz&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;foo=bar;bar=baz&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&#39;foo bar baz&#39;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">&quot;a, b, c&quot;</span><span class="p">,</span> <span class="p">[[(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)],</span> <span class="p">[(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)],</span> <span class="p">[(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]]),</span>
            <span class="p">(</span><span class="s">r&#39;foo; bar=baz, spam=, foo=&quot;\,\;\&quot;&quot;, bar= &#39;</span><span class="p">,</span>
             <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)],</span>
              <span class="p">[(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)],</span> <span class="p">[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&#39;,;&quot;&#39;</span><span class="p">)],</span> <span class="p">[(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]]),</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">expect</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">split_header_words</span><span class="p">([</span><span class="n">arg</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">io</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;(error -- traceback follows)</span><span class="se">\n\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span>  <span class="n">expect</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">When parsing: &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">Expected:     &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">Got:          &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HeaderTests.test_roundtrip"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.HeaderTests.test_roundtrip">[docs]</a>    <span class="k">def</span> <span class="nf">test_roundtrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;foo=bar&quot;</span><span class="p">,</span> <span class="s">&quot;foo=bar&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;   foo   &quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;foo=&quot;</span><span class="p">,</span> <span class="s">&#39;foo=&quot;&quot;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;foo=bar bar=baz&quot;</span><span class="p">,</span> <span class="s">&quot;foo=bar; bar=baz&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;foo=bar;bar=baz&quot;</span><span class="p">,</span> <span class="s">&quot;foo=bar; bar=baz&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;foo bar baz&#39;</span><span class="p">,</span> <span class="s">&quot;foo; bar; baz&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&#39;foo=&quot;\&quot;&quot; bar=&quot;</span><span class="se">\\</span><span class="s">&quot;&#39;</span><span class="p">,</span> <span class="s">r&#39;foo=&quot;\&quot;&quot;; bar=&quot;</span><span class="se">\\</span><span class="s">&quot;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;foo,,,bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo, bar&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;foo=bar,bar=baz&#39;</span><span class="p">,</span> <span class="s">&#39;foo=bar, bar=baz&#39;</span><span class="p">),</span>

            <span class="p">(</span><span class="s">&#39;text/html; charset=iso-8859-1&#39;</span><span class="p">,</span>
             <span class="s">&#39;text/html; charset=&quot;iso-8859-1&quot;&#39;</span><span class="p">),</span>

            <span class="p">(</span><span class="s">&#39;foo=&quot;bar&quot;; port=&quot;80,81&quot;; discard, bar=baz&#39;</span><span class="p">,</span>
             <span class="s">&#39;foo=bar; port=&quot;80,81&quot;; discard, bar=baz&#39;</span><span class="p">),</span>

            <span class="p">(</span><span class="s">r&#39;Basic realm=&quot;\&quot;foo</span><span class="se">\\\\</span><span class="s">bar\&quot;&quot;&#39;</span><span class="p">,</span>
             <span class="s">r&#39;Basic; realm=&quot;\&quot;foo</span><span class="se">\\\\</span><span class="s">bar\&quot;&quot;&#39;</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">expect</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">split_header_words</span><span class="p">([</span><span class="n">arg</span><span class="p">])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">join_header_words</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">When parsing: &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">Expected:     &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">Got:          &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">Input was:    &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="FakeResponse"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.FakeResponse">[docs]</a><span class="k">class</span> <span class="nc">FakeResponse</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[],</span> <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        headers: list of RFC822-style &#39;Key: value&#39; strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>
<div class="viewcode-block" id="FakeResponse.info"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.FakeResponse.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>
</div></div>
<div class="viewcode-block" id="interact_2965"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.interact_2965">[docs]</a><span class="k">def</span> <span class="nf">interact_2965</span><span class="p">(</span><span class="n">cookiejar</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">set_cookie_hdrs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_interact</span><span class="p">(</span><span class="n">cookiejar</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">set_cookie_hdrs</span><span class="p">,</span> <span class="s">&quot;Set-Cookie2&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="interact_netscape"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.interact_netscape">[docs]</a><span class="k">def</span> <span class="nf">interact_netscape</span><span class="p">(</span><span class="n">cookiejar</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">set_cookie_hdrs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_interact</span><span class="p">(</span><span class="n">cookiejar</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">set_cookie_hdrs</span><span class="p">,</span> <span class="s">&quot;Set-Cookie&quot;</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_interact</span><span class="p">(</span><span class="n">cookiejar</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">set_cookie_hdrs</span><span class="p">,</span> <span class="n">hdr_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform a single request / response cycle, returning Cookie: header.&quot;&quot;&quot;</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">cookiejar</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="n">cookie_hdr</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="n">set_cookie_hdrs</span><span class="p">:</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hdr_name</span><span class="p">,</span> <span class="n">hdr</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">cookiejar</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cookie_hdr</span>


<div class="viewcode-block" id="FileCookieJarTests"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.FileCookieJarTests">[docs]</a><span class="k">class</span> <span class="nc">FileCookieJarTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="FileCookieJarTests.test_lwp_valueless_cookie"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.FileCookieJarTests.test_lwp_valueless_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">test_lwp_valueless_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># cookies with no value should be saved and loaded consistently</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">LWPCookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;boo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;boo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">LWPCookieJar</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;boo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FileCookieJarTests.test_bad_magic"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.FileCookieJarTests.test_bad_magic">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_magic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># OSErrors (eg. file doesn&#39;t exist) are allowed to propagate</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="k">for</span> <span class="n">cookiejar_class</span> <span class="ow">in</span> <span class="n">LWPCookieJar</span><span class="p">,</span> <span class="n">MozillaCookieJar</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">cookiejar_class</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;for this test to work, a file with this &quot;</span>
                                <span class="s">&quot;filename should not exist&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="c"># an OSError subclass (likely FileNotFoundError), but not</span>
                <span class="c"># LoadError</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">LoadError</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;expected OSError for invalid filename&quot;</span><span class="p">)</span>
        <span class="c"># Invalid contents of cookies file (eg. bad magic string)</span>
        <span class="c"># causes a LoadError.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;oops</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cookiejar_class</span> <span class="ow">in</span> <span class="n">LWPCookieJar</span><span class="p">,</span> <span class="n">MozillaCookieJar</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">cookiejar_class</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">LoadError</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span> <span class="k">pass</span>
</div></div>
<div class="viewcode-block" id="CookieTests"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests">[docs]</a><span class="k">class</span> <span class="nc">CookieTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># XXX</span>
    <span class="c"># Get rid of string comparisons where not actually testing str / repr.</span>
    <span class="c"># .clear() etc.</span>
    <span class="c"># IP addresses like 50 (single number, no dot) and domain-matching</span>
    <span class="c">#  functions (and is_HDN)?  See draft RFC 2965 errata.</span>
    <span class="c"># Strictness switches</span>
    <span class="c"># is_third_party()</span>
    <span class="c"># unverifiability / third-party blocking</span>
    <span class="c"># Netscape cookies work the same as RFC 2965 with regard to port.</span>
    <span class="c"># Set-Cookie with negative max age.</span>
    <span class="c"># If turn RFC 2965 handling off, Set-Cookie2 cookies should not clobber</span>
    <span class="c">#  Set-Cookie cookies.</span>
    <span class="c"># Cookie2 should be sent if *any* cookies are not V1 (ie. V0 OR V2 etc.).</span>
    <span class="c"># Cookies (V1 and V0) with no expiry date should be set to be discarded.</span>
    <span class="c"># RFC 2965 Quoting:</span>
    <span class="c">#  Should accept unquoted cookie-attribute values?  check errata draft.</span>
    <span class="c">#   Which are required on the way in and out?</span>
    <span class="c">#  Should always return quoted cookie-attribute values?</span>
    <span class="c"># Proper testing of when RFC 2965 clobbers Netscape (waiting for errata).</span>
    <span class="c"># Path-match on return (same for V0 and V1).</span>
    <span class="c"># RFC 2965 acceptance and returning rules</span>
    <span class="c">#  Set-Cookie2 without version attribute is rejected.</span>

    <span class="c"># Netscape peculiarities list from Ronald Tschalar.</span>
    <span class="c"># The first two still need tests, the rest are covered.</span>
<span class="c">## - Quoting: only quotes around the expires value are recognized as such</span>
<span class="c">##   (and yes, some folks quote the expires value); quotes around any other</span>
<span class="c">##   value are treated as part of the value.</span>
<span class="c">## - White space: white space around names and values is ignored</span>
<span class="c">## - Default path: if no path parameter is given, the path defaults to the</span>
<span class="c">##   path in the request-uri up to, but not including, the last &#39;/&#39;. Note</span>
<span class="c">##   that this is entirely different from what the spec says.</span>
<span class="c">## - Commas and other delimiters: Netscape just parses until the next &#39;;&#39;.</span>
<span class="c">##   This means it will allow commas etc inside values (and yes, both</span>
<span class="c">##   commas and equals are commonly appear in the cookie value). This also</span>
<span class="c">##   means that if you fold multiple Set-Cookie header fields into one,</span>
<span class="c">##   comma-separated list, it&#39;ll be a headache to parse (at least my head</span>
<span class="c">##   starts hurting every time I think of that code).</span>
<span class="c">## - Expires: You&#39;ll get all sorts of date formats in the expires,</span>
<span class="c">##   including emtpy expires attributes (&quot;expires=&quot;). Be as flexible as you</span>
<span class="c">##   can, and certainly don&#39;t expect the weekday to be there; if you can&#39;t</span>
<span class="c">##   parse it, just ignore it and pretend it&#39;s a session cookie.</span>
<span class="c">## - Domain-matching: Netscape uses the 2-dot rule for _all_ domains, not</span>
<span class="c">##   just the 7 special TLD&#39;s listed in their spec. And folks rely on</span>
<span class="c">##   that...</span>

<div class="viewcode-block" id="CookieTests.test_domain_return_ok"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_domain_return_ok">[docs]</a>    <span class="k">def</span> <span class="nf">test_domain_return_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># test optimization: .domain_return_ok() should filter out most</span>
        <span class="c"># domains in the CookieJar before we try to access them (because that</span>
        <span class="c"># may require disk access -- in particular, with MSIECookieJar)</span>
        <span class="c"># This is only a rough check for performance reasons, so it&#39;s not too</span>
        <span class="c"># critical as long as it&#39;s sufficiently liberal.</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">ok</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;blah.com&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;rhubarb.blah.com&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;rhubarb.foo.bar.com&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;.foo.bar.com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;foo.bar.com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;.bar.com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.bar.com/&quot;</span><span class="p">,</span> <span class="s">&quot;com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.com/&quot;</span><span class="p">,</span> <span class="s">&quot;rhubarb.foo.com&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.com/&quot;</span><span class="p">,</span> <span class="s">&quot;.foo.com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.com/&quot;</span><span class="p">,</span> <span class="s">&quot;foo.com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo.com/&quot;</span><span class="p">,</span> <span class="s">&quot;com&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo/&quot;</span><span class="p">,</span> <span class="s">&quot;rhubarb.foo&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo/&quot;</span><span class="p">,</span> <span class="s">&quot;.foo&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo/&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo/&quot;</span><span class="p">,</span> <span class="s">&quot;foo.local&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;http://foo/&quot;</span><span class="p">,</span> <span class="s">&quot;.local&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="p">]:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">domain_return_ok</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_missing_value"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_missing_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># missing = sign in Cookie: header is regarded by Mozilla as a missing</span>
        <span class="c"># name, and by http.cookiejar as a missing value</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">MozillaCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;eggs&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;&quot;spam&quot;; path=/foo/&#39;</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;eggs&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&#39;/foo/&#39;</span><span class="p">][</span><span class="s">&#39;&quot;spam&quot;&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;&quot;spam&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lwp_cookie_str</span><span class="p">(</span><span class="n">cookie</span><span class="p">),</span> <span class="p">(</span>
            <span class="s">r&#39;&quot;spam&quot;; path=&quot;/foo/&quot;; domain=&quot;www.acme.com&quot;; &#39;</span>
            <span class="s">&#39;path_spec; discard; version=0&#39;</span><span class="p">))</span>
        <span class="n">old_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ignore_expires</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">MozillaCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">revert</span><span class="p">(</span><span class="n">ignore_expires</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="c"># cookies unchanged apart from lost info re. whether path was specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
            <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;path_specified=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;path_specified=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">False</span><span class="p">,</span>
                   <span class="n">old_str</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/foo/&quot;</span><span class="p">),</span>
                         <span class="s">&#39;&quot;spam&quot;; eggs&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_rfc2109_handling"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_rfc2109_handling">[docs]</a>    <span class="k">def</span> <span class="nf">test_rfc2109_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># RFC 2109 cookies are handled as RFC 2965 or Netscape cookies,</span>
        <span class="c"># dependent on policy settings</span>
        <span class="k">for</span> <span class="n">rfc2109_as_netscape</span><span class="p">,</span> <span class="n">rfc2965</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="c"># default according to rfc2965 if not explicitly specified</span>
            <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="c"># explicit rfc2109_as_netscape</span>
            <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>  <span class="c"># version None here means no cookie stored</span>
            <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]:</span>
            <span class="n">policy</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span>
                <span class="n">rfc2109_as_netscape</span><span class="o">=</span><span class="n">rfc2109_as_netscape</span><span class="p">,</span>
                <span class="n">rfc2965</span><span class="o">=</span><span class="n">rfc2965</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
            <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.example.com/&quot;</span><span class="p">,</span> <span class="s">&quot;ni=ni; Version=1&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.example.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;ni&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>  <span class="c"># didn&#39;t expect a stored cookie</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
                <span class="c"># 2965 cookies are unaffected</span>
                <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.example.com/&quot;</span><span class="p">,</span>
                              <span class="s">&quot;foo=bar; Version=1&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rfc2965</span><span class="p">:</span>
                    <span class="n">cookie2965</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.example.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie2965</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_ns_parser"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_ns_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_ns_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span>
                          <span class="s">&#39;spam=eggs; DoMain=.acme.com; port; blArgh=&quot;feep&quot;&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;ni=ni; port=80,8080&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com:80/&quot;</span><span class="p">,</span> <span class="s">&#39;nini=ni&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com:80/&quot;</span><span class="p">,</span> <span class="s">&#39;foo=bar; expires=&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com:80/&quot;</span><span class="p">,</span> <span class="s">&#39;spam=eggs; &#39;</span>
                          <span class="s">&#39;expires=&quot;Foo Bar 25 33:22:11 3022&quot;&#39;</span><span class="p">)</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;spam&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&quot;.acme.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain_specified</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">DEFAULT_HTTP_PORT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">port_specified</span><span class="p">)</span>
        <span class="c"># case is preserved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">has_nonstandard_attr</span><span class="p">(</span><span class="s">&quot;blArgh&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">has_nonstandard_attr</span><span class="p">(</span><span class="s">&quot;blargh&quot;</span><span class="p">))</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;ni&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&quot;www.acme.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">domain_specified</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="s">&quot;80,8080&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">port_specified</span><span class="p">)</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;nini&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">port_specified</span><span class="p">)</span>

        <span class="c"># invalid expires should not cause cookie to be dropped</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>
        <span class="n">spam</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">expires</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">spam</span><span class="o">.</span><span class="n">expires</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_ns_parser_special_names"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_ns_parser_special_names">[docs]</a>    <span class="k">def</span> <span class="nf">test_ns_parser_special_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># names such as &#39;expires&#39; are not special in first name=value pair</span>
        <span class="c"># of Set-Cookie: header</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;expires=eggs&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;version=eggs; spam=eggs&#39;</span><span class="p">)</span>

        <span class="n">cookies</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;expires&#39;</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_expires"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_expires">[docs]</a>    <span class="k">def</span> <span class="nf">test_expires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># if expires is in future, keep cookie...</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">time2netscape</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;spam=&quot;bar&quot;; expires=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                          <span class="n">future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time2netscape</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># ... and if in past or present, discard it</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;foo=&quot;eggs&quot;; expires=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                          <span class="n">now</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;spam=&quot;bar&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="c"># max-age takes precedence over expires, and zero max-age is request to</span>
        <span class="c"># delete both new cookie and any old matching cookie</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;eggs=&quot;bar&quot;; expires=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                          <span class="n">future</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;bar=&quot;bar&quot;; expires=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                          <span class="n">future</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;eggs=&quot;bar&quot;; &#39;</span>
                          <span class="s">&#39;expires=</span><span class="si">%s</span><span class="s">; max-age=0&#39;</span> <span class="o">%</span> <span class="n">future</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;bar=&quot;bar&quot;; &#39;</span>
                          <span class="s">&#39;max-age=0; expires=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">future</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># test expiry at end of session for cookies with no expires attribute</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.rhubarb.net/&quot;</span><span class="p">,</span> <span class="s">&#39;whum=&quot;fizz&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">clear_session_cookies</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;spam=&quot;bar&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="c"># XXX RFC 2965 expiry rules (some apply to V0 too)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_default_path"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_default_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># RFC 2965</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;spam=&quot;bar&quot;; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah&quot;</span><span class="p">,</span> <span class="s">&#39;eggs=&quot;bar&quot;; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/rhubarb&quot;</span><span class="p">,</span>
                      <span class="s">&#39;eggs=&quot;bar&quot;; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/blah/&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/rhubarb/&quot;</span><span class="p">,</span>
                      <span class="s">&#39;eggs=&quot;bar&quot;; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/blah/rhubarb/&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="c"># Netscape</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&#39;spam=&quot;bar&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah&quot;</span><span class="p">,</span> <span class="s">&#39;eggs=&quot;bar&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/rhubarb&quot;</span><span class="p">,</span> <span class="s">&#39;eggs=&quot;bar&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/blah&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/rhubarb/&quot;</span><span class="p">,</span> <span class="s">&#39;eggs=&quot;bar&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/blah/rhubarb&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="CookieTests.test_default_path_with_query"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_default_path_with_query">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_path_with_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cj</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;http://example.com/?spam/eggs&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;eggs=&quot;bar&quot;&#39;</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c"># Default path does not include query, so is &quot;/&quot;, not &quot;/?spam&quot;.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">cj</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;example.com&quot;</span><span class="p">])</span>
        <span class="c"># Cookie is sent back to the same URI.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_netscape</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="n">uri</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_escape_path"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_escape_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c"># quoted safe</span>
            <span class="p">(</span><span class="s">&quot;/foo</span><span class="si">%2f</span><span class="s">/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/foo</span><span class="si">%2F</span><span class="s">/bar&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;/foo</span><span class="si">%2F</span><span class="s">/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/foo</span><span class="si">%2F</span><span class="s">/bar&quot;</span><span class="p">),</span>
            <span class="c"># quoted %</span>
            <span class="p">(</span><span class="s">&quot;/foo</span><span class="si">%%</span><span class="s">/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/foo</span><span class="si">%%</span><span class="s">/bar&quot;</span><span class="p">),</span>
            <span class="c"># quoted unsafe</span>
            <span class="p">(</span><span class="s">&quot;/fo</span><span class="si">%19o</span><span class="s">/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/fo</span><span class="si">%19o</span><span class="s">/bar&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;/fo</span><span class="si">%7d</span><span class="s">o/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/fo%7Do/bar&quot;</span><span class="p">),</span>
            <span class="c"># unquoted safe</span>
            <span class="p">(</span><span class="s">&quot;/foo/bar&amp;&quot;</span><span class="p">,</span> <span class="s">&quot;/foo/bar&amp;&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;/foo//bar&quot;</span><span class="p">,</span> <span class="s">&quot;/foo//bar&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\176</span><span class="s">/foo/bar&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\176</span><span class="s">/foo/bar&quot;</span><span class="p">),</span>
            <span class="c"># unquoted unsafe</span>
            <span class="p">(</span><span class="s">&quot;/foo</span><span class="se">\031</span><span class="s">/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/foo%19/bar&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;/</span><span class="se">\175</span><span class="s">foo/bar&quot;</span><span class="p">,</span> <span class="s">&quot;/%7Dfoo/bar&quot;</span><span class="p">),</span>
            <span class="c"># unicode, latin-1 range</span>
            <span class="p">(</span><span class="s">&quot;/foo/bar</span><span class="se">\u00fc</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;/foo/bar%C3%BC&quot;</span><span class="p">),</span>     <span class="c"># UTF-8 encoded</span>
            <span class="c"># unicode</span>
            <span class="p">(</span><span class="s">&quot;/foo/bar</span><span class="se">\uabcd</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;/foo/bar</span><span class="si">%E</span><span class="s">A%AF%8D&quot;</span><span class="p">),</span>  <span class="c"># UTF-8 encoded</span>
            <span class="p">]</span>
        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">escape_path</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_request_path"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_request_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_request_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># with parameters</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
            <span class="s">&quot;http://www.example.com/rheum/rhaponticum;&quot;</span>
            <span class="s">&quot;foo=bar;sing=song?apples=pears&amp;spam=eggs#ni&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_path</span><span class="p">(</span><span class="n">req</span><span class="p">),</span>
                         <span class="s">&quot;/rheum/rhaponticum;foo=bar;sing=song&quot;</span><span class="p">)</span>
        <span class="c"># without parameters</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
            <span class="s">&quot;http://www.example.com/rheum/rhaponticum?&quot;</span>
            <span class="s">&quot;apples=pears&amp;spam=eggs#ni&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_path</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="s">&quot;/rheum/rhaponticum&quot;</span><span class="p">)</span>
        <span class="c"># missing final slash</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.example.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_path</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_request_port"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_request_port">[docs]</a>    <span class="k">def</span> <span class="nf">test_request_port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com:1234/&quot;</span><span class="p">,</span>
                                     <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Host&quot;</span><span class="p">:</span> <span class="s">&quot;www.acme.com:4321&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_port</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="s">&quot;1234&quot;</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span>
                                     <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Host&quot;</span><span class="p">:</span> <span class="s">&quot;www.acme.com:4321&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_port</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="n">DEFAULT_HTTP_PORT</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_request_host"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_request_host">[docs]</a>    <span class="k">def</span> <span class="nf">test_request_host</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># this request is illegal (RFC2616, 14.2.3)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://1.1.1.1/&quot;</span><span class="p">,</span>
                                     <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Host&quot;</span><span class="p">:</span> <span class="s">&quot;www.acme.com:80&quot;</span><span class="p">})</span>
        <span class="c"># libwww-perl wants this response, but that seems wrong (RFC 2616,</span>
        <span class="c"># section 5.2, point 1., and RFC 2965 section 1, paragraph 3)</span>
        <span class="c">#self.assertEqual(request_host(req), &quot;www.acme.com&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_host</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="s">&quot;1.1.1.1&quot;</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span>
                                     <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Host&quot;</span><span class="p">:</span> <span class="s">&quot;irrelevant.com&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_host</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="s">&quot;www.acme.com&quot;</span><span class="p">)</span>
        <span class="c"># port shouldn&#39;t be in request-host</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com:2345/resource.html&quot;</span><span class="p">,</span>
                                     <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Host&quot;</span><span class="p">:</span> <span class="s">&quot;www.acme.com:5432&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_host</span><span class="p">(</span><span class="n">req</span><span class="p">),</span> <span class="s">&quot;www.acme.com&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_is_HDN"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_is_HDN">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_HDN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;foo.bar.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;1foo2.3bar4.5com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;.foo.bar.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;..foo&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_HDN</span><span class="p">(</span><span class="s">&quot;foo.&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CookieTests.test_reach"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_reach">[docs]</a>    <span class="k">def</span> <span class="nf">test_reach</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">),</span> <span class="s">&quot;.acme.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;acme.com&quot;</span><span class="p">),</span> <span class="s">&quot;acme.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;acme.local&quot;</span><span class="p">),</span> <span class="s">&quot;.local&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;.local&quot;</span><span class="p">),</span> <span class="s">&quot;.local&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;.com&quot;</span><span class="p">),</span> <span class="s">&quot;.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">),</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reach</span><span class="p">(</span><span class="s">&quot;192.168.0.1&quot;</span><span class="p">),</span> <span class="s">&quot;192.168.0.1&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_domain_match"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_domain_match">[docs]</a>    <span class="k">def</span> <span class="nf">test_domain_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;192.168.1.1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;.168.1.1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;x.Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;.Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;a.b.c.com&quot;</span><span class="p">,</span> <span class="s">&quot;.c.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;.c.com&quot;</span><span class="p">,</span> <span class="s">&quot;a.b.c.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;example.local&quot;</span><span class="p">,</span> <span class="s">&quot;.local&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;blah.blah&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;.rhubarb.rhubarb&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">domain_match</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;acme.com&quot;</span><span class="p">,</span> <span class="s">&quot;acme.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;acme.com&quot;</span><span class="p">,</span> <span class="s">&quot;.acme.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;rhubarb.acme.com&quot;</span><span class="p">,</span> <span class="s">&quot;.acme.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;www.rhubarb.acme.com&quot;</span><span class="p">,</span> <span class="s">&quot;.acme.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;x.Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;.Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;y.com&quot;</span><span class="p">,</span> <span class="s">&quot;Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;.Y.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;.com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;com&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;m&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;.m&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;x.y.com&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;192.168.1.1&quot;</span><span class="p">))</span>
        <span class="c"># not both HDNs, so must string-compare equal to match</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;.168.1.1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>
        <span class="c"># empty string is a special case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user_domain_match</span><span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CookieTests.test_wrong_domain"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_wrong_domain">[docs]</a>    <span class="k">def</span> <span class="nf">test_wrong_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Cookies whose effective request-host name does not domain-match the</span>
        <span class="c"># domain are rejected.</span>

        <span class="c"># XXX far from complete</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.nasty.com/&quot;</span><span class="p">,</span>
                      <span class="s">&#39;foo=bar; domain=friendly.org; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_strict_domain"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_strict_domain">[docs]</a>    <span class="k">def</span> <span class="nf">test_strict_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Cookies whose domain is a country-code tld like .co.uk should</span>
        <span class="c"># not be set if CookiePolicy.strict_domain is true.</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">strict_domain</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">cj</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">cp</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="s">&quot;http://example.co.uk/&quot;</span><span class="p">,</span> <span class="s">&#39;no=problemo&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="s">&quot;http://example.co.uk/&quot;</span><span class="p">,</span>
                          <span class="s">&#39;okey=dokey; Domain=.example.co.uk&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cj</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pseudo_tld</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;.co.uk&quot;</span><span class="p">,</span> <span class="s">&quot;.org.za&quot;</span><span class="p">,</span> <span class="s">&quot;.tx.us&quot;</span><span class="p">,</span> <span class="s">&quot;.name.us&quot;</span><span class="p">]:</span>
            <span class="n">interact_netscape</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="s">&quot;http://example.</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="n">pseudo_tld</span><span class="p">,</span>
                              <span class="s">&#39;spam=eggs; Domain=.co.uk&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cj</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_two_component_domain_ns"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_two_component_domain_ns">[docs]</a>    <span class="k">def</span> <span class="nf">test_two_component_domain_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Netscape: .www.bar.com, www.bar.com, .bar.com, bar.com, no domain</span>
        <span class="c"># should all get accepted, as should .acme.com, acme.com and no domain</span>
        <span class="c"># for 2-component domains like acme.com.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>

        <span class="c"># two-component V0 domain is OK</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/&quot;</span><span class="p">,</span> <span class="s">&#39;ns=bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;foo.net&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;ns&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/&quot;</span><span class="p">),</span> <span class="s">&quot;ns=bar&quot;</span><span class="p">)</span>
        <span class="c"># *will* be returned to any other domain (unlike RFC 2965)...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.net/&quot;</span><span class="p">),</span>
                         <span class="s">&quot;ns=bar&quot;</span><span class="p">)</span>
        <span class="c"># ...unless requested otherwise</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span>
            <span class="n">strict_ns_domain</span><span class="o">=</span><span class="n">DefaultCookiePolicy</span><span class="o">.</span><span class="n">DomainStrictNonDomain</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_policy</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.net/&quot;</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># unlike RFC 2965, even explicit two-component domain is OK,</span>
        <span class="c"># because .foo.net matches foo.net</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/foo/&quot;</span><span class="p">,</span>
                          <span class="s">&#39;spam1=eggs; domain=foo.net&#39;</span><span class="p">)</span>
        <span class="c"># even if starts with a dot -- in NS rules, .foo.net matches foo.net!</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/foo/bar/&quot;</span><span class="p">,</span>
                          <span class="s">&#39;spam2=eggs; domain=.foo.net&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;.foo.net&quot;</span><span class="p">][</span><span class="s">&quot;/foo&quot;</span><span class="p">][</span><span class="s">&quot;spam1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                         <span class="s">&quot;eggs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;.foo.net&quot;</span><span class="p">][</span><span class="s">&quot;/foo/bar&quot;</span><span class="p">][</span><span class="s">&quot;spam2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                         <span class="s">&quot;eggs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/foo/bar/&quot;</span><span class="p">),</span>
                         <span class="s">&quot;spam2=eggs; spam1=eggs; ns=bar&quot;</span><span class="p">)</span>

        <span class="c"># top-level domain is too general</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/&quot;</span><span class="p">,</span> <span class="s">&#39;nini=&quot;ni&quot;; domain=.net&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

<span class="c">##         # Netscape protocol doesn&#39;t allow non-special top level domains (such</span>
<span class="c">##         # as co.uk) in the domain attribute unless there are at least three</span>
<span class="c">##         # dots in it.</span>
        <span class="c"># Oh yes it does!  Real implementations don&#39;t check this, and real</span>
        <span class="c"># cookies (of course) rely on that behaviour.</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.co.uk&quot;</span><span class="p">,</span> <span class="s">&#39;nasty=trick; domain=.co.uk&#39;</span><span class="p">)</span>
<span class="c">##         self.assertEqual(len(c), 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_two_component_domain_rfc2965"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_two_component_domain_rfc2965">[docs]</a>    <span class="k">def</span> <span class="nf">test_two_component_domain_rfc2965</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>

        <span class="c"># two-component V1 domain is OK</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/&quot;</span><span class="p">,</span> <span class="s">&#39;foo=bar; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;foo.net&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;foo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/&quot;</span><span class="p">),</span>
                         <span class="s">&quot;$Version=1; foo=bar&quot;</span><span class="p">)</span>
        <span class="c"># won&#39;t be returned to any other domain (because domain was implied)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.net/&quot;</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># unless domain is given explicitly, because then it must be</span>
        <span class="c"># rewritten to start with a dot: foo.net --&gt; .foo.net, which does</span>
        <span class="c"># not domain-match foo.net</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/foo&quot;</span><span class="p">,</span>
                      <span class="s">&#39;spam=eggs; domain=foo.net; path=/foo; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/foo&quot;</span><span class="p">),</span>
                         <span class="s">&quot;$Version=1; foo=bar&quot;</span><span class="p">)</span>

        <span class="c"># explicit foo.net from three-component domain www.foo.net *does* get</span>
        <span class="c"># set, because .foo.net domain-matches .foo.net</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.net/foo/&quot;</span><span class="p">,</span>
                      <span class="s">&#39;spam=eggs; domain=foo.net; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;.foo.net&quot;</span><span class="p">][</span><span class="s">&quot;/foo/&quot;</span><span class="p">][</span><span class="s">&quot;spam&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                         <span class="s">&quot;eggs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/foo/&quot;</span><span class="p">),</span>
                         <span class="s">&quot;$Version=1; foo=bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.net/foo/&quot;</span><span class="p">),</span>
                         <span class="s">&#39;$Version=1; spam=eggs; $Domain=&quot;foo.net&quot;&#39;</span><span class="p">)</span>

        <span class="c"># top-level domain is too general</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.net/&quot;</span><span class="p">,</span>
                      <span class="s">&#39;ni=&quot;ni&quot;; domain=&quot;.net&quot;; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># RFC 2965 doesn&#39;t require blocking this</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://foo.co.uk/&quot;</span><span class="p">,</span>
                      <span class="s">&#39;nasty=trick; domain=.co.uk; Version=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_domain_allow"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_domain_allow">[docs]</a>    <span class="k">def</span> <span class="nf">test_domain_allow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span>
            <span class="n">blocked_domains</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;acme.com&quot;</span><span class="p">],</span>
            <span class="n">allowed_domains</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">]))</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://acme.com/&quot;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Set-Cookie: CUSTOMER=WILE_E_COYOTE; path=/&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.coyote.com/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.coyote.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># set a cookie with non-allowed domain...</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.coyote.com/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.coyote.com/&quot;</span><span class="p">)</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">make_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">cookies</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c"># ... and check is doesn&#39;t get returned</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CookieTests.test_domain_block"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_domain_block">[docs]</a>    <span class="k">def</span> <span class="nf">test_domain_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span>
            <span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blocked_domains</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;.acme.com&quot;</span><span class="p">])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Set-Cookie: CUSTOMER=WILE_E_COYOTE; path=/&quot;</span><span class="p">]</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">set_blocked_domains</span><span class="p">([</span><span class="s">&quot;acme.com&quot;</span><span class="p">])</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.roadrunner.net/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.roadrunner.net/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.roadrunner.net/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cookie2&quot;</span><span class="p">))</span>

        <span class="n">c</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">pol</span><span class="o">.</span><span class="n">set_blocked_domains</span><span class="p">([</span><span class="s">&quot;.acme.com&quot;</span><span class="p">])</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># set a cookie with blocked domain...</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">make_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">cookies</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c"># ... and check is doesn&#39;t get returned</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CookieTests.test_secure"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_secure">[docs]</a>    <span class="k">def</span> <span class="nf">test_secure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">whitespace</span> <span class="ow">in</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ns</span><span class="p">:</span>
                    <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="nb">int</span> <span class="o">=</span> <span class="n">interact_netscape</span>
                    <span class="n">vs</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="nb">int</span> <span class="o">=</span> <span class="n">interact_2965</span>
                    <span class="n">vs</span> <span class="o">=</span> <span class="s">&quot;; Version=1&quot;</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_policy</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://www.acme.com/&quot;</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;foo1=bar</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">whitespace</span><span class="p">))</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;foo2=bar</span><span class="si">%s</span><span class="s">; secure</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">whitespace</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;foo1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">secure</span><span class="p">,</span>
                    <span class="s">&quot;non-secure cookie registered secure&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.acme.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;foo2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">secure</span><span class="p">,</span>
                    <span class="s">&quot;secure cookie registered non-secure&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_quote_cookie_value"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_quote_cookie_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_quote_cookie_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">r&#39;foo=\b&quot;a&quot;r; Version=1&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s">r&#39;$Version=1; foo=</span><span class="se">\\</span><span class="s">b\&quot;a\&quot;r&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_missing_final_slash"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_missing_final_slash">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_final_slash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Missing slash from request URL&#39;s abs_path should be assumed present.</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://www.acme.com&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;foo=bar; Version=1&quot;</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CookieTests.test_domain_mirror"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_domain_mirror">[docs]</a>    <span class="k">def</span> <span class="nf">test_domain_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;spam=eggs; Version=1&quot;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Domain&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                     <span class="s">&quot;absent domain returned with domain present&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;spam=eggs; Version=1; Domain=.bar.com&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;$Domain=&quot;.bar.com&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;domain not returned&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="c"># note missing initial dot in Domain</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;spam=eggs; Version=1; Domain=bar.com&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;$Domain=&quot;bar.com&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;domain not returned&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_path_mirror"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_path_mirror">[docs]</a>    <span class="k">def</span> <span class="nf">test_path_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;spam=eggs; Version=1&quot;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Path&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;absent path returned with path present&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;spam=eggs; Version=1; Path=/&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;$Path=&quot;/&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;path not returned&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_port_mirror"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_port_mirror">[docs]</a>    <span class="k">def</span> <span class="nf">test_port_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;spam=eggs; Version=1&quot;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Port&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&quot;absent port returned with port present&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&quot;spam=eggs; Version=1; Port&quot;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s">&quot;\$Port([^=]|$)&quot;</span><span class="p">,</span>
                         <span class="s">&quot;port with no value not returned with no value&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;spam=eggs; Version=1; Port=&quot;80&quot;&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;$Port=&quot;80&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                      <span class="s">&quot;port with single value not returned with single value&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;spam=eggs; Version=1; Port=&quot;80,8080&quot;&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;$Port=&quot;80,8080&quot;&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                      <span class="s">&quot;port with multiple values not returned with multiple &quot;</span>
                      <span class="s">&quot;values&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_no_return_comment"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_no_return_comment">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_return_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://foo.bar.com/&quot;</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;spam=eggs; Version=1; &#39;</span>
                      <span class="s">&#39;Comment=&quot;does anybody read these?&quot;; &#39;</span>
                      <span class="s">&#39;CommentURL=&quot;http://foo.bar.net/comment.html&quot;&#39;</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Comment&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
            <span class="s">&quot;Comment or CommentURL cookie-attributes returned to server&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CookieTests.test_Cookie_iterator"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_Cookie_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">test_Cookie_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="c"># add some random cookies</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s">&quot;http://blah.spam.org/&quot;</span><span class="p">,</span> <span class="s">&#39;foo=eggs; Version=1; &#39;</span>
                      <span class="s">&#39;Comment=&quot;does anybody read these?&quot;; &#39;</span>
                      <span class="s">&#39;CommentURL=&quot;http://foo.bar.net/comment.html&quot;&#39;</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/&quot;</span><span class="p">,</span> <span class="s">&quot;spam=bar; secure&quot;</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/&quot;</span><span class="p">,</span>
                      <span class="s">&quot;foo=bar; secure; Version=1&quot;</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/blah/&quot;</span><span class="p">,</span>
                      <span class="s">&quot;foo=bar; path=/; Version=1&quot;</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no&quot;</span><span class="p">,</span>
                      <span class="s">r&#39;bang=wallop; version=1; domain=&quot;.sol.no&quot;; &#39;</span>
                      <span class="s">r&#39;port=&quot;90,100, 80,8080&quot;; &#39;</span>
                      <span class="s">r&#39;max-age=100; Comment = &quot;Just kidding! (\&quot;|</span><span class="se">\\\\</span><span class="s">) &quot;&#39;</span><span class="p">)</span>

        <span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;bang&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">]</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;.sol.no&quot;</span><span class="p">,</span> <span class="s">&quot;blah.spam.org&quot;</span><span class="p">,</span> <span class="s">&quot;www.acme.com&quot;</span><span class="p">,</span>
                   <span class="s">&quot;www.acme.com&quot;</span><span class="p">,</span> <span class="s">&quot;www.acme.com&quot;</span><span class="p">]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="s">&quot;/blah&quot;</span><span class="p">,</span> <span class="s">&quot;/blah/&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Cookie</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">versions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">domains</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="CookieTests.test_parse_ns_headers"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_parse_ns_headers">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_ns_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># missing domain value (invalid cookie)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">parse_ns_headers</span><span class="p">([</span><span class="s">&quot;foo=bar; path=/; domain&quot;</span><span class="p">]),</span>
            <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;domain&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)]]</span>
            <span class="p">)</span>
        <span class="c"># invalid expires value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">parse_ns_headers</span><span class="p">([</span><span class="s">&quot;foo=bar; expires=Foo Bar 12 33:22:11 2000&quot;</span><span class="p">]),</span>
            <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;expires&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)]]</span>
            <span class="p">)</span>
        <span class="c"># missing cookie value (valid cookie)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">parse_ns_headers</span><span class="p">([</span><span class="s">&quot;foo&quot;</span><span class="p">]),</span>
            <span class="p">[[(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)]]</span>
            <span class="p">)</span>
        <span class="c"># shouldn&#39;t add version if header is empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_ns_headers</span><span class="p">([</span><span class="s">&quot;&quot;</span><span class="p">]),</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="CookieTests.test_bad_cookie_header"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.CookieTests.test_bad_cookie_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_cookie_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">cookiejar_from_cookie_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.example.com/&quot;</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.example.com/&quot;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">c</span>

        <span class="c"># none of these bad headers should cause an exception to be raised</span>
        <span class="k">for</span> <span class="n">headers</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">[</span><span class="s">&quot;Set-Cookie: &quot;</span><span class="p">],</span>  <span class="c"># actually, nothing wrong with this</span>
            <span class="p">[</span><span class="s">&quot;Set-Cookie2: &quot;</span><span class="p">],</span>  <span class="c"># ditto</span>
            <span class="c"># missing domain value</span>
            <span class="p">[</span><span class="s">&quot;Set-Cookie2: a=foo; path=/; Version=1; domain&quot;</span><span class="p">],</span>
            <span class="c"># bad max-age</span>
            <span class="p">[</span><span class="s">&quot;Set-Cookie: b=foo; max-age=oops&quot;</span><span class="p">],</span>
            <span class="c"># bad version</span>
            <span class="p">[</span><span class="s">&quot;Set-Cookie: b=foo; version=spam&quot;</span><span class="p">],</span>
            <span class="p">]:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">cookiejar_from_cookie_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
            <span class="c"># these bad cookies shouldn&#39;t be set</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># cookie with invalid expires is treated as session cookie</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Set-Cookie: c=foo; expires=Foo Bar 12 33:22:11 2000&quot;</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cookiejar_from_cookie_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="s">&quot;www.example.com&quot;</span><span class="p">][</span><span class="s">&quot;/&quot;</span><span class="p">][</span><span class="s">&quot;c&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">expires</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="LWPCookieTests"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests">[docs]</a><span class="k">class</span> <span class="nc">LWPCookieTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># Tests taken from libwww-perl, with a few modifications and additions.</span>

<div class="viewcode-block" id="LWPCookieTests.test_netscape_example_1"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_netscape_example_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_netscape_example_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#-------------------------------------------------------------------</span>
        <span class="c"># First we check that it works for the original example at</span>
        <span class="c"># http://www.netscape.com/newsref/std/cookie_spec.html</span>

        <span class="c"># Client requests a document, and receives in the response:</span>
        <span class="c">#</span>
        <span class="c">#       Set-Cookie: CUSTOMER=WILE_E_COYOTE; path=/; expires=Wednesday, 09-Nov-99 23:12:40 GMT</span>
        <span class="c">#</span>
        <span class="c"># When client requests a URL in path &quot;/&quot; on this server, it sends:</span>
        <span class="c">#</span>
        <span class="c">#       Cookie: CUSTOMER=WILE_E_COYOTE</span>
        <span class="c">#</span>
        <span class="c"># Client requests a document, and receives in the response:</span>
        <span class="c">#</span>
        <span class="c">#       Set-Cookie: PART_NUMBER=ROCKET_LAUNCHER_0001; path=/</span>
        <span class="c">#</span>
        <span class="c"># When client requests a URL in path &quot;/&quot; on this server, it sends:</span>
        <span class="c">#</span>
        <span class="c">#       Cookie: CUSTOMER=WILE_E_COYOTE; PART_NUMBER=ROCKET_LAUNCHER_0001</span>
        <span class="c">#</span>
        <span class="c"># Client receives:</span>
        <span class="c">#</span>
        <span class="c">#       Set-Cookie: SHIPPING=FEDEX; path=/fo</span>
        <span class="c">#</span>
        <span class="c"># When client requests a URL in path &quot;/&quot; on this server, it sends:</span>
        <span class="c">#</span>
        <span class="c">#       Cookie: CUSTOMER=WILE_E_COYOTE; PART_NUMBER=ROCKET_LAUNCHER_0001</span>
        <span class="c">#</span>
        <span class="c"># When client requests a URL in path &quot;/foo&quot; on this server, it sends:</span>
        <span class="c">#</span>
        <span class="c">#       Cookie: CUSTOMER=WILE_E_COYOTE; PART_NUMBER=ROCKET_LAUNCHER_0001; SHIPPING=FEDEX</span>
        <span class="c">#</span>
        <span class="c"># The last Cookie is buggy, because both specifications say that the</span>
        <span class="c"># most specific cookie must be sent first.  SHIPPING=FEDEX is the</span>
        <span class="c"># most specific and should thus be first.</span>

        <span class="n">year_plus_one</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>

        <span class="c">#req = urllib.request.Request(&quot;http://1.1.1.1/&quot;,</span>
        <span class="c">#              headers={&quot;Host&quot;: &quot;www.acme.com:80&quot;})</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com:80/&quot;</span><span class="p">,</span>
                      <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Host&quot;</span><span class="p">:</span> <span class="s">&quot;www.acme.com:80&quot;</span><span class="p">})</span>

        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&quot;Set-Cookie: CUSTOMER=WILE_E_COYOTE; path=/ ; &quot;</span>
            <span class="s">&quot;expires=Wednesday, 09-Nov-</span><span class="si">%d</span><span class="s"> 23:12:40 GMT&quot;</span> <span class="o">%</span> <span class="n">year_plus_one</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">),</span> <span class="s">&quot;CUSTOMER=WILE_E_COYOTE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie2&quot;</span><span class="p">),</span> <span class="s">&#39;$Version=&quot;1&quot;&#39;</span><span class="p">)</span>

        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: PART_NUMBER=ROCKET_LAUNCHER_0001; path=/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/foo/bar&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;PART_NUMBER=ROCKET_LAUNCHER_0001&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;CUSTOMER=WILE_E_COYOTE&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Set-Cookie: SHIPPING=FEDEX; path=/foo&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;PART_NUMBER=ROCKET_LAUNCHER_0001&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;CUSTOMER=WILE_E_COYOTE&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;SHIPPING=FEDEX&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/foo/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;PART_NUMBER=ROCKET_LAUNCHER_0001&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;CUSTOMER=WILE_E_COYOTE&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;SHIPPING=FEDEX;&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_netscape_example_2"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_netscape_example_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_netscape_example_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Second Example transaction sequence:</span>
        <span class="c">#</span>
        <span class="c"># Assume all mappings from above have been cleared.</span>
        <span class="c">#</span>
        <span class="c"># Client receives:</span>
        <span class="c">#</span>
        <span class="c">#       Set-Cookie: PART_NUMBER=ROCKET_LAUNCHER_0001; path=/</span>
        <span class="c">#</span>
        <span class="c"># When client requests a URL in path &quot;/&quot; on this server, it sends:</span>
        <span class="c">#</span>
        <span class="c">#       Cookie: PART_NUMBER=ROCKET_LAUNCHER_0001</span>
        <span class="c">#</span>
        <span class="c"># Client receives:</span>
        <span class="c">#</span>
        <span class="c">#       Set-Cookie: PART_NUMBER=RIDING_ROCKET_0023; path=/ammo</span>
        <span class="c">#</span>
        <span class="c"># When client requests a URL in path &quot;/ammo&quot; on this server, it sends:</span>
        <span class="c">#</span>
        <span class="c">#       Cookie: PART_NUMBER=RIDING_ROCKET_0023; PART_NUMBER=ROCKET_LAUNCHER_0001</span>
        <span class="c">#</span>
        <span class="c">#       NOTE: There are two name/value pairs named &quot;PART_NUMBER&quot; due to</span>
        <span class="c">#       the inheritance of the &quot;/&quot; mapping in addition to the &quot;/ammo&quot; mapping.</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: PART_NUMBER=ROCKET_LAUNCHER_0001; path=/&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">),</span>
                         <span class="s">&quot;PART_NUMBER=ROCKET_LAUNCHER_0001&quot;</span><span class="p">)</span>

        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&quot;Set-Cookie: PART_NUMBER=RIDING_ROCKET_0023; path=/ammo&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.acme.com/ammo&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">),</span>
                         <span class="s">r&quot;PART_NUMBER=RIDING_ROCKET_0023;\s*&quot;</span>
                          <span class="s">&quot;PART_NUMBER=ROCKET_LAUNCHER_0001&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_ietf_example_1"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_ietf_example_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_ietf_example_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#-------------------------------------------------------------------</span>
        <span class="c"># Then we test with the examples from draft-ietf-http-state-man-mec-03.txt</span>
        <span class="c">#</span>
        <span class="c"># 5.  EXAMPLES</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="c">#</span>
        <span class="c"># 5.1  Example 1</span>
        <span class="c">#</span>
        <span class="c"># Most detail of request and response headers has been omitted.  Assume</span>
        <span class="c"># the user agent has no stored cookies.</span>
        <span class="c">#</span>
        <span class="c">#   1.  User Agent -&gt; Server</span>
        <span class="c">#</span>
        <span class="c">#       POST /acme/login HTTP/1.1</span>
        <span class="c">#       [form data]</span>
        <span class="c">#</span>
        <span class="c">#       User identifies self via a form.</span>
        <span class="c">#</span>
        <span class="c">#   2.  Server -&gt; User Agent</span>
        <span class="c">#</span>
        <span class="c">#       HTTP/1.1 200 OK</span>
        <span class="c">#       Set-Cookie2: Customer=&quot;WILE_E_COYOTE&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;</span>
        <span class="c">#</span>
        <span class="c">#       Cookie reflects user&#39;s identity.</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span> <span class="s">&#39;http://www.acme.com/acme/login&#39;</span><span class="p">,</span>
            <span class="s">&#39;Customer=&quot;WILE_E_COYOTE&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c">#   3.  User Agent -&gt; Server</span>
        <span class="c">#</span>
        <span class="c">#       POST /acme/pickitem HTTP/1.1</span>
        <span class="c">#       Cookie: $Version=&quot;1&quot;; Customer=&quot;WILE_E_COYOTE&quot;; $Path=&quot;/acme&quot;</span>
        <span class="c">#       [form data]</span>
        <span class="c">#</span>
        <span class="c">#       User selects an item for ``shopping basket.&#39;&#39;</span>
        <span class="c">#</span>
        <span class="c">#   4.  Server -&gt; User Agent</span>
        <span class="c">#</span>
        <span class="c">#       HTTP/1.1 200 OK</span>
        <span class="c">#       Set-Cookie2: Part_Number=&quot;Rocket_Launcher_0001&quot;; Version=&quot;1&quot;;</span>
        <span class="c">#               Path=&quot;/acme&quot;</span>
        <span class="c">#</span>
        <span class="c">#       Shopping basket contains an item.</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;http://www.acme.com/acme/pickitem&#39;</span><span class="p">,</span>
                               <span class="s">&#39;Part_Number=&quot;Rocket_Launcher_0001&quot;; &#39;</span>
                               <span class="s">&#39;Version=&quot;1&quot;; Path=&quot;/acme&quot;&#39;</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span>
            <span class="s">r&#39;^\$Version=&quot;?1&quot;?; Customer=&quot;?WILE_E_COYOTE&quot;?; \$Path=&quot;/acme&quot;$&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c">#   5.  User Agent -&gt; Server</span>
        <span class="c">#</span>
        <span class="c">#       POST /acme/shipping HTTP/1.1</span>
        <span class="c">#       Cookie: $Version=&quot;1&quot;;</span>
        <span class="c">#               Customer=&quot;WILE_E_COYOTE&quot;; $Path=&quot;/acme&quot;;</span>
        <span class="c">#               Part_Number=&quot;Rocket_Launcher_0001&quot;; $Path=&quot;/acme&quot;</span>
        <span class="c">#       [form data]</span>
        <span class="c">#</span>
        <span class="c">#       User selects shipping method from form.</span>
        <span class="c">#</span>
        <span class="c">#   6.  Server -&gt; User Agent</span>
        <span class="c">#</span>
        <span class="c">#       HTTP/1.1 200 OK</span>
        <span class="c">#       Set-Cookie2: Shipping=&quot;FedEx&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;</span>
        <span class="c">#</span>
        <span class="c">#       New cookie reflects shipping method.</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/acme/shipping&quot;</span><span class="p">,</span>
                               <span class="s">&#39;Shipping=&quot;FedEx&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="s">r&#39;^\$Version=&quot;?1&quot;?;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="s">r&#39;Part_Number=&quot;?Rocket_Launcher_0001&quot;?;&#39;</span>
                                  <span class="s">&#39;\s*\$Path=&quot;\/acme&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="s">r&#39;Customer=&quot;?WILE_E_COYOTE&quot;?;&#39;</span>
                                  <span class="s">&#39;\s*\$Path=&quot;\/acme&quot;&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c">#   7.  User Agent -&gt; Server</span>
        <span class="c">#</span>
        <span class="c">#       POST /acme/process HTTP/1.1</span>
        <span class="c">#       Cookie: $Version=&quot;1&quot;;</span>
        <span class="c">#               Customer=&quot;WILE_E_COYOTE&quot;; $Path=&quot;/acme&quot;;</span>
        <span class="c">#               Part_Number=&quot;Rocket_Launcher_0001&quot;; $Path=&quot;/acme&quot;;</span>
        <span class="c">#               Shipping=&quot;FedEx&quot;; $Path=&quot;/acme&quot;</span>
        <span class="c">#       [form data]</span>
        <span class="c">#</span>
        <span class="c">#       User chooses to process order.</span>
        <span class="c">#</span>
        <span class="c">#   8.  Server -&gt; User Agent</span>
        <span class="c">#</span>
        <span class="c">#       HTTP/1.1 200 OK</span>
        <span class="c">#</span>
        <span class="c">#       Transaction is complete.</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/acme/process&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="s">r&#39;Shipping=&quot;?FedEx&quot;?;\s*\$Path=&quot;\/acme&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;WILE_E_COYOTE&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># The user agent makes a series of requests on the origin server, after</span>
        <span class="c"># each of which it receives a new cookie.  All the cookies have the same</span>
        <span class="c"># Path attribute and (default) domain.  Because the request URLs all have</span>
        <span class="c"># /acme as a prefix, and that matches the Path attribute, each request</span>
        <span class="c"># contains all the cookies received so far.</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_ietf_example_2"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_ietf_example_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_ietf_example_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 5.2  Example 2</span>
        <span class="c">#</span>
        <span class="c"># This example illustrates the effect of the Path attribute.  All detail</span>
        <span class="c"># of request and response headers has been omitted.  Assume the user agent</span>
        <span class="c"># has no stored cookies.</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="c"># Imagine the user agent has received, in response to earlier requests,</span>
        <span class="c"># the response headers</span>
        <span class="c">#</span>
        <span class="c"># Set-Cookie2: Part_Number=&quot;Rocket_Launcher_0001&quot;; Version=&quot;1&quot;;</span>
        <span class="c">#         Path=&quot;/acme&quot;</span>
        <span class="c">#</span>
        <span class="c"># and</span>
        <span class="c">#</span>
        <span class="c"># Set-Cookie2: Part_Number=&quot;Riding_Rocket_0023&quot;; Version=&quot;1&quot;;</span>
        <span class="c">#         Path=&quot;/acme/ammo&quot;</span>

        <span class="n">interact_2965</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/acme/ammo/specific&quot;</span><span class="p">,</span>
            <span class="s">&#39;Part_Number=&quot;Rocket_Launcher_0001&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;&#39;</span><span class="p">,</span>
            <span class="s">&#39;Part_Number=&quot;Riding_Rocket_0023&quot;; Version=&quot;1&quot;; Path=&quot;/acme/ammo&quot;&#39;</span><span class="p">)</span>

        <span class="c"># A subsequent request by the user agent to the (same) server for URLs of</span>
        <span class="c"># the form /acme/ammo/...  would include the following request header:</span>
        <span class="c">#</span>
        <span class="c"># Cookie: $Version=&quot;1&quot;;</span>
        <span class="c">#         Part_Number=&quot;Riding_Rocket_0023&quot;; $Path=&quot;/acme/ammo&quot;;</span>
        <span class="c">#         Part_Number=&quot;Rocket_Launcher_0001&quot;; $Path=&quot;/acme&quot;</span>
        <span class="c">#</span>
        <span class="c"># Note that the NAME=VALUE pair for the cookie with the more specific Path</span>
        <span class="c"># attribute, /acme/ammo, comes before the one with the less specific Path</span>
        <span class="c"># attribute, /acme.  Further note that the same cookie name appears more</span>
        <span class="c"># than once.</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/acme/ammo/...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="s">r&quot;Riding_Rocket_0023.*Rocket_Launcher_0001&quot;</span><span class="p">)</span>

        <span class="c"># A subsequent request by the user agent to the (same) server for a URL of</span>
        <span class="c"># the form /acme/parts/ would include the following request header:</span>
        <span class="c">#</span>
        <span class="c"># Cookie: $Version=&quot;1&quot;; Part_Number=&quot;Rocket_Launcher_0001&quot;; $Path=&quot;/acme&quot;</span>
        <span class="c">#</span>
        <span class="c"># Here, the second cookie&#39;s Path attribute /acme/ammo is not a prefix of</span>
        <span class="c"># the request URL, /acme/parts/, so the cookie does not get forwarded to</span>
        <span class="c"># the server.</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/acme/parts/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;Rocket_Launcher_0001&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Riding_Rocket_0023&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_rejection"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_rejection">[docs]</a>    <span class="k">def</span> <span class="nf">test_rejection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test rejection of Set-Cookie2 responses based on domain, path, port.</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">LWPCookieJar</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span>

        <span class="n">max_age</span> <span class="o">=</span> <span class="s">&quot;max-age=3600&quot;</span>

        <span class="c"># illegal domain (no embedded dots)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com&quot;</span><span class="p">,</span>
                               <span class="s">&#39;foo=bar; domain=&quot;.com&quot;; version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c"># legal domain</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com&quot;</span><span class="p">,</span>
                               <span class="s">&#39;ping=pong; domain=&quot;acme.com&quot;; version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># illegal domain (host prefix &quot;www.a&quot; contains a dot)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.a.acme.com&quot;</span><span class="p">,</span>
                               <span class="s">&#39;whiz=bang; domain=&quot;acme.com&quot;; version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># legal domain</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.a.acme.com&quot;</span><span class="p">,</span>
                               <span class="s">&#39;wow=flutter; domain=&quot;.a.acme.com&quot;; version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># can&#39;t partially match an IP-address</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://125.125.125.125&quot;</span><span class="p">,</span>
                               <span class="s">&#39;zzzz=ping; domain=&quot;125.125.125&quot;; version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># illegal path (must be prefix of request path)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no&quot;</span><span class="p">,</span>
                               <span class="s">&#39;blah=rhubarb; domain=&quot;.sol.no&quot;; path=&quot;/foo&quot;; &#39;</span>
                               <span class="s">&#39;version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># legal path</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no/foo/bar&quot;</span><span class="p">,</span>
                               <span class="s">&#39;bing=bong; domain=&quot;.sol.no&quot;; path=&quot;/foo&quot;; &#39;</span>
                               <span class="s">&#39;version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c"># illegal port (request-port not in list)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no&quot;</span><span class="p">,</span>
                               <span class="s">&#39;whiz=ffft; domain=&quot;.sol.no&quot;; port=&quot;90,100&quot;; &#39;</span>
                               <span class="s">&#39;version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c"># legal port</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no&quot;</span><span class="p">,</span>
            <span class="s">r&#39;bang=wallop; version=1; domain=&quot;.sol.no&quot;; &#39;</span>
            <span class="s">r&#39;port=&quot;90,100, 80,8080&quot;; &#39;</span>
            <span class="s">r&#39;max-age=100; Comment = &quot;Just kidding! (\&quot;|</span><span class="se">\\\\</span><span class="s">) &quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c"># port attribute without any value (current port)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no&quot;</span><span class="p">,</span>
                               <span class="s">&#39;foo9=bar; version=1; domain=&quot;.sol.no&quot;; port; &#39;</span>
                               <span class="s">&#39;max-age=100;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c"># encoded path</span>
        <span class="c"># LWP has this test, but unescaping allowed path characters seems</span>
        <span class="c"># like a bad idea, so I think this should fail:</span>
<span class="c">##         cookie = interact_2965(c, &quot;http://www.sol.no/foo/&quot;,</span>
<span class="c">##                           r&#39;foo8=bar; version=1; path=&quot;/%66oo&quot;&#39;)</span>
        <span class="c"># but this is OK, because &#39;&lt;&#39; is not an allowed HTTP URL path</span>
        <span class="c"># character:</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.sol.no/&lt;oo/&quot;</span><span class="p">,</span>
                               <span class="s">r&#39;foo8=bar; version=1; path=&quot;/</span><span class="si">%3c</span><span class="s">oo&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>

        <span class="c"># save and restore</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

            <span class="n">c</span> <span class="o">=</span> <span class="n">LWPCookieJar</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span> <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_url_encoding"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_url_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_url_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Try some URL encodings of the PATHs.</span>
        <span class="c"># (the behaviour here has changed from libwww-perl)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/foo</span><span class="si">%2f</span><span class="s">%25/&quot;</span>
                         <span class="s">&quot;</span><span class="si">%3c%3c</span><span class="s">%0Anew%C3%A5/%C3%A5&quot;</span><span class="p">,</span>
                      <span class="s">&quot;foo  =   bar; version    =   1&quot;</span><span class="p">)</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/foo</span><span class="si">%2f</span><span class="s">%25/&lt;&lt;%0anew</span><span class="se">\345</span><span class="s">/</span><span class="se">\346\370\345</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="s">&#39;bar=baz; path=&quot;/foo/&quot;; version=1&#39;</span><span class="p">);</span>
        <span class="n">version_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^\$version=\&quot;?1\&quot;?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;foo=bar&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">version_re</span><span class="p">)</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/foo/%25/&lt;&lt;%0anew</span><span class="se">\345</span><span class="s">/</span><span class="se">\346\370\345</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>

        <span class="c"># unicode URL doesn&#39;t raise exception</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/</span><span class="se">\xfc</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_mozilla"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_mozilla">[docs]</a>    <span class="k">def</span> <span class="nf">test_mozilla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Save / load Mozilla/Netscape cookie file format.</span>
        <span class="n">year_plus_one</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">MozillaCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                             <span class="n">policy</span><span class="o">=</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span>
                      <span class="s">&quot;foo1=bar; max-age=100; Version=1&quot;</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span>
                      <span class="s">&#39;foo2=bar; port=&quot;80&quot;; max-age=100; Discard; Version=1&#39;</span><span class="p">)</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/&quot;</span><span class="p">,</span> <span class="s">&quot;foo3=bar; secure; Version=1&quot;</span><span class="p">)</span>

        <span class="n">expires</span> <span class="o">=</span> <span class="s">&quot;expires=09-Nov-</span><span class="si">%d</span><span class="s"> 23:12:40 GMT&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year_plus_one</span><span class="p">,)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.com/&quot;</span><span class="p">,</span>
                          <span class="s">&quot;fooa=bar; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">expires</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.com/&quot;</span><span class="p">,</span>
                          <span class="s">&quot;foob=bar; Domain=.foo.com; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">expires</span><span class="p">)</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://www.foo.com/&quot;</span><span class="p">,</span>
                          <span class="s">&quot;fooc=bar; Domain=www.foo.com; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">expires</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">save_and_restore</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ignore_discard</span><span class="o">=</span><span class="n">ignore_discard</span><span class="p">)</span>
                <span class="n">new_c</span> <span class="o">=</span> <span class="n">MozillaCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                                         <span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
                <span class="n">new_c</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ignore_discard</span><span class="o">=</span><span class="n">ignore_discard</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">return</span> <span class="n">new_c</span>

        <span class="n">new_c</span> <span class="o">=</span> <span class="n">save_and_restore</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_c</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>  <span class="c"># none discarded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;name=&#39;foo1&#39;, value=&#39;bar&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">new_c</span><span class="p">))</span>

        <span class="n">new_c</span> <span class="o">=</span> <span class="n">save_and_restore</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_c</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>  <span class="c"># 2 of them discarded on save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;name=&#39;foo1&#39;, value=&#39;bar&#39;&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">new_c</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_netscape_misc"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_netscape_misc">[docs]</a>    <span class="k">def</span> <span class="nf">test_netscape_misc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Some additional Netscape cookies tests.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://foo.bar.acme.com/foo&quot;</span><span class="p">)</span>

        <span class="c"># Netscape allows a host part that contains dots</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: Customer=WILE_E_COYOTE; domain=.acme.com&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/foo&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="c"># and that the domain is the same as the host without adding a leading</span>
        <span class="c"># dot to the domain.  Should not quote even if strange chars are used</span>
        <span class="c"># in the cookie value.</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: PART_NUMBER=3,4; domain=foo.bar.acme.com&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.acme.com/foo&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://foo.bar.acme.com/foo&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;PART_NUMBER=3,4&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;Customer=WILE_E_COYOTE&quot;</span><span class="p">,</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_intranet_domains_2965"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_intranet_domains_2965">[docs]</a>    <span class="k">def</span> <span class="nf">test_intranet_domains_2965</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test handling of local intranet hostnames without a dot.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">,</span>
                      <span class="s">&quot;foo1=bar; PORT; Discard; Version=1;&quot;</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">,</span>
                               <span class="s">&#39;foo2=bar; domain=&quot;.local&quot;; Version=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;foo1=bar&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>

        <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">,</span> <span class="s">&#39;foo3=bar; Version=1&#39;</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_2965</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;foo2=bar&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_intranet_domains_ns"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_intranet_domains_ns">[docs]</a>    <span class="k">def</span> <span class="nf">test_intranet_domains_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span> <span class="o">=</span> <span class="bp">False</span><span class="p">))</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">,</span> <span class="s">&quot;foo1=bar&quot;</span><span class="p">)</span>
        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">,</span>
                                   <span class="s">&#39;foo2=bar; domain=.local&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;foo1=bar&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>

        <span class="n">cookie</span> <span class="o">=</span> <span class="n">interact_netscape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;http://example/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;foo2=bar&quot;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_empty_path"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_empty_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for empty path</span>
        <span class="c"># Broken web-server ORION/1.3.38 returns to the client response like</span>
        <span class="c">#</span>
        <span class="c">#       Set-Cookie: JSESSIONID=ABCDERANDOM123; Path=</span>
        <span class="c">#</span>
        <span class="c"># ie. with Path set to nothing.</span>
        <span class="c"># In this case, extract_cookies() must set cookie to / (root)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">(</span><span class="n">DefaultCookiePolicy</span><span class="p">(</span><span class="n">rfc2965</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.ants.com/&quot;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: JSESSIONID=ABCDERANDOM123; Path=&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&quot;http://www.ants.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.ants.com/&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">),</span>
                         <span class="s">&quot;JSESSIONID=ABCDERANDOM123&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie2&quot;</span><span class="p">),</span> <span class="s">&#39;$Version=&quot;1&quot;&#39;</span><span class="p">)</span>

        <span class="c"># missing path in the request URI</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.ants.com:8080&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">),</span>
                         <span class="s">&quot;JSESSIONID=ABCDERANDOM123&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Cookie2&quot;</span><span class="p">),</span> <span class="s">&#39;$Version=&quot;1&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LWPCookieTests.test_session_cookies"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.LWPCookieTests.test_session_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">test_session_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">year_plus_one</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c"># Check session cookies are deleted properly by</span>
        <span class="c"># CookieJar.clear_session_cookies method</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&#39;http://www.perlmeister.com/scripts&#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: s1=session;Path=/scripts&quot;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: p1=perm; Domain=.perlmeister.com;&quot;</span>
                       <span class="s">&quot;Path=/;expires=Fri, 02-Feb-</span><span class="si">%d</span><span class="s"> 23:24:20 GMT&quot;</span> <span class="o">%</span>
                       <span class="n">year_plus_one</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: p2=perm;Path=/;expires=Fri, &quot;</span>
                       <span class="s">&quot;02-Feb-</span><span class="si">%d</span><span class="s"> 23:24:20 GMT&quot;</span> <span class="o">%</span> <span class="n">year_plus_one</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Set-Cookie: s2=session;Path=/scripts;&quot;</span>
                       <span class="s">&quot;Domain=.perlmeister.com&quot;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Set-Cookie2: s3=session;Version=1;Discard;Path=&quot;/&quot;&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FakeResponse</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s">&#39;http://www.perlmeister.com/scripts&#39;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extract_cookies</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="c"># How many session/permanent cookies do we have?</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;session_after&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="s">&quot;perm_after&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="s">&quot;session_before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="s">&quot;perm_before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_before&quot;</span> <span class="o">%</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">c</span><span class="o">.</span><span class="n">clear_session_cookies</span><span class="p">()</span>
        <span class="c"># How many now?</span>
        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_after&quot;</span> <span class="o">%</span> <span class="n">cookie</span><span class="o">.</span><span class="n">value</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c"># a permanent cookie got lost accidently</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="s">&quot;perm_after&quot;</span><span class="p">],</span> <span class="n">counter</span><span class="p">[</span><span class="s">&quot;perm_before&quot;</span><span class="p">])</span>
            <span class="c"># a session cookie hasn&#39;t been cleared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="s">&quot;session_after&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c"># we didn&#39;t have session cookies in the first place</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="s">&quot;session_before&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_http_cookiejar.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span>
        <span class="n">DateTimeTests</span><span class="p">,</span>
        <span class="n">HeaderTests</span><span class="p">,</span>
        <span class="n">CookieTests</span><span class="p">,</span>
        <span class="n">FileCookieJarTests</span><span class="p">,</span>
        <span class="n">LWPCookieTests</span><span class="p">,</span>
        <span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_main</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>