

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_long &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_long</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_long</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">array</span>

<span class="c"># Used for lazy formatting of failure messages</span>
<div class="viewcode-block" id="Frm"><a class="viewcode-back" href="../../test.html#test.test_long.Frm">[docs]</a><span class="k">class</span> <span class="nc">Frm</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>

<span class="c"># SHIFT should match the value in longintrepr.h for best testing.</span></div>
<span class="n">SHIFT</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">int_info</span><span class="o">.</span><span class="n">bits_per_digit</span>
<span class="n">BASE</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">SHIFT</span>
<span class="n">MASK</span> <span class="o">=</span> <span class="n">BASE</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">KARATSUBA_CUTOFF</span> <span class="o">=</span> <span class="mi">70</span>   <span class="c"># from longobject.c</span>

<span class="c"># Max number of base BASE digits to use in test cases.  Doubling</span>
<span class="c"># this will more than double the runtime.</span>
<span class="n">MAXDIGITS</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c"># build some special values</span>
<span class="n">special</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">BASE</span><span class="p">,</span> <span class="n">BASE</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x5555555555555555</span><span class="p">,</span> <span class="mh">0xaaaaaaaaaaaaaaaa</span><span class="p">]</span>
<span class="c">#  some solid strings of one bits</span>
<span class="n">p2</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c"># 0 and 1 already added</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">SHIFT</span><span class="p">):</span>
    <span class="n">special</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
<span class="k">del</span> <span class="n">p2</span>
<span class="c"># add complements &amp; negations</span>
<span class="n">special</span> <span class="o">+=</span> <span class="p">[</span><span class="o">~</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">special</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">special</span><span class="p">]</span>

<span class="n">DBL_MAX</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span>
<span class="n">DBL_MAX_EXP</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max_exp</span>
<span class="n">DBL_MIN_EXP</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min_exp</span>
<span class="n">DBL_MANT_DIG</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">mant_dig</span>
<span class="n">DBL_MIN_OVERFLOW</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">DBL_MAX_EXP</span> <span class="o">-</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">DBL_MAX_EXP</span> <span class="o">-</span> <span class="n">DBL_MANT_DIG</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="c"># Pure Python version of correctly-rounded integer-to-float conversion.</span>
<div class="viewcode-block" id="int_to_float"><a class="viewcode-back" href="../../test.html#test.test_long.int_to_float">[docs]</a><span class="k">def</span> <span class="nf">int_to_float</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Correctly-rounded integer-to-float conversion.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Constants, depending only on the floating-point format in use.</span>
    <span class="c"># We use an extra 2 bits of precision for rounding purposes.</span>
    <span class="n">PRECISION</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">mant_dig</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">SHIFT_MAX</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max_exp</span> <span class="o">-</span> <span class="n">PRECISION</span>
    <span class="n">Q_MAX</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">PRECISION</span>
    <span class="n">ROUND_HALF_TO_EVEN_CORRECTION</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c"># Reduce to the case where n is positive.</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">int_to_float</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span>

    <span class="c"># Convert n to a &#39;floating-point&#39; number q * 2**shift, where q is an</span>
    <span class="c"># integer with &#39;PRECISION&#39; significant bits.  When shifting n to create q,</span>
    <span class="c"># the least significant bit of q is treated as &#39;sticky&#39;.  That is, the</span>
    <span class="c"># least significant bit of q is set if either the corresponding bit of n</span>
    <span class="c"># was already set, or any one of the bits of n lost in the shift was set.</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="n">PRECISION</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="n">shift</span> <span class="k">if</span> <span class="n">shift</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">))</span>

    <span class="c"># Round half to even (actually rounds to the nearest multiple of 4,</span>
    <span class="c"># rounding ties to a multiple of 8).</span>
    <span class="n">q</span> <span class="o">+=</span> <span class="n">ROUND_HALF_TO_EVEN_CORRECTION</span><span class="p">[</span><span class="n">q</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span>

    <span class="c"># Detect overflow.</span>
    <span class="k">if</span> <span class="n">shift</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="n">Q_MAX</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">SHIFT_MAX</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s">&quot;integer too large to convert to float&quot;</span><span class="p">)</span>

    <span class="c"># Checks: q is exactly representable, and q**2**shift doesn&#39;t overflow.</span>
    <span class="k">assert</span> <span class="n">q</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">q</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">mant_dig</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">q</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="n">shift</span> <span class="o">&lt;=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span>

    <span class="c"># Some circularity here, since float(q) is doing an int-to-float</span>
    <span class="c"># conversion.  But here q is of bounded size, and is exactly representable</span>
    <span class="c"># as a float.  In a low-level C-like language, this operation would be a</span>
    <span class="c"># simple cast (e.g., from unsigned long long to double).</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ldexp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">shift</span><span class="p">)</span>


<span class="c"># pure Python version of correctly-rounded true division</span></div>
<div class="viewcode-block" id="truediv"><a class="viewcode-back" href="../../test.html#test.test_long.truediv">[docs]</a><span class="k">def</span> <span class="nf">truediv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Correctly-rounded true division for integers.&quot;&quot;&quot;</span>
    <span class="n">negative</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="c"># exceptions:  division by zero, overflow</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s">&quot;division by zero&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">DBL_MIN_OVERFLOW</span> <span class="o">*</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s">&quot;int/int too large to represent as a float&quot;</span><span class="p">)</span>

   <span class="c"># find integer d satisfying 2**(d - 1) &lt;= a/b &lt; 2**d</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">**</span><span class="n">d</span> <span class="o">*</span> <span class="n">b</span> <span class="ow">or</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**-</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c"># compute 2**-exp * a / b for suitable exp</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">DBL_MIN_EXP</span><span class="p">)</span> <span class="o">-</span> <span class="n">DBL_MANT_DIG</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c"># round-half-to-even: fractional part is r/b, which is &gt; 0.5 iff</span>
    <span class="c"># 2*r &gt; b, and == 0.5 iff 2*r == b.</span>
    <span class="k">if</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="ow">or</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">q</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ldexp</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">result</span> <span class="k">if</span> <span class="n">negative</span> <span class="k">else</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="LongTest"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest">[docs]</a><span class="k">class</span> <span class="nc">LongTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c"># Get quasi-random long consisting of ndigits digits (in base BASE).</span>
    <span class="c"># quasi == the most-significant digit will not be 0, and the number</span>
    <span class="c"># is constructed to contain long strings of 0 and 1 bits.  These are</span>
    <span class="c"># more likely than random bits to provoke digit-boundary errors.</span>
    <span class="c"># The sign of the number is also random.</span>

<div class="viewcode-block" id="LongTest.getran"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.getran">[docs]</a>    <span class="k">def</span> <span class="nf">getran</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">ndigits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nbits_hi</span> <span class="o">=</span> <span class="n">ndigits</span> <span class="o">*</span> <span class="n">SHIFT</span>
        <span class="n">nbits_lo</span> <span class="o">=</span> <span class="n">nbits_hi</span> <span class="o">-</span> <span class="n">SHIFT</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nbits</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">SHIFT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> <span class="o">|</span> <span class="mi">1</span>  <span class="c"># force 1 bits to start</span>
        <span class="k">while</span> <span class="n">nbits</span> <span class="o">&lt;</span> <span class="n">nbits_lo</span><span class="p">:</span>
            <span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">bits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="n">nbits_hi</span> <span class="o">-</span> <span class="n">nbits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">bits</span> <span class="o">&lt;=</span> <span class="n">SHIFT</span><span class="p">)</span>
            <span class="n">nbits</span> <span class="o">=</span> <span class="n">nbits</span> <span class="o">+</span> <span class="n">bits</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span> <span class="o">&lt;&lt;</span> <span class="n">bits</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span> <span class="o">|</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">SHIFT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">nbits_lo</span> <span class="o">&lt;=</span> <span class="n">nbits</span> <span class="o">&lt;=</span> <span class="n">nbits_hi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="o">-</span><span class="n">answer</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="c"># Get random long consisting of ndigits random digits (relative to base</span>
    <span class="c"># BASE).  The sign bit is also random.</span>
</div>
<div class="viewcode-block" id="LongTest.getran2"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.getran2">[docs]</a>    <span class="k">def</span> <span class="nf">getran2</span><span class="p">(</span><span class="n">ndigits</span><span class="p">):</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndigits</span><span class="p">):</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="p">(</span><span class="n">answer</span> <span class="o">&lt;&lt;</span> <span class="n">SHIFT</span><span class="p">)</span> <span class="o">|</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MASK</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="o">-</span><span class="n">answer</span>
        <span class="k">return</span> <span class="n">answer</span>
</div>
<div class="viewcode-block" id="LongTest.check_division"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_division">[docs]</a>    <span class="k">def</span> <span class="nf">check_division</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">q2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">x</span><span class="o">//</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">%</span><span class="n">y</span>
        <span class="n">pab</span><span class="p">,</span> <span class="n">pba</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="n">x</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">pab</span><span class="p">,</span> <span class="n">pba</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;multiplication does not commute for </span><span class="si">%r</span><span class="s"> and </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;divmod returns different quotient than / for </span><span class="si">%r</span><span class="s"> and </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;divmod returns different mod than </span><span class="si">%%</span><span class="s"> for </span><span class="si">%r</span><span class="s"> and </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x != q*y + r after divmod on x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;bad mod from divmod on </span><span class="si">%r</span><span class="s"> and </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;bad mod from divmod on </span><span class="si">%r</span><span class="s"> and </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.test_division"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_division">[docs]</a>    <span class="k">def</span> <span class="nf">test_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAXDIGITS</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">KARATSUBA_CUTOFF</span><span class="p">,</span>
                                                      <span class="n">KARATSUBA_CUTOFF</span> <span class="o">+</span> <span class="mi">14</span><span class="p">))</span>
        <span class="n">digits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">KARATSUBA_CUTOFF</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lenx</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getran</span><span class="p">(</span><span class="n">lenx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">leny</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getran</span><span class="p">(</span><span class="n">leny</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c"># specific numbers chosen to exercise corner cases of the</span>
        <span class="c"># current long division implementation</span>

        <span class="c"># 30-bit cases involving a quotient digit estimate of BASE+1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">1231948412290879395966702881</span><span class="p">,</span>
                            <span class="mi">1147341367131428698</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">815427756481275430342312021515587883</span><span class="p">,</span>
                       <span class="mi">707270836069027745</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">627976073697012820849443363563599041</span><span class="p">,</span>
                       <span class="mi">643588798496057020</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">1115141373653752303710932756325578065</span><span class="p">,</span>
                       <span class="mi">1038556335171453937726882627</span><span class="p">)</span>
        <span class="c"># 30-bit cases that require the post-subtraction correction step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">922498905405436751940989320930368494</span><span class="p">,</span>
                       <span class="mi">949985870686786135626943396</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">768235853328091167204009652174031844</span><span class="p">,</span>
                       <span class="mi">1091555541180371554426545266</span><span class="p">)</span>

        <span class="c"># 15-bit cases involving a quotient digit estimate of BASE+1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">20172188947443</span><span class="p">,</span> <span class="mi">615611397</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">1020908530270155025</span><span class="p">,</span> <span class="mi">950795710</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">128589565723112408</span><span class="p">,</span> <span class="mi">736393718</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">609919780285761575</span><span class="p">,</span> <span class="mi">18613274546784</span><span class="p">)</span>
        <span class="c"># 15-bit cases that require the post-subtraction correction step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">710031681576388032</span><span class="p">,</span> <span class="mi">26769404391308</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_division</span><span class="p">(</span><span class="mi">1933622614268221</span><span class="p">,</span> <span class="mi">30212853348836</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="LongTest.test_karatsuba"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_karatsuba">[docs]</a>    <span class="k">def</span> <span class="nf">test_karatsuba</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">KARATSUBA_CUTOFF</span><span class="p">,</span>
                                                <span class="n">KARATSUBA_CUTOFF</span> <span class="o">+</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">digits</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">KARATSUBA_CUTOFF</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">KARATSUBA_CUTOFF</span> <span class="o">*</span> <span class="mi">100</span><span class="p">])</span>

        <span class="n">bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">digit</span> <span class="o">*</span> <span class="n">SHIFT</span> <span class="k">for</span> <span class="n">digit</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">]</span>

        <span class="c"># Test products of long strings of 1 bits -- (2**x-1)*(2**y-1) ==</span>
        <span class="c"># 2**(x+y) - 2**x - 2**y + 1, so the proper result is easy to check.</span>
        <span class="k">for</span> <span class="n">abits</span> <span class="ow">in</span> <span class="n">bits</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">abits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">bbits</span> <span class="ow">in</span> <span class="n">bits</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bbits</span> <span class="o">&lt;</span> <span class="n">abits</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bbits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">abits</span> <span class="o">+</span> <span class="n">bbits</span><span class="p">))</span> <span class="o">-</span>
                     <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">abits</span><span class="p">)</span> <span class="o">-</span>
                     <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bbits</span><span class="p">)</span> <span class="o">+</span>
                     <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                    <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;bad result for a*b: a=</span><span class="si">%r</span><span class="s">, b=</span><span class="si">%r</span><span class="s">, x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.check_bitop_identities_1"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_bitop_identities_1">[docs]</a>    <span class="k">def</span> <span class="nf">check_bitop_identities_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; 0 != 0 for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | 0 != x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ 0 != x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; -1 != x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | -1 != -1 for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ -1 != ~x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">~~</span><span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x != ~~x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; x != x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | x != x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ x != 0 for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; ~x != 0 for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | ~x != -1 for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ ~x != -1 for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;not -x == 1 + ~x for x=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">~</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;not -x == ~(x-1) forx =</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">SHIFT</span><span class="p">):</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">n</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &lt;&lt; n &gt;&gt; n != x for x=</span><span class="si">%r</span><span class="s">, n=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">//</span> <span class="n">p2</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">,</span>
                <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x // p2 != x &gt;&gt; n for x=</span><span class="si">%r</span><span class="s"> n=</span><span class="si">%r</span><span class="s"> p2=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p2</span><span class="p">)))</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">p2</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">,</span>
                <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x * p2 != x &lt;&lt; n for x=</span><span class="si">%r</span><span class="s"> n=</span><span class="si">%r</span><span class="s"> p2=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p2</span><span class="p">)))</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">p2</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">,</span>
                <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;not x &amp; -p2 == x &gt;&gt; n &lt;&lt; n for x=</span><span class="si">%r</span><span class="s"> n=</span><span class="si">%r</span><span class="s"> p2=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p2</span><span class="p">)))</span>
            <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">p2</span><span class="p">,</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;not x &amp; -p2 == x &amp; ~(p2 - 1) for x=</span><span class="si">%r</span><span class="s"> n=</span><span class="si">%r</span><span class="s"> p2=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p2</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="LongTest.check_bitop_identities_2"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_bitop_identities_2">[docs]</a>    <span class="k">def</span> <span class="nf">check_bitop_identities_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; y != y &amp; x for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">|</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | y != y | x for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">^</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ y != y ^ x for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="o">^</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ y ^ x != y for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">,</span> <span class="o">~</span><span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">|</span> <span class="o">~</span><span class="n">y</span><span class="p">),</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; y != ~(~x | ~y) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span><span class="p">,</span> <span class="o">~</span><span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">y</span><span class="p">),</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | y != ~(~x &amp; ~y) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ y != (x | y) &amp; ~(x &amp; y) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ y == (x &amp; ~y) | (~x &amp; y) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="o">|</span> <span class="o">~</span><span class="n">y</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x ^ y == (x | y) &amp; (~x | ~y) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="LongTest.check_bitop_identities_3"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_bitop_identities_3">[docs]</a>    <span class="k">def</span> <span class="nf">check_bitop_identities_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>
        <span class="n">eq</span><span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&amp;</span> <span class="n">z</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;(x &amp; y) &amp; z != x &amp; (y &amp; z) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">, z=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">((</span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span> <span class="o">|</span> <span class="p">(</span><span class="n">y</span> <span class="o">|</span> <span class="n">z</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;(x | y) | z != x | (y | z) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">, z=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">((</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">)</span> <span class="o">^</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span> <span class="o">^</span> <span class="p">(</span><span class="n">y</span> <span class="o">^</span> <span class="n">z</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;(x ^ y) ^ z != x ^ (y ^ z) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">, z=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">|</span> <span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">z</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x &amp; (y | z) != (x &amp; y) | (x &amp; z) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">, z=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>
        <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="p">(</span><span class="n">y</span> <span class="o">&amp;</span> <span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">|</span> <span class="n">z</span><span class="p">),</span>
             <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;x | (y &amp; z) != (x | y) &amp; (x | z) for x=</span><span class="si">%r</span><span class="s">, y=</span><span class="si">%r</span><span class="s">, z=</span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="LongTest.test_bitop_identities"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_bitop_identities">[docs]</a>    <span class="k">def</span> <span class="nf">test_bitop_identities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">special</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_bitop_identities_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAXDIGITS</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lenx</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getran</span><span class="p">(</span><span class="n">lenx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_bitop_identities_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">leny</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getran</span><span class="p">(</span><span class="n">leny</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_bitop_identities_2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_bitop_identities_3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getran</span><span class="p">((</span><span class="n">lenx</span> <span class="o">+</span> <span class="n">leny</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.slow_format"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.slow_format">[docs]</a>    <span class="k">def</span> <span class="nf">slow_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sign</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span>
        <span class="k">while</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
            <span class="n">digits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">digits</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="n">digits</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">&#39;-&#39;</span><span class="p">[:</span><span class="n">sign</span><span class="p">]</span> <span class="o">+</span> \
               <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;0b&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;0o&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;0x&#39;</span><span class="p">}[</span><span class="n">base</span><span class="p">]</span> <span class="o">+</span> \
               <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;0123456789abcdef&quot;</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.check_format_1"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_format_1">[docs]</a>    <span class="k">def</span> <span class="nf">check_format_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">mapper</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">bin</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">oct</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">repr</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="nb">hex</span><span class="p">):</span>
            <span class="n">got</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slow_format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> returned </span><span class="si">%r</span><span class="s"> but expected </span><span class="si">%r</span><span class="s"> for </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="n">mapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">got</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&#39;int(&quot;</span><span class="si">%s</span><span class="s">&quot;, 0) != </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">got</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.test_format"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_format">[docs]</a>    <span class="k">def</span> <span class="nf">test_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">special</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_format_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lenx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAXDIGITS</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getran</span><span class="p">(</span><span class="n">lenx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_format_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_long"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check conversions from string</span>
        <span class="n">LL</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s">&#39;1&#39;</span> <span class="o">+</span> <span class="s">&#39;0&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">20</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;1&#39;</span> <span class="o">+</span> <span class="s">&#39;0&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">LL</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;+&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;  </span><span class="se">\t\t</span><span class="s">  &quot;</span><span class="p">:</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">+</span> <span class="n">s</span>
                    <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">vv</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ss</span><span class="p">),</span> <span class="n">vv</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="c"># trailing L should no longer be accepted...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;123L&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;123l&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;0L&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;-37L&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;0x32L&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;1L&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="c"># ... but it&#39;s just a normal digit if base &gt;= 22</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;1L&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span> <span class="mi">43</span><span class="p">)</span>

        <span class="c"># tests with base 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;000&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;0o123&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">83</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;0x123&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">291</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;0b100&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39; 0O123   &#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">83</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39; 0X123  &#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">291</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39; 0B100 &#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;+0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;-0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;00&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;08&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;-012395&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># invalid bases</span>
        <span class="n">invalid_bases</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">909</span><span class="p">,</span>
                          <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                          <span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                          <span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span>
                          <span class="p">]</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">invalid_bases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&#39;42&#39;</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="LongTest.test_conversion"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">test_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">class</span> <span class="nc">JustLong</span><span class="p">:</span>
            <span class="c"># test that __long__ no longer used in 3.x</span>
            <span class="k">def</span> <span class="nf">__long__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">42</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">JustLong</span><span class="p">())</span>

        <span class="k">class</span> <span class="nc">LongTrunc</span><span class="p">:</span>
            <span class="c"># __long__ should be ignored in 3.x</span>
            <span class="k">def</span> <span class="nf">__long__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">42</span>
            <span class="k">def</span> <span class="nf">__trunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">1729</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">LongTrunc</span><span class="p">()),</span> <span class="mi">1729</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.check_float_conversion"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_float_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">check_float_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c"># Check that int -&gt; float conversion behaviour matches</span>
        <span class="c"># that of the pure Python version above.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="s">&#39;overflow&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">int_to_float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="s">&#39;overflow&#39;</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Error in conversion of integer {} to float.  &quot;</span>
               <span class="s">&quot;Got {}, expected {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</div>
    <span class="nd">@support.requires_IEEE_754</span>
<div class="viewcode-block" id="LongTest.test_float_conversion"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_float_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">test_float_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">exact_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">54</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">54</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">54</span><span class="p">,</span>
                         <span class="mi">2</span><span class="o">**</span><span class="mi">54</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">exact_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">),</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>

        <span class="c"># test round-half-even</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="o">+</span><span class="n">x</span><span class="p">))),</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">53</span><span class="o">+</span><span class="n">y</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                     <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                     <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">)]:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">54</span><span class="o">+</span><span class="n">x</span><span class="p">))),</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">54</span><span class="o">+</span><span class="n">y</span><span class="p">))</span>

        <span class="c"># behaviour near extremes of floating-point range</span>
        <span class="n">int_dbl_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">DBL_MAX</span><span class="p">)</span>
        <span class="n">top_power</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">DBL_MAX_EXP</span>
        <span class="n">halfway</span> <span class="o">=</span> <span class="p">(</span><span class="n">int_dbl_max</span> <span class="o">+</span> <span class="n">top_power</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">int_dbl_max</span><span class="p">),</span> <span class="n">DBL_MAX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">int_dbl_max</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">DBL_MAX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">halfway</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">DBL_MAX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">halfway</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">halfway</span><span class="p">),</span> <span class="o">-</span><span class="n">DBL_MAX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="o">-</span><span class="n">halfway</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">top_power</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">top_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">top_power</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">top_power</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">top_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">top_power</span><span class="o">*</span><span class="n">top_power</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">53</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">53</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">y</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">53</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">53</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">y</span><span class="p">)</span>

        <span class="c"># Compare builtin float conversion with pure Python int_to_float</span>
        <span class="c"># function above.</span>
        <span class="n">test_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">int_dbl_max</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">int_dbl_max</span><span class="p">,</span> <span class="n">int_dbl_max</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">halfway</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">halfway</span><span class="p">,</span> <span class="n">halfway</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">top_power</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">top_power</span><span class="p">,</span> <span class="n">top_power</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span><span class="o">*</span><span class="n">top_power</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">top_power</span><span class="p">,</span> <span class="n">top_power</span><span class="o">*</span><span class="n">top_power</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">test_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">exact_values</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">):</span>
                <span class="n">test_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">53</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_float_conversion</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_float_conversion</span><span class="p">(</span><span class="o">-</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_float_overflow"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_float_overflow">[docs]</a>    <span class="k">def</span> <span class="nf">test_float_overflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">shuge</span> <span class="o">=</span> <span class="s">&#39;12345&#39;</span> <span class="o">*</span> <span class="mi">120</span>
        <span class="n">huge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30000</span>
        <span class="n">mhuge</span> <span class="o">=</span> <span class="o">-</span><span class="n">huge</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;huge&#39;</span><span class="p">:</span> <span class="n">huge</span><span class="p">,</span> <span class="s">&#39;mhuge&#39;</span><span class="p">:</span> <span class="n">mhuge</span><span class="p">,</span> <span class="s">&#39;shuge&#39;</span><span class="p">:</span> <span class="n">shuge</span><span class="p">,</span> <span class="s">&#39;math&#39;</span><span class="p">:</span> <span class="n">math</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;float(huge)&quot;</span><span class="p">,</span> <span class="s">&quot;float(mhuge)&quot;</span><span class="p">,</span>
                     <span class="s">&quot;complex(huge)&quot;</span><span class="p">,</span> <span class="s">&quot;complex(mhuge)&quot;</span><span class="p">,</span>
                     <span class="s">&quot;complex(huge, 1)&quot;</span><span class="p">,</span> <span class="s">&quot;complex(mhuge, 1)&quot;</span><span class="p">,</span>
                     <span class="s">&quot;complex(1, huge)&quot;</span><span class="p">,</span> <span class="s">&quot;complex(1, mhuge)&quot;</span><span class="p">,</span>
                     <span class="s">&quot;1. + huge&quot;</span><span class="p">,</span> <span class="s">&quot;huge + 1.&quot;</span><span class="p">,</span> <span class="s">&quot;1. + mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge + 1.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;1. - huge&quot;</span><span class="p">,</span> <span class="s">&quot;huge - 1.&quot;</span><span class="p">,</span> <span class="s">&quot;1. - mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge - 1.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;1. * huge&quot;</span><span class="p">,</span> <span class="s">&quot;huge * 1.&quot;</span><span class="p">,</span> <span class="s">&quot;1. * mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge * 1.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;1. // huge&quot;</span><span class="p">,</span> <span class="s">&quot;huge // 1.&quot;</span><span class="p">,</span> <span class="s">&quot;1. // mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge // 1.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;1. / huge&quot;</span><span class="p">,</span> <span class="s">&quot;huge / 1.&quot;</span><span class="p">,</span> <span class="s">&quot;1. / mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge / 1.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;1. ** huge&quot;</span><span class="p">,</span> <span class="s">&quot;huge ** 1.&quot;</span><span class="p">,</span> <span class="s">&quot;1. ** mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge ** 1.&quot;</span><span class="p">,</span>
                     <span class="s">&quot;math.sin(huge)&quot;</span><span class="p">,</span> <span class="s">&quot;math.sin(mhuge)&quot;</span><span class="p">,</span>
                     <span class="s">&quot;math.sqrt(huge)&quot;</span><span class="p">,</span> <span class="s">&quot;math.sqrt(mhuge)&quot;</span><span class="p">,</span> <span class="c"># should do better</span>
                     <span class="c"># math.floor() of an int returns an int now</span>
                     <span class="c">##&quot;math.floor(huge)&quot;, &quot;math.floor(mhuge)&quot;,</span>
                     <span class="p">]:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

        <span class="c"># XXX Perhaps float(shuge) can raise OverflowError on some box?</span>
        <span class="c"># The comparison should not.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">shuge</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">shuge</span><span class="p">),</span>
            <span class="s">&quot;float(shuge) should not equal int(shuge)&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_logs"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_logs">[docs]</a>    <span class="k">def</span> <span class="nf">test_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG10E</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exp</span>
            <span class="n">log10</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">log10</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

            <span class="c"># log10(value) == exp, so log(value) == log10(value)/log10(e) ==</span>
            <span class="c"># exp/LOG10E</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">exp</span> <span class="o">/</span> <span class="n">LOG10E</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bad</span> <span class="ow">in</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_mixed_compares"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_mixed_compares">[docs]</a>    <span class="k">def</span> <span class="nf">test_mixed_compares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span>

        <span class="c"># We&#39;re mostly concerned with that mixing floats and ints does the</span>
        <span class="c"># right stuff, even when ints are too large to fit in a float.</span>
        <span class="c"># The safest way to check the results is to use an entirely different</span>
        <span class="c"># method, which we do here via a skeletal rational class (which</span>
        <span class="c"># represents all Python ints and floats exactly).</span>
        <span class="k">class</span> <span class="nc">Rat</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="c"># Convert to exact rational equivalent.</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">frexp</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="k">assert</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="mf">0.5</span> <span class="o">&lt;=</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
                    <span class="c"># |value| = f * 2**e exactly</span>

                    <span class="c"># Suck up CHUNK bits at a time; 28 is enough so that we suck</span>
                    <span class="c"># up all bits in 2 iterations for all known binary double-</span>
                    <span class="c"># precision formats, and small enough to fit in an int.</span>
                    <span class="n">CHUNK</span> <span class="o">=</span> <span class="mi">28</span>
                    <span class="n">top</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c"># invariant: |value| = (top + f) * 2**e exactly</span>
                    <span class="k">while</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ldexp</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">CHUNK</span><span class="p">)</span>
                        <span class="n">digit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="n">digit</span> <span class="o">&gt;&gt;</span> <span class="n">CHUNK</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">top</span> <span class="o">&lt;&lt;</span> <span class="n">CHUNK</span><span class="p">)</span> <span class="o">|</span> <span class="n">digit</span>
                        <span class="n">f</span> <span class="o">-=</span> <span class="n">digit</span>
                        <span class="k">assert</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
                        <span class="n">e</span> <span class="o">-=</span> <span class="n">CHUNK</span>

                    <span class="c"># Now |value| = top * 2**e exactly.</span>
                    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="n">top</span> <span class="o">&lt;&lt;</span> <span class="n">e</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="n">top</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="n">e</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span>
                    <span class="k">assert</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;can&#39;t deal with </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">_cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Rat</span><span class="p">):</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">Rat</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">n</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
            <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

        <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1e20</span><span class="p">,</span> <span class="mf">1e200</span><span class="p">]</span>
        <span class="c"># 2**48 is an important boundary in the internals.  2**53 is an</span>
        <span class="c"># important boundary for IEEE double precision.</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="mf">2.0</span><span class="o">**</span><span class="mi">48</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">**</span><span class="mi">50</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">**</span><span class="mi">53</span><span class="p">:</span>
            <span class="n">cases</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">t</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span>
                          <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">cases</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">)])</span>
        <span class="c"># 1 &lt;&lt; 20000 should exceed all double formats.  int(1e200) is to</span>
        <span class="c"># check that we get equality with 1e200 above.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e200</span><span class="p">)</span>
        <span class="n">cases</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20000</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cases</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
            <span class="n">Rx</span> <span class="o">=</span> <span class="n">Rat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
                <span class="n">Ry</span> <span class="o">=</span> <span class="n">Rat</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">Rcmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rx</span> <span class="o">&gt;</span> <span class="n">Ry</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Rx</span> <span class="o">&lt;</span> <span class="n">Ry</span><span class="p">)</span>
                <span class="n">xycmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">Rcmp</span><span class="p">,</span> <span class="n">xycmp</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">,</span> <span class="n">xycmp</span><span class="p">))</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> == </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">))</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> != </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">))</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> &lt; </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">))</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> &lt;= </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">))</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> &gt; </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">))</span>
                <span class="n">eq</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Frm</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> &gt;= </span><span class="si">%r</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Rcmp</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.test__format__"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test__format__">[docs]</a>    <span class="k">def</span> <span class="nf">test__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">123456789</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">),</span> <span class="s">&#39;123456789&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">123456789</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">),</span> <span class="s">&#39;123456789&#39;</span><span class="p">)</span>

        <span class="c"># sign and aligning are interdependent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">),</span> <span class="s">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">),</span> <span class="s">&#39;-1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;-3&quot;</span><span class="p">),</span> <span class="s">&#39;  1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;-3&quot;</span><span class="p">),</span> <span class="s">&#39; -1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;+3&quot;</span><span class="p">),</span> <span class="s">&#39; +1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;+3&quot;</span><span class="p">),</span> <span class="s">&#39; -1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot; 3&quot;</span><span class="p">),</span> <span class="s">&#39;  1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot; 3&quot;</span><span class="p">),</span> <span class="s">&#39; -1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">),</span> <span class="s">&#39; 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">),</span> <span class="s">&#39;-1&#39;</span><span class="p">)</span>

        <span class="c"># hex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;X&quot;</span><span class="p">),</span> <span class="s">&quot;3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;4d2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;-4d2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;8x&quot;</span><span class="p">),</span> <span class="s">&quot;     4d2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;8x&quot;</span><span class="p">),</span> <span class="s">&quot;    -4d2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;4d2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;-4d2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;-3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;X&quot;</span><span class="p">),</span> <span class="s">&quot;-3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;be&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;be&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;be&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="s">&quot;X&quot;</span><span class="p">),</span> <span class="s">&quot;BE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;be&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="s">&quot;x&quot;</span><span class="p">),</span> <span class="s">&quot;-be&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;be&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="s">&quot;X&quot;</span><span class="p">),</span> <span class="s">&quot;-BE&quot;</span><span class="p">)</span>

        <span class="c"># octal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">),</span> <span class="s">&quot;11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">),</span> <span class="s">&quot;-11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">),</span> <span class="s">&quot;10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">),</span> <span class="s">&quot;-10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;-b&quot;</span><span class="p">),</span> <span class="s">&quot;10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;-b&quot;</span><span class="p">),</span> <span class="s">&quot;-10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot; b&quot;</span><span class="p">),</span> <span class="s">&quot; 10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot; b&quot;</span><span class="p">),</span> <span class="s">&quot;-10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;+b&quot;</span><span class="p">),</span> <span class="s">&quot;+10011010010&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;+b&quot;</span><span class="p">),</span> <span class="s">&quot;-10011010010&quot;</span><span class="p">)</span>

        <span class="c"># make sure these are errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;1.3&quot;</span><span class="p">)</span>  <span class="c"># precision disallowed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;+c&quot;</span><span class="p">)</span>   <span class="c"># sign not allowed</span>
                                                         <span class="c"># with &#39;c&#39;</span>

        <span class="c"># ensure that only int and float type specifiers work</span>
        <span class="k">for</span> <span class="n">format_spec</span> <span class="ow">in</span> <span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span>
                            <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">format_spec</span> <span class="ow">in</span> <span class="s">&#39;bcdoxXeEfFgGn%&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">),</span> <span class="n">format_spec</span><span class="p">)</span>

        <span class="c"># ensure that float type specifiers work; format converts</span>
        <span class="c">#  the int to a float</span>
        <span class="k">for</span> <span class="n">format_spec</span> <span class="ow">in</span> <span class="s">&#39;eEfFgG%&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1234567890</span><span class="p">,</span> <span class="o">-</span><span class="mi">1234567890</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">),</span>
                                 <span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">format_spec</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.test_nan_inf"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_nan_inf">[docs]</a>    <span class="k">def</span> <span class="nf">test_nan_inf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;-inf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LongTest.test_true_division"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_true_division">[docs]</a>    <span class="k">def</span> <span class="nf">test_true_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">huge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">40000</span>
        <span class="n">mhuge</span> <span class="o">=</span> <span class="o">-</span><span class="n">huge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">huge</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mhuge</span> <span class="o">/</span> <span class="n">mhuge</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">huge</span> <span class="o">/</span> <span class="n">mhuge</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mhuge</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mhuge</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mhuge</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">666</span> <span class="o">*</span> <span class="n">huge</span> <span class="o">+</span> <span class="p">(</span><span class="n">huge</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="mf">666.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">666</span> <span class="o">*</span> <span class="n">mhuge</span> <span class="o">+</span> <span class="p">(</span><span class="n">mhuge</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">mhuge</span><span class="p">,</span> <span class="mf">666.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">666</span> <span class="o">*</span> <span class="n">huge</span> <span class="o">+</span> <span class="p">(</span><span class="n">huge</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">mhuge</span><span class="p">,</span> <span class="o">-</span><span class="mf">666.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">666</span> <span class="o">*</span> <span class="n">mhuge</span> <span class="o">+</span> <span class="p">(</span><span class="n">mhuge</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="o">-</span><span class="mf">666.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">huge</span> <span class="o">/</span> <span class="p">(</span><span class="n">huge</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">1000000</span> <span class="o">*</span> <span class="n">huge</span><span class="p">)</span> <span class="o">/</span> <span class="n">huge</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>

        <span class="n">namespace</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;huge&#39;</span><span class="p">:</span> <span class="n">huge</span><span class="p">,</span> <span class="s">&#39;mhuge&#39;</span><span class="p">:</span> <span class="n">mhuge</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">overflow</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;float(huge)&quot;</span><span class="p">,</span> <span class="s">&quot;float(mhuge)&quot;</span><span class="p">,</span>
                         <span class="s">&quot;huge / 1&quot;</span><span class="p">,</span> <span class="s">&quot;huge / 2&quot;</span><span class="p">,</span> <span class="s">&quot;huge / -1&quot;</span><span class="p">,</span> <span class="s">&quot;huge / -2&quot;</span><span class="p">,</span>
                         <span class="s">&quot;mhuge / 100&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge / 200&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="n">overflow</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">underflow</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;1 / huge&quot;</span><span class="p">,</span> <span class="s">&quot;2 / huge&quot;</span><span class="p">,</span> <span class="s">&quot;-1 / huge&quot;</span><span class="p">,</span> <span class="s">&quot;-2 / huge&quot;</span><span class="p">,</span>
                         <span class="s">&quot;100 / mhuge&quot;</span><span class="p">,</span> <span class="s">&quot;200 / mhuge&quot;</span><span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">underflow</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                             <span class="s">&quot;expected underflow to 0 from </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">underflow</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">zero</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;huge / 0&quot;</span><span class="p">,</span> <span class="s">&quot;mhuge / 0&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.check_truediv"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.check_truediv">[docs]</a>    <span class="k">def</span> <span class="nf">check_truediv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">skip_small</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify that the result of a/b is correctly rounded, by</span>
<span class="sd">        comparing it with a pure Python implementation of correctly</span>
<span class="sd">        rounded division.  b should be nonzero.&quot;&quot;&quot;</span>

        <span class="c"># skip check for small a and b: in this case, the current</span>
        <span class="c"># implementation converts the arguments to float directly and</span>
        <span class="c"># then applies a float division.  This can give doubly-rounded</span>
        <span class="c"># results on x87-using machines (particularly 32-bit Linux).</span>
        <span class="k">if</span> <span class="n">skip_small</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">**</span><span class="n">DBL_MANT_DIG</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># use repr so that we can distinguish between -0.0 and 0.0</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">truediv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="s">&#39;overflow&#39;</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="s">&#39;zerodivision&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">got</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="n">got</span> <span class="o">=</span> <span class="s">&#39;overflow&#39;</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">got</span> <span class="o">=</span> <span class="s">&#39;zerodivision&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">got</span><span class="p">,</span> <span class="s">&quot;Incorrectly rounded division {}/{}: &quot;</span>
                         <span class="s">&quot;expected {}, got {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">got</span><span class="p">))</span>
</div>
    <span class="nd">@support.requires_IEEE_754</span>
<div class="viewcode-block" id="LongTest.test_correctly_rounded_true_division"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_correctly_rounded_true_division">[docs]</a>    <span class="k">def</span> <span class="nf">test_correctly_rounded_true_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># more stringent tests than those above, checking that the</span>
        <span class="c"># result of true division of ints is always correctly rounded.</span>
        <span class="c"># This test should probably be considered CPython-specific.</span>

        <span class="c"># Exercise all the code paths not involving Gb-sized ints.</span>
        <span class="c"># ... divisions involving zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="o">-</span><span class="mi">456</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c"># ... overflow or underflow by large margin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">671</span> <span class="o">*</span> <span class="mi">12345</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="n">DBL_MAX_EXP</span><span class="p">,</span> <span class="mi">12345</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">12345</span><span class="p">,</span> <span class="mi">345678</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">DBL_MANT_DIG</span> <span class="o">-</span> <span class="n">DBL_MIN_EXP</span><span class="p">))</span>
        <span class="c"># ... a much larger or smaller than b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">12345</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span> <span class="mi">98765</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">12345</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">,</span> <span class="mi">98765</span><span class="o">*</span><span class="mi">7</span><span class="o">**</span><span class="mi">81</span><span class="p">)</span>
        <span class="c"># ... a / b near a boundary: one of 1, 2**DBL_MANT_DIG, 2**DBL_MIN_EXP,</span>
        <span class="c">#                 2**DBL_MAX_EXP, 2**(DBL_MIN_EXP-DBL_MANT_DIG)</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">DBL_MANT_DIG</span><span class="p">,</span> <span class="n">DBL_MIN_EXP</span><span class="p">,</span>
                 <span class="n">DBL_MAX_EXP</span><span class="p">,</span> <span class="n">DBL_MIN_EXP</span> <span class="o">-</span> <span class="n">DBL_MANT_DIG</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mi">15</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">75312</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="nb">max</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">69187</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">69187</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="nb">max</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">75312</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c"># overflow corner case</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">7</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">23</span><span class="p">,</span> <span class="o">-</span><span class="mi">67891</span><span class="p">,</span> <span class="o">-</span><span class="mi">41</span><span class="o">**</span><span class="mi">50</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">DBL_MIN_OVERFLOW</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">DBL_MIN_OVERFLOW</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>

        <span class="c"># check detection of inexactness in shifting stage</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">250</span><span class="p">):</span>
            <span class="c"># (2**DBL_MANT_DIG+1)/(2**DBL_MANT_DIG) lies halfway</span>
            <span class="c"># between two representable floats, and would usually be</span>
            <span class="c"># rounded down under round-half-to-even.  The tiniest of</span>
            <span class="c"># additions to the numerator should cause it to be rounded</span>
            <span class="c"># up instead.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">((</span><span class="mi">2</span><span class="o">**</span><span class="n">DBL_MANT_DIG</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">12345</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="mi">200</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="n">n</span><span class="p">,</span>
                           <span class="mi">2</span><span class="o">**</span><span class="n">DBL_MANT_DIG</span><span class="o">*</span><span class="mi">12345</span><span class="p">)</span>

        <span class="c"># 1/2731 is one of the smallest division cases that&#39;s subject</span>
        <span class="c"># to double rounding on IEEE 754 machines working internally with</span>
        <span class="c"># 64-bit precision.  On such machines, the next check would fail,</span>
        <span class="c"># were it not explicitly skipped in check_truediv.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2731</span><span class="p">)</span>

        <span class="c"># a particularly bad case for the old algorithm:  gives an</span>
        <span class="c"># error of close to 3.5 ulps.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">295147931372582273023</span><span class="p">,</span> <span class="mi">295147932265116303360</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="c"># test round-half-to-even behaviour, normal result</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">7</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">23</span><span class="p">,</span> <span class="o">-</span><span class="mi">67891</span><span class="p">,</span> <span class="o">-</span><span class="mi">41</span><span class="o">**</span><span class="mi">50</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">DBL_MANT_DIG</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="c"># test round-half-to-even, subnormal result</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">1076</span><span class="p">)</span>

        <span class="c"># largeish random divisions: a/b where |a| &lt;= |b| &lt;=</span>
        <span class="c"># 2*|a|; |ans| is between 0.5 and 1.0, so error should</span>
        <span class="c"># always be bounded by 2**-54 with equality possible only</span>
        <span class="c"># if the least significant bit of q=ans*2**53 is zero.</span>
        <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">1000</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">)</span>

        <span class="c"># and some (genuinely) random tests</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
            <span class="n">a_bits</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">b_bits</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">a_bits</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">b_bits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_truediv</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_small_ints"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_small_ints">[docs]</a>    <span class="k">def</span> <span class="nf">test_small_ints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">257</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">|</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">^</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">~~</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">**</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="c"># corner cases</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">70</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_bit_length"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_bit_length">[docs]</a>    <span class="k">def</span> <span class="nf">test_bit_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tiny</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">65000</span><span class="p">,</span> <span class="mi">65000</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
            <span class="c"># Check equivalence with Python version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;-0b&#39;</span><span class="p">)))</span>
            <span class="c"># Behaviour as specified in the docs</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c"># Alternative definition: x.bit_length() == 1 + floor(log_2(x))</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># When x is an exact power of 2, numeric errors can</span>
                <span class="c"># cause floor(log(x)/log(2)) to be one too small; for</span>
                <span class="c"># small x this can be fixed by adding a small quantity</span>
                <span class="c"># to the quotient before taking the floor.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
                        <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tiny</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">234</span><span class="p">]:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_round"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_round">[docs]</a>    <span class="k">def</span> <span class="nf">test_round</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># check round-half-even algorithm. For round to nearest ten;</span>
        <span class="c"># rounding map is invariant under adding multiples of 20</span>
        <span class="n">test_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                     <span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span><span class="mi">20</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">520</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">test_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">got</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="n">v</span><span class="o">+</span><span class="n">offset</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">got</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>

        <span class="c"># larger second argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">149</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">51</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">149</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">251</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">172500</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="mi">172000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">173500</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="mi">174000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">31415926540</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">31415926500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="mi">31415927000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="mi">31415930000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span> <span class="mi">31415900000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="mi">31416000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="mi">31420000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">),</span> <span class="mi">31400000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">),</span> <span class="mi">31000000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span> <span class="mi">30000000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">31415926535</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># should get correct results even for huge inputs</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
            <span class="n">got</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">k</span> <span class="o">+</span> <span class="mi">324678</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">expect</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">k</span> <span class="o">+</span> <span class="mi">325000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">expect</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">got</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>

        <span class="c"># nonnegative second argument: round(x, n) should just return x</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
                <span class="n">got</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">got</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">huge_n</span> <span class="ow">in</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">8979323</span><span class="p">,</span> <span class="n">huge_n</span><span class="p">),</span> <span class="mi">8979323</span><span class="p">)</span>

        <span class="c"># omitted second argument</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
            <span class="n">got</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">got</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>

        <span class="c"># bad second argument</span>
        <span class="n">bad_exponents</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;brian&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">0j</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bad_exponents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_to_bytes"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_to_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_to_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="n">byteorder</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">test</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="n">test</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">),</span> <span class="n">byteorder</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">),</span>
                        <span class="n">expected</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                        <span class="s">&quot;failed to convert {0} with byteorder={1} and signed={2}&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">byteorder</span><span class="p">,</span> <span class="n">signed</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="c"># Convert integers to signed big-endian byte arrays.</span>
        <span class="n">tests1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">127</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">128</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">129</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">127</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">129</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x81</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">255</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">256</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">256</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">32767</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">32768</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x80\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">65535</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">65536</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">8388608</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x00\x00</span><span class="s">&#39;</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests1</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Convert integers to signed little-endian byte arrays.</span>
        <span class="n">tests2</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">127</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">128</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">129</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">127</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">129</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">255</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">256</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">256</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">32767</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">32768</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x80</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">65535</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">65536</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">8388608</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x80</span><span class="s">&#39;</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests2</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Convert integers to unsigned big-endian byte arrays.</span>
        <span class="n">tests3</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">127</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">128</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">256</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">32767</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">32768</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">65535</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">65536</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00\x00</span><span class="s">&#39;</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests3</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># Convert integers to unsigned little-endian byte arrays.</span>
        <span class="n">tests4</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">127</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">128</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">256</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">32767</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">32768</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x80</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">65535</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="mi">65536</span><span class="p">:</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x01</span><span class="s">&#39;</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests4</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x01</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff\xff\xff\xff</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_from_bytes"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_from_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="n">byteorder</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">test</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">byteorder</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="n">signed</span><span class="p">),</span>
                        <span class="n">expected</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                        <span class="s">&quot;failed to convert {0} with byteorder={1!r} and signed={2}&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">byteorder</span><span class="p">,</span> <span class="n">signed</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="c"># Convert signed big-endian byte arrays to integers.</span>
        <span class="n">tests1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">127</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">129</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x81</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">255</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">32767</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">65535</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">65536</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x00\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">8388608</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests1</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Convert signed little-endian byte arrays to integers.</span>
        <span class="n">tests2</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">127</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">129</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">255</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">32767</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">65535</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">65536</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">8388608</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests2</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Convert unsigned big-endian byte arrays to integers.</span>
        <span class="n">tests3</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">32767</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">32768</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">65535</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01\x00\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">65536</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests3</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># Convert integers to unsigned little-endian byte arrays.</span>
        <span class="n">tests4</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x7f</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">32767</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x80</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">32768</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xff</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">65535</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="mi">65536</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">check</span><span class="p">(</span><span class="n">tests4</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">myint</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)),</span> <span class="n">myint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="n">myint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">)),</span> <span class="n">myint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="n">myint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">([</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="o">-</span><span class="mi">65536</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="o">-</span><span class="mi">65536</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00\x00</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="o">-</span><span class="mi">65536</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00\x00</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="o">-</span><span class="mi">65536</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00\x00</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="o">-</span><span class="mi">65536</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
            <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\x00\x00</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="o">-</span><span class="mi">65536</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;big</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;little</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">myint</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_access_to_nonexistent_digit_0"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_access_to_nonexistent_digit_0">[docs]</a>    <span class="k">def</span> <span class="nf">test_access_to_nonexistent_digit_0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># http://bugs.python.org/issue14630: A bug in _PyLong_Copy meant that</span>
        <span class="c"># ob_digit[0] was being incorrectly accessed for instances of a</span>
        <span class="c"># subclass of int, with value 0.</span>
        <span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>
                <span class="k">return</span> <span class="bp">self</span>

        <span class="n">integers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">integers</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LongTest.test_shift_bool"><a class="viewcode-back" href="../../test.html#test.test_long.LongTest.test_shift_bool">[docs]</a>    <span class="k">def</span> <span class="nf">test_shift_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #21422: ensure that bool &lt;&lt; int and bool &gt;&gt; int return int</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_long.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">():</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="n">LongTest</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>