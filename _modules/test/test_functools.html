

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_functools &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_functools</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_functools</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">proxy</span>

<span class="kn">import</span> <span class="nn">functools</span>

<span class="n">py_functools</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">import_fresh_module</span><span class="p">(</span><span class="s">&#39;functools&#39;</span><span class="p">,</span> <span class="n">blocked</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;_functools&#39;</span><span class="p">])</span>
<span class="n">c_functools</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">import_fresh_module</span><span class="p">(</span><span class="s">&#39;functools&#39;</span><span class="p">,</span> <span class="n">fresh</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;_functools&#39;</span><span class="p">])</span>

<span class="n">decimal</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">import_fresh_module</span><span class="p">(</span><span class="s">&#39;decimal&#39;</span><span class="p">,</span> <span class="n">fresh</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;_decimal&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="capture"><a class="viewcode-back" href="../../test.html#test.test_functools.capture">[docs]</a><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;capture all positional and keyword arguments&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kw</span>

</div>
<div class="viewcode-block" id="signature"><a class="viewcode-back" href="../../test.html#test.test_functools.signature">[docs]</a><span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="n">part</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; return the signature of a partial object &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestPartial"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial">[docs]</a><span class="k">class</span> <span class="nc">TestPartial</span><span class="p">:</span>

<div class="viewcode-block" id="TestPartial.test_basic_examples"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_basic_examples">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">callable</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
                         <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">40</span><span class="p">)))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])),</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestPartial.test_attributes"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="c"># attributes should be readable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">capture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">keywords</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestPartial.test_argument_checking"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_argument_checking">[docs]</a>    <span class="k">def</span> <span class="nf">test_argument_checking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">)</span>     <span class="c"># need at least a func arg</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="mi">2</span><span class="p">)()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;First arg not checked for callability&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartial.test_protection_of_callers_dict_argument"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_protection_of_callers_dict_argument">[docs]</a>    <span class="k">def</span> <span class="nf">test_protection_of_callers_dict_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># a caller&#39;s dictionary should not be altered by partial</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
        <span class="n">p</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="TestPartial.test_arg_combinations"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_arg_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">test_arg_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># exercise special code paths for zero args in either partial</span>
        <span class="c"># object or the caller</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(),</span> <span class="p">((),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(),</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">{}))</span>
</div>
<div class="viewcode-block" id="TestPartial.test_kw_combinations"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_kw_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">test_kw_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># exercise special code paths for no keyword args in</span>
        <span class="c"># either the partial object or the caller</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(),</span> <span class="p">((),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">((),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(),</span> <span class="p">((),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="p">((),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}))</span>
        <span class="c"># keyword args in the call override those in the partial object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="p">((),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}))</span>
</div>
<div class="viewcode-block" id="TestPartial.test_positional"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_positional">[docs]</a>    <span class="k">def</span> <span class="nf">test_positional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># make sure positional arguments are captured correctly</span>
        <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="p">[(),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,)</span>
            <span class="n">got</span><span class="p">,</span> <span class="n">empty</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">expected</span> <span class="o">==</span> <span class="n">got</span> <span class="ow">and</span> <span class="n">empty</span> <span class="o">==</span> <span class="p">{})</span>
</div>
<div class="viewcode-block" id="TestPartial.test_keyword"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_keyword">[docs]</a>    <span class="k">def</span> <span class="nf">test_keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># make sure keyword arguments are captured correctly</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">,</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
            <span class="n">empty</span><span class="p">,</span> <span class="n">got</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">expected</span> <span class="o">==</span> <span class="n">got</span> <span class="ow">and</span> <span class="n">empty</span> <span class="o">==</span> <span class="p">())</span>
</div>
<div class="viewcode-block" id="TestPartial.test_no_side_effects"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_no_side_effects">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_side_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># make sure there are no side effects that affect subsequent calls</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">args1</span><span class="p">,</span> <span class="n">kw1</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">args1</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kw1</span> <span class="o">==</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">args2</span><span class="p">,</span> <span class="n">kw2</span> <span class="o">=</span> <span class="n">p</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">args2</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="ow">and</span> <span class="n">kw2</span> <span class="o">==</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="TestPartial.test_error_propagation"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_error_propagation">[docs]</a>    <span class="k">def</span> <span class="nf">test_error_propagation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartial.test_weakref"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_weakref">[docs]</a>    <span class="k">def</span> <span class="nf">test_weakref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ReferenceError</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;func&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartial.test_with_bound_and_unbound_methods"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartial.test_with_bound_and_unbound_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_with_bound_and_unbound_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
        <span class="n">join</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;0123456789&#39;</span><span class="p">)</span>
        <span class="n">join</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">&#39;0123456789&#39;</span><span class="p">)</span>

</div></div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">c_functools</span><span class="p">,</span> <span class="s">&#39;requires the C _functools module&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestPartialC"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialC">[docs]</a><span class="k">class</span> <span class="nc">TestPartialC</span><span class="p">(</span><span class="n">TestPartial</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">c_functools</span><span class="p">:</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">c_functools</span><span class="o">.</span><span class="n">partial</span>

<div class="viewcode-block" id="TestPartialC.test_attributes_unwritable"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialC.test_attributes_unwritable">[docs]</a>    <span class="k">def</span> <span class="nf">test_attributes_unwritable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># attributes should not be writable</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;func&#39;</span><span class="p">,</span> <span class="nb">map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;args&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;keywords&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">hex</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">p</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;partial object allowed __dict__ to be deleted&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartialC.test_repr"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialC.test_repr">[docs]</a>    <span class="k">def</span> <span class="nf">test_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="nb">object</span><span class="p">(),</span> <span class="nb">object</span><span class="p">())</span>
        <span class="n">args_repr</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
        <span class="c">#kwargs = {&#39;a&#39;: object(), &#39;b&#39;: object()}</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">()}</span>
        <span class="n">kwargs_repr</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span> <span class="ow">is</span> <span class="n">c_functools</span><span class="o">.</span><span class="n">partial</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;functools.partial&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="o">.</span><span class="n">__name__</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;{}({!r})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">capture</span><span class="p">),</span>
                         <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;{}({!r}, {})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">capture</span><span class="p">,</span> <span class="n">args_repr</span><span class="p">),</span>
                         <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;{}({!r}, {})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">capture</span><span class="p">,</span> <span class="n">kwargs_repr</span><span class="p">),</span>
                         <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;{}({!r}, {}, {})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">capture</span><span class="p">,</span> <span class="n">args_repr</span><span class="p">,</span> <span class="n">kwargs_repr</span><span class="p">),</span>
                         <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestPartialC.test_pickle"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialC.test_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">test_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">signature</span><span class="p">,</span> <span class="s">&#39;asdf&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">add_something_to__dict__</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">f_copy</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">signature</span><span class="p">(</span><span class="n">f_copy</span><span class="p">))</span>

    <span class="c"># Issue 6083: Reference counting bug</span></div>
<div class="viewcode-block" id="TestPartialC.test_setstate_refcount"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialC.test_setstate_refcount">[docs]</a>    <span class="k">def</span> <span class="nf">test_setstate_refcount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">BadSequence</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">4</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">max</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">{}</span>
                <span class="k">raise</span> <span class="ne">IndexError</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">SystemError</span><span class="p">,</span>
                <span class="s">&quot;new style getargs format but argument is not a tuple&quot;</span><span class="p">,</span>
                <span class="n">f</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">,</span> <span class="n">BadSequence</span><span class="p">())</span>

</div></div>
<div class="viewcode-block" id="TestPartialPy"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialPy">[docs]</a><span class="k">class</span> <span class="nc">TestPartialPy</span><span class="p">(</span><span class="n">TestPartial</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">partial</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">py_functools</span><span class="o">.</span><span class="n">partial</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">c_functools</span><span class="p">:</span>
<div class="viewcode-block" id="PartialSubclass"><a class="viewcode-back" href="../../test.html#test.test_functools.PartialSubclass">[docs]</a>    <span class="k">class</span> <span class="nc">PartialSubclass</span><span class="p">(</span><span class="n">c_functools</span><span class="o">.</span><span class="n">partial</span><span class="p">):</span>
        <span class="k">pass</span>

</div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">c_functools</span><span class="p">,</span> <span class="s">&#39;requires the C _functools module&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestPartialCSubclass"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialCSubclass">[docs]</a><span class="k">class</span> <span class="nc">TestPartialCSubclass</span><span class="p">(</span><span class="n">TestPartialC</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">c_functools</span><span class="p">:</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">PartialSubclass</span>

</div>
<div class="viewcode-block" id="TestPartialMethod"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod">[docs]</a><span class="k">class</span> <span class="nc">TestPartialMethod</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestPartialMethod.A"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.A">[docs]</a>    <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="n">nothing</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">capture</span><span class="p">)</span>
        <span class="n">positional</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">both</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">nested</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">positional</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">over_partial</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">capture</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>

        <span class="n">static</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="nb">staticmethod</span><span class="p">(</span><span class="n">capture</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="nb">classmethod</span><span class="p">(</span><span class="n">capture</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</div>
    <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>

<div class="viewcode-block" id="TestPartialMethod.test_arg_combinations"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_arg_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">test_arg_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nothing</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nothing</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nothing</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nothing</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">positional</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">positional</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">positional</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">positional</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">keywords</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">keywords</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">keywords</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">keywords</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">both</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">both</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">both</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">both</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">both</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_nested"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_nested">[docs]</a>    <span class="k">def</span> <span class="nf">test_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nested</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nested</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nested</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">nested</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">nested</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_over_partial"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_over_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_over_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">over_partial</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">over_partial</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">over_partial</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">over_partial</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">over_partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_bound_method_introspection"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_bound_method_introspection">[docs]</a>    <span class="k">def</span> <span class="nf">test_bound_method_introspection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">both</span><span class="o">.</span><span class="n">__self__</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">nested</span><span class="o">.</span><span class="n">__self__</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">over_partial</span><span class="o">.</span><span class="n">__self__</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">__self__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">__self__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_unbound_method_retrieval"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_unbound_method_retrieval">[docs]</a>    <span class="k">def</span> <span class="nf">test_unbound_method_retrieval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">both</span><span class="p">,</span> <span class="s">&quot;__self__&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="s">&quot;__self__&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">over_partial</span><span class="p">,</span> <span class="s">&quot;__self__&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static</span><span class="p">,</span> <span class="s">&quot;__self__&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">static</span><span class="p">,</span> <span class="s">&quot;__self__&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_descriptors"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_descriptors">[docs]</a>    <span class="k">def</span> <span class="nf">test_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">]:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static</span><span class="p">(),</span> <span class="p">((</span><span class="mi">8</span><span class="p">,),</span> <span class="p">{}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="mi">8</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cls</span><span class="p">(),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cls</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cls</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cls</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_overriding_keywords"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_overriding_keywords">[docs]</a>    <span class="k">def</span> <span class="nf">test_overriding_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">keywords</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,),</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_invalid_args"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_invalid_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_repr"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_repr">[docs]</a>    <span class="k">def</span> <span class="nf">test_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)[</span><span class="s">&#39;both&#39;</span><span class="p">]),</span>
                         <span class="s">&#39;functools.partialmethod({}, 3, b=4)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">capture</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestPartialMethod.test_abstract"><a class="viewcode-back" href="../../test.html#test.test_functools.TestPartialMethod.test_abstract">[docs]</a>    <span class="k">def</span> <span class="nf">test_abstract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Abstract</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>

            <span class="nd">@abc.abstractmethod</span>
            <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
                <span class="k">pass</span>

            <span class="n">add5</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">Abstract</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">__isabstractmethod__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">Abstract</span><span class="o">.</span><span class="n">add5</span><span class="o">.</span><span class="n">__isabstractmethod__</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">static</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">over_partial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">both</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s">&#39;__isabstractmethod__&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="TestUpdateWrapper"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper">[docs]</a><span class="k">class</span> <span class="nc">TestUpdateWrapper</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestUpdateWrapper.check_wrapper"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.check_wrapper">[docs]</a>    <span class="k">def</span> <span class="nf">check_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">,</span>
                      <span class="n">assigned</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">WRAPPER_ASSIGNMENTS</span><span class="p">,</span>
                      <span class="n">updated</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">WRAPPER_UPDATES</span><span class="p">):</span>
        <span class="c"># Check attributes were assigned</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">assigned</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="c"># Check attributes were updated</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
            <span class="n">wrapper_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">wrapped_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wrapped_attr</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;__dict__&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&quot;__wrapped__&quot;</span><span class="p">:</span>
                    <span class="c"># __wrapped__ is overwritten by the update code</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">wrapped_attr</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">wrapper_attr</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="c"># Check __wrapped__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">)</span>

</div>
    <span class="k">def</span> <span class="nf">_default_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="s">&#39;This is a new annotation&#39;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;This is a test&quot;&quot;&quot;</span>
            <span class="k">pass</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;This is also a test&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">__wrapped__</span> <span class="o">=</span> <span class="s">&quot;This is a bald faced lie&quot;</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="s">&#39;This is the prior annotation&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span>

<div class="viewcode-block" id="TestUpdateWrapper.test_default_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.test_default_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">&#39;This is also a test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__annotations__</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="s">&#39;This is a new annotation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">__annotations__</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">optimize</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span>
                     <span class="s">&quot;Docstrings are omitted with -O2 and above&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestUpdateWrapper.test_default_update_doc"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.test_default_update_doc">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_update_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="s">&#39;This is a test&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestUpdateWrapper.test_no_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.test_no_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;This is a test&quot;&quot;&quot;</span>
            <span class="k">pass</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;This is also a test&#39;</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">(),</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">(),</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;wrapper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__annotations__</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="s">&#39;attr&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestUpdateWrapper.test_selective_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.test_selective_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_selective_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;This is a different test&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">dict_attr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">assign</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;attr&#39;</span><span class="p">,)</span>
        <span class="n">update</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dict_attr&#39;</span><span class="p">,)</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;wrapper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">&#39;This is a different test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">dict_attr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestUpdateWrapper.test_missing_attributes"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.test_missing_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_missing_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">assign</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;attr&#39;</span><span class="p">,)</span>
        <span class="n">update</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dict_attr&#39;</span><span class="p">,)</span>
        <span class="c"># Missing attributes on wrapped object are ignored</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;attr&#39;</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span><span class="p">,</span> <span class="p">{})</span>
        <span class="c"># Wrapper must have expected attributes for updating</span>
        <span class="k">del</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
</div>
    <span class="nd">@support.requires_docstrings</span>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">optimize</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span>
                     <span class="s">&quot;Docstrings are omitted with -O2 and above&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestUpdateWrapper.test_builtin_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestUpdateWrapper.test_builtin_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_builtin_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for bug #1576241</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;max(&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__annotations__</span><span class="p">,</span> <span class="p">{})</span>

</div></div>
<div class="viewcode-block" id="TestWraps"><a class="viewcode-back" href="../../test.html#test.test_functools.TestWraps">[docs]</a><span class="k">class</span> <span class="nc">TestWraps</span><span class="p">(</span><span class="n">TestUpdateWrapper</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_default_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;This is a test&quot;&quot;&quot;</span>
            <span class="k">pass</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;This is also a test&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">__wrapped__</span> <span class="o">=</span> <span class="s">&quot;This is still a bald faced lie&quot;</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span>

<div class="viewcode-block" id="TestWraps.test_default_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestWraps.test_default_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">&#39;This is also a test&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">optimize</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span>
                     <span class="s">&quot;Docstrings are omitted with -O2 and above&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestWraps.test_default_update_doc"><a class="viewcode-back" href="../../test.html#test.test_functools.TestWraps.test_default_update_doc">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_update_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="s">&#39;This is a test&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestWraps.test_no_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestWraps.test_no_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;This is a test&quot;&quot;&quot;</span>
            <span class="k">pass</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;This is also a test&#39;</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(),</span> <span class="p">())</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">(),</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;wrapper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="s">&#39;attr&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestWraps.test_selective_update"><a class="viewcode-back" href="../../test.html#test.test_functools.TestWraps.test_selective_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_selective_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;This is a different test&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">dict_attr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">add_dict_attr</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">dict_attr</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="n">assign</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;attr&#39;</span><span class="p">,)</span>
        <span class="n">update</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dict_attr&#39;</span><span class="p">,)</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="nd">@add_dict_attr</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assign</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;wrapper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s">&#39;This is a different test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">dict_attr</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">dict_attr</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestReduce"><a class="viewcode-back" href="../../test.html#test.test_functools.TestReduce">[docs]</a><span class="k">class</span> <span class="nc">TestReduce</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span>

<div class="viewcode-block" id="TestReduce.test_reduce"><a class="viewcode-back" href="../../test.html#test.test_functools.TestReduce.test_reduce">[docs]</a>    <span class="k">def</span> <span class="nf">test_reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Squares</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sofar</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sofar</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IndexError</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sofar</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sofar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sofar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="s">&#39;abc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">]],</span> <span class="p">[]),</span>
            <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">5040</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
            <span class="mi">2432902008176640000</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">Squares</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span> <span class="mi">285</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">Squares</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">285</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">Squares</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">),</span> <span class="s">&quot;1&quot;</span><span class="p">)</span> <span class="c"># func is never called with one item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">),</span> <span class="s">&quot;1&quot;</span><span class="p">)</span> <span class="c"># func is never called with one item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="p">[])</span> <span class="c"># arg 2 must not be empty sequence with no initial value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="nb">object</span><span class="p">())</span>

        <span class="k">class</span> <span class="nc">TestFailingIter</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">TestFailingIter</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">42</span><span class="p">),</span> <span class="mi">42</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">BadSeq</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">BadSeq</span><span class="p">())</span>

    <span class="c"># Test reduce()&#39;s use of iterators.</span></div>
<div class="viewcode-block" id="TestReduce.test_iterator_usage"><a class="viewcode-back" href="../../test.html#test.test_functools.TestReduce.test_iterator_usage">[docs]</a>    <span class="k">def</span> <span class="nf">test_iterator_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">SequenceClass</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">i</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span>

        <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">SequenceClass</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">SequenceClass</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">42</span><span class="p">),</span> <span class="mi">52</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">SequenceClass</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">SequenceClass</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">42</span><span class="p">),</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">SequenceClass</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">SequenceClass</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">42</span><span class="p">),</span> <span class="mi">42</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;one&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

</div></div>
<div class="viewcode-block" id="TestCmpToKey"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey">[docs]</a><span class="k">class</span> <span class="nc">TestCmpToKey</span><span class="p">:</span>

<div class="viewcode-block" id="TestCmpToKey.test_cmp_to_key"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_cmp_to_key">[docs]</a>    <span class="k">def</span> <span class="nf">test_cmp_to_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">cmp1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">cmp1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">cmp2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">cmp2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mf">4.0</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="s">&#39;4&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="s">&#39;35&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="s">&#39;35&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="s">&#39;35&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestCmpToKey.test_cmp_to_key_arguments"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_cmp_to_key_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">test_cmp_to_key_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">cmp1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">mycmp</span><span class="o">=</span><span class="n">cmp1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">key</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)):</span>
            <span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>    <span class="c"># rhs is not a K object</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)):</span>
            <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>    <span class="c"># lhs is not a K object</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">()</span>             <span class="c"># too few args</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">cmp1</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>   <span class="c"># too many args</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">cmp1</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">key</span><span class="p">()</span>                                    <span class="c"># too few args</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">key</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>                          <span class="c"># too many args</span>
</div>
<div class="viewcode-block" id="TestCmpToKey.test_bad_cmp"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_bad_cmp">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_cmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">cmp1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ZeroDivisionError</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">cmp1</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
            <span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">key</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">BadCmp</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ZeroDivisionError</span>
        <span class="k">def</span> <span class="nf">cmp1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">BadCmp</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
            <span class="n">key</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">key</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestCmpToKey.test_obj_field"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_obj_field">[docs]</a>    <span class="k">def</span> <span class="nf">test_obj_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">cmp1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">mycmp</span><span class="o">=</span><span class="n">cmp1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestCmpToKey.test_sort_int"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_sort_int">[docs]</a>    <span class="k">def</span> <span class="nf">test_sort_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">mycmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">mycmp</span><span class="p">)),</span>
                         <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestCmpToKey.test_sort_int_str"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_sort_int_str">[docs]</a>    <span class="k">def</span> <span class="nf">test_sort_int_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">mycmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">mycmp</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestCmpToKey.test_hash"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKey.test_hash">[docs]</a>    <span class="k">def</span> <span class="nf">test_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">mycmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">mycmp</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">key</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Hashable</span><span class="p">)</span>

</div></div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">c_functools</span><span class="p">,</span> <span class="s">&#39;requires the C _functools module&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestCmpToKeyC"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKeyC">[docs]</a><span class="k">class</span> <span class="nc">TestCmpToKeyC</span><span class="p">(</span><span class="n">TestCmpToKey</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">c_functools</span><span class="p">:</span>
        <span class="n">cmp_to_key</span> <span class="o">=</span> <span class="n">c_functools</span><span class="o">.</span><span class="n">cmp_to_key</span>

</div>
<div class="viewcode-block" id="TestCmpToKeyPy"><a class="viewcode-back" href="../../test.html#test.test_functools.TestCmpToKeyPy">[docs]</a><span class="k">class</span> <span class="nc">TestCmpToKeyPy</span><span class="p">(</span><span class="n">TestCmpToKey</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">cmp_to_key</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">py_functools</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestTotalOrdering"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering">[docs]</a><span class="k">class</span> <span class="nc">TestTotalOrdering</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestTotalOrdering.test_total_ordering_lt"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_total_ordering_lt">[docs]</a>    <span class="k">def</span> <span class="nf">test_total_ordering_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestTotalOrdering.test_total_ordering_le"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_total_ordering_le">[docs]</a>    <span class="k">def</span> <span class="nf">test_total_ordering_le</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestTotalOrdering.test_total_ordering_gt"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_total_ordering_gt">[docs]</a>    <span class="k">def</span> <span class="nf">test_total_ordering_gt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestTotalOrdering.test_total_ordering_ge"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_total_ordering_ge">[docs]</a>    <span class="k">def</span> <span class="nf">test_total_ordering_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestTotalOrdering.test_total_ordering_no_overwrite"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_total_ordering_no_overwrite">[docs]</a>    <span class="k">def</span> <span class="nf">test_total_ordering_no_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># new methods should not overwrite existing</span>
        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestTotalOrdering.test_no_operations_defined"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_no_operations_defined">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_operations_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="nd">@functools.total_ordering</span>
            <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TestTotalOrdering.test_type_error_when_not_implemented"><a class="viewcode-back" href="../../test.html#test.test_functools.TestTotalOrdering.test_type_error_when_not_implemented">[docs]</a>    <span class="k">def</span> <span class="nf">test_type_error_when_not_implemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bug 10042; ensure stack overflow does not occur</span>
        <span class="c"># when decorated types return NotImplemented</span>
        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">ImplementsLessThan</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsLessThan</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsLessThan</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">ImplementsGreaterThan</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsGreaterThan</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsGreaterThan</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">ImplementsLessThanEqualTo</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsLessThanEqualTo</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsLessThanEqualTo</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">ImplementsGreaterThanEqualTo</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsGreaterThanEqualTo</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ImplementsGreaterThanEqualTo</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="nd">@functools.total_ordering</span>
        <span class="k">class</span> <span class="nc">ComparatorNotImplemented</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ComparatorNotImplemented</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;LT &lt; 1&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsLessThan</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;LT &lt; LE&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsLessThan</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ImplementsLessThanEqualTo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;LT &lt; GT&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsLessThan</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ImplementsGreaterThan</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;LE &lt;= LT&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsLessThanEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">ImplementsLessThan</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;LE &lt;= GE&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsLessThanEqualTo</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">ImplementsGreaterThanEqualTo</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;GT &gt; GE&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsGreaterThan</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ImplementsGreaterThanEqualTo</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;GT &gt; LT&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsGreaterThan</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ImplementsLessThan</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;GE &gt;= GT&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsGreaterThanEqualTo</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ImplementsGreaterThan</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;GE &gt;= LE&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">ImplementsGreaterThanEqualTo</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ImplementsLessThanEqualTo</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;GE when equal&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ComparatorNotImplemented</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">ComparatorNotImplemented</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="s">&quot;LE when equal&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ComparatorNotImplemented</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">ComparatorNotImplemented</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span>
</div></div>
<div class="viewcode-block" id="TestLRU"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU">[docs]</a><span class="k">class</span> <span class="nc">TestLRU</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestLRU.test_lru"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_lru">[docs]</a>    <span class="k">def</span> <span class="nf">test_lru</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">orig</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)(</span><span class="n">orig</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">maxsize</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">domain</span><span class="p">),</span> <span class="n">choice</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">orig</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">hits</span> <span class="o">&gt;</span> <span class="n">misses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span> <span class="o">+</span> <span class="n">misses</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>   <span class="c"># test clearing</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Test bypassing the cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># test size zero (which means &quot;never-cache&quot;)</span>
        <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="n">nonlocal</span> <span class="n">f_cnt</span>
            <span class="n">f_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">f_cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(),</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f_cnt</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># test size one</span>
        <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="n">nonlocal</span> <span class="n">f_cnt</span>
            <span class="n">f_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f_cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(),</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f_cnt</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># test size two</span>
        <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">nonlocal</span> <span class="n">f_cnt</span>
            <span class="n">f_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">f_cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span>
            <span class="c">#    *  *              *                          *</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f_cnt</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">hits</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">,</span> <span class="n">currsize</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">misses</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currsize</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLRU.test_lru_with_maxsize_none"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_lru_with_maxsize_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_lru_with_maxsize_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">n</span>
            <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">610</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fib</span><span class="o">.</span><span class="n">cache_info</span><span class="p">(),</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">_CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">fib</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fib</span><span class="o">.</span><span class="n">cache_info</span><span class="p">(),</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">_CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestLRU.test_lru_with_exceptions"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_lru_with_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_lru_with_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that user_function exceptions get passed through without</span>
        <span class="c"># creating a hard-to-read chained exception.</span>
        <span class="c"># http://bugs.python.org/issue13177</span>
        <span class="k">for</span> <span class="n">maxsize</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">128</span><span class="p">):</span>
            <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">return</span> <span class="s">&#39;abc&#39;</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__context__</span><span class="p">)</span>
            <span class="c"># Verify that the previous exception did not result in a cached entry</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">):</span>
                <span class="n">func</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLRU.test_lru_with_types"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_lru_with_types">[docs]</a>    <span class="k">def</span> <span class="nf">test_lru_with_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">maxsize</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">128</span><span class="p">):</span>
            <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">typed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">type</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="mf">3.0</span><span class="p">),</span> <span class="mf">9.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)),</span> <span class="nb">type</span><span class="p">(</span><span class="mf">9.0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">type</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">3.0</span><span class="p">),</span> <span class="mf">9.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)),</span> <span class="nb">type</span><span class="p">(</span><span class="mf">9.0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">square</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">square</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">misses</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestLRU.test_lru_with_keyword_args"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_lru_with_keyword_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_lru_with_keyword_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.lru_cache</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">n</span>
            <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">610</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fib</span><span class="o">.</span><span class="n">cache_info</span><span class="p">(),</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">_CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">fib</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fib</span><span class="o">.</span><span class="n">cache_info</span><span class="p">(),</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">_CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestLRU.test_lru_with_keyword_args_maxsize_none"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_lru_with_keyword_args_maxsize_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_lru_with_keyword_args_maxsize_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">n</span>
            <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">610</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fib</span><span class="o">.</span><span class="n">cache_info</span><span class="p">(),</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">_CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">fib</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fib</span><span class="o">.</span><span class="n">cache_info</span><span class="p">(),</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">_CacheInfo</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">currsize</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestLRU.test_need_for_rlock"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_need_for_rlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_need_for_rlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This will deadlock on an LRU cache that uses a regular lock</span>

        <span class="nd">@functools.lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="s">&#39;Used to demonstrate a reentrant lru_cache call within a single thread&#39;</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">class</span> <span class="nc">DoubleEq</span><span class="p">:</span>
            <span class="s">&#39;Demonstrate a reentrant lru_cache call within a single thread&#39;</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">test_func</span><span class="p">(</span><span class="n">DoubleEq</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>

        <span class="n">test_func</span><span class="p">(</span><span class="n">DoubleEq</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>                      <span class="c"># Load the cache</span>
        <span class="n">test_func</span><span class="p">(</span><span class="n">DoubleEq</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>                      <span class="c"># Load the cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_func</span><span class="p">(</span><span class="n">DoubleEq</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>    <span class="c"># Trigger a re-entrant __eq__ call</span>
                         <span class="n">DoubleEq</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>               <span class="c"># Verify the correct return value</span>
</div>
<div class="viewcode-block" id="TestLRU.test_early_detection_of_bad_call"><a class="viewcode-back" href="../../test.html#test.test_functools.TestLRU.test_early_detection_of_bad_call">[docs]</a>    <span class="k">def</span> <span class="nf">test_early_detection_of_bad_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #22184</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="nd">@functools.lru_cache</span>
            <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
                <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="TestSingleDispatch"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch">[docs]</a><span class="k">class</span> <span class="nc">TestSingleDispatch</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestSingleDispatch.test_simple_overloads"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_simple_overloads">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_overloads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="k">def</span> <span class="nf">g_int</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;integer&quot;</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">g_int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&quot;str&quot;</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&quot;integer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_mro"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_mro">[docs]</a>    <span class="k">def</span> <span class="nf">test_mro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">g_A</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;A&quot;</span>
        <span class="k">def</span> <span class="nf">g_B</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;B&quot;</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">g_A</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">g_B</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">A</span><span class="p">()),</span> <span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">B</span><span class="p">()),</span> <span class="s">&quot;B&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">C</span><span class="p">()),</span> <span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">D</span><span class="p">()),</span> <span class="s">&quot;B&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_register_decorator"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_register_decorator">[docs]</a>    <span class="k">def</span> <span class="nf">test_register_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="nd">@g.register</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">g_int</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;int </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="s">&quot;int 12&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">g_int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="nb">object</span><span class="p">),</span> <span class="n">g</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="c"># Note: in the assert above this is not g.</span>
        <span class="c"># @singledispatch returns the wrapper.</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_wrapping_attributes"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_wrapping_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_wrapping_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="s">&quot;Simple test&quot;</span>
            <span class="k">return</span> <span class="s">&quot;Test&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&quot;g&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">optimize</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span> <span class="s">&quot;Simple test&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">decimal</span><span class="p">,</span> <span class="s">&#39;requires _decimal&#39;</span><span class="p">)</span>
    <span class="nd">@support.cpython_only</span>
<div class="viewcode-block" id="TestSingleDispatch.test_c_classes"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_c_classes">[docs]</a>    <span class="k">def</span> <span class="nf">test_c_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="nd">@g.register</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">DecimalException</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">args</span>
        <span class="n">subn</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Subnormal</span><span class="p">(</span><span class="s">&quot;Exponent &lt; Emin&quot;</span><span class="p">)</span>
        <span class="n">rnd</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Rounded</span><span class="p">(</span><span class="s">&quot;Number got rounded&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">subn</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Exponent &lt; Emin&quot;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">rnd</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Number got rounded&quot;</span><span class="p">,))</span>
        <span class="nd">@g.register</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Subnormal</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;Too small to care.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">subn</span><span class="p">),</span> <span class="s">&quot;Too small to care.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">rnd</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Number got rounded&quot;</span><span class="p">,))</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_compose_mro"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_compose_mro">[docs]</a>    <span class="k">def</span> <span class="nf">test_compose_mro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># None of the examples in this test depend on haystack ordering.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">collections</span>
        <span class="n">mro</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">_compose_mro</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">haystack</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mro</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span>
                                 <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">haystack</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mro</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ChainMap</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">ChainMap</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span>
                                 <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span>

        <span class="c"># If there&#39;s a generic function with implementations registered for</span>
        <span class="c"># both Sized and Container, passing a defaultdict to it results in an</span>
        <span class="c"># ambiguous dispatch which will cause a RuntimeError (see</span>
        <span class="c"># test_mro_conflicts).</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">haystack</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mro</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span>
                                 <span class="nb">object</span><span class="p">])</span>

        <span class="c"># MutableSequence below is registered directly on D. In other words, it</span>
        <span class="c"># preceeds MutableMapping which means single dispatch will always</span>
        <span class="c"># choose MutableSequence here.</span>
        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">c</span><span class="o">.</span><span class="n">MutableSequence</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">MutableSequence</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">haystack</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mro</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableSequence</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span>
                                 <span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span>
                                 <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span>
                                 <span class="nb">object</span><span class="p">])</span>

        <span class="c"># Container and Callable are registered on different base classes and</span>
        <span class="c"># a generic function supporting both should always pick the Callable</span>
        <span class="c"># implementation if a C instance is passed.</span>
        <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">haystack</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mro</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">C</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span>
                                 <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_register_abc"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_register_abc">[docs]</a>    <span class="k">def</span> <span class="nf">test_register_abc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">collections</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">:</span> <span class="s">&quot;b&quot;</span><span class="p">}</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="nb">object</span><span class="p">(),</span> <span class="bp">None</span><span class="p">}</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ChainMap</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;chainmap&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>  <span class="c"># irrelevant ABCs registered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">MutableSequence</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">MutableSet</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;mapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>  <span class="c"># not specific enough</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;mutablesequence&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;mutableset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;concrete-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;concrete-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;frozen-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;concrete-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;frozen-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;tuple&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;concrete-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&quot;frozen-set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;tuple&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_c3_abc"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_c3_abc">[docs]</a>    <span class="k">def</span> <span class="nf">test_c3_abc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">collections</span>
        <span class="n">mro</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">_c3_mro</span>
        <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>   <span class="c"># implies Sized</span>
        <span class="nd">@c.Container.register</span>
        <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">pass</span>   <span class="c"># unrelated</span>
        <span class="k">class</span> <span class="nc">X</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>   <span class="c"># implies Callable</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">abcs</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mro</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">abcs</span><span class="o">=</span><span class="n">abcs</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
        <span class="c"># unrelated ABCs don&#39;t appear in the resulting MRO</span>
        <span class="n">many_abcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mro</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">abcs</span><span class="o">=</span><span class="n">many_abcs</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_mro_conflicts"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_mro_conflicts">[docs]</a>    <span class="k">def</span> <span class="nf">test_mro_conflicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">collections</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="k">class</span> <span class="nc">O</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">O</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;iterable&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;container&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>   <span class="c"># because it&#39;s explicitly in __mro__</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>   <span class="c"># see above: Sized is in __mro__</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>     <span class="c"># because c.Set is a subclass of</span>
                                          <span class="c"># c.Sized and c.Container</span>
        <span class="k">class</span> <span class="nc">P</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s">&quot;iterable&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">re_one</span><span class="p">:</span>
            <span class="n">g</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">re_one</span><span class="o">.</span><span class="n">exception</span><span class="p">),</span>
            <span class="p">((</span><span class="s">&quot;Ambiguous dispatch: &lt;class &#39;collections.abc.Container&#39;&gt; &quot;</span>
              <span class="s">&quot;or &lt;class &#39;collections.abc.Iterable&#39;&gt;&quot;</span><span class="p">),</span>
             <span class="p">(</span><span class="s">&quot;Ambiguous dispatch: &lt;class &#39;collections.abc.Iterable&#39;&gt; &quot;</span>
              <span class="s">&quot;or &lt;class &#39;collections.abc.Container&#39;&gt;&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">class</span> <span class="nc">Q</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Iterable</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>   <span class="c"># because it&#39;s explicitly in __mro__</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Set</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="s">&quot;set&quot;</span><span class="p">)</span>     <span class="c"># because c.Set is a subclass of</span>
                                          <span class="c"># c.Sized and c.Iterable</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="nd">@h.register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;sized&quot;</span>
        <span class="nd">@h.register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;container&quot;</span>
        <span class="c"># Even though Sized and Container are explicit bases of MutableMapping,</span>
        <span class="c"># this ABC is implicitly registered on defaultdict which makes all of</span>
        <span class="c"># MutableMapping&#39;s bases implicit as well from defaultdict&#39;s</span>
        <span class="c"># perspective.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">re_two</span><span class="p">:</span>
            <span class="n">h</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">re_two</span><span class="o">.</span><span class="n">exception</span><span class="p">),</span>
            <span class="p">((</span><span class="s">&quot;Ambiguous dispatch: &lt;class &#39;collections.abc.Container&#39;&gt; &quot;</span>
              <span class="s">&quot;or &lt;class &#39;collections.abc.Sized&#39;&gt;&quot;</span><span class="p">),</span>
             <span class="p">(</span><span class="s">&quot;Ambiguous dispatch: &lt;class &#39;collections.abc.Sized&#39;&gt; &quot;</span>
              <span class="s">&quot;or &lt;class &#39;collections.abc.Container&#39;&gt;&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">class</span> <span class="nc">R</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">c</span><span class="o">.</span><span class="n">MutableSequence</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">i</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="nd">@i.register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;mapping&quot;</span>
        <span class="nd">@i.register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">MutableSequence</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;sequence&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">R</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s">&quot;sequence&quot;</span><span class="p">)</span>
        <span class="k">class</span> <span class="nc">S</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>   <span class="c"># because it&#39;s explicitly in the MRO</span>
        <span class="k">class</span> <span class="nc">U</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>   <span class="c"># implicit Sized subclass inferred</span>
                                          <span class="c"># from the existence of __len__()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
        <span class="c"># There is no preference for registered versus inferred ABCs.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">re_three</span><span class="p">:</span>
            <span class="n">h</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">re_three</span><span class="o">.</span><span class="n">exception</span><span class="p">),</span>
            <span class="p">((</span><span class="s">&quot;Ambiguous dispatch: &lt;class &#39;collections.abc.Container&#39;&gt; &quot;</span>
              <span class="s">&quot;or &lt;class &#39;collections.abc.Sized&#39;&gt;&quot;</span><span class="p">),</span>
             <span class="p">(</span><span class="s">&quot;Ambiguous dispatch: &lt;class &#39;collections.abc.Sized&#39;&gt; &quot;</span>
              <span class="s">&quot;or &lt;class &#39;collections.abc.Container&#39;&gt;&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">class</span> <span class="nc">V</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">j</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="nd">@j.register</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;s&quot;</span>
        <span class="nd">@j.register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;container&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">V</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="s">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Container</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="s">&quot;container&quot;</span><span class="p">)</span>   <span class="c"># because it ends up right after</span>
                                              <span class="c"># Sized in the MRO</span>
</div>
<div class="viewcode-block" id="TestSingleDispatch.test_cache_invalidation"><a class="viewcode-back" href="../../test.html#test.test_functools.TestSingleDispatch.test_cache_invalidation">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_invalidation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span>
        <span class="k">class</span> <span class="nc">TracingDict</span><span class="p">(</span><span class="n">UserDict</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">TracingDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_ops</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_ops</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">_orig_wkd</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">WeakKeyDictionary</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">TracingDict</span><span class="p">()</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">WeakKeyDictionary</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">td</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">collections</span>
        <span class="nd">@functools.singledispatch</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;base&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">g</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                         <span class="n">functools</span><span class="o">.</span><span class="n">_find_impl</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">registry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span>
                         <span class="n">functools</span><span class="o">.</span><span class="n">_find_impl</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">registry</span><span class="p">))</span>
        <span class="k">class</span> <span class="nc">X</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>   <span class="c"># Will not invalidate the cache,</span>
                                       <span class="c"># not using ABCs yet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;base&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Sized</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;sized&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span>
                                      <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">set_ops</span><span class="p">,</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
        <span class="n">c</span><span class="o">.</span><span class="n">MutableSet</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>       <span class="c"># Will invalidate the cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>   <span class="c"># Stale cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;mutablemapping&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;dict&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">_clear_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">WeakKeyDictionary</span> <span class="o">=</span> <span class="n">_orig_wkd</span>

</div></div>
<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_functools.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">test_classes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">TestPartialC</span><span class="p">,</span>
        <span class="n">TestPartialPy</span><span class="p">,</span>
        <span class="n">TestPartialCSubclass</span><span class="p">,</span>
        <span class="n">TestPartialMethod</span><span class="p">,</span>
        <span class="n">TestUpdateWrapper</span><span class="p">,</span>
        <span class="n">TestTotalOrdering</span><span class="p">,</span>
        <span class="n">TestCmpToKeyC</span><span class="p">,</span>
        <span class="n">TestCmpToKeyPy</span><span class="p">,</span>
        <span class="n">TestWraps</span><span class="p">,</span>
        <span class="n">TestReduce</span><span class="p">,</span>
        <span class="n">TestLRU</span><span class="p">,</span>
        <span class="n">TestSingleDispatch</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="o">*</span><span class="n">test_classes</span><span class="p">)</span>

    <span class="c"># verify reference counting</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&quot;gettotalrefcount&quot;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">gc</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="o">*</span><span class="n">test_classes</span><span class="p">)</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">gettotalrefcount</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_main</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>