

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_urllib2 &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_urllib2</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_urllib2</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">test_urllib</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="c"># The proxy bypass method imported below has logic specific to the OSX</span>
<span class="c"># proxy config data structure but is testable on all platforms.</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">OpenerDirector</span><span class="p">,</span> <span class="n">_parse_proxy</span><span class="p">,</span> <span class="n">_proxy_bypass_macosx_sysconf</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>
<span class="kn">import</span> <span class="nn">http.client</span>

<span class="c"># XXX</span>
<span class="c"># Request</span>
<span class="c"># CacheFTPHandler (hard to write)</span>
<span class="c"># parse_keqv_list, parse_http_list, HTTPDigestAuthHandler</span>

<div class="viewcode-block" id="TrivialTests"><a class="viewcode-back" href="../../test.html#test.test_urllib2.TrivialTests">[docs]</a><span class="k">class</span> <span class="nc">TrivialTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TrivialTests.test___all__"><a class="viewcode-back" href="../../test.html#test.test_urllib2.TrivialTests.test___all__">[docs]</a>    <span class="k">def</span> <span class="nf">test___all__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify which names are exposed</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="s">&#39;request&#39;</span><span class="p">,</span> <span class="s">&#39;response&#39;</span><span class="p">,</span> <span class="s">&#39;parse&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="s">&#39;robotparser&#39;</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">exec</span><span class="p">(</span><span class="s">&#39;from urllib.</span><span class="si">%s</span><span class="s"> import *&#39;</span> <span class="o">%</span> <span class="n">module</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;__builtins__&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s">&#39;request&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;nt&#39;</span><span class="p">:</span>
                <span class="n">u</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;url2pathname&#39;</span><span class="p">),</span> <span class="n">context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;pathname2url&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="s">&#39;nturl2path&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="s">&#39;nturl2path&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="s">&#39;urllib.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">module</span><span class="p">,</span>
                    <span class="s">&quot;</span><span class="si">%r</span><span class="s"> is exposed in &#39;urllib.</span><span class="si">%s</span><span class="s">&#39; but defined in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">__module__</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TrivialTests.test_trivial"><a class="viewcode-back" href="../../test.html#test.test_urllib2.TrivialTests.test_trivial">[docs]</a>    <span class="k">def</span> <span class="nf">test_trivial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># A couple trivial tests</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">,</span> <span class="s">&#39;bogus url&#39;</span><span class="p">)</span>

        <span class="c"># XXX Name hacking to get this to work on Windows.</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;nt&#39;</span><span class="p">:</span>
            <span class="n">file_url</span> <span class="o">=</span> <span class="s">&quot;file:///</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">fname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_url</span> <span class="o">=</span> <span class="s">&quot;file://</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">fname</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TrivialTests.test_parse_http_list"><a class="viewcode-back" href="../../test.html#test.test_urllib2.TrivialTests.test_parse_http_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_http_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;a,b,c&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&#39;path&quot;o,l&quot;og&quot;i&quot;cal, example&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;path&quot;o,l&quot;og&quot;i&quot;cal&#39;</span><span class="p">,</span> <span class="s">&#39;example&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&#39;a, b, &quot;c&quot;, &quot;d&quot;, &quot;e,f&quot;, g, h&#39;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;c&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;d&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;e,f&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;h&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&#39;a=&quot;b</span><span class="se">\\</span><span class="s">&quot;c&quot;, d=&quot;e</span><span class="se">\\</span><span class="s">,f&quot;, g=&quot;h</span><span class="se">\\\\</span><span class="s">i&quot;&#39;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&#39;a=&quot;b&quot;c&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;d=&quot;e,f&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;g=&quot;h</span><span class="se">\\</span><span class="s">i&quot;&#39;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">string</span><span class="p">,</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">parse_http_list</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="nb">list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TrivialTests.test_URLError_reasonstr"><a class="viewcode-back" href="../../test.html#test.test_urllib2.TrivialTests.test_URLError_reasonstr">[docs]</a>    <span class="k">def</span> <span class="nf">test_URLError_reasonstr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">(</span><span class="s">&#39;reason&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="RequestHdrsTests"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestHdrsTests">[docs]</a><span class="k">class</span> <span class="nc">RequestHdrsTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="RequestHdrsTests.test_request_headers_dict"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestHdrsTests.test_request_headers_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_request_headers_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Request.headers dictionary is not a documented interface.  It</span>
<span class="sd">        should stay that way, because the complete set of headers are only</span>
<span class="sd">        accessible through the .get_header(), .has_header(), .header_items()</span>
<span class="sd">        interface.  However, .headers pre-dates those methods, and so real code</span>
<span class="sd">        will be using the dictionary.</span>

<span class="sd">        The introduction in 2.4 of those methods was a mistake for the same</span>
<span class="sd">        reason: code that previously saw all (urllib2 user)-provided headers in</span>
<span class="sd">        .headers now sees only a subset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://example.com&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                 <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">:</span> <span class="s">&quot;blah&quot;</span><span class="p">}</span>
                                 <span class="p">)</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">],</span> <span class="s">&quot;blah&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                 <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;spam-EggS&quot;</span><span class="p">:</span> <span class="s">&quot;blah&quot;</span><span class="p">}</span>
                                 <span class="p">)</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">],</span> <span class="s">&quot;blah&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestHdrsTests.test_request_headers_methods"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestHdrsTests.test_request_headers_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_request_headers_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note the case normalization of header names here, to</span>
<span class="sd">        .capitalize()-case.  This should be preserved for</span>
<span class="sd">        backwards-compatibility.  (In the HTTP case, normalization to</span>
<span class="sd">        .title()-case is done by urllib2 before sending headers to</span>
<span class="sd">        http.client).</span>

<span class="sd">        Note that e.g. r.has_header(&quot;spam-EggS&quot;) is currently False, and</span>
<span class="sd">        r.get_header(&quot;spam-EggS&quot;) returns None, but that could be changed in</span>
<span class="sd">        future.</span>

<span class="sd">        Method r.remove_header should remove items both from r.headers and</span>
<span class="sd">        r.unredirected_hdrs dictionaries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://example.com&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">:</span> <span class="s">&quot;blah&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">header_items</span><span class="p">(),</span> <span class="p">[(</span><span class="s">&#39;Spam-eggs&#39;</span><span class="p">,</span> <span class="s">&#39;blah&#39;</span><span class="p">)])</span>

        <span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&quot;Foo-Bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">header_items</span><span class="p">()),</span>
                         <span class="p">[(</span><span class="s">&#39;Foo-bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Spam-eggs&#39;</span><span class="p">,</span> <span class="s">&#39;blah&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Not-there&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Not-there&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Not-there&quot;</span><span class="p">,</span> <span class="s">&quot;default&quot;</span><span class="p">),</span> <span class="s">&quot;default&quot;</span><span class="p">)</span>

        <span class="n">req</span><span class="o">.</span><span class="n">remove_header</span><span class="p">(</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Spam-eggs&quot;</span><span class="p">))</span>

        <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Unredirected-spam&quot;</span><span class="p">,</span> <span class="s">&quot;Eggs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Unredirected-spam&quot;</span><span class="p">))</span>

        <span class="n">req</span><span class="o">.</span><span class="n">remove_header</span><span class="p">(</span><span class="s">&quot;Unredirected-spam&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Unredirected-spam&quot;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="RequestHdrsTests.test_password_manager"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestHdrsTests.test_password_manager">[docs]</a>    <span class="k">def</span> <span class="nf">test_password_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mgr</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPPasswordMgr</span><span class="p">()</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">add_password</span>
        <span class="n">find_user_pass</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">find_user_password</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="s">&quot;joe&quot;</span><span class="p">,</span> <span class="s">&quot;password&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/ni&quot;</span><span class="p">,</span> <span class="s">&quot;ni&quot;</span><span class="p">,</span> <span class="s">&quot;ni&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/foo&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;ni&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/bar&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;nini&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="s">&quot;blah&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="s">&quot;spam&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://c.example.com:3128&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;d.example.com&quot;</span><span class="p">,</span> <span class="s">&quot;4&quot;</span><span class="p">,</span> <span class="s">&quot;d&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;e.example.com:3128&quot;</span><span class="p">,</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;e&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">))</span>

        <span class="c">#self.assertEqual(find_user_pass(&quot;Some Realm&quot;, &quot;http://example.com/ni&quot;),</span>
        <span class="c">#                (&#39;ni&#39;, &#39;ni&#39;))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/spam&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/spam/spam&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/foo&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;ni&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/bar&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;nini&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;spam&#39;</span><span class="p">))</span>

        <span class="c"># No special relationship between a.example.com and example.com:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;http://a.example.com/&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="c"># Ports:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;c.example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;c.example.com:3128&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;http://c.example.com:3128&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;d.example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;Some Realm&quot;</span><span class="p">,</span> <span class="s">&quot;e.example.com:3128&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;5&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="RequestHdrsTests.test_password_manager_default_port"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestHdrsTests.test_password_manager_default_port">[docs]</a>    <span class="k">def</span> <span class="nf">test_password_manager_default_port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The point to note here is that we can&#39;t guess the default port if</span>
<span class="sd">        there&#39;s no scheme.  This applies to both add_password and</span>
<span class="sd">        find_user_password.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mgr</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPPasswordMgr</span><span class="p">()</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">add_password</span>
        <span class="n">find_user_pass</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">find_user_password</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;http://g.example.com:80&quot;</span><span class="p">,</span> <span class="s">&quot;10&quot;</span><span class="p">,</span> <span class="s">&quot;j&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">,</span> <span class="s">&quot;http://h.example.com&quot;</span><span class="p">,</span> <span class="s">&quot;11&quot;</span><span class="p">,</span> <span class="s">&quot;k&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="s">&quot;i.example.com:80&quot;</span><span class="p">,</span> <span class="s">&quot;12&quot;</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">)</span>
        <span class="n">add</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;j.example.com&quot;</span><span class="p">,</span> <span class="s">&quot;13&quot;</span><span class="p">,</span> <span class="s">&quot;m&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;g.example.com:100&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;g.example.com:80&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="s">&#39;j&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;g.example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;http://g.example.com:100&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;http://g.example.com:80&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="s">&#39;j&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;http://g.example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="s">&#39;j&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">,</span> <span class="s">&quot;h.example.com&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;11&#39;</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">,</span> <span class="s">&quot;h.example.com:80&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;11&#39;</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">,</span> <span class="s">&quot;http://h.example.com:80&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;11&#39;</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="s">&quot;i.example.com&quot;</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="s">&quot;i.example.com:80&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;12&#39;</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="s">&quot;http://i.example.com:80&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;12&#39;</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;j.example.com&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;13&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;j.example.com:80&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;http://j.example.com&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;13&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">find_user_pass</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="s">&quot;http://j.example.com:80&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="MockOpener"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockOpener">[docs]</a><span class="k">class</span> <span class="nc">MockOpener</span><span class="p">:</span>
    <span class="n">addheaders</span> <span class="o">=</span> <span class="p">[]</span>
<div class="viewcode-block" id="MockOpener.open"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockOpener.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">req</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">timeout</span></div>
<div class="viewcode-block" id="MockOpener.error"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockOpener.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proto</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">proto</span><span class="p">,</span> <span class="n">args</span>
</div></div>
<div class="viewcode-block" id="MockFile"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockFile">[docs]</a><span class="k">class</span> <span class="nc">MockFile</span><span class="p">:</span>
<div class="viewcode-block" id="MockFile.read"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockFile.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="MockFile.readline"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockFile.readline">[docs]</a>    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="MockFile.close"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockFile.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
</div></div>
<div class="viewcode-block" id="MockHeaders"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHeaders">[docs]</a><span class="k">class</span> <span class="nc">MockHeaders</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<div class="viewcode-block" id="MockHeaders.getheaders"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHeaders.getheaders">[docs]</a>    <span class="k">def</span> <span class="nf">getheaders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</div></div>
<div class="viewcode-block" id="MockResponse"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockResponse">[docs]</a><span class="k">class</span> <span class="nc">MockResponse</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">url</span>
<div class="viewcode-block" id="MockResponse.info"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockResponse.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span></div>
<div class="viewcode-block" id="MockResponse.geturl"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockResponse.geturl">[docs]</a>    <span class="k">def</span> <span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
</div></div>
<div class="viewcode-block" id="MockCookieJar"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockCookieJar">[docs]</a><span class="k">class</span> <span class="nc">MockCookieJar</span><span class="p">:</span>
<div class="viewcode-block" id="MockCookieJar.add_cookie_header"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockCookieJar.add_cookie_header">[docs]</a>    <span class="k">def</span> <span class="nf">add_cookie_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ach_req</span> <span class="o">=</span> <span class="n">request</span></div>
<div class="viewcode-block" id="MockCookieJar.extract_cookies"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockCookieJar.extract_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">extract_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ec_req</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ec_r</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span>
</div></div>
<div class="viewcode-block" id="FakeMethod"><a class="viewcode-back" href="../../test.html#test.test_urllib2.FakeMethod">[docs]</a><span class="k">class</span> <span class="nc">FakeMethod</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">handle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meth_name</span> <span class="o">=</span> <span class="n">meth_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meth_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MockHTTPResponse"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPResponse">[docs]</a><span class="k">class</span> <span class="nc">MockHTTPResponse</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">reason</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="mi">200</span>

<div class="viewcode-block" id="MockHTTPResponse.read"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPResponse.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="MockHTTPResponse.info"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPResponse.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="MockHTTPResponse.geturl"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPResponse.geturl">[docs]</a>    <span class="k">def</span> <span class="nf">geturl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>

</div></div>
<div class="viewcode-block" id="MockHTTPClass"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPClass">[docs]</a><span class="k">class</span> <span class="nc">MockHTTPClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req_headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_endheaders</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tunnel_headers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="MockHTTPClass.set_debuglevel"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPClass.set_debuglevel">[docs]</a>    <span class="k">def</span> <span class="nf">set_debuglevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
</div>
<div class="viewcode-block" id="MockHTTPClass.set_tunnel"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPClass.set_tunnel">[docs]</a>    <span class="k">def</span> <span class="nf">set_tunnel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tunnel_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tunnel_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tunnel_headers</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tunnel_headers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="MockHTTPClass.request"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPClass.request">[docs]</a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">req_headers</span> <span class="o">+=</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req_headers</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">body</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_endheaders</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">()</span></div>
<div class="viewcode-block" id="MockHTTPClass.getresponse"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPClass.getresponse">[docs]</a>    <span class="k">def</span> <span class="nf">getresponse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MockHTTPResponse</span><span class="p">(</span><span class="n">MockFile</span><span class="p">(),</span> <span class="p">{},</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MockHTTPClass.close"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPClass.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div></div>
<div class="viewcode-block" id="MockHandler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHandler">[docs]</a><span class="k">class</span> <span class="nc">MockHandler</span><span class="p">:</span>
    <span class="c"># useful for testing handler machinery</span>
    <span class="c"># see add_ordered_mock_handlers() docstring</span>
    <span class="n">handler_order</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_define_methods</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_define_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">spec</span><span class="p">,</span> <span class="bp">None</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="n">FakeMethod</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meth</span><span class="p">)</span>
<div class="viewcode-block" id="MockHandler.handle"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHandler.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;return self&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;return response&quot;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;return request&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://blah/&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;raise&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">(</span><span class="s">&quot;blah&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">False</span></div>
<div class="viewcode-block" id="MockHandler.close"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHandler.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="MockHandler.add_parent"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHandler.add_parent">[docs]</a>    <span class="k">def</span> <span class="nf">add_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">calls</span> <span class="o">=</span> <span class="p">[]</span></div>
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;handler_order&quot;</span><span class="p">):</span>
            <span class="c"># No handler_order, leave in original order.  Yuck.</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler_order</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">handler_order</span>
</div>
<div class="viewcode-block" id="add_ordered_mock_handlers"><a class="viewcode-back" href="../../test.html#test.test_urllib2.add_ordered_mock_handlers">[docs]</a><span class="k">def</span> <span class="nf">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">opener</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create MockHandlers and add them to an OpenerDirector.</span>

<span class="sd">    meth_spec: list of lists of tuples and strings defining methods to define</span>
<span class="sd">    on handlers.  eg:</span>

<span class="sd">    [[&quot;http_error&quot;, &quot;ftp_open&quot;], [&quot;http_open&quot;]]</span>

<span class="sd">    defines methods .http_error() and .ftp_open() on one handler, and</span>
<span class="sd">    .http_open() on another.  These methods just record their arguments and</span>
<span class="sd">    return None.  Using a tuple instead of a string causes the method to</span>
<span class="sd">    perform some action (see MockHandler.handle()), eg:</span>

<span class="sd">    [[&quot;http_error&quot;], [(&quot;http_open&quot;, &quot;return request&quot;)]]</span>

<span class="sd">    defines .http_error() on one handler (which simply returns None), and</span>
<span class="sd">    .http_open() on another handler, which returns a Request object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">meths</span> <span class="ow">in</span> <span class="n">meth_spec</span><span class="p">:</span>
        <span class="k">class</span> <span class="nc">MockHandlerSubclass</span><span class="p">(</span><span class="n">MockHandler</span><span class="p">):</span> <span class="k">pass</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">MockHandlerSubclass</span><span class="p">(</span><span class="n">meths</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">handler_order</span> <span class="o">+=</span> <span class="n">count</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_parent</span><span class="p">(</span><span class="n">opener</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handlers</span>
</div>
<div class="viewcode-block" id="build_test_opener"><a class="viewcode-back" href="../../test.html#test.test_urllib2.build_test_opener">[docs]</a><span class="k">def</span> <span class="nf">build_test_opener</span><span class="p">(</span><span class="o">*</span><span class="n">handler_instances</span><span class="p">):</span>
    <span class="n">opener</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handler_instances</span><span class="p">:</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">opener</span>
</div>
<div class="viewcode-block" id="MockHTTPHandler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPHandler">[docs]</a><span class="k">class</span> <span class="nc">MockHTTPHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="c"># useful for testing redirections and auth</span>
    <span class="c"># sends supplied headers and code as first response</span>
    <span class="c"># sends 200 OK as second response</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<div class="viewcode-block" id="MockHTTPHandler.reset"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPHandler.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span></div>
<div class="viewcode-block" id="MockHTTPHandler.http_open"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPHandler.http_open">[docs]</a>    <span class="k">def</span> <span class="nf">http_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">email</span><span class="o">,</span> <span class="nn">http.client</span><span class="o">,</span> <span class="nn">copy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">req</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">MockFile</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">req</span> <span class="o">=</span> <span class="n">req</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())</span>
</div></div>
<div class="viewcode-block" id="MockHTTPSHandler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPSHandler">[docs]</a><span class="k">class</span> <span class="nc">MockHTTPSHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="p">):</span>
    <span class="c"># Useful for testing the Proxy-Authorization request by verifying the</span>
    <span class="c"># properties of httpcon</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">httpconn</span> <span class="o">=</span> <span class="n">MockHTTPClass</span><span class="p">()</span>

<div class="viewcode-block" id="MockHTTPSHandler.https_open"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockHTTPSHandler.https_open">[docs]</a>    <span class="k">def</span> <span class="nf">https_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">httpconn</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MockPasswordManager"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockPasswordManager">[docs]</a><span class="k">class</span> <span class="nc">MockPasswordManager</span><span class="p">:</span>
<div class="viewcode-block" id="MockPasswordManager.add_password"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockPasswordManager.add_password">[docs]</a>    <span class="k">def</span> <span class="nf">add_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">realm</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">realm</span> <span class="o">=</span> <span class="n">realm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span></div>
<div class="viewcode-block" id="MockPasswordManager.find_user_password"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MockPasswordManager.find_user_password">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">realm</span><span class="p">,</span> <span class="n">authuri</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_realm</span> <span class="o">=</span> <span class="n">realm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_url</span> <span class="o">=</span> <span class="n">authuri</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span>

</div></div>
<div class="viewcode-block" id="OpenerDirectorTests"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests">[docs]</a><span class="k">class</span> <span class="nc">OpenerDirectorTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="OpenerDirectorTests.test_add_non_handler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_add_non_handler">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_non_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">NonHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span>
                          <span class="n">OpenerDirector</span><span class="p">()</span><span class="o">.</span><span class="n">add_handler</span><span class="p">,</span> <span class="n">NonHandler</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="OpenerDirectorTests.test_badly_named_methods"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_badly_named_methods">[docs]</a>    <span class="k">def</span> <span class="nf">test_badly_named_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># test work-around for three methods that accidentally follow the</span>
        <span class="c"># naming conventions for handler methods</span>
        <span class="c"># (*_open() / *_request() / *_response())</span>

        <span class="c"># These used to call the accidentally-named methods, causing a</span>
        <span class="c"># TypeError in real code; here, returning self from these mock</span>
        <span class="c"># methods would either cause no exception, or AttributeError.</span>

        <span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">URLError</span>

        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s">&quot;do_open&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;proxy_open&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s">&quot;redirect_request&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">UnknownHandler</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="s">&quot;do&quot;</span><span class="p">,</span> <span class="s">&quot;proxy&quot;</span><span class="p">,</span> <span class="s">&quot;redirect&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">URLError</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">scheme</span><span class="o">+</span><span class="s">&quot;://example.com/&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OpenerDirectorTests.test_handled"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_handled">[docs]</a>    <span class="k">def</span> <span class="nf">test_handled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># handler returning non-None means no more handlers will be called</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;ftp_open&quot;</span><span class="p">,</span> <span class="s">&quot;http_error_302&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&quot;ftp_open&quot;</span><span class="p">],</span>
            <span class="p">[(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="c"># Second .http_open() gets called, third doesn&#39;t, since second returned</span>
        <span class="c"># non-None.  Handlers without .http_open() never get any methods called</span>
        <span class="c"># on them.</span>
        <span class="c"># In fact, second mock handler defining .http_open() returns self</span>
        <span class="c"># (instead of response), which becomes the OpenerDirector&#39;s return</span>
        <span class="c"># value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">handlers</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="p">[(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;http_open&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&quot;http_open&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">got</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">calls</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">):</span>
            <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span> <span class="o">=</span> <span class="n">got</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="n">req</span><span class="p">,))</span>
</div>
<div class="viewcode-block" id="OpenerDirectorTests.test_handler_order"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_handler_order">[docs]</a>    <span class="k">def</span> <span class="nf">test_handler_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">meths</span><span class="p">,</span> <span class="n">handler_order</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">([(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">)],</span> <span class="mi">500</span><span class="p">),</span>
            <span class="p">([</span><span class="s">&quot;http_open&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">]:</span>
            <span class="k">class</span> <span class="nc">MockHandlerSubclass</span><span class="p">(</span><span class="n">MockHandler</span><span class="p">):</span> <span class="k">pass</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">MockHandlerSubclass</span><span class="p">(</span><span class="n">meths</span><span class="p">)</span>
            <span class="n">h</span><span class="o">.</span><span class="n">handler_order</span> <span class="o">=</span> <span class="n">handler_order</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
        <span class="c"># handlers called in reverse order, thanks to their sort order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">handlers</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="OpenerDirectorTests.test_raise"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_raise">[docs]</a>    <span class="k">def</span> <span class="nf">test_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># raising URLError stops processing of request</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;raise&quot;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;return self&quot;</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">,</span> <span class="p">[(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">req</span><span class="p">,),</span> <span class="p">{})])</span>
</div>
<div class="viewcode-block" id="OpenerDirectorTests.test_http_error"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_http_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_http_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># XXX http_error_default</span>
        <span class="c"># http errors are a special case</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;error 302&quot;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s">&quot;http_error_400&quot;</span><span class="p">,</span> <span class="s">&quot;raise&quot;</span><span class="p">),</span> <span class="s">&quot;http_open&quot;</span><span class="p">],</span>
            <span class="p">[(</span><span class="s">&quot;http_error_302&quot;</span><span class="p">,</span> <span class="s">&quot;return response&quot;</span><span class="p">),</span> <span class="s">&quot;http_error_303&quot;</span><span class="p">,</span>
             <span class="s">&quot;http_error&quot;</span><span class="p">],</span>
            <span class="p">[(</span><span class="s">&quot;http_error_302&quot;</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">Unknown</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="p">[(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">req</span><span class="p">,)),</span>
                 <span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&quot;http_error_302&quot;</span><span class="p">,</span>
                  <span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">Unknown</span><span class="p">(),</span> <span class="mi">302</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">{}))]</span>
        <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">got</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">calls</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">):</span>
            <span class="n">handler</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">expected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">handler</span><span class="p">,</span> <span class="n">method_name</span><span class="p">),</span> <span class="n">got</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">got</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="OpenerDirectorTests.test_processors"><a class="viewcode-back" href="../../test.html#test.test_urllib2.OpenerDirectorTests.test_processors">[docs]</a>    <span class="k">def</span> <span class="nf">test_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># *_request / *_response methods get called appropriately</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s">&quot;http_request&quot;</span><span class="p">,</span> <span class="s">&quot;return request&quot;</span><span class="p">),</span>
             <span class="p">(</span><span class="s">&quot;http_response&quot;</span><span class="p">,</span> <span class="s">&quot;return response&quot;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s">&quot;http_request&quot;</span><span class="p">,</span> <span class="s">&quot;return request&quot;</span><span class="p">),</span>
             <span class="p">(</span><span class="s">&quot;http_response&quot;</span><span class="p">,</span> <span class="s">&quot;return response&quot;</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="c"># processor methods are called on *all* handlers that define them,</span>
        <span class="c"># not just the first handler that handles the request</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;http_request&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;http_request&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;http_response&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;http_response&quot;</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c"># *_request</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">calls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Request</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># *_response</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">calls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Request</span><span class="p">)</span>
                <span class="c"># response from opener.open is None, because there&#39;s no</span>
                <span class="c"># handler that defines http_open to handle it</span>
                <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MockResponse</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="sanepathname2url"><a class="viewcode-back" href="../../test.html#test.test_urllib2.sanepathname2url">[docs]</a><span class="k">def</span> <span class="nf">sanepathname2url</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">unittest</span><span class="o">.</span><span class="n">SkipTest</span><span class="p">(</span><span class="s">&quot;path is not encodable to utf8&quot;</span><span class="p">)</span>
    <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">pathname2url</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;nt&quot;</span> <span class="ow">and</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;///&quot;</span><span class="p">):</span>
        <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urlpath</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c"># XXX don&#39;t ask me about the mac...</span>
    <span class="k">return</span> <span class="n">urlpath</span>
</div>
<div class="viewcode-block" id="HandlerTests"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests">[docs]</a><span class="k">class</span> <span class="nc">HandlerTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="HandlerTests.test_ftp"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_ftp">[docs]</a>    <span class="k">def</span> <span class="nf">test_ftp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MockFTPWrapper</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">def</span> <span class="nf">retrfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">filetype</span>
                <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

        <span class="k">class</span> <span class="nc">NullFTPHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FTPHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">def</span> <span class="nf">connect_ftp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passwd</span> <span class="o">=</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirs</span> <span class="o">=</span> <span class="n">dirs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ftpwrapper</span> <span class="o">=</span> <span class="n">MockFTPWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftpwrapper</span>

        <span class="kn">import</span> <span class="nn">ftplib</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;rheum rhaponicum&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">NullFTPHandler</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mimetype</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;ftp://localhost/foo/bar/baz.html&quot;</span><span class="p">,</span>
             <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_PORT</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;I&quot;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="s">&quot;baz.html&quot;</span><span class="p">,</span> <span class="s">&quot;text/html&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ftp://parrot@localhost/foo/bar/baz.html&quot;</span><span class="p">,</span>
             <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_PORT</span><span class="p">,</span> <span class="s">&quot;parrot&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;I&quot;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="s">&quot;baz.html&quot;</span><span class="p">,</span> <span class="s">&quot;text/html&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ftp://%25parrot@localhost/foo/bar/baz.html&quot;</span><span class="p">,</span>
             <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_PORT</span><span class="p">,</span> <span class="s">&quot;%parrot&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;I&quot;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="s">&quot;baz.html&quot;</span><span class="p">,</span> <span class="s">&quot;text/html&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ftp://%2542parrot@localhost/foo/bar/baz.html&quot;</span><span class="p">,</span>
             <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_PORT</span><span class="p">,</span> <span class="s">&quot;%42parrot&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;I&quot;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="s">&quot;baz.html&quot;</span><span class="p">,</span> <span class="s">&quot;text/html&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ftp://localhost:80/foo/bar/&quot;</span><span class="p">,</span>
             <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;D&quot;</span><span class="p">,</span>
             <span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ftp://localhost/baz.gif;type=a&quot;</span><span class="p">,</span>
             <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_PORT</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">,</span>
             <span class="p">[],</span> <span class="s">&quot;baz.gif&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>  <span class="c"># XXX really this should guess image/gif</span>
            <span class="p">]:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ftp_open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="c"># ftp authentication not yet implemented by FTPHandler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">passwd</span><span class="p">,</span> <span class="n">passwd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">host</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">dirs</span><span class="p">,</span> <span class="n">dirs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ftpwrapper</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ftpwrapper</span><span class="o">.</span><span class="n">filetype</span><span class="p">,</span> <span class="n">type_</span><span class="p">)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">),</span> <span class="n">mimetype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Content-length&quot;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_file"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">email.utils</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="n">TESTFN</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="n">urlpath</span> <span class="o">=</span> <span class="n">sanepathname2url</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">))</span>
        <span class="n">towrite</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;hello, world</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;file://localhost</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">urlpath</span><span class="p">,</span>
            <span class="s">&quot;file://</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">urlpath</span><span class="p">,</span>
            <span class="s">&quot;file://</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">),</span> <span class="n">urlpath</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">localaddr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
            <span class="n">localaddr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">localaddr</span><span class="p">:</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;file://</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localaddr</span><span class="p">,</span> <span class="n">urlpath</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">towrite</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="n">r</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">file_open</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
                    <span class="n">respurl</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span> <span class="n">usegmt</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">towrite</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Content-type&quot;</span><span class="p">],</span> <span class="s">&quot;text/plain&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Content-length&quot;</span><span class="p">],</span> <span class="s">&quot;13&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Last-modified&quot;</span><span class="p">],</span> <span class="n">modified</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">respurl</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s">&quot;file://localhost:80</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">urlpath</span><span class="p">,</span>
            <span class="s">&quot;file:///file_does_not_exist.txt&quot;</span><span class="p">,</span>
            <span class="s">&quot;file://not-a-local-host.com//dir/file.txt&quot;</span><span class="p">,</span>
            <span class="s">&quot;file://</span><span class="si">%s</span><span class="s">:80</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">),</span>
                                   <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">TESTFN</span><span class="p">),</span>
            <span class="s">&quot;file://somerandomhost.ontheinternet.com</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">TESTFN</span><span class="p">),</span>
            <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">towrite</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span>
                                  <span class="n">h</span><span class="o">.</span><span class="n">file_open</span><span class="p">,</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TESTFN</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>
        <span class="c"># XXXX why does // mean ftp (and /// mean not ftp!), and where</span>
        <span class="c">#  is file: scheme specified?  I think this is really a bug, and</span>
        <span class="c">#  what was intended was to distinguish between URLs like:</span>
        <span class="c"># file:/blah.txt (a file)</span>
        <span class="c"># file://localhost/blah.txt (a file)</span>
        <span class="c"># file:///blah.txt (a file)</span>
        <span class="c"># file://ftp.example.com/blah.txt (an ftp URL)</span>
        <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">ftp</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;file://ftp.example.com//foo.txt&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;file://ftp.example.com///foo.txt&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
<span class="c"># XXXX bug: fails with OSError, should be URLError</span>
            <span class="p">(</span><span class="s">&quot;file://ftp.example.com/foo.txt&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;file://somehost//foo/something.txt&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;file://localhost//foo/something.txt&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">]:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">h</span><span class="o">.</span><span class="n">file_open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="c"># XXXX remove OSError when bug fixed</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">ftp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;ftp&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&quot;ftp&quot;</span><span class="p">,</span> <span class="n">ftp</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_http"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_http">[docs]</a>    <span class="k">def</span> <span class="nf">test_http</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://example.com/&quot;</span>
        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;blah&quot;</span><span class="p">)]:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;Foo&quot;</span><span class="p">:</span> <span class="s">&quot;bar&quot;</span><span class="p">})</span>
            <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">)</span>
            <span class="n">http</span> <span class="o">=</span> <span class="n">MockHTTPClass</span><span class="p">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_open</span><span class="p">(</span><span class="n">http</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

            <span class="c"># result attributes</span>
            <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">;</span> <span class="n">r</span><span class="o">.</span><span class="n">readline</span>  <span class="c"># wrapped MockFile methods</span>
            <span class="n">r</span><span class="o">.</span><span class="n">info</span><span class="p">;</span> <span class="n">r</span><span class="o">.</span><span class="n">geturl</span>  <span class="c"># addinfourl methods</span>
            <span class="n">r</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">msg</span> <span class="o">==</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span>  <span class="c"># added from MockHTTPClass.getreply()</span>
            <span class="n">hdrs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="n">hdrs</span><span class="o">.</span><span class="n">get</span><span class="p">;</span> <span class="n">hdrs</span><span class="o">.</span><span class="n">__contains__</span>  <span class="c"># r.info() gives dict from .getreply()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geturl</span><span class="p">(),</span> <span class="n">url</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;example.com&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">req_headers</span><span class="p">,</span>
                             <span class="p">[(</span><span class="s">&quot;Connection&quot;</span><span class="p">,</span> <span class="s">&quot;close&quot;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c"># check OSError converted to URLError</span>
        <span class="n">http</span><span class="o">.</span><span class="n">raise_on_endheaders</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">do_open</span><span class="p">,</span> <span class="n">http</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="c"># Check for TypeError on POST data which is str.</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span><span class="s">&quot;badpost&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

        <span class="c"># check adding of standard headers</span>
        <span class="n">o</span><span class="o">.</span><span class="n">addheaders</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># POST, GET</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># GET</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># POST</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Content-length&quot;</span><span class="p">],</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Content-type&quot;</span><span class="p">],</span>
                             <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">)</span>
            <span class="c"># XXX the details of Host could be better tested</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Host&quot;</span><span class="p">],</span> <span class="s">&quot;example.com&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Spam&quot;</span><span class="p">],</span> <span class="s">&quot;eggs&quot;</span><span class="p">)</span>

            <span class="c"># don&#39;t clobber existing headers</span>
            <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
            <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Host&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">)</span>
            <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Content-length&quot;</span><span class="p">],</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Content-type&quot;</span><span class="p">],</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Host&quot;</span><span class="p">],</span> <span class="s">&quot;baz&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Spam&quot;</span><span class="p">],</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>

        <span class="c"># Check iterable body support</span>
        <span class="k">def</span> <span class="nf">iterable_body</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">b</span><span class="s">&quot;one&quot;</span>
            <span class="k">yield</span> <span class="n">b</span><span class="s">&quot;two&quot;</span>
            <span class="k">yield</span> <span class="n">b</span><span class="s">&quot;three&quot;</span>

        <span class="k">for</span> <span class="n">headers</span> <span class="ow">in</span> <span class="p">{},</span> <span class="p">{</span><span class="s">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="n">iterable_body</span><span class="p">(),</span> <span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">headers</span><span class="p">:</span>
                <span class="c"># Having an iterable body without a Content-Length should</span>
                <span class="c"># raise an exception</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="c"># A file object.</span>
        <span class="c"># Test only Content-Length attribute of request.</span>

        <span class="n">file_obj</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;Something</span><span class="se">\n</span><span class="s">Something</span><span class="se">\n</span><span class="s">Something</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">headers</span> <span class="ow">in</span> <span class="p">{},</span> <span class="p">{</span><span class="s">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">headers</span><span class="p">:</span>
                <span class="c"># Having an iterable body without a Content-Length should</span>
                <span class="c"># raise an exception</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newreq</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&#39;Content-length&#39;</span><span class="p">)),</span><span class="mi">30</span><span class="p">)</span>

        <span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># array.array Iterable - Content Length is calculated</span>

        <span class="n">iterable_array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">headers</span> <span class="ow">in</span> <span class="p">{},</span> <span class="p">{</span><span class="s">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">}:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">,</span> <span class="n">iterable_array</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newreq</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&#39;Content-length&#39;</span><span class="p">)),</span><span class="mi">16</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_http_doubleslash"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_http_doubleslash">[docs]</a>    <span class="k">def</span> <span class="nf">test_http_doubleslash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Checks the presence of any unnecessary double slash in url does not</span>
        <span class="c"># break anything. Previously, a double slash directly after the host</span>
        <span class="c"># could cause incorrect parsing.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
        <span class="n">ds_urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;http://example.com/foo/bar/baz.html&quot;</span><span class="p">,</span>
            <span class="s">&quot;http://example.com//foo/bar/baz.html&quot;</span><span class="p">,</span>
            <span class="s">&quot;http://example.com/foo//bar/baz.html&quot;</span><span class="p">,</span>
            <span class="s">&quot;http://example.com/foo/bar//baz.html&quot;</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">ds_url</span> <span class="ow">in</span> <span class="n">ds_urls</span><span class="p">:</span>
            <span class="n">ds_req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="c"># Check whether host is determined correctly if there is no proxy</span>
            <span class="n">np_ds_req</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">ds_req</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">np_ds_req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Host&quot;</span><span class="p">],</span><span class="s">&quot;example.com&quot;</span><span class="p">)</span>

            <span class="c"># Check whether host is determined correctly if there is a proxy</span>
            <span class="n">ds_req</span><span class="o">.</span><span class="n">set_proxy</span><span class="p">(</span><span class="s">&quot;someproxy:3128&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
            <span class="n">p_ds_req</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">ds_req</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p_ds_req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Host&quot;</span><span class="p">],</span><span class="s">&quot;example.com&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_full_url_setter"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_full_url_setter">[docs]</a>    <span class="k">def</span> <span class="nf">test_full_url_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Checks to ensure that components are set correctly after setting the</span>
        <span class="c"># full_url of a Request object</span>

        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;http://example.com?foo=bar#baz&#39;</span><span class="p">,</span>
            <span class="s">&#39;http://example.com?foo=bar&amp;spam=eggs#bash&#39;</span><span class="p">,</span>
            <span class="s">&#39;http://example.com&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c"># testing a reusable request instance, but the url parameter is</span>
        <span class="c"># required, so just use a dummy one to instantiate</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&#39;http://example.com&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">full_url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(),</span> <span class="n">url</span><span class="p">)</span>
            <span class="c"># full_url setter uses splittag to split into components.</span>
            <span class="c"># splittag sets the fragment as None while urlparse sets it to &#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fragment</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">fragment</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_full_url_deleter"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_full_url_deleter">[docs]</a>    <span class="k">def</span> <span class="nf">test_full_url_deleter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&#39;http://www.example.com&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">r</span><span class="o">.</span><span class="n">full_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">full_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fragment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_fixpath_in_weirdurls"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_fixpath_in_weirdurls">[docs]</a>    <span class="k">def</span> <span class="nf">test_fixpath_in_weirdurls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue4493: urllib2 to supply &#39;/&#39; when to urls where path does not</span>
        <span class="c"># start with&#39;/&#39;</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="n">weird_url</span> <span class="o">=</span> <span class="s">&#39;http://www.python.org?getspam&#39;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">weird_url</span><span class="p">)</span>
        <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newreq</span><span class="o">.</span><span class="n">host</span><span class="p">,</span><span class="s">&#39;www.python.org&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newreq</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span><span class="s">&#39;/?getspam&#39;</span><span class="p">)</span>

        <span class="n">url_without_path</span> <span class="o">=</span> <span class="s">&#39;http://www.python.org&#39;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url_without_path</span><span class="p">)</span>
        <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">do_request_</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newreq</span><span class="o">.</span><span class="n">host</span><span class="p">,</span><span class="s">&#39;www.python.org&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newreq</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="HandlerTests.test_errors"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPErrorProcessor</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://example.com/&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="c"># all 2xx are passed through</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">newr</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_response</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">newr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;proto&quot;</span><span class="p">))</span>  <span class="c"># o.error not called</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">202</span><span class="p">,</span> <span class="s">&quot;Accepted&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">newr</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_response</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">newr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;proto&quot;</span><span class="p">))</span>  <span class="c"># o.error not called</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">206</span><span class="p">,</span> <span class="s">&quot;Partial content&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">newr</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_response</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">newr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;proto&quot;</span><span class="p">))</span>  <span class="c"># o.error not called</span>
        <span class="c"># anything else calls o.error (and MockOpener returns None, here)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">502</span><span class="p">,</span> <span class="s">&quot;Bad gateway&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">http_response</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">proto</span><span class="p">,</span> <span class="s">&quot;http&quot;</span><span class="p">)</span>  <span class="c"># o.error called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="s">&quot;Bad gateway&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_cookies"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">test_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cj</span> <span class="o">=</span> <span class="n">MockCookieJar</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cj</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MockResponse</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">newreq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">cj</span><span class="o">.</span><span class="n">ach_req</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">cj</span><span class="o">.</span><span class="n">ach_req</span><span class="p">,</span> <span class="n">newreq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">origin_req_host</span><span class="p">,</span> <span class="s">&quot;example.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">unverifiable</span><span class="p">)</span>
        <span class="n">newr</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">http_response</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">cj</span><span class="o">.</span><span class="n">ec_req</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">cj</span><span class="o">.</span><span class="n">ec_r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">newr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_redirect"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_redirect">[docs]</a>    <span class="k">def</span> <span class="nf">test_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">from_url</span> <span class="o">=</span> <span class="s">&quot;http://example.com/a.html&quot;</span>
        <span class="n">to_url</span> <span class="o">=</span> <span class="s">&quot;http://example.com/b.html&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>

        <span class="c"># ordinary redirect behaviour</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">307</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;blah</span><span class="se">\n</span><span class="s">blah</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s">&quot;http_error_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">code</span><span class="p">)</span>
                <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">from_url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span>
                <span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&quot;Nonsense&quot;</span><span class="p">,</span> <span class="s">&quot;viking=withhold&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                <span class="n">req</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="s">&quot;spam&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">method</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">MockFile</span><span class="p">(),</span> <span class="n">code</span><span class="p">,</span> <span class="s">&quot;Blah&quot;</span><span class="p">,</span>
                           <span class="n">MockHeaders</span><span class="p">({</span><span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="n">to_url</span><span class="p">}))</span>
                <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
                    <span class="c"># 307 in response to POST requires user OK</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="mi">307</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(),</span> <span class="n">to_url</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">get_method</span><span class="p">(),</span> <span class="s">&quot;GET&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="c"># now it&#39;s a GET, there should not be headers regarding content</span>
                <span class="c"># (possibly dragged from before being a POST)</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;content-length&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;content-type&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;Nonsense&quot;</span><span class="p">],</span>
                                 <span class="s">&quot;viking=withhold&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Spam&quot;</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>

        <span class="c"># loop detection</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">from_url</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span>
        <span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">to_url</span><span class="p">):</span>
            <span class="n">h</span><span class="o">.</span><span class="n">http_error_302</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">MockFile</span><span class="p">(),</span> <span class="mi">302</span><span class="p">,</span> <span class="s">&quot;Blah&quot;</span><span class="p">,</span>
                             <span class="n">MockHeaders</span><span class="p">({</span><span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">}))</span>
        <span class="c"># Note that the *original* request shares the same record of</span>
        <span class="c"># redirections with the sub-requests caused by the redirections.</span>

        <span class="c"># detect infinite loop redirect of a URL to itself</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">from_url</span><span class="p">,</span> <span class="n">origin_req_host</span><span class="o">=</span><span class="s">&quot;example.com&quot;</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">redirect</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">&quot;http://example.com/&quot;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="c"># don&#39;t stop until max_repeats, because cookies may introduce state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="o">.</span><span class="n">max_repeats</span><span class="p">)</span>

        <span class="c"># detect endless non-repeating chain of redirects</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">from_url</span><span class="p">,</span> <span class="n">origin_req_host</span><span class="o">=</span><span class="s">&quot;example.com&quot;</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">redirect</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="s">&quot;http://example.com/</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span>
                             <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="o">.</span><span class="n">max_redirections</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="HandlerTests.test_invalid_redirect"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_invalid_redirect">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">from_url</span> <span class="o">=</span> <span class="s">&quot;http://example.com/a.html&quot;</span>
        <span class="n">valid_schemes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;http&#39;</span><span class="p">,</span><span class="s">&#39;https&#39;</span><span class="p">,</span><span class="s">&#39;ftp&#39;</span><span class="p">]</span>
        <span class="n">invalid_schemes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">,</span><span class="s">&#39;imap&#39;</span><span class="p">,</span><span class="s">&#39;ldap&#39;</span><span class="p">]</span>
        <span class="n">schemeless_url</span> <span class="o">=</span> <span class="s">&quot;example.com/b.html&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">from_url</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span>

        <span class="k">for</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">invalid_schemes</span><span class="p">:</span>
            <span class="n">invalid_url</span> <span class="o">=</span> <span class="n">scheme</span> <span class="o">+</span> <span class="s">&#39;://&#39;</span> <span class="o">+</span> <span class="n">schemeless_url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">http_error_302</span><span class="p">,</span>
                    <span class="n">req</span><span class="p">,</span> <span class="n">MockFile</span><span class="p">(),</span> <span class="mi">302</span><span class="p">,</span> <span class="s">&quot;Security Loophole&quot;</span><span class="p">,</span>
                    <span class="n">MockHeaders</span><span class="p">({</span><span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="n">invalid_url</span><span class="p">}))</span>

        <span class="k">for</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">valid_schemes</span><span class="p">:</span>
            <span class="n">valid_url</span> <span class="o">=</span> <span class="n">scheme</span> <span class="o">+</span> <span class="s">&#39;://&#39;</span> <span class="o">+</span> <span class="n">schemeless_url</span>
            <span class="n">h</span><span class="o">.</span><span class="n">http_error_302</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">MockFile</span><span class="p">(),</span> <span class="mi">302</span><span class="p">,</span> <span class="s">&quot;That&#39;s fine&quot;</span><span class="p">,</span>
                <span class="n">MockHeaders</span><span class="p">({</span><span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="n">valid_url</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(),</span> <span class="n">valid_url</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_relative_redirect"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_relative_redirect">[docs]</a>    <span class="k">def</span> <span class="nf">test_relative_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">from_url</span> <span class="o">=</span> <span class="s">&quot;http://example.com/a.html&quot;</span>
        <span class="n">relative_url</span> <span class="o">=</span> <span class="s">&quot;/b.html&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">MockOpener</span><span class="p">()</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">from_url</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">_GLOBAL_DEFAULT_TIMEOUT</span>

        <span class="n">valid_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">from_url</span><span class="p">,</span><span class="n">relative_url</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">http_error_302</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">MockFile</span><span class="p">(),</span> <span class="mi">302</span><span class="p">,</span> <span class="s">&quot;That&#39;s fine&quot;</span><span class="p">,</span>
            <span class="n">MockHeaders</span><span class="p">({</span><span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="n">valid_url</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(),</span> <span class="n">valid_url</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_cookie_redirect"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_cookie_redirect">[docs]</a>    <span class="k">def</span> <span class="nf">test_cookie_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># cookies shouldn&#39;t leak into redirected requests</span>
        <span class="kn">from</span> <span class="nn">http.cookiejar</span> <span class="kn">import</span> <span class="n">CookieJar</span>
        <span class="kn">from</span> <span class="nn">test.test_http_cookiejar</span> <span class="kn">import</span> <span class="n">interact_netscape</span>

        <span class="n">cj</span> <span class="o">=</span> <span class="n">CookieJar</span><span class="p">()</span>
        <span class="n">interact_netscape</span><span class="p">(</span><span class="n">cj</span><span class="p">,</span> <span class="s">&quot;http://www.example.com/&quot;</span><span class="p">,</span> <span class="s">&quot;spam=eggs&quot;</span><span class="p">)</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="s">&quot;Location: http://www.cracker.com/</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">hdeh</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPDefaultErrorHandler</span><span class="p">()</span>
        <span class="n">hrh</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="p">()</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cj</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_test_opener</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">hdeh</span><span class="p">,</span> <span class="n">hrh</span><span class="p">,</span> <span class="n">cp</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;http://www.example.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">hh</span><span class="o">.</span><span class="n">req</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="s">&quot;Cookie&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_redirect_fragment"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_redirect_fragment">[docs]</a>    <span class="k">def</span> <span class="nf">test_redirect_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">redirected_url</span> <span class="o">=</span> <span class="s">&#39;http://www.example.com/index.html#OK</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="s">&#39;Location: &#39;</span> <span class="o">+</span> <span class="n">redirected_url</span><span class="p">)</span>
        <span class="n">hdeh</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPDefaultErrorHandler</span><span class="p">()</span>
        <span class="n">hrh</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_test_opener</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">hdeh</span><span class="p">,</span> <span class="n">hrh</span><span class="p">)</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;http://www.example.com&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">geturl</span><span class="p">(),</span> <span class="n">redirected_url</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_proxy"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">http</span><span class="o">=</span><span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s">&quot;http_open&quot;</span><span class="p">,</span> <span class="s">&quot;return response&quot;</span><span class="p">)]</span>
            <span class="p">]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://acme.example.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;acme.example.com&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;http_open&quot;</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_proxy_no_proxy"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_proxy_no_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy_no_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;no_proxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;python.org&#39;</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">http</span><span class="o">=</span><span class="s">&quot;proxy.example.com&quot;</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.perl.org/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.perl.org&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;proxy.example.com&quot;</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.python.org&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.python.org&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;no_proxy&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_proxy_no_proxy_all"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_proxy_no_proxy_all">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy_no_proxy_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;no_proxy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">http</span><span class="o">=</span><span class="s">&quot;proxy.example.com&quot;</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.python.org&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.python.org&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;no_proxy&#39;</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="HandlerTests.test_proxy_https"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_proxy_https">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy_https</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">https</span><span class="o">=</span><span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">meth_spec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s">&quot;https_open&quot;</span><span class="p">,</span> <span class="s">&quot;return response&quot;</span><span class="p">)]</span>
        <span class="p">]</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="n">add_ordered_mock_handlers</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">meth_spec</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;https://www.example.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.example.com&quot;</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;https_open&quot;</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">calls</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_proxy_https_proxy_authorization"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_proxy_https_proxy_authorization">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy_https_proxy_authorization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">https</span><span class="o">=</span><span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">https_handler</span> <span class="o">=</span> <span class="n">MockHTTPSHandler</span><span class="p">()</span>
        <span class="n">o</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">https_handler</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;https://www.example.com/&quot;</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&quot;Proxy-Authorization&quot;</span><span class="p">,</span><span class="s">&quot;FooBar&quot;</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&quot;User-Agent&quot;</span><span class="p">,</span><span class="s">&quot;Grail&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;www.example.com&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">_tunnel_host</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="c"># Verify Proxy-Authorization gets tunneled to request.</span>
        <span class="c"># httpsconn req_headers do not have the Proxy-Authorization header but</span>
        <span class="c"># the req will have.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">((</span><span class="s">&quot;Proxy-Authorization&quot;</span><span class="p">,</span><span class="s">&quot;FooBar&quot;</span><span class="p">),</span>
                         <span class="n">https_handler</span><span class="o">.</span><span class="n">httpconn</span><span class="o">.</span><span class="n">req_headers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">((</span><span class="s">&quot;User-Agent&quot;</span><span class="p">,</span><span class="s">&quot;Grail&quot;</span><span class="p">),</span>
                      <span class="n">https_handler</span><span class="o">.</span><span class="n">httpconn</span><span class="o">.</span><span class="n">req_headers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">_tunnel_host</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Proxy-authorization&quot;</span><span class="p">),</span><span class="s">&quot;FooBar&quot;</span><span class="p">)</span>

    <span class="c"># TODO: This should be only for OSX</span></div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">,</span> <span class="s">&quot;only relevant for OSX&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="HandlerTests.test_osx_proxy_bypass"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_osx_proxy_bypass">[docs]</a>    <span class="k">def</span> <span class="nf">test_osx_proxy_bypass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bypass</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;exclude_simple&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;exceptions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;*.bar.com&#39;</span><span class="p">,</span> <span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s">&#39;10.10&#39;</span><span class="p">,</span>
                           <span class="s">&#39;10.0/16&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="c"># Check hosts that should trigger the proxy bypass</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;www.bar.com&#39;</span><span class="p">,</span> <span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s">&#39;10.10.0.1&#39;</span><span class="p">,</span>
                     <span class="s">&#39;10.0.0.1&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">_proxy_bypass_macosx_sysconf</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">bypass</span><span class="p">),</span>
                            <span class="s">&#39;expected bypass of </span><span class="si">%s</span><span class="s"> to be True&#39;</span> <span class="o">%</span> <span class="n">host</span><span class="p">)</span>
        <span class="c"># Check hosts that should not trigger the proxy bypass</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;abc.foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;bar.com&#39;</span><span class="p">,</span> <span class="s">&#39;127.0.0.2&#39;</span><span class="p">,</span> <span class="s">&#39;10.11.0.1&#39;</span><span class="p">,</span>
                <span class="s">&#39;notinbypass&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">_proxy_bypass_macosx_sysconf</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">bypass</span><span class="p">),</span>
                             <span class="s">&#39;expected bypass of </span><span class="si">%s</span><span class="s"> to be False&#39;</span> <span class="o">%</span> <span class="n">host</span><span class="p">)</span>

        <span class="c"># Check the exclude_simple flag</span>
        <span class="n">bypass</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;exclude_simple&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;exceptions&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">_proxy_bypass_macosx_sysconf</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="n">bypass</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_basic_auth"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_basic_auth">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quote_char</span><span class="o">=</span><span class="s">&#39;&quot;&#39;</span><span class="p">):</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">password_manager</span> <span class="o">=</span> <span class="n">MockPasswordManager</span><span class="p">()</span>
        <span class="n">auth_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="p">(</span><span class="n">password_manager</span><span class="p">)</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="s">&quot;ACME Widget Store&quot;</span>
        <span class="n">http_handler</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span>
            <span class="mi">401</span><span class="p">,</span> <span class="s">&#39;WWW-Authenticate: Basic realm=</span><span class="si">%s%s%s</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">quote_char</span><span class="p">,</span> <span class="n">realm</span><span class="p">,</span> <span class="n">quote_char</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">auth_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">http_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_basic_auth</span><span class="p">(</span><span class="n">opener</span><span class="p">,</span> <span class="n">auth_handler</span><span class="p">,</span> <span class="s">&quot;Authorization&quot;</span><span class="p">,</span>
                              <span class="n">realm</span><span class="p">,</span> <span class="n">http_handler</span><span class="p">,</span> <span class="n">password_manager</span><span class="p">,</span>
                              <span class="s">&quot;http://acme.example.com/protected&quot;</span><span class="p">,</span>
                              <span class="s">&quot;http://acme.example.com/protected&quot;</span><span class="p">,</span>
                              <span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_basic_auth_with_single_quoted_realm"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_basic_auth_with_single_quoted_realm">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic_auth_with_single_quoted_realm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_basic_auth</span><span class="p">(</span><span class="n">quote_char</span><span class="o">=</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_basic_auth_with_unquoted_realm"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_basic_auth_with_unquoted_realm">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic_auth_with_unquoted_realm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">password_manager</span> <span class="o">=</span> <span class="n">MockPasswordManager</span><span class="p">()</span>
        <span class="n">auth_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="p">(</span><span class="n">password_manager</span><span class="p">)</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="s">&quot;ACME Widget Store&quot;</span>
        <span class="n">http_handler</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span>
            <span class="mi">401</span><span class="p">,</span> <span class="s">&#39;WWW-Authenticate: Basic realm=</span><span class="si">%s</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">realm</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">auth_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">http_handler</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_basic_auth</span><span class="p">(</span><span class="n">opener</span><span class="p">,</span> <span class="n">auth_handler</span><span class="p">,</span> <span class="s">&quot;Authorization&quot;</span><span class="p">,</span>
                                <span class="n">realm</span><span class="p">,</span> <span class="n">http_handler</span><span class="p">,</span> <span class="n">password_manager</span><span class="p">,</span>
                                <span class="s">&quot;http://acme.example.com/protected&quot;</span><span class="p">,</span>
                                <span class="s">&quot;http://acme.example.com/protected&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_proxy_basic_auth"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_proxy_basic_auth">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy_basic_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">http</span><span class="o">=</span><span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">))</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">password_manager</span> <span class="o">=</span> <span class="n">MockPasswordManager</span><span class="p">()</span>
        <span class="n">auth_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyBasicAuthHandler</span><span class="p">(</span><span class="n">password_manager</span><span class="p">)</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="s">&quot;ACME Networks&quot;</span>
        <span class="n">http_handler</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span>
            <span class="mi">407</span><span class="p">,</span> <span class="s">&#39;Proxy-Authenticate: Basic realm=&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">realm</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">auth_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">http_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_basic_auth</span><span class="p">(</span><span class="n">opener</span><span class="p">,</span> <span class="n">auth_handler</span><span class="p">,</span> <span class="s">&quot;Proxy-authorization&quot;</span><span class="p">,</span>
                              <span class="n">realm</span><span class="p">,</span> <span class="n">http_handler</span><span class="p">,</span> <span class="n">password_manager</span><span class="p">,</span>
                              <span class="s">&quot;http://acme.example.com:3128/protected&quot;</span><span class="p">,</span>
                              <span class="s">&quot;proxy.example.com:3128&quot;</span><span class="p">,</span>
                              <span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_basic_and_digest_auth_handlers"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_basic_and_digest_auth_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic_and_digest_auth_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># HTTPDigestAuthHandler raised an exception if it couldn&#39;t handle a 40*</span>
        <span class="c"># response (http://python.org/sf/1479302), where it should instead</span>
        <span class="c"># return None to allow another handler (especially</span>
        <span class="c"># HTTPBasicAuthHandler) to handle the response.</span>

        <span class="c"># Also (http://python.org/sf/14797027, RFC 2617 section 1.2), we must</span>
        <span class="c"># try digest first (since it&#39;s the strongest auth scheme), so we record</span>
        <span class="c"># order of calls here to check digest comes first:</span>
        <span class="k">class</span> <span class="nc">RecordingOpenerDirector</span><span class="p">(</span><span class="n">OpenerDirector</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">OpenerDirector</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recorded</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">class</span> <span class="nc">TestDigestAuthHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPDigestAuthHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">http_error_401</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s">&quot;digest&quot;</span><span class="p">)</span>
                <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPDigestAuthHandler</span><span class="o">.</span><span class="n">http_error_401</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                             <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">class</span> <span class="nc">TestBasicAuthHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">http_error_401</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s">&quot;basic&quot;</span><span class="p">)</span>
                <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="o">.</span><span class="n">http_error_401</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">opener</span> <span class="o">=</span> <span class="n">RecordingOpenerDirector</span><span class="p">()</span>
        <span class="n">password_manager</span> <span class="o">=</span> <span class="n">MockPasswordManager</span><span class="p">()</span>
        <span class="n">digest_handler</span> <span class="o">=</span> <span class="n">TestDigestAuthHandler</span><span class="p">(</span><span class="n">password_manager</span><span class="p">)</span>
        <span class="n">basic_handler</span> <span class="o">=</span> <span class="n">TestBasicAuthHandler</span><span class="p">(</span><span class="n">password_manager</span><span class="p">)</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="s">&quot;ACME Networks&quot;</span>
        <span class="n">http_handler</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span>
            <span class="mi">401</span><span class="p">,</span> <span class="s">&#39;WWW-Authenticate: Basic realm=&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">realm</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">basic_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">digest_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">http_handler</span><span class="p">)</span>

        <span class="c"># check basic auth isn&#39;t blocked by digest handler failing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_basic_auth</span><span class="p">(</span><span class="n">opener</span><span class="p">,</span> <span class="n">basic_handler</span><span class="p">,</span> <span class="s">&quot;Authorization&quot;</span><span class="p">,</span>
                              <span class="n">realm</span><span class="p">,</span> <span class="n">http_handler</span><span class="p">,</span> <span class="n">password_manager</span><span class="p">,</span>
                              <span class="s">&quot;http://acme.example.com/protected&quot;</span><span class="p">,</span>
                              <span class="s">&quot;http://acme.example.com/protected&quot;</span><span class="p">,</span>
                              <span class="p">)</span>
        <span class="c"># check digest was tried before basic (twice, because</span>
        <span class="c"># _test_basic_auth called .open() twice)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">opener</span><span class="o">.</span><span class="n">recorded</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;digest&quot;</span><span class="p">,</span> <span class="s">&quot;basic&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_unsupported_auth_digest_handler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_unsupported_auth_digest_handler">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsupported_auth_digest_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="c"># While using DigestAuthHandler</span>
        <span class="n">digest_auth_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPDigestAuthHandler</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">http_handler</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span>
            <span class="mi">401</span><span class="p">,</span> <span class="s">&#39;WWW-Authenticate: Kerberos</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">digest_auth_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">http_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">,</span><span class="s">&quot;http://www.example.com&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_unsupported_auth_basic_handler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_unsupported_auth_basic_handler">[docs]</a>    <span class="k">def</span> <span class="nf">test_unsupported_auth_basic_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># While using BasicAuthHandler</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="n">OpenerDirector</span><span class="p">()</span>
        <span class="n">basic_auth_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">http_handler</span> <span class="o">=</span> <span class="n">MockHTTPHandler</span><span class="p">(</span>
            <span class="mi">401</span><span class="p">,</span> <span class="s">&#39;WWW-Authenticate: NTLM</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">basic_auth_handler</span><span class="p">)</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">http_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">,</span><span class="s">&quot;http://www.example.com&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_basic_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opener</span><span class="p">,</span> <span class="n">auth_handler</span><span class="p">,</span> <span class="n">auth_header</span><span class="p">,</span>
                         <span class="n">realm</span><span class="p">,</span> <span class="n">http_handler</span><span class="p">,</span> <span class="n">password_manager</span><span class="p">,</span>
                         <span class="n">request_url</span><span class="p">,</span> <span class="n">protected_url</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">base64</span>
        <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;wile&quot;</span><span class="p">,</span> <span class="s">&quot;coyote&quot;</span>

        <span class="c"># .add_password() fed through to password manager</span>
        <span class="n">auth_handler</span><span class="o">.</span><span class="n">add_password</span><span class="p">(</span><span class="n">realm</span><span class="p">,</span> <span class="n">request_url</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">realm</span><span class="p">,</span> <span class="n">password_manager</span><span class="o">.</span><span class="n">realm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">password_manager</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password_manager</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">password_manager</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

        <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request_url</span><span class="p">)</span>

        <span class="c"># should have asked the password manager for the username/password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">password_manager</span><span class="o">.</span><span class="n">target_realm</span><span class="p">,</span> <span class="n">realm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">password_manager</span><span class="o">.</span><span class="n">target_url</span><span class="p">,</span> <span class="n">protected_url</span><span class="p">)</span>

        <span class="c"># expect one request without authorization, then one with</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">http_handler</span><span class="o">.</span><span class="n">requests</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">http_handler</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">))</span>
        <span class="n">userpass</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">),</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="n">auth_hdr_value</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Basic &#39;</span> <span class="o">+</span>
            <span class="n">base64</span><span class="o">.</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">userpass</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http_handler</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">),</span>
                         <span class="n">auth_hdr_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">http_handler</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="n">auth_header</span><span class="p">],</span>
                         <span class="n">auth_hdr_value</span><span class="p">)</span>
        <span class="c"># if the password manager can&#39;t find a password, the handler won&#39;t</span>
        <span class="c"># handle the HTTP auth error</span>
        <span class="n">password_manager</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">password_manager</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">http_handler</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">http_handler</span><span class="o">.</span><span class="n">requests</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">http_handler</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">has_header</span><span class="p">(</span><span class="n">auth_header</span><span class="p">))</span>

<div class="viewcode-block" id="HandlerTests.test_http_closed"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_http_closed">[docs]</a>    <span class="k">def</span> <span class="nf">test_http_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test the connection is cleaned up when the response is closed&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">transfer</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;Connection: close&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;data&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Transfer-Encoding: chunked&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;4</span><span class="se">\r\n</span><span class="s">data</span><span class="se">\r\n</span><span class="s">0</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Content-Length: 4&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;data&quot;</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s">&quot;HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s">{}</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transfer</span><span class="p">)</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">test_urllib</span><span class="o">.</span><span class="n">fakehttp</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="p">()</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://dummy/&quot;</span><span class="p">)</span>
            <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">with</span> <span class="n">handler</span><span class="o">.</span><span class="n">do_open</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
                <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">fakesock</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span>
                <span class="s">&quot;Connection not closed with {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transfer</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HandlerTests.test_invalid_closed"><a class="viewcode-back" href="../../test.html#test.test_urllib2.HandlerTests.test_invalid_closed">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test the connection is cleaned up after an invalid response&quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">test_urllib</span><span class="o">.</span><span class="n">fakehttp</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">AbstractHTTPHandler</span><span class="p">()</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://dummy/&quot;</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">BadStatusLine</span><span class="p">):</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">do_open</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">fakesock</span><span class="o">.</span><span class="n">closed</span><span class="p">,</span> <span class="s">&quot;Connection not closed&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="MiscTests"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MiscTests">[docs]</a><span class="k">class</span> <span class="nc">MiscTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="MiscTests.opener_has_handler"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MiscTests.opener_has_handler">[docs]</a>    <span class="k">def</span> <span class="nf">opener_has_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opener</span><span class="p">,</span> <span class="n">handler_class</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">handler_class</span>
                            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">opener</span><span class="o">.</span><span class="n">handlers</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MiscTests.test_build_opener"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MiscTests.test_build_opener">[docs]</a>    <span class="k">def</span> <span class="nf">test_build_opener</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MyHTTPHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">FooHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">BaseHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">foo_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">class</span> <span class="nc">BarHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">BaseHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">bar_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

        <span class="n">build_opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span>

        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">FooHandler</span><span class="p">,</span> <span class="n">BarHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">FooHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">BarHandler</span><span class="p">)</span>

        <span class="c"># can take a mix of classes and instances</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">FooHandler</span><span class="p">,</span> <span class="n">BarHandler</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">FooHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">BarHandler</span><span class="p">)</span>

        <span class="c"># subclasses of default handlers override default handlers</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">MyHTTPHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">MyHTTPHandler</span><span class="p">)</span>

        <span class="c"># a particular case of overriding: default handlers can be passed</span>
        <span class="c"># in explicitly</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">)</span>

        <span class="c"># Issue2670: multiple handlers sharing the same base class</span>
        <span class="k">class</span> <span class="nc">MyOtherHTTPHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">):</span> <span class="k">pass</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">MyHTTPHandler</span><span class="p">,</span> <span class="n">MyOtherHTTPHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">MyHTTPHandler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener_has_handler</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">MyOtherHTTPHandler</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">is_resource_enabled</span><span class="p">(</span><span class="s">&#39;network&#39;</span><span class="p">),</span>
                         <span class="s">&#39;test requires network access&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="MiscTests.test_issue16464"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MiscTests.test_issue16464">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue16464</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">()</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.example.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;us-ascii&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">))</span>

        <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&quot;1234567890&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;us-ascii&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;1234567890&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;10&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MiscTests.test_HTTPError_interface"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MiscTests.test_HTTPError_interface">[docs]</a>    <span class="k">def</span> <span class="nf">test_HTTPError_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Issue 13211 reveals that HTTPError didn&#39;t implement the URLError</span>
<span class="sd">        interface even though HTTPError is a subclass of URLError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;something bad happened&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">code</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">hdrs</span> <span class="o">=</span> <span class="s">&#39;Content-Length: 42&#39;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">hdrs</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s">&#39;reason&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="s">&#39;something bad happened&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s">&#39;headers&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="s">&#39;Content-Length: 42&#39;</span><span class="p">)</span>
        <span class="n">expected_errmsg</span> <span class="o">=</span> <span class="s">&#39;HTTP Error </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="n">expected_errmsg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTests.test_parse_proxy"><a class="viewcode-back" href="../../test.html#test.test_urllib2.MiscTests.test_parse_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parse_proxy_test_cases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;proxy.example.com&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;proxy.example.com&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">)),</span>
            <span class="c"># The authority component may optionally include userinfo</span>
            <span class="c"># (assumed to be # username:password):</span>
            <span class="p">(</span><span class="s">&#39;joe:password@proxy.example.com&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;joe:password@proxy.example.com:3128&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">)),</span>
            <span class="c">#Examples with URLS</span>
            <span class="p">(</span><span class="s">&#39;http://proxy.example.com/&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;http://proxy.example.com:3128/&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;http://joe:password@proxy.example.com/&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;http://joe:password@proxy.example.com:3128&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;proxy.example.com:3128&#39;</span><span class="p">)),</span>
            <span class="c"># Everything after the authority is ignored</span>
            <span class="p">(</span><span class="s">&#39;ftp://joe:password@proxy.example.com/rubbish:3128&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="s">&#39;ftp&#39;</span><span class="p">,</span> <span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">)),</span>
            <span class="c"># Test for no trailing &#39;/&#39; case</span>
            <span class="p">(</span><span class="s">&#39;http://joe:password@proxy.example.com&#39;</span><span class="p">,</span>
             <span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="s">&#39;joe&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;proxy.example.com&#39;</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">tc</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">parse_proxy_test_cases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">_parse_proxy</span><span class="p">(</span><span class="n">tc</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">_parse_proxy</span><span class="p">,</span> <span class="s">&#39;file:/ftp.example.com&#39;</span><span class="p">),</span>
</div></div>
<div class="viewcode-block" id="RequestTests"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests">[docs]</a><span class="k">class</span> <span class="nc">RequestTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="RequestTests.PutRequest"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.PutRequest">[docs]</a>    <span class="k">class</span> <span class="nc">PutRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
        <span class="n">method</span><span class="o">=</span><span class="s">&#39;PUT&#39;</span>
</div>
<div class="viewcode-block" id="RequestTests.setUp"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org/~jeremy/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org/~jeremy/&quot;</span><span class="p">,</span>
                            <span class="s">&quot;data&quot;</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;X-Test&quot;</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org/~jeremy/&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;HEAD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PutRequest</span><span class="p">(</span><span class="s">&quot;http://www.python.org/~jeremy/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PutRequest</span><span class="p">(</span><span class="s">&quot;http://www.python.org/~jeremy/&quot;</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_method"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_method">[docs]</a>    <span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;PUT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_post</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="RequestTests.test_data"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">&quot;spam&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>

    <span class="c"># issue 16464</span>
    <span class="c"># if we change data we need to remove content-length header</span>
    <span class="c"># (cause it&#39;s most probably calculated for previous value)</span></div>
<div class="viewcode-block" id="RequestTests.test_setting_data_should_remove_content_length"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_setting_data_should_remove_content_length">[docs]</a>    <span class="k">def</span> <span class="nf">test_setting_data_should_remove_content_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Content-length&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">&quot;spam&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>

    <span class="c"># issue 17485 same for deleting data.</span></div>
<div class="viewcode-block" id="RequestTests.test_deleting_data_should_remove_content_length"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_deleting_data_should_remove_content_length">[docs]</a>    <span class="k">def</span> <span class="nf">test_deleting_data_should_remove_content_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">[</span><span class="s">&quot;Content-length&quot;</span><span class="p">])</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">unredirected_hdrs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_get_full_url"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_get_full_url">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_full_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;http://www.python.org/~jeremy/&quot;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="RequestTests.test_selector"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_selector">[docs]</a>    <span class="k">def</span> <span class="nf">test_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;/~jeremy/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">selector</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_get_type"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_get_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_get_host"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_get_host">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_host</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;www.python.org&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_get_host_unquote"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_get_host_unquote">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_host_unquote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.%70ython.org/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;www.python.org&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_proxy"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">has_proxy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">set_proxy</span><span class="p">(</span><span class="s">&quot;www.perl.org&quot;</span><span class="p">,</span> <span class="s">&quot;http&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">has_proxy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;www.python.org&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">origin_req_host</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;www.perl.org&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_wrapped_url"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_wrapped_url">[docs]</a>    <span class="k">def</span> <span class="nf">test_wrapped_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;&lt;URL:http://www.python.org&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;www.python.org&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_url_fragment"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_url_fragment">[docs]</a>    <span class="k">def</span> <span class="nf">test_url_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org/?qs=query#fragment=true&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;/?qs=query&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">&quot;http://www.python.org/#fun=true&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">selector</span><span class="p">)</span>

        <span class="c"># Issue 11703: geturl() omits fragment in the original URL.</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://docs.python.org/library/urllib2.html#OK&#39;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(),</span> <span class="n">url</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RequestTests.test_url_fullurl_get_full_url"><a class="viewcode-back" href="../../test.html#test.test_urllib2.RequestTests.test_url_fullurl_get_full_url">[docs]</a>    <span class="k">def</span> <span class="nf">test_url_fullurl_get_full_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;http://docs.python.org&#39;</span><span class="p">,</span>
                <span class="s">&#39;http://docs.python.org/library/urllib2.html#OK&#39;</span><span class="p">,</span>
                <span class="s">&#39;http://www.python.org/?qs=query#fragment=true&#39;</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(),</span> <span class="n">req</span><span class="o">.</span><span class="n">full_url</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_urllib2.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">test_urllib2</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_doctest</span><span class="p">(</span><span class="n">test_urllib2</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_doctest</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="p">(</span><span class="n">TrivialTests</span><span class="p">,</span>
             <span class="n">OpenerDirectorTests</span><span class="p">,</span>
             <span class="n">HandlerTests</span><span class="p">,</span>
             <span class="n">MiscTests</span><span class="p">,</span>
             <span class="n">RequestTests</span><span class="p">,</span>
             <span class="n">RequestHdrsTests</span><span class="p">)</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="o">*</span><span class="n">tests</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_main</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>