

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_nntplib &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_nntplib</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_nntplib</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">from</span> <span class="nn">nntplib</span> <span class="kn">import</span> <span class="n">NNTP</span><span class="p">,</span> <span class="n">GroupInfo</span>
<span class="kn">import</span> <span class="nn">nntplib</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ssl</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c"># TODO:</span>
<span class="c"># - test the `file` arg to more commands</span>
<span class="c"># - test error conditions</span>
<span class="c"># - test auth and `usenetrc`</span>


<div class="viewcode-block" id="NetworkedNNTPTestsMixin"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin">[docs]</a><span class="k">class</span> <span class="nc">NetworkedNNTPTestsMixin</span><span class="p">:</span>

<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_welcome"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_welcome">[docs]</a>    <span class="k">def</span> <span class="nf">test_welcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">welcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">getwelcome</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">welcome</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_help"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_help">[docs]</a>    <span class="k">def</span> <span class="nf">test_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">help</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;100 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_list"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">GroupInfo</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_list_active"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_list_active">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_PAT</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">GroupInfo</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_unknown_command"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_unknown_command">[docs]</a>    <span class="k">def</span> <span class="nf">test_unknown_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPPermanentError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_shortcmd</span><span class="p">(</span><span class="s">&quot;XYZZY&quot;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;500 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_newgroups"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_newgroups">[docs]</a>    <span class="k">def</span> <span class="nf">test_newgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># gmane gets a constant influx of new groups.  In order not to stress</span>
        <span class="c"># the server too much, we choose a recent date in the past.</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">newgroups</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">GroupInfo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_description"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_description">[docs]</a>    <span class="k">def</span> <span class="nf">test_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_check_desc</span><span class="p">(</span><span class="n">desc</span><span class="p">):</span>
            <span class="c"># Sanity checks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="n">_check_desc</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="c"># Another sanity check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&quot;Python&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>
        <span class="c"># With a pattern</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_PAT</span><span class="p">)</span>
        <span class="n">_check_desc</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="c"># Shouldn&#39;t exist</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="s">&quot;zk.brrtt.baz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_descriptions"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_descriptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">descs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">descriptions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_PAT</span><span class="p">)</span>
        <span class="c"># 215 for LIST NEWSGROUPS, 282 for XGTITLE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;215 &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;282 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">descs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">descs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_group"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_group">[docs]</a>    <span class="k">def</span> <span class="nf">test_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;211 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_date"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_date">[docs]</a>    <span class="k">def</span> <span class="nf">test_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
        <span class="c"># Sanity check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">1995</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">2030</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_art_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">art_dict</span><span class="p">):</span>
        <span class="c"># Some sanity checks for a field dictionary returned by OVER / XOVER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">art_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="c"># NNTP has 7 mandatory fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">art_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="p">{</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span>
             <span class="s">&quot;references&quot;</span><span class="p">,</span> <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">art_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">)))</span>

<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_xover"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_xover">[docs]</a>    <span class="k">def</span> <span class="nf">test_xover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">xover</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;no articles retrieved&quot;</span><span class="p">)</span>
        <span class="c"># The &#39;last&#39; article is not necessarily part of the output (cancelled?)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">art_dict</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_art_dict</span><span class="p">(</span><span class="n">art_dict</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_over"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_over">[docs]</a>    <span class="k">def</span> <span class="nf">test_over</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="c"># The &quot;start-&quot; article range form</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">over</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">art_dict</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_art_dict</span><span class="p">(</span><span class="n">art_dict</span><span class="p">)</span>
        <span class="c"># The &quot;start-end&quot; article range form</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">over</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">last</span><span class="p">))</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">art_dict</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># The &#39;last&#39; article is not necessarily part of the output (cancelled?)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_art_dict</span><span class="p">(</span><span class="n">art_dict</span><span class="p">)</span>
        <span class="c"># XXX The &quot;message_id&quot; form is unsupported by gmane</span>
        <span class="c"># 503 Overview by message-ID unsupported</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_xhdr"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_xhdr">[docs]</a>    <span class="k">def</span> <span class="nf">test_xhdr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">xhdr</span><span class="p">(</span><span class="s">&#39;subject&#39;</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.check_article_resp"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.check_article_resp">[docs]</a>    <span class="k">def</span> <span class="nf">check_article_resp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">article</span><span class="p">,</span> <span class="n">art_num</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">ArticleInfo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">art_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">art_num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
        <span class="c"># XXX this could exceptionally happen...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">article</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_article_head_body"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_article_head_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_article_head_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GROUP_NAME</span><span class="p">)</span>
        <span class="c"># Try to find an available article</span>
        <span class="k">for</span> <span class="n">art_num</span> <span class="ow">in</span> <span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resp</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">art_num</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;423 &quot;</span><span class="p">):</span>
                    <span class="k">raise</span>
                <span class="c"># &quot;423 No such article&quot; =&gt; choose another one</span>
                <span class="k">continue</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;could not find a suitable article number&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;221 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_article_resp</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">art_num</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="n">art_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;222 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_article_resp</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">art_num</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">article</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="n">art_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;220 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_article_resp</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">article</span><span class="p">,</span> <span class="n">art_num</span><span class="p">)</span>
        <span class="c"># Tolerate running the tests from behind a NNTP virus checker</span>
        <span class="n">blacklist</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;X-Antivirus&#39;</span><span class="p">)</span>
        <span class="n">filtered_head_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">head</span><span class="o">.</span><span class="n">lines</span>
                               <span class="k">if</span> <span class="ow">not</span> <span class="n">blacklist</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
        <span class="n">filtered_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">lines</span>
                          <span class="k">if</span> <span class="ow">not</span> <span class="n">blacklist</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">filtered_lines</span><span class="p">,</span> <span class="n">filtered_head_lines</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_capabilities"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_capabilities">[docs]</a>    <span class="k">def</span> <span class="nf">test_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The server under test implements NNTP version 2 and has a</span>
        <span class="c"># couple of well-known capabilities. Just sanity check that we</span>
        <span class="c"># got them.</span>
        <span class="k">def</span> <span class="nf">_check_caps</span><span class="p">(</span><span class="n">caps</span><span class="p">):</span>
            <span class="n">caps_list</span> <span class="o">=</span> <span class="n">caps</span><span class="p">[</span><span class="s">&#39;LIST&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">caps_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;OVERVIEW.FMT&#39;</span><span class="p">,</span> <span class="n">caps_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">nntp_version</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">_check_caps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">getcapabilities</span><span class="p">())</span>
        <span class="c"># This re-emits the command</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">caps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span>
        <span class="n">_check_caps</span><span class="p">(</span><span class="n">caps</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">ssl</span><span class="p">,</span> <span class="s">&#39;requires SSL support&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_starttls"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_starttls">[docs]</a>    <span class="k">def</span> <span class="nf">test_starttls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">file</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">sock</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPPermanentError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;STARTTLS not supported by server.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check that the socket and internal pseudo-file really were</span>
            <span class="c"># changed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">sock</span><span class="p">)</span>
            <span class="c"># Check that the new socket really is an SSL one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
            <span class="c"># Check that trying starttls when it&#39;s already active fails.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_zlogin"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_zlogin">[docs]</a>    <span class="k">def</span> <span class="nf">test_zlogin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This test must be the penultimate because further commands will be</span>
        <span class="c"># refused.</span>
        <span class="n">baduser</span> <span class="o">=</span> <span class="s">&quot;notarealuser&quot;</span>
        <span class="n">badpw</span> <span class="o">=</span> <span class="s">&quot;notarealpassword&quot;</span>
        <span class="c"># Check that bogus credentials cause failure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">,</span>
                          <span class="n">user</span><span class="o">=</span><span class="n">baduser</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">badpw</span><span class="p">,</span> <span class="n">usenetrc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># FIXME: We should check that correct credentials succeed, but that</span>
        <span class="c"># would require valid details for some server somewhere to be in the</span>
        <span class="c"># test suite, I think. Gmane is anonymous, at least as used for the</span>
        <span class="c"># other tests.</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_zzquit"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_zzquit">[docs]</a>    <span class="k">def</span> <span class="nf">test_zzquit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This test must be called last, hence the name</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.wrap_methods"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.wrap_methods">[docs]</a>    <span class="k">def</span> <span class="nf">wrap_methods</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c"># Wrap all methods in a transient_internet() exception catcher</span>
        <span class="c"># XXX put a generic version in test.support?</span>
        <span class="k">def</span> <span class="nf">wrap_meth</span><span class="p">(</span><span class="n">meth</span><span class="p">):</span>
            <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">transient_internet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NNTP_HOST</span><span class="p">):</span>
                    <span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">wrapped</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;test_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">meth</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c"># Need to use a closure so that meth remains bound to its current</span>
            <span class="c"># value</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wrap_meth</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NetworkedNNTPTestsMixin.test_with_statement"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTestsMixin.test_with_statement">[docs]</a>    <span class="k">def</span> <span class="nf">test_with_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">is_connected</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s">&#39;file&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">server</span><span class="o">.</span><span class="n">help</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">NNTP_CLASS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NNTP_HOST</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">usenetrc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_connected</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">help</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_connected</span><span class="p">())</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">NNTP_CLASS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NNTP_HOST</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">usenetrc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">server</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_connected</span><span class="p">())</span>

</div></div>
<span class="n">NetworkedNNTPTestsMixin</span><span class="o">.</span><span class="n">wrap_methods</span><span class="p">()</span>


<div class="viewcode-block" id="NetworkedNNTPTests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTests">[docs]</a><span class="k">class</span> <span class="nc">NetworkedNNTPTests</span><span class="p">(</span><span class="n">NetworkedNNTPTestsMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># This server supports STARTTLS (gmane doesn&#39;t)</span>
    <span class="n">NNTP_HOST</span> <span class="o">=</span> <span class="s">&#39;news.trigofacile.com&#39;</span>
    <span class="n">GROUP_NAME</span> <span class="o">=</span> <span class="s">&#39;fr.comp.lang.python&#39;</span>
    <span class="n">GROUP_PAT</span> <span class="o">=</span> <span class="s">&#39;fr.comp.lang.*&#39;</span>

    <span class="n">NNTP_CLASS</span> <span class="o">=</span> <span class="n">NNTP</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NetworkedNNTPTests.setUpClass"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTests.setUpClass">[docs]</a>    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">support</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s">&quot;network&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">transient_internet</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">NNTP_HOST</span><span class="p">):</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">NNTP_CLASS</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">NNTP_HOST</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">usenetrc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NetworkedNNTPTests.tearDownClass"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTPTests.tearDownClass">[docs]</a>    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</div></div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">ssl</span><span class="p">,</span> <span class="s">&#39;requires SSL support&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="NetworkedNNTP_SSLTests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NetworkedNNTP_SSLTests">[docs]</a><span class="k">class</span> <span class="nc">NetworkedNNTP_SSLTests</span><span class="p">(</span><span class="n">NetworkedNNTPTests</span><span class="p">):</span>

    <span class="c"># Technical limits for this public NNTP server (see http://www.aioe.org):</span>
    <span class="c"># &quot;Only two concurrent connections per IP address are allowed and</span>
    <span class="c"># 400 connections per day are accepted from each IP address.&quot;</span>

    <span class="n">NNTP_HOST</span> <span class="o">=</span> <span class="s">&#39;nntp.aioe.org&#39;</span>
    <span class="n">GROUP_NAME</span> <span class="o">=</span> <span class="s">&#39;comp.lang.python&#39;</span>
    <span class="n">GROUP_PAT</span> <span class="o">=</span> <span class="s">&#39;comp.lang.*&#39;</span>

    <span class="n">NNTP_CLASS</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nntplib</span><span class="p">,</span> <span class="s">&#39;NNTP_SSL&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="c"># Disabled as it produces too much data</span>
    <span class="n">test_list</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Disabled as the connection will already be encrypted.</span>
    <span class="n">test_starttls</span> <span class="o">=</span> <span class="bp">None</span>


<span class="c">#</span>
<span class="c"># Non-networked tests using a local server (or something mocking it).</span>
<span class="c">#</span>
</div>
<span class="k">class</span> <span class="nc">_NNTPServerIO</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A raw IO object allowing NNTP commands to be received and processed</span>
<span class="sd">    by a handler.  The handler can push responses which can then be read</span>
<span class="sd">    from the IO object.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># The channel from the client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="c"># The channel to the client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2c</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c2s</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">push_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Push (buffer) some data to send to the client.&quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2c</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2c</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2c</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2c</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The client sends us some data&quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2s</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2s</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">process_pending</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readinto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The client wants to read a response&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">process_pending</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2c</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">buf</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">return</span> <span class="n">n</span>


<div class="viewcode-block" id="MockedNNTPTestsMixin"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MockedNNTPTestsMixin">[docs]</a><span class="k">class</span> <span class="nc">MockedNNTPTestsMixin</span><span class="p">:</span>
    <span class="c"># Override in derived classes</span>
    <span class="n">handler_class</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="MockedNNTPTestsMixin.setUp"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MockedNNTPTestsMixin.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_server</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="MockedNNTPTestsMixin.tearDown"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MockedNNTPTestsMixin.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span>
</div>
<div class="viewcode-block" id="MockedNNTPTestsMixin.make_server"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MockedNNTPTestsMixin.make_server">[docs]</a>    <span class="k">def</span> <span class="nf">make_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler_class</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sio</span> <span class="o">=</span> <span class="n">_NNTPServerIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="p">)</span>
        <span class="c"># Using BufferedRWPair instead of BufferedRandom ensures the file</span>
        <span class="c"># isn&#39;t seekable.</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedRWPair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">_NNTPBase</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;test.server&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span>

</div></div>
<div class="viewcode-block" id="MockedNNTPWithReaderModeMixin"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MockedNNTPWithReaderModeMixin">[docs]</a><span class="k">class</span> <span class="nc">MockedNNTPWithReaderModeMixin</span><span class="p">(</span><span class="n">MockedNNTPTestsMixin</span><span class="p">):</span>
<div class="viewcode-block" id="MockedNNTPWithReaderModeMixin.setUp"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MockedNNTPWithReaderModeMixin.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_server</span><span class="p">(</span><span class="n">readermode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="NNTPv1Handler"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler">[docs]</a><span class="k">class</span> <span class="nc">NNTPv1Handler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A handler for RFC 977&quot;&quot;&quot;</span>

    <span class="n">welcome</span> <span class="o">=</span> <span class="s">&quot;200 NNTP mock server&quot;</span>

<div class="viewcode-block" id="NNTPv1Handler.start"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readline</span><span class="p">,</span> <span class="n">push_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_body</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_posting</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_readline</span> <span class="o">=</span> <span class="n">readline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_push_data</span> <span class="o">=</span> <span class="n">push_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logged_in</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_sent</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># Our welcome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_welcome</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NNTPv1Handler.process_pending"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.process_pending">[docs]</a>    <span class="k">def</span> <span class="nf">process_pending</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_body</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readline</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">meth</span><span class="p">,</span> <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_callback</span>
                <span class="n">meth</span><span class="p">(</span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body_callback</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_body</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_readline</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;line doesn&#39;t end with </span><span class="se">\\</span><span class="s">r</span><span class="se">\\</span><span class="s">n: {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">cmd</span><span class="p">,</span> <span class="o">*</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c">#meth = getattr(self.handler, &quot;handle_&quot; + cmd.upper(), None)</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;handle_&quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">meth</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_unknown</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">meth</span><span class="p">(</span><span class="o">*</span><span class="n">tokens</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;command failed: {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">e</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_body</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">body_callback</span> <span class="o">=</span> <span class="n">meth</span><span class="p">,</span> <span class="n">tokens</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.expect_body"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.expect_body">[docs]</a>    <span class="k">def</span> <span class="nf">expect_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flag that the client is expected to post a request body&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_body</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.push_data"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.push_data">[docs]</a>    <span class="k">def</span> <span class="nf">push_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Push some binary data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_push_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.push_lit"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.push_lit">[docs]</a>    <span class="k">def</span> <span class="nf">push_lit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Push a string literal&quot;&quot;&quot;</span>
        <span class="n">lit</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
        <span class="n">lit</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lit</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">lit</span> <span class="o">=</span> <span class="n">lit</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_data</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_unknown"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">handle_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;500 What?&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_welcome"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_welcome">[docs]</a>    <span class="k">def</span> <span class="nf">handle_welcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">welcome</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_QUIT"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_QUIT">[docs]</a>    <span class="k">def</span> <span class="nf">handle_QUIT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;205 Bye!&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_DATE"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_DATE">[docs]</a>    <span class="k">def</span> <span class="nf">handle_DATE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;111 20100914001155&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_GROUP"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_GROUP">[docs]</a>    <span class="k">def</span> <span class="nf">handle_GROUP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="s">&quot;fr.comp.lang.python&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;211 486 761 1265 fr.comp.lang.python&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;411 No such group {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_HELP"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_HELP">[docs]</a>    <span class="k">def</span> <span class="nf">handle_HELP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            100 Legal commands</span>
<span class="s">              authinfo user Name|pass Password|generic &lt;prog&gt; &lt;args&gt;</span>
<span class="s">              date</span>
<span class="s">              help</span>
<span class="s">            Report problems to &lt;root@example.org&gt;</span>
<span class="s">            .&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_STAT"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_STAT">[docs]</a>    <span class="k">def</span> <span class="nf">handle_STAT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_spec</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message_spec</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;412 No newsgroup selected&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;3000234&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;223 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;223 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_NEXT"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_NEXT">[docs]</a>    <span class="k">def</span> <span class="nf">handle_NEXT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;223 3000237 &lt;668929@example.org&gt; retrieved&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_LAST"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_LAST">[docs]</a>    <span class="k">def</span> <span class="nf">handle_LAST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;223 3000234 &lt;45223423@example.com&gt; retrieved&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_LIST"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_LIST">[docs]</a>    <span class="k">def</span> <span class="nf">handle_LIST</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                215 Newsgroups in form &quot;group high low flags&quot;.</span>
<span class="s">                comp.lang.python 0000052340 0000002828 y</span>
<span class="s">                comp.lang.python.announce 0000001153 0000000993 m</span>
<span class="s">                free.it.comp.lang.python 0000000002 0000000002 y</span>
<span class="s">                fr.comp.lang.python 0000001254 0000000760 y</span>
<span class="s">                free.it.comp.lang.python.learner 0000000000 0000000001 y</span>
<span class="s">                tw.bbs.comp.lang.python 0000000304 0000000304 y</span>
<span class="s">                .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;ACTIVE&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s">&quot;*distutils*&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                    215 Newsgroups in form &quot;group high low flags&quot;</span>
<span class="s">                    gmane.comp.python.distutils.devel 0000014104 0000000001 m</span>
<span class="s">                    gmane.comp.python.distutils.cvs 0000000000 0000000001 m</span>
<span class="s">                    .&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                    215 Newsgroups in form &quot;group high low flags&quot;</span>
<span class="s">                    .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;OVERVIEW.FMT&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                215 Order of fields in overview database.</span>
<span class="s">                Subject:</span>
<span class="s">                From:</span>
<span class="s">                Date:</span>
<span class="s">                Message-ID:</span>
<span class="s">                References:</span>
<span class="s">                Bytes:</span>
<span class="s">                Lines:</span>
<span class="s">                Xref:full</span>
<span class="s">                .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;NEWSGROUPS&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s">&quot;comp.lang.python&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                    215 Descriptions in form &quot;group description&quot;.</span>
<span class="s">                    comp.lang.python</span><span class="se">\t</span><span class="s">The Python computer language.</span>
<span class="s">                    .&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s">&quot;comp.lang.python*&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                    215 Descriptions in form &quot;group description&quot;.</span>
<span class="s">                    comp.lang.python.announce</span><span class="se">\t</span><span class="s">Announcements about the Python language. (Moderated)</span>
<span class="s">                    comp.lang.python</span><span class="se">\t</span><span class="s">The Python computer language.</span>
<span class="s">                    .&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                    215 Descriptions in form &quot;group description&quot;.</span>
<span class="s">                    .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;501 Unknown LIST keyword&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_NEWNEWS"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_NEWNEWS">[docs]</a>    <span class="k">def</span> <span class="nf">handle_NEWNEWS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">):</span>
        <span class="c"># We hard code different return messages depending on passed</span>
        <span class="c"># argument and date syntax.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">group</span> <span class="o">==</span> <span class="s">&quot;comp.lang.python&quot;</span> <span class="ow">and</span> <span class="n">date_str</span> <span class="o">==</span> <span class="s">&quot;20100913&quot;</span>
            <span class="ow">and</span> <span class="n">time_str</span> <span class="o">==</span> <span class="s">&quot;082004&quot;</span><span class="p">):</span>
            <span class="c"># Date was passed in RFC 3977 format (NNTP &quot;v2&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                230 list of newsarticles (NNTP v2) created after Mon Sep 13 08:20:04 2010 follows</span>
<span class="s">                &lt;a4929a40-6328-491a-aaaf-cb79ed7309a2@q2g2000vbk.googlegroups.com&gt;</span>
<span class="s">                &lt;f30c0419-f549-4218-848f-d7d0131da931@y3g2000vbm.googlegroups.com&gt;</span>
<span class="s">                .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">group</span> <span class="o">==</span> <span class="s">&quot;comp.lang.python&quot;</span> <span class="ow">and</span> <span class="n">date_str</span> <span class="o">==</span> <span class="s">&quot;100913&quot;</span>
            <span class="ow">and</span> <span class="n">time_str</span> <span class="o">==</span> <span class="s">&quot;082004&quot;</span><span class="p">):</span>
            <span class="c"># Date was passed in RFC 977 format (NNTP &quot;v1&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                230 list of newsarticles (NNTP v1) created after Mon Sep 13 08:20:04 2010 follows</span>
<span class="s">                &lt;a4929a40-6328-491a-aaaf-cb79ed7309a2@q2g2000vbk.googlegroups.com&gt;</span>
<span class="s">                &lt;f30c0419-f549-4218-848f-d7d0131da931@y3g2000vbm.googlegroups.com&gt;</span>
<span class="s">                .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">group</span> <span class="o">==</span> <span class="s">&#39;comp.lang.python&#39;</span> <span class="ow">and</span>
              <span class="n">date_str</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;20100101&#39;</span><span class="p">,</span> <span class="s">&#39;100101&#39;</span><span class="p">)</span> <span class="ow">and</span>
              <span class="n">time_str</span> <span class="o">==</span> <span class="s">&#39;090000&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;too long line&#39;</span> <span class="o">*</span> <span class="mi">3000</span> <span class="o">+</span>
                          <span class="s">&#39;</span><span class="se">\n</span><span class="s">.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                230 An empty list of newsarticles follows</span>
<span class="s">                .&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c"># (Note for experiments: many servers disable NEWNEWS.</span>
        <span class="c">#  As of this writing, sicinfo3.epfl.ch doesn&#39;t.)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_XOVER"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_XOVER">[docs]</a>    <span class="k">def</span> <span class="nf">handle_XOVER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_spec</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;57-59&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span>
                <span class="s">&quot;224 Overview information for 57-58 follows</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;57</span><span class="se">\t</span><span class="s">Re: ANN: New Plone book with strong Python (and Zope) themes throughout&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Doug Hellmann &lt;doug.hellmann-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org&gt;&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Sat, 19 Jun 2010 18:04:08 -0400&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">&lt;4FD05F05-F98B-44DC-8111-C6009C925F0C@gmail.com&gt;&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">&lt;hvalf7$ort$1@dough.gmane.org&gt;</span><span class="se">\t</span><span class="s">7103</span><span class="se">\t</span><span class="s">16&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Xref: news.gmane.org gmane.comp.python.authors:57&quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;58</span><span class="se">\t</span><span class="s">Looking for a few good bloggers&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Doug Hellmann &lt;doug.hellmann-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org&gt;&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Thu, 22 Jul 2010 09:14:14 -0400&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">&lt;A29863FA-F388-40C3-AA25-0FD06B09B5BF@gmail.com&gt;&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t\t</span><span class="s">6683</span><span class="se">\t</span><span class="s">16&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="c"># An UTF-8 overview line from fr.comp.lang.python</span>
                <span class="s">&quot;59</span><span class="se">\t</span><span class="s">Re: Message d&#39;erreur incompréhensible (par moi)&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Eric Brunel &lt;eric.brunel@pragmadev.nospam.com&gt;&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Wed, 15 Sep 2010 18:09:15 +0200&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">&lt;eric.brunel-2B8B56.18091515092010@news.wanadoo.fr&gt;&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">&lt;4c90ec87$0$32425$ba4acef3@reader.news.orange.fr&gt;</span><span class="se">\t</span><span class="s">1641</span><span class="se">\t</span><span class="s">27&quot;</span>
                    <span class="s">&quot;</span><span class="se">\t</span><span class="s">Xref: saria.nerim.net fr.comp.lang.python:1265&quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">                224 No articles</span>
<span class="s">                .&quot;&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_POST"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_POST">[docs]</a>    <span class="k">def</span> <span class="nf">handle_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_posting</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;340 Input article; end with &lt;CR-LF&gt;.&lt;CR-LF&gt;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expect_body</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;440 Posting not permitted&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_posting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;240 Article received OK&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">posted_body</span> <span class="o">=</span> <span class="n">body</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_IHAVE"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_IHAVE">[docs]</a>    <span class="k">def</span> <span class="nf">handle_IHAVE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_posting</span> <span class="ow">and</span>
                <span class="n">message_id</span> <span class="o">==</span> <span class="s">&quot;&lt;i.am.an.article.you.will.want@example.com&gt;&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;335 Send it; end with &lt;CR-LF&gt;.&lt;CR-LF&gt;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expect_body</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;435 Article not wanted&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_posting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;235 Article transferred OK&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">posted_body</span> <span class="o">=</span> <span class="n">body</span>
</div>
    <span class="n">sample_head</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: &quot;Demo User&quot; &lt;nobody@example.net&gt;</span>
<span class="s">        Subject: I am just a test article</span>
<span class="s">        Content-Type: text/plain; charset=UTF-8; format=flowed</span>
<span class="s">        Message-ID: &lt;i.am.an.article.you.will.want@example.com&gt;&quot;&quot;&quot;</span>

    <span class="n">sample_body</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        This is just a test article.</span>
<span class="s">        ..Here is a dot-starting line.</span>

<span class="s">        -- Signed by Andr</span><span class="se">\xe9</span><span class="s">.&quot;&quot;&quot;</span>

    <span class="n">sample_article</span> <span class="o">=</span> <span class="n">sample_head</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">sample_body</span>

<div class="viewcode-block" id="NNTPv1Handler.handle_ARTICLE"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_ARTICLE">[docs]</a>    <span class="k">def</span> <span class="nf">handle_ARTICLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_spec</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message_spec</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;220 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;220 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;3000234&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;220 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_article</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_HEAD"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_HEAD">[docs]</a>    <span class="k">def</span> <span class="nf">handle_HEAD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_spec</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message_spec</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;221 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;221 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;3000234&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;221 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_head</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_BODY"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_BODY">[docs]</a>    <span class="k">def</span> <span class="nf">handle_BODY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_spec</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message_spec</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;222 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;222 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message_spec</span> <span class="o">==</span> <span class="s">&quot;3000234&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;222 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1Handler.handle_AUTHINFO"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Handler.handle_AUTHINFO">[docs]</a>    <span class="k">def</span> <span class="nf">handle_AUTHINFO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cred_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logged_in</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;502 Already Logged In&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cred_type</span> <span class="o">==</span> <span class="s">&#39;user&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_sent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;482 User Credential Already Sent&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;381 Password Required&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_user_sent</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">cred_type</span> <span class="o">==</span> <span class="s">&#39;pass&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;281 Login Successful&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logged_in</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown cred type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cred_type</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="NNTPv2Handler"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv2Handler">[docs]</a><span class="k">class</span> <span class="nc">NNTPv2Handler</span><span class="p">(</span><span class="n">NNTPv1Handler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A handler for RFC 3977 (NNTP &quot;v2&quot;)&quot;&quot;&quot;</span>

<div class="viewcode-block" id="NNTPv2Handler.handle_CAPABILITIES"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv2Handler.handle_CAPABILITIES">[docs]</a>    <span class="k">def</span> <span class="nf">handle_CAPABILITIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            101 Capability list:</span>
<span class="s">            VERSION 2 3</span>
<span class="s">            IMPLEMENTATION INN 2.5.1{}</span>
<span class="s">            HDR</span>
<span class="s">            LIST ACTIVE ACTIVE.TIMES DISTRIB.PATS HEADERS NEWSGROUPS OVERVIEW.FMT</span>
<span class="s">            OVER</span>
<span class="s">            POST</span>
<span class="s">            READER</span>
<span class="s">            .&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logged_in</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">            AUTHINFO USER&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv2Handler.handle_MODE"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv2Handler.handle_MODE">[docs]</a>    <span class="k">def</span> <span class="nf">handle_MODE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;MODE READER sent despite READER has been advertised&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv2Handler.handle_OVER"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv2Handler.handle_OVER">[docs]</a>    <span class="k">def</span> <span class="nf">handle_OVER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_spec</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_XOVER</span><span class="p">(</span><span class="n">message_spec</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="CapsAfterLoginNNTPv2Handler"><a class="viewcode-back" href="../../test.html#test.test_nntplib.CapsAfterLoginNNTPv2Handler">[docs]</a><span class="k">class</span> <span class="nc">CapsAfterLoginNNTPv2Handler</span><span class="p">(</span><span class="n">NNTPv2Handler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A handler that allows CAPABILITIES only after login&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CapsAfterLoginNNTPv2Handler.handle_CAPABILITIES"><a class="viewcode-back" href="../../test.html#test.test_nntplib.CapsAfterLoginNNTPv2Handler.handle_CAPABILITIES">[docs]</a>    <span class="k">def</span> <span class="nf">handle_CAPABILITIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logged_in</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;480 You must log in.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_CAPABILITIES</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="ModeSwitchingNNTPv2Handler"><a class="viewcode-back" href="../../test.html#test.test_nntplib.ModeSwitchingNNTPv2Handler">[docs]</a><span class="k">class</span> <span class="nc">ModeSwitchingNNTPv2Handler</span><span class="p">(</span><span class="n">NNTPv2Handler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A server that starts in transit mode&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="ModeSwitchingNNTPv2Handler.handle_CAPABILITIES"><a class="viewcode-back" href="../../test.html#test.test_nntplib.ModeSwitchingNNTPv2Handler.handle_CAPABILITIES">[docs]</a>    <span class="k">def</span> <span class="nf">handle_CAPABILITIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            101 Capability list:</span>
<span class="s">            VERSION 2 3</span>
<span class="s">            IMPLEMENTATION INN 2.5.1</span>
<span class="s">            HDR</span>
<span class="s">            LIST ACTIVE ACTIVE.TIMES DISTRIB.PATS HEADERS NEWSGROUPS OVERVIEW.FMT</span>
<span class="s">            OVER</span>
<span class="s">            POST</span>
<span class="s">            {}READER</span>
<span class="s">            .&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;MODE-&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ModeSwitchingNNTPv2Handler.handle_MODE"><a class="viewcode-back" href="../../test.html#test.test_nntplib.ModeSwitchingNNTPv2Handler.handle_MODE">[docs]</a>    <span class="k">def</span> <span class="nf">handle_MODE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span> <span class="ow">and</span> <span class="n">what</span> <span class="o">==</span> <span class="s">&#39;reader&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_lit</span><span class="p">(</span><span class="s">&#39;200 Posting allowed&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin">[docs]</a><span class="k">class</span> <span class="nc">NNTPv1v2TestsMixin</span><span class="p">:</span>

<div class="viewcode-block" id="NNTPv1v2TestsMixin.setUp"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_welcome"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_welcome">[docs]</a>    <span class="k">def</span> <span class="nf">test_welcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">welcome</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">welcome</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_authinfo"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_authinfo">[docs]</a>    <span class="k">def</span> <span class="nf">test_authinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nntp_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;AUTHINFO&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_caps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;testpw&#39;</span><span class="p">)</span>
        <span class="c"># if AUTHINFO is gone from _caps we also know that getcapabilities()</span>
        <span class="c"># has been called after login as it should</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;AUTHINFO&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_caps</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_date"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_date">[docs]</a>    <span class="k">def</span> <span class="nf">test_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;111 20100914001155&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">55</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_quit"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_quit">[docs]</a>    <span class="k">def</span> <span class="nf">test_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sio</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;205 Bye!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sio</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_help"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_help">[docs]</a>    <span class="k">def</span> <span class="nf">test_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">help</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;100 Legal commands&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">help</span><span class="p">,</span> <span class="p">[</span>
            <span class="s">&#39;  authinfo user Name|pass Password|generic &lt;prog&gt; &lt;args&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;  date&#39;</span><span class="p">,</span>
            <span class="s">&#39;  help&#39;</span><span class="p">,</span>
            <span class="s">&#39;Report problems to &lt;root@example.org&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_list"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">,</span>
            <span class="n">GroupInfo</span><span class="p">(</span><span class="s">&quot;comp.lang.python.announce&quot;</span><span class="p">,</span> <span class="s">&quot;0000001153&quot;</span><span class="p">,</span>
                      <span class="s">&quot;0000000993&quot;</span><span class="p">,</span> <span class="s">&quot;m&quot;</span><span class="p">))</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="s">&quot;*distutils*&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">,</span>
            <span class="n">GroupInfo</span><span class="p">(</span><span class="s">&quot;gmane.comp.python.distutils.devel&quot;</span><span class="p">,</span> <span class="s">&quot;0000014104&quot;</span><span class="p">,</span>
                      <span class="s">&quot;0000000001&quot;</span><span class="p">,</span> <span class="s">&quot;m&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_stat"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_stat">[docs]</a>    <span class="k">def</span> <span class="nf">test_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;223 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;223 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;&lt;non.existent.id&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;412 No newsgroup selected&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_next"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_next">[docs]</a>    <span class="k">def</span> <span class="nf">test_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;223 3000237 &lt;668929@example.org&gt; retrieved&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;668929@example.org&gt;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_last"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_last">[docs]</a>    <span class="k">def</span> <span class="nf">test_last</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;223 3000234 &lt;45223423@example.com&gt; retrieved&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_description"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_description">[docs]</a>    <span class="k">def</span> <span class="nf">test_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="s">&quot;comp.lang.python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s">&quot;The Python computer language.&quot;</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="s">&quot;comp.lang.pythonx&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_descriptions"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_descriptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_descriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">descriptions</span><span class="p">(</span><span class="s">&quot;comp.lang.python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&#39;215 Descriptions in form &quot;group description&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&quot;comp.lang.python&quot;</span><span class="p">:</span> <span class="s">&quot;The Python computer language.&quot;</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">descriptions</span><span class="p">(</span><span class="s">&quot;comp.lang.python*&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&quot;comp.lang.python&quot;</span><span class="p">:</span> <span class="s">&quot;The Python computer language.&quot;</span><span class="p">,</span>
            <span class="s">&quot;comp.lang.python.announce&quot;</span><span class="p">:</span> <span class="s">&quot;Announcements about the Python language. (Moderated)&quot;</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">descriptions</span><span class="p">(</span><span class="s">&quot;comp.lang.pythonx&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="p">{})</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_group"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_group">[docs]</a>    <span class="k">def</span> <span class="nf">test_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;fr.comp.lang.python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;211 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">761</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="mi">1265</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">486</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="s">&quot;fr.comp.lang.python&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;comp.lang.python.devel&quot;</span><span class="p">)</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;411 No such group&quot;</span><span class="p">),</span>
                        <span class="n">exc</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_newnews"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_newnews">[docs]</a>    <span class="k">def</span> <span class="nf">test_newnews</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># NEWNEWS comp.lang.python [20]100913 082004</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">newnews</span><span class="p">(</span><span class="s">&quot;comp.lang.python&quot;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;230 list of newsarticles (NNTP v{0}) &quot;</span>
            <span class="s">&quot;created after Mon Sep 13 08:20:04 2010 follows&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nntp_version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="p">[</span>
            <span class="s">&quot;&lt;a4929a40-6328-491a-aaaf-cb79ed7309a2@q2g2000vbk.googlegroups.com&gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;&lt;f30c0419-f549-4218-848f-d7d0131da931@y3g2000vbm.googlegroups.com&gt;&quot;</span><span class="p">,</span>
            <span class="p">])</span>
        <span class="c"># NEWNEWS fr.comp.lang.python [20]100913 082004</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">newnews</span><span class="p">(</span><span class="s">&quot;fr.comp.lang.python&quot;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;230 An empty list of newsarticles follows&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="p">[])</span>
</div>
    <span class="k">def</span> <span class="nf">_check_article_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s">&quot;-- Signed by André.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">b</span><span class="s">&quot;.Here is a dot-starting line.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">b</span><span class="s">&quot;This is just a test article.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_article_head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;From: &quot;Demo User&quot; &lt;nobody@example.net&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">b</span><span class="s">&quot;Message-ID: &lt;i.am.an.article.you.will.want@example.com&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_article_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_head</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_body</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_article"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_article">[docs]</a>    <span class="k">def</span> <span class="nf">test_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># ARTICLE</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;220 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_data</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># ARTICLE num</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;220 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_data</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># ARTICLE id</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;220 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_data</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># Non-existent id</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="s">&quot;&lt;non-existent@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_article_file"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_article_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_article_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># With a &quot;file&quot; argument</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;220 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;From: &quot;Demo User&quot; &lt;nobody@example.net&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;Subject: I am just a test article</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="p">),</span> <span class="n">ascii</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;This is just a test article.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;.Here is a dot-starting line.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;-- Signed by Andr</span><span class="se">\xc3\xa9</span><span class="s">.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="p">),</span> <span class="n">ascii</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_head"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_head">[docs]</a>    <span class="k">def</span> <span class="nf">test_head</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># HEAD</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;221 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_head</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># HEAD num</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;221 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_head</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># HEAD id</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;221 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_head</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># Non-existent id</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s">&quot;&lt;non-existent@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_head_file"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_head_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_head_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;221 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;From: &quot;Demo User&quot; &lt;nobody@example.net&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;Subject: I am just a test article</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="p">),</span> <span class="n">ascii</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;This is just a test article.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;.Here is a dot-starting line.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;-- Signed by Andr</span><span class="se">\xc3\xa9</span><span class="s">.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="p">),</span> <span class="n">ascii</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_body"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># BODY</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;222 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># BODY num</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;222 3000234 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># BODY id</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;222 0 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_article_body</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="c"># Non-existent id</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;&lt;non-existent@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;430 No Such Article Found&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_body_file"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_body_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_body_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">&quot;222 3000237 &lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000237</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message_id</span><span class="p">,</span> <span class="s">&quot;&lt;45223423@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;From: &quot;Demo User&quot; &lt;nobody@example.net&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;Subject: I am just a test article</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="p">),</span> <span class="n">ascii</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&#39;This is just a test article.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;.Here is a dot-starting line.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="n">b</span><span class="s">&#39;-- Signed by Andr</span><span class="se">\xc3\xa9</span><span class="s">.</span><span class="se">\r\n</span><span class="s">&#39;</span>
            <span class="p">),</span> <span class="n">ascii</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.check_over_xover_resp"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.check_over_xover_resp">[docs]</a>    <span class="k">def</span> <span class="nf">check_over_xover_resp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">overviews</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;224 &quot;</span><span class="p">),</span> <span class="n">resp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">overviews</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">over</span> <span class="o">=</span> <span class="n">overviews</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">57</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">over</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&quot;from&quot;</span><span class="p">:</span> <span class="s">&quot;Doug Hellmann &lt;doug.hellmann-Re5JQEeQqe8AvxtiuMwx3w@public.gmane.org&gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;subject&quot;</span><span class="p">:</span> <span class="s">&quot;Re: ANN: New Plone book with strong Python (and Zope) themes throughout&quot;</span><span class="p">,</span>
            <span class="s">&quot;date&quot;</span><span class="p">:</span> <span class="s">&quot;Sat, 19 Jun 2010 18:04:08 -0400&quot;</span><span class="p">,</span>
            <span class="s">&quot;message-id&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;4FD05F05-F98B-44DC-8111-C6009C925F0C@gmail.com&gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;references&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;hvalf7$ort$1@dough.gmane.org&gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;:bytes&quot;</span><span class="p">:</span> <span class="s">&quot;7103&quot;</span><span class="p">,</span>
            <span class="s">&quot;:lines&quot;</span><span class="p">:</span> <span class="s">&quot;16&quot;</span><span class="p">,</span>
            <span class="s">&quot;xref&quot;</span><span class="p">:</span> <span class="s">&quot;news.gmane.org gmane.comp.python.authors:57&quot;</span>
            <span class="p">})</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">over</span> <span class="o">=</span> <span class="n">overviews</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">over</span><span class="p">[</span><span class="s">&quot;xref&quot;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">art_num</span><span class="p">,</span> <span class="n">over</span> <span class="o">=</span> <span class="n">overviews</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">over</span><span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">],</span>
                         <span class="s">&quot;Re: Message d&#39;erreur incompréhensible (par moi)&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_xover"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_xover">[docs]</a>    <span class="k">def</span> <span class="nf">test_xover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">overviews</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">xover</span><span class="p">(</span><span class="mi">57</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_over_xover_resp</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">overviews</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_over"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_over">[docs]</a>    <span class="k">def</span> <span class="nf">test_over</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># In NNTP &quot;v1&quot;, this will fallback on XOVER</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">overviews</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">over</span><span class="p">((</span><span class="mi">57</span><span class="p">,</span> <span class="mi">59</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_over_xover_resp</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">overviews</span><span class="p">)</span>
</div>
    <span class="n">sample_post</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b</span><span class="s">&#39;From: &quot;Demo User&quot; &lt;nobody@example.net&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;Subject: I am just a test article</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;Content-Type: text/plain; charset=UTF-8; format=flowed</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;Message-ID: &lt;i.am.an.article.you.will.want@example.com&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;This is just a test article.</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;.Here is a dot-starting line.</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span>
        <span class="n">b</span><span class="s">&#39;-- Signed by Andr</span><span class="se">\xc3\xa9</span><span class="s">.</span><span class="se">\r\n</span><span class="s">&#39;</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_posted_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check the raw body as received by the server</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">posted_body</span>
        <span class="c"># One additional line for the &quot;.&quot; terminator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;.</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;-- Signed by Andr</span><span class="se">\xc3\xa9</span><span class="s">.</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;..Here is a dot-starting line.</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="s">&#39;From: &quot;Demo User&quot; &lt;nobody@example.net&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_post_ihave_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file_factory</span><span class="p">):</span>
        <span class="c"># First the prepared post with CRLF endings</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_post</span>
        <span class="n">func_args</span> <span class="o">=</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="n">file_factory</span><span class="p">(</span><span class="n">post</span><span class="p">),)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">posted_body</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">func_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_posted_body</span><span class="p">()</span>
        <span class="c"># Then the same post with &quot;normal&quot; line endings - they should be</span>
        <span class="c"># converted by NNTP.post and NNTP.ihave.</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_post</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">func_args</span> <span class="o">=</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="n">file_factory</span><span class="p">(</span><span class="n">post</span><span class="p">),)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">posted_body</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">func_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_posted_body</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resp</span>

<div class="viewcode-block" id="NNTPv1v2TestsMixin.check_post_ihave"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.check_post_ihave">[docs]</a>    <span class="k">def</span> <span class="nf">check_post_ihave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">success_resp</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># With a bytes object</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_post_ihave_sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file_factory</span><span class="o">=</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">success_resp</span><span class="p">)</span>
        <span class="c"># With a bytearray object</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_post_ihave_sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file_factory</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">success_resp</span><span class="p">)</span>
        <span class="c"># With a file object</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_post_ihave_sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file_factory</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">success_resp</span><span class="p">)</span>
        <span class="c"># With an iterable of terminated lines</span>
        <span class="k">def</span> <span class="nf">iterlines</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_post_ihave_sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file_factory</span><span class="o">=</span><span class="n">iterlines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">success_resp</span><span class="p">)</span>
        <span class="c"># With an iterable of non-terminated lines</span>
        <span class="k">def</span> <span class="nf">iterlines</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_post_ihave_sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file_factory</span><span class="o">=</span><span class="n">iterlines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">success_resp</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_post"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_post">[docs]</a>    <span class="k">def</span> <span class="nf">test_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_post_ihave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">post</span><span class="p">,</span> <span class="s">&quot;240 Article received OK&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">allow_posting</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_post</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
                         <span class="s">&quot;440 Posting not permitted&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_ihave"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_ihave">[docs]</a>    <span class="k">def</span> <span class="nf">test_ihave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_post_ihave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">ihave</span><span class="p">,</span> <span class="s">&quot;235 Article transferred OK&quot;</span><span class="p">,</span>
                              <span class="s">&quot;&lt;i.am.an.article.you.will.want@example.com&gt;&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPTemporaryError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">ihave</span><span class="p">(</span><span class="s">&quot;&lt;another.message.id&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_post</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
                         <span class="s">&quot;435 Article not wanted&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NNTPv1v2TestsMixin.test_too_long_lines"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1v2TestsMixin.test_too_long_lines">[docs]</a>    <span class="k">def</span> <span class="nf">test_too_long_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">NNTPDataError</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">newnews</span><span class="p">,</span> <span class="s">&quot;comp.lang.python&quot;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="NNTPv1Tests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Tests">[docs]</a><span class="k">class</span> <span class="nc">NNTPv1Tests</span><span class="p">(</span><span class="n">NNTPv1v2TestsMixin</span><span class="p">,</span> <span class="n">MockedNNTPTestsMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests an NNTP v1 server (no capabilities).&quot;&quot;&quot;</span>

    <span class="n">nntp_version</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">handler_class</span> <span class="o">=</span> <span class="n">NNTPv1Handler</span>

<div class="viewcode-block" id="NNTPv1Tests.test_caps"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv1Tests.test_caps">[docs]</a>    <span class="k">def</span> <span class="nf">test_caps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">caps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">getcapabilities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">caps</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">nntp_version</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">nntp_implementation</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="NNTPv2Tests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv2Tests">[docs]</a><span class="k">class</span> <span class="nc">NNTPv2Tests</span><span class="p">(</span><span class="n">NNTPv1v2TestsMixin</span><span class="p">,</span> <span class="n">MockedNNTPTestsMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests an NNTP v2 server (with capabilities).&quot;&quot;&quot;</span>

    <span class="n">nntp_version</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">handler_class</span> <span class="o">=</span> <span class="n">NNTPv2Handler</span>

<div class="viewcode-block" id="NNTPv2Tests.test_caps"><a class="viewcode-back" href="../../test.html#test.test_nntplib.NNTPv2Tests.test_caps">[docs]</a>    <span class="k">def</span> <span class="nf">test_caps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">caps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">getcapabilities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">caps</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;VERSION&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">],</span>
            <span class="s">&#39;IMPLEMENTATION&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;INN&#39;</span><span class="p">,</span> <span class="s">&#39;2.5.1&#39;</span><span class="p">],</span>
            <span class="s">&#39;AUTHINFO&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;USER&#39;</span><span class="p">],</span>
            <span class="s">&#39;HDR&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">&#39;LIST&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;ACTIVE&#39;</span><span class="p">,</span> <span class="s">&#39;ACTIVE.TIMES&#39;</span><span class="p">,</span> <span class="s">&#39;DISTRIB.PATS&#39;</span><span class="p">,</span>
                     <span class="s">&#39;HEADERS&#39;</span><span class="p">,</span> <span class="s">&#39;NEWSGROUPS&#39;</span><span class="p">,</span> <span class="s">&#39;OVERVIEW.FMT&#39;</span><span class="p">],</span>
            <span class="s">&#39;OVER&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">&#39;POST&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">&#39;READER&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">nntp_version</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">nntp_implementation</span><span class="p">,</span> <span class="s">&#39;INN 2.5.1&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="CapsAfterLoginNNTPv2Tests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.CapsAfterLoginNNTPv2Tests">[docs]</a><span class="k">class</span> <span class="nc">CapsAfterLoginNNTPv2Tests</span><span class="p">(</span><span class="n">MockedNNTPTestsMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests a probably NNTP v2 server with capabilities only after login.&quot;&quot;&quot;</span>

    <span class="n">nntp_version</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">handler_class</span> <span class="o">=</span> <span class="n">CapsAfterLoginNNTPv2Handler</span>

<div class="viewcode-block" id="CapsAfterLoginNNTPv2Tests.test_caps_only_after_login"><a class="viewcode-back" href="../../test.html#test.test_nntplib.CapsAfterLoginNNTPv2Tests.test_caps_only_after_login">[docs]</a>    <span class="k">def</span> <span class="nf">test_caps_only_after_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_caps</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;testpw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;VERSION&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_caps</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SendReaderNNTPv2Tests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.SendReaderNNTPv2Tests">[docs]</a><span class="k">class</span> <span class="nc">SendReaderNNTPv2Tests</span><span class="p">(</span><span class="n">MockedNNTPWithReaderModeMixin</span><span class="p">,</span>
        <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same tests as for v2 but we tell NTTP to send MODE READER to a server</span>
<span class="sd">    that isn&#39;t in READER mode by default.&quot;&quot;&quot;</span>

    <span class="n">nntp_version</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">handler_class</span> <span class="o">=</span> <span class="n">ModeSwitchingNNTPv2Handler</span>

<div class="viewcode-block" id="SendReaderNNTPv2Tests.test_we_are_in_reader_mode_after_connect"><a class="viewcode-back" href="../../test.html#test.test_nntplib.SendReaderNNTPv2Tests.test_we_are_in_reader_mode_after_connect">[docs]</a>    <span class="k">def</span> <span class="nf">test_we_are_in_reader_mode_after_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;READER&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_caps</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="MiscTests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests">[docs]</a><span class="k">class</span> <span class="nc">MiscTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="MiscTests.test_decode_header"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_decode_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">gives</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;a plain header&quot;</span><span class="p">,</span> <span class="s">&quot;a plain header&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot; with extra  spaces &quot;</span><span class="p">,</span> <span class="s">&quot; with extra  spaces &quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;=?ISO-8859-15?Q?D=E9buter_en_Python?=&quot;</span><span class="p">,</span> <span class="s">&quot;Débuter en Python&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;=?utf-8?q?Re=3A_=5Bsqlite=5D_probl=C3=A8me_avec_ORDER_BY_sur_des_cha?=&quot;</span>
              <span class="s">&quot; =?utf-8?q?=C3=AEnes_de_caract=C3=A8res_accentu=C3=A9es?=&quot;</span><span class="p">,</span>
              <span class="s">&quot;Re: [sqlite] problème avec ORDER BY sur des chaînes de caractères accentuées&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;Re: =?UTF-8?B?cHJvYmzDqG1lIGRlIG1hdHJpY2U=?=&quot;</span><span class="p">,</span>
              <span class="s">&quot;Re: problème de matrice&quot;</span><span class="p">)</span>
        <span class="c"># A natively utf-8 header (found in the real world!)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;Re: Message d&#39;erreur incompréhensible (par moi)&quot;</span><span class="p">,</span>
              <span class="s">&quot;Re: Message d&#39;erreur incompréhensible (par moi)&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTests.test_parse_overview_fmt"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_parse_overview_fmt">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_overview_fmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The minimal (default) response</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Subject:&quot;</span><span class="p">,</span> <span class="s">&quot;From:&quot;</span><span class="p">,</span> <span class="s">&quot;Date:&quot;</span><span class="p">,</span> <span class="s">&quot;Message-ID:&quot;</span><span class="p">,</span>
                 <span class="s">&quot;References:&quot;</span><span class="p">,</span> <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview_fmt</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
            <span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span> <span class="s">&quot;references&quot;</span><span class="p">,</span>
             <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">])</span>
        <span class="c"># The minimal response using alternative names</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Subject:&quot;</span><span class="p">,</span> <span class="s">&quot;From:&quot;</span><span class="p">,</span> <span class="s">&quot;Date:&quot;</span><span class="p">,</span> <span class="s">&quot;Message-ID:&quot;</span><span class="p">,</span>
                 <span class="s">&quot;References:&quot;</span><span class="p">,</span> <span class="s">&quot;Bytes:&quot;</span><span class="p">,</span> <span class="s">&quot;Lines:&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview_fmt</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
            <span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span> <span class="s">&quot;references&quot;</span><span class="p">,</span>
             <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">])</span>
        <span class="c"># Variations in casing</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;subject:&quot;</span><span class="p">,</span> <span class="s">&quot;FROM:&quot;</span><span class="p">,</span> <span class="s">&quot;DaTe:&quot;</span><span class="p">,</span> <span class="s">&quot;message-ID:&quot;</span><span class="p">,</span>
                 <span class="s">&quot;References:&quot;</span><span class="p">,</span> <span class="s">&quot;BYTES:&quot;</span><span class="p">,</span> <span class="s">&quot;Lines:&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview_fmt</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
            <span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span> <span class="s">&quot;references&quot;</span><span class="p">,</span>
             <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">])</span>
        <span class="c"># First example from RFC 3977</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Subject:&quot;</span><span class="p">,</span> <span class="s">&quot;From:&quot;</span><span class="p">,</span> <span class="s">&quot;Date:&quot;</span><span class="p">,</span> <span class="s">&quot;Message-ID:&quot;</span><span class="p">,</span>
                 <span class="s">&quot;References:&quot;</span><span class="p">,</span> <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">,</span> <span class="s">&quot;Xref:full&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Distribution:full&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview_fmt</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
            <span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span> <span class="s">&quot;references&quot;</span><span class="p">,</span>
             <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">,</span> <span class="s">&quot;xref&quot;</span><span class="p">,</span> <span class="s">&quot;distribution&quot;</span><span class="p">])</span>
        <span class="c"># Second example from RFC 3977</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Subject:&quot;</span><span class="p">,</span> <span class="s">&quot;From:&quot;</span><span class="p">,</span> <span class="s">&quot;Date:&quot;</span><span class="p">,</span> <span class="s">&quot;Message-ID:&quot;</span><span class="p">,</span>
                 <span class="s">&quot;References:&quot;</span><span class="p">,</span> <span class="s">&quot;Bytes:&quot;</span><span class="p">,</span> <span class="s">&quot;Lines:&quot;</span><span class="p">,</span> <span class="s">&quot;Xref:FULL&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Distribution:FULL&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview_fmt</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
            <span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span> <span class="s">&quot;references&quot;</span><span class="p">,</span>
             <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">,</span> <span class="s">&quot;xref&quot;</span><span class="p">,</span> <span class="s">&quot;distribution&quot;</span><span class="p">])</span>
        <span class="c"># A classic response from INN</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Subject:&quot;</span><span class="p">,</span> <span class="s">&quot;From:&quot;</span><span class="p">,</span> <span class="s">&quot;Date:&quot;</span><span class="p">,</span> <span class="s">&quot;Message-ID:&quot;</span><span class="p">,</span>
                 <span class="s">&quot;References:&quot;</span><span class="p">,</span> <span class="s">&quot;Bytes:&quot;</span><span class="p">,</span> <span class="s">&quot;Lines:&quot;</span><span class="p">,</span> <span class="s">&quot;Xref:full&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview_fmt</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
            <span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">,</span> <span class="s">&quot;from&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="s">&quot;message-id&quot;</span><span class="p">,</span> <span class="s">&quot;references&quot;</span><span class="p">,</span>
             <span class="s">&quot;:bytes&quot;</span><span class="p">,</span> <span class="s">&quot;:lines&quot;</span><span class="p">,</span> <span class="s">&quot;xref&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="MiscTests.test_parse_overview"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_parse_overview">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">_DEFAULT_OVERVIEW_FMT</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;xref&quot;</span><span class="p">]</span>
        <span class="c"># First example from RFC 3977</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;3000234</span><span class="se">\t</span><span class="s">I am just a test article</span><span class="se">\t</span><span class="s">&quot;Demo User&quot; &#39;</span>
            <span class="s">&#39;&lt;nobody@example.com&gt;</span><span class="se">\t</span><span class="s">6 Oct 1998 04:38:40 -0500</span><span class="se">\t</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;45223423@example.com&gt;</span><span class="se">\t</span><span class="s">&lt;45454@example.net&gt;</span><span class="se">\t</span><span class="s">1234</span><span class="se">\t</span><span class="s">&#39;</span>
            <span class="s">&#39;17</span><span class="se">\t</span><span class="s">Xref: news.example.com misc.test:3000363&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">overview</span> <span class="o">=</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">fields</span><span class="p">),</span> <span class="o">=</span> <span class="n">overview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="mi">3000234</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;subject&#39;</span><span class="p">:</span> <span class="s">&#39;I am just a test article&#39;</span><span class="p">,</span>
            <span class="s">&#39;from&#39;</span><span class="p">:</span> <span class="s">&#39;&quot;Demo User&quot; &lt;nobody@example.com&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;6 Oct 1998 04:38:40 -0500&#39;</span><span class="p">,</span>
            <span class="s">&#39;message-id&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;45223423@example.com&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;references&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;45454@example.net&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;:bytes&#39;</span><span class="p">:</span> <span class="s">&#39;1234&#39;</span><span class="p">,</span>
            <span class="s">&#39;:lines&#39;</span><span class="p">:</span> <span class="s">&#39;17&#39;</span><span class="p">,</span>
            <span class="s">&#39;xref&#39;</span><span class="p">:</span> <span class="s">&#39;news.example.com misc.test:3000363&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="c"># Second example; here the &quot;Xref&quot; field is totally absent (including</span>
        <span class="c"># the header name) and comes out as None</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;3000234</span><span class="se">\t</span><span class="s">I am just a test article</span><span class="se">\t</span><span class="s">&quot;Demo User&quot; &#39;</span>
            <span class="s">&#39;&lt;nobody@example.com&gt;</span><span class="se">\t</span><span class="s">6 Oct 1998 04:38:40 -0500</span><span class="se">\t</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;45223423@example.com&gt;</span><span class="se">\t</span><span class="s">&lt;45454@example.net&gt;</span><span class="se">\t</span><span class="s">1234</span><span class="se">\t</span><span class="s">&#39;</span>
            <span class="s">&#39;17</span><span class="se">\t\t</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">overview</span> <span class="o">=</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">fields</span><span class="p">),</span> <span class="o">=</span> <span class="n">overview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;xref&#39;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
        <span class="c"># Third example; the &quot;Xref&quot; is an empty string, while &quot;references&quot;</span>
        <span class="c"># is a single space.</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;3000234</span><span class="se">\t</span><span class="s">I am just a test article</span><span class="se">\t</span><span class="s">&quot;Demo User&quot; &#39;</span>
            <span class="s">&#39;&lt;nobody@example.com&gt;</span><span class="se">\t</span><span class="s">6 Oct 1998 04:38:40 -0500</span><span class="se">\t</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;45223423@example.com&gt;</span><span class="se">\t</span><span class="s"> </span><span class="se">\t</span><span class="s">1234</span><span class="se">\t</span><span class="s">&#39;</span>
            <span class="s">&#39;17</span><span class="se">\t</span><span class="s">Xref: </span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">overview</span> <span class="o">=</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_overview</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="p">(</span><span class="n">art_num</span><span class="p">,</span> <span class="n">fields</span><span class="p">),</span> <span class="o">=</span> <span class="n">overview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;references&#39;</span><span class="p">],</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;xref&#39;</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTests.test_parse_datetime"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_parse_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">gives</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_parse_datetime</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
        <span class="c"># Output of DATE command</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;19990623135624&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
        <span class="c"># Variations</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;19990623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">,</span> <span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;990623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">,</span> <span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="s">&quot;090623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">,</span> <span class="mi">2009</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTests.test_unparse_datetime"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_unparse_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">test_unparse_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test non-legacy mode</span>
        <span class="c"># 1) with a datetime</span>
        <span class="k">def</span> <span class="nf">gives</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_unparse_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_unparse_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">))</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&quot;19990623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&quot;20000623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;20100605&quot;</span><span class="p">,</span> <span class="s">&quot;010203&quot;</span><span class="p">)</span>
        <span class="c"># 2) with a date</span>
        <span class="k">def</span> <span class="nf">gives</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_unparse_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_unparse_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">))</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&quot;19990623&quot;</span><span class="p">,</span> <span class="s">&quot;000000&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&quot;20000623&quot;</span><span class="p">,</span> <span class="s">&quot;000000&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;20100605&quot;</span><span class="p">,</span> <span class="s">&quot;000000&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiscTests.test_unparse_datetime_legacy"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_unparse_datetime_legacy">[docs]</a>    <span class="k">def</span> <span class="nf">test_unparse_datetime_legacy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test legacy mode (RFC 977)</span>
        <span class="c"># 1) with a datetime</span>
        <span class="k">def</span> <span class="nf">gives</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_unparse_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">))</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&quot;990623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&quot;000623&quot;</span><span class="p">,</span> <span class="s">&quot;135624&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;100605&quot;</span><span class="p">,</span> <span class="s">&quot;010203&quot;</span><span class="p">)</span>
        <span class="c"># 2) with a date</span>
        <span class="k">def</span> <span class="nf">gives</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">_unparse_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">time_str</span><span class="p">))</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">1999</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&quot;990623&quot;</span><span class="p">,</span> <span class="s">&quot;000000&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s">&quot;000623&quot;</span><span class="p">,</span> <span class="s">&quot;000000&quot;</span><span class="p">)</span>
        <span class="n">gives</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;100605&quot;</span><span class="p">,</span> <span class="s">&quot;000000&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">ssl</span><span class="p">,</span> <span class="s">&#39;requires SSL support&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="MiscTests.test_ssl_support"><a class="viewcode-back" href="../../test.html#test.test_nntplib.MiscTests.test_ssl_support">[docs]</a>    <span class="k">def</span> <span class="nf">test_ssl_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">nntplib</span><span class="p">,</span> <span class="s">&#39;NNTP_SSL&#39;</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="PublicAPITests"><a class="viewcode-back" href="../../test.html#test.test_nntplib.PublicAPITests">[docs]</a><span class="k">class</span> <span class="nc">PublicAPITests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that the correct values are exposed in the public API.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PublicAPITests.test_module_all_attribute"><a class="viewcode-back" href="../../test.html#test.test_nntplib.PublicAPITests.test_module_all_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_module_all_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">nntplib</span><span class="p">,</span> <span class="s">&#39;__all__&#39;</span><span class="p">))</span>
        <span class="n">target_api</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;NNTP&#39;</span><span class="p">,</span> <span class="s">&#39;NNTPError&#39;</span><span class="p">,</span> <span class="s">&#39;NNTPReplyError&#39;</span><span class="p">,</span>
                      <span class="s">&#39;NNTPTemporaryError&#39;</span><span class="p">,</span> <span class="s">&#39;NNTPPermanentError&#39;</span><span class="p">,</span>
                      <span class="s">&#39;NNTPProtocolError&#39;</span><span class="p">,</span> <span class="s">&#39;NNTPDataError&#39;</span><span class="p">,</span> <span class="s">&#39;decode_header&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ssl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">target_api</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;NNTP_SSL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nntplib</span><span class="o">.</span><span class="n">__all__</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">target_api</span><span class="p">))</span>
</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>