

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_codeccallbacks &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_codeccallbacks</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_codeccallbacks</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">html.entities</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">test.support</span>
<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ctypes</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ctypes</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">SIZEOF_WCHAR_T</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">SIZEOF_WCHAR_T</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar</span><span class="p">)</span>

<div class="viewcode-block" id="PosReturn"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.PosReturn">[docs]</a><span class="k">class</span> <span class="nc">PosReturn</span><span class="p">:</span>
    <span class="c"># this can be used for configurable callbacks</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="PosReturn.handle"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.PosReturn.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
        <span class="n">oldpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">realpos</span> <span class="o">=</span> <span class="n">oldpos</span>
        <span class="k">if</span> <span class="n">realpos</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">realpos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">)</span> <span class="o">+</span> <span class="n">realpos</span>
        <span class="c"># if we don&#39;t advance this time, terminate on the next call</span>
        <span class="c"># otherwise we&#39;d get an endless loop</span>
        <span class="k">if</span> <span class="n">realpos</span> <span class="o">&lt;=</span> <span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&quot;&lt;?&gt;&quot;</span><span class="p">,</span> <span class="n">oldpos</span><span class="p">)</span>

<span class="c"># A UnicodeEncodeError object with a bad start attribute</span></div></div>
<div class="viewcode-block" id="BadStartUnicodeEncodeError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.BadStartUnicodeEncodeError">[docs]</a><span class="k">class</span> <span class="nc">BadStartUnicodeEncodeError</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeEncodeError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># A UnicodeEncodeError object with a bad object attribute</span></div>
<div class="viewcode-block" id="BadObjectUnicodeEncodeError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.BadObjectUnicodeEncodeError">[docs]</a><span class="k">class</span> <span class="nc">BadObjectUnicodeEncodeError</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeEncodeError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># A UnicodeDecodeError object without an end attribute</span></div>
<div class="viewcode-block" id="NoEndUnicodeDecodeError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.NoEndUnicodeDecodeError">[docs]</a><span class="k">class</span> <span class="nc">NoEndUnicodeDecodeError</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeDecodeError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>

<span class="c"># A UnicodeDecodeError object with a bad object attribute</span></div>
<div class="viewcode-block" id="BadObjectUnicodeDecodeError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.BadObjectUnicodeDecodeError">[docs]</a><span class="k">class</span> <span class="nc">BadObjectUnicodeDecodeError</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeDecodeError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># A UnicodeTranslateError object without a start attribute</span></div>
<div class="viewcode-block" id="NoStartUnicodeTranslateError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.NoStartUnicodeTranslateError">[docs]</a><span class="k">class</span> <span class="nc">NoStartUnicodeTranslateError</span><span class="p">(</span><span class="ne">UnicodeTranslateError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeTranslateError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>

<span class="c"># A UnicodeTranslateError object without an end attribute</span></div>
<div class="viewcode-block" id="NoEndUnicodeTranslateError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.NoEndUnicodeTranslateError">[docs]</a><span class="k">class</span> <span class="nc">NoEndUnicodeTranslateError</span><span class="p">(</span><span class="ne">UnicodeTranslateError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeTranslateError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>

<span class="c"># A UnicodeTranslateError object without an object attribute</span></div>
<div class="viewcode-block" id="NoObjectUnicodeTranslateError"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.NoObjectUnicodeTranslateError">[docs]</a><span class="k">class</span> <span class="nc">NoObjectUnicodeTranslateError</span><span class="p">(</span><span class="ne">UnicodeTranslateError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="ne">UnicodeTranslateError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bad&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest">[docs]</a><span class="k">class</span> <span class="nc">CodecCallbackTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="CodecCallbackTest.test_xmlcharrefreplace"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_xmlcharrefreplace">[docs]</a>    <span class="k">def</span> <span class="nf">test_xmlcharrefreplace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># replace unencodable characters which numeric character entities.</span>
        <span class="c"># For ascii, latin-1 and charmaps this is completely implemented</span>
        <span class="c"># in C and should be reasonably fast.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\u30b9\u30d1\u30e2</span><span class="s"> </span><span class="se">\xe4</span><span class="s">nd eggs&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">),</span>
            <span class="n">b</span><span class="s">&quot;&amp;#12473;&amp;#12497;&amp;#12514; &amp;#228;nd eggs&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">),</span>
            <span class="n">b</span><span class="s">&quot;&amp;#12473;&amp;#12497;&amp;#12514; </span><span class="se">\xe4</span><span class="s">nd eggs&quot;</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_xmlcharnamereplace"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_xmlcharnamereplace">[docs]</a>    <span class="k">def</span> <span class="nf">test_xmlcharnamereplace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This time use a named character entity for unencodable</span>
        <span class="c"># characters, if one is available.</span>

        <span class="k">def</span> <span class="nf">xmlcharnamereplace</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeEncodeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&amp;</span><span class="si">%s</span><span class="s">;&quot;</span> <span class="o">%</span> <span class="n">html</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">codepoint2name</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&amp;#</span><span class="si">%d</span><span class="s">;&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>

        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span>
            <span class="s">&quot;test.xmlcharnamereplace&quot;</span><span class="p">,</span> <span class="n">xmlcharnamereplace</span><span class="p">)</span>

        <span class="n">sin</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xab\u211c\xbb</span><span class="s"> = </span><span class="se">\u2329\u1234\u20ac\u232a</span><span class="s">&quot;</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&amp;laquo;&amp;real;&amp;raquo; = &amp;lang;&amp;#4660;&amp;euro;&amp;rang;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.xmlcharnamereplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xab</span><span class="s">&amp;real;</span><span class="se">\xbb</span><span class="s"> = &amp;lang;&amp;#4660;&amp;euro;&amp;rang;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;test.xmlcharnamereplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xab</span><span class="s">&amp;real;</span><span class="se">\xbb</span><span class="s"> = &amp;lang;&amp;#4660;</span><span class="se">\xa4</span><span class="s">&amp;rang;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;iso-8859-15&quot;</span><span class="p">,</span> <span class="s">&quot;test.xmlcharnamereplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_uninamereplace"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_uninamereplace">[docs]</a>    <span class="k">def</span> <span class="nf">test_uninamereplace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># We&#39;re using the names from the unicode database this time,</span>
        <span class="c"># and we&#39;re doing &quot;syntax highlighting&quot; here, i.e. we include</span>
        <span class="c"># the replaced text in ANSI escape sequences. For this it is</span>
        <span class="c"># useful that the error handler is not called for every single</span>
        <span class="c"># unencodable character, but for a complete sequence of</span>
        <span class="c"># unencodable characters, otherwise we would output many</span>
        <span class="c"># unnecessary escape sequences.</span>

        <span class="k">def</span> <span class="nf">uninamereplace</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeEncodeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">]:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;0x</span><span class="si">%x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\033</span><span class="s">[1m</span><span class="si">%s</span><span class="se">\033</span><span class="s">[0m&quot;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>

        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span>
            <span class="s">&quot;test.uninamereplace&quot;</span><span class="p">,</span> <span class="n">uninamereplace</span><span class="p">)</span>

        <span class="n">sin</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xac\u1234\u20ac\u8000</span><span class="s">&quot;</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\033</span><span class="s">[1mNOT SIGN, ETHIOPIC SYLLABLE SEE, EURO SIGN, CJK UNIFIED IDEOGRAPH-8000</span><span class="se">\033</span><span class="s">[0m&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.uninamereplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>

        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xac\033</span><span class="s">[1mETHIOPIC SYLLABLE SEE, EURO SIGN, CJK UNIFIED IDEOGRAPH-8000</span><span class="se">\033</span><span class="s">[0m&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;test.uninamereplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>

        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xac\033</span><span class="s">[1mETHIOPIC SYLLABLE SEE</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\xa4\033</span><span class="s">[1mCJK UNIFIED IDEOGRAPH-8000</span><span class="se">\033</span><span class="s">[0m&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;iso-8859-15&quot;</span><span class="p">,</span> <span class="s">&quot;test.uninamereplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_backslashescape"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_backslashescape">[docs]</a>    <span class="k">def</span> <span class="nf">test_backslashescape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Does the same as the &quot;unicode-escape&quot; encoding, but with different</span>
        <span class="c"># base encodings.</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="s">&quot;a</span><span class="se">\xac\u1234\u20ac\u8000\U0010ffff</span><span class="s">&quot;</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;a</span><span class="se">\\</span><span class="s">xac</span><span class="se">\\</span><span class="s">u1234</span><span class="se">\\</span><span class="s">u20ac</span><span class="se">\\</span><span class="s">u8000</span><span class="se">\\</span><span class="s">U0010ffff&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;backslashreplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>

        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;a</span><span class="se">\xac\\</span><span class="s">u1234</span><span class="se">\\</span><span class="s">u20ac</span><span class="se">\\</span><span class="s">u8000</span><span class="se">\\</span><span class="s">U0010ffff&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;backslashreplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>

        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;a</span><span class="se">\xac\\</span><span class="s">u1234</span><span class="se">\xa4\\</span><span class="s">u8000</span><span class="se">\\</span><span class="s">U0010ffff&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;iso-8859-15&quot;</span><span class="p">,</span> <span class="s">&quot;backslashreplace&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_decoding_callbacks"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_decoding_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoding_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This is a test for a decoding callback handler</span>
        <span class="c"># that allows the decoding of the invalid sequence</span>
        <span class="c"># &quot;\xc0\x80&quot; and returns &quot;\x00&quot; instead of raising an error.</span>
        <span class="c"># All other illegal sequences will be handled strictly.</span>
        <span class="k">def</span> <span class="nf">relaxedutf8</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xc0\x80</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="c"># retry after two bytes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span>

        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.relaxedutf8&quot;</span><span class="p">,</span> <span class="n">relaxedutf8</span><span class="p">)</span>

        <span class="c"># all the &quot;\xc0\x80&quot; will be decoded to &quot;\x00&quot;</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;a</span><span class="se">\x00</span><span class="s">b</span><span class="se">\xc0\x80</span><span class="s">c</span><span class="se">\xc3\xbc\xc0\x80\xc0\x80</span><span class="s">&quot;</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="s">&quot;a</span><span class="se">\x00</span><span class="s">b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\xfc\x00\x00</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sin</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;test.relaxedutf8&quot;</span><span class="p">),</span> <span class="n">sout</span><span class="p">)</span>

        <span class="c"># &quot;\xc0\x81&quot; is not valid and a UnicodeDecodeError will be raised</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xc0\x80\xc0\x81</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">sin</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span>
                          <span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;test.relaxedutf8&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_charmapencode"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_charmapencode">[docs]</a>    <span class="k">def</span> <span class="nf">test_charmapencode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># For charmap encodings the replacement string will be</span>
        <span class="c"># mapped through the encoding again. This means, that</span>
        <span class="c"># to be able to use e.g. the &quot;replace&quot; handler, the</span>
        <span class="c"># charmap has to have a mapping for &quot;?&quot;.</span>
        <span class="n">charmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&quot;abcdefgh&quot;</span><span class="p">)</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="s">&quot;abc&quot;</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;AABBCC&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="n">charmap</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sout</span><span class="p">)</span>

        <span class="n">sin</span> <span class="o">=</span> <span class="s">&quot;abcA&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="n">charmap</span><span class="p">)</span>

        <span class="n">charmap</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;XYZ&quot;</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="s">&quot;abcDEF&quot;</span>
        <span class="n">sout</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;AABBCCXYZXYZXYZ&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span> <span class="n">charmap</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sout</span><span class="p">)</span>

        <span class="n">charmap</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s">&quot;XYZ&quot;</span> <span class="c"># wrong type in mapping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span> <span class="n">charmap</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_decodeunicodeinternal"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_decodeunicodeinternal">[docs]</a>    <span class="k">def</span> <span class="nf">test_decodeunicodeinternal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;unicode_internal codec has been &#39;</span>
                                          <span class="s">&#39;deprecated&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
                <span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span>
                <span class="s">&quot;unicode-internal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">handler_unicodeinternal</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\x01</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;unicode_internal codec has been &#39;</span>
                                              <span class="s">&#39;deprecated&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode-internal&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span>
                    <span class="s">&quot;</span><span class="se">\u0000</span><span class="s">&quot;</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode-internal&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                    <span class="s">&quot;</span><span class="se">\u0000\ufffd</span><span class="s">&quot;</span>
                <span class="p">)</span>

                <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.hui&quot;</span><span class="p">,</span> <span class="n">handler_unicodeinternal</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode-internal&quot;</span><span class="p">,</span> <span class="s">&quot;test.hui&quot;</span><span class="p">),</span>
                    <span class="s">&quot;</span><span class="se">\u0000\u0001\u0000</span><span class="s">&quot;</span>
                <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_callbacks"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">test_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">handler1</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeEncodeError</span><span class="p">):</span>
                <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&lt;</span><span class="si">%d</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&lt;</span><span class="si">%d</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;[</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>

        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.handler1&quot;</span><span class="p">,</span> <span class="n">handler1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">handler2</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&lt;</span><span class="si">%d</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)]</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;[</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c"># skip one character</span>

        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.handler2&quot;</span><span class="p">,</span> <span class="n">handler2</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x81\x7f\x80\xff</span><span class="s">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler1&quot;</span><span class="p">),</span>
            <span class="s">&quot;</span><span class="se">\x00</span><span class="s">[&lt;129&gt;]</span><span class="se">\x7f</span><span class="s">[&lt;128&gt;][&lt;255&gt;]&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler2&quot;</span><span class="p">),</span>
            <span class="s">&quot;</span><span class="se">\x00</span><span class="s">[&lt;129&gt;][&lt;128&gt;]&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">u3042\u3xxx&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler1&quot;</span><span class="p">),</span>
            <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">[&lt;92&gt;&lt;117&gt;&lt;51&gt;]xxx&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">u3042\u3xx&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler1&quot;</span><span class="p">),</span>
            <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">[&lt;92&gt;&lt;117&gt;&lt;51&gt;]xx&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler1&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nb">ord</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">):</span> <span class="s">&quot;z&quot;</span><span class="p">})[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">&quot;z[&lt;98&gt;][&lt;99&gt;]&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;g</span><span class="se">\xfc\xdf</span><span class="s">rk&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler1&quot;</span><span class="p">),</span>
            <span class="n">b</span><span class="s">&quot;g[&lt;252&gt;&lt;223&gt;]rk&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;g</span><span class="se">\xfc\xdf</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.handler1&quot;</span><span class="p">),</span>
            <span class="n">b</span><span class="s">&quot;g[&lt;252&gt;&lt;223&gt;]&quot;</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_longstrings"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_longstrings">[docs]</a>    <span class="k">def</span> <span class="nf">test_longstrings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># test long strings to check for memory overflow problems</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">,</span>
                   <span class="s">&quot;backslashreplace&quot;</span><span class="p">]</span>
        <span class="c"># register the handlers under different names,</span>
        <span class="c"># to prevent the codec from recognizing the name</span>
        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.&quot;</span> <span class="o">+</span> <span class="n">err</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="n">l</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">errors</span> <span class="o">+=</span> <span class="p">[</span> <span class="s">&quot;test.&quot;</span> <span class="o">+</span> <span class="n">err</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errors</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">uni</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">s</span><span class="o">*</span><span class="n">l</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;a</span><span class="se">\xe4</span><span class="s">&quot;</span><span class="p">)</span> <span class="p">]:</span>
            <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-15&quot;</span><span class="p">,</span>
                        <span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;utf-7&quot;</span><span class="p">,</span> <span class="s">&quot;utf-16&quot;</span><span class="p">,</span> <span class="s">&quot;utf-32&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">uni</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
                        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.check_exceptionobjectargs"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.check_exceptionobjectargs">[docs]</a>    <span class="k">def</span> <span class="nf">check_exceptionobjectargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c"># Test UnicodeError subclasses: construction, attribute assignment and __str__ conversion</span>
        <span class="c"># check with one missing argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c"># check with one argument too much</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">args</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;too much&quot;</span><span class="p">]))</span>
        <span class="c"># check with one argument of the wrong type</span>
        <span class="n">wrongargs</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;eggs&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="bp">None</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">wrongarg</span> <span class="ow">in</span> <span class="n">wrongargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wrongarg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="c"># build argument array</span>
                <span class="n">callargs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
                        <span class="n">callargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrongarg</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">callargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">)</span>

        <span class="c"># check with the correct number and type of arguments</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="n">exctype</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_unicodeencodeerror"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_unicodeencodeerror">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicodeencodeerror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;g</span><span class="se">\xfc</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t encode character &#39;</span><span class="se">\\</span><span class="s">xfc&#39; in position 1: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;g</span><span class="se">\xfc</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t encode characters in position 1-3: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xfc</span><span class="s">x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t encode character &#39;</span><span class="se">\\</span><span class="s">xfc&#39; in position 0: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u0100</span><span class="s">x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t encode character &#39;</span><span class="se">\\</span><span class="s">u0100&#39; in position 0: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\uffff</span><span class="s">x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t encode character &#39;</span><span class="se">\\</span><span class="s">uffff&#39; in position 0: ouch&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U00010000</span><span class="s">x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
                <span class="s">&quot;&#39;ascii&#39; codec can&#39;t encode character &#39;</span><span class="se">\\</span><span class="s">U00010000&#39; in position 0: ouch&quot;</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_unicodedecodeerror"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_unicodedecodeerror">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicodedecodeerror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;g</span><span class="se">\xfc</span><span class="s">rk&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t decode byte 0xfc in position 1: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;g</span><span class="se">\xfc</span><span class="s">rk&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;&#39;ascii&#39; codec can&#39;t decode bytes in position 1-2: ouch&quot;</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_unicodetranslateerror"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_unicodetranslateerror">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicodetranslateerror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeTranslateError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;g</span><span class="se">\xfc</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;can&#39;t translate character &#39;</span><span class="se">\\</span><span class="s">xfc&#39; in position 1: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeTranslateError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;g</span><span class="se">\u0100</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;can&#39;t translate character &#39;</span><span class="se">\\</span><span class="s">u0100&#39; in position 1: ouch&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeTranslateError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;g</span><span class="se">\uffff</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;can&#39;t translate character &#39;</span><span class="se">\\</span><span class="s">uffff&#39; in position 1: ouch&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
                <span class="ne">UnicodeTranslateError</span><span class="p">,</span>
                <span class="p">[</span><span class="s">&quot;g</span><span class="se">\U00010000</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
                <span class="s">&quot;can&#39;t translate character &#39;</span><span class="se">\\</span><span class="s">U00010000&#39; in position 1: ouch&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_exceptionobjectargs</span><span class="p">(</span>
            <span class="ne">UnicodeTranslateError</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;g</span><span class="se">\xfc</span><span class="s">rk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">],</span>
            <span class="s">&quot;can&#39;t translate characters in position 1-2: ouch&quot;</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badandgoodstrictexceptions"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badandgoodstrictexceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_badandgoodstrictexceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># &quot;strict&quot; complains about a non-exception passed in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">strict_errors</span><span class="p">,</span>
            <span class="mi">42</span>
        <span class="p">)</span>
        <span class="c"># &quot;strict&quot; complains about the wrong exception type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">Exception</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">strict_errors</span><span class="p">,</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c"># If the correct exception is passed in, &quot;strict&quot; raises it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">strict_errors</span><span class="p">,</span>
            <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badandgoodignoreexceptions"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badandgoodignoreexceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_badandgoodignoreexceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># &quot;ignore&quot; complains about a non-exception passed in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">,</span>
           <span class="mi">42</span>
        <span class="p">)</span>
        <span class="c"># &quot;ignore&quot; complains about the wrong exception type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">,</span>
           <span class="ne">UnicodeError</span><span class="p">(</span><span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c"># If the correct exception is passed in, &quot;ignore&quot; returns an empty replacement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">(</span>
                <span class="ne">UnicodeDecodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">(</span>
                <span class="ne">UnicodeTranslateError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badandgoodreplaceexceptions"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badandgoodreplaceexceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_badandgoodreplaceexceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># &quot;replace&quot; complains about a non-exception passed in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">,</span>
           <span class="mi">42</span>
        <span class="p">)</span>
        <span class="c"># &quot;replace&quot; complains about the wrong exception type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">,</span>
           <span class="ne">UnicodeError</span><span class="p">(</span><span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">,</span>
            <span class="n">BadObjectUnicodeEncodeError</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">,</span>
            <span class="n">BadObjectUnicodeDecodeError</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c"># With the correct exception, &quot;replace&quot; returns an &quot;?&quot; or &quot;\ufffd&quot; replacement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeDecodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">replace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeTranslateError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badandgoodxmlcharrefreplaceexceptions"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badandgoodxmlcharrefreplaceexceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_badandgoodxmlcharrefreplaceexceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># &quot;xmlcharrefreplace&quot; complains about a non-exception passed in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">,</span>
           <span class="mi">42</span>
        <span class="p">)</span>
        <span class="c"># &quot;xmlcharrefreplace&quot; complains about the wrong exception types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">,</span>
           <span class="ne">UnicodeError</span><span class="p">(</span><span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c"># &quot;xmlcharrefreplace&quot; can only be used for encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">,</span>
            <span class="ne">UnicodeDecodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">,</span>
            <span class="ne">UnicodeTranslateError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c"># Use the correct exception</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">999</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mh">0x3042</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;ouch&quot;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;&amp;#</span><span class="si">%d</span><span class="s">;&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badandgoodbackslashreplaceexceptions"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badandgoodbackslashreplaceexceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_badandgoodbackslashreplaceexceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># &quot;backslashreplace&quot; complains about a non-exception passed in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">,</span>
           <span class="mi">42</span>
        <span class="p">)</span>
        <span class="c"># &quot;backslashreplace&quot; complains about the wrong exception types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
           <span class="ne">TypeError</span><span class="p">,</span>
           <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">,</span>
           <span class="ne">UnicodeError</span><span class="p">(</span><span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c"># &quot;backslashreplace&quot; can only be used for encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">,</span>
            <span class="ne">UnicodeDecodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">,</span>
            <span class="ne">UnicodeTranslateError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c"># Use the correct exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">u3042&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">x00&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">xff&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u0100</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">u0100&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\uffff</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">uffff&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">SIZEOF_WCHAR_T</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                    <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
                                       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">U00010000&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                    <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U0010ffff</span><span class="s">&quot;</span><span class="p">,</span>
                                       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">U0010ffff&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c"># Lone surrogates (regardless of unicode width)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                    <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\ud800</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">ud800&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">(</span>
                    <span class="ne">UnicodeEncodeError</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\udfff</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ouch&quot;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">udfff&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badhandlerresults"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badhandlerresults">[docs]</a>    <span class="k">def</span> <span class="nf">test_badhandlerresults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,),</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,)</span> <span class="p">)</span>
        <span class="n">encs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-15&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.badhandler&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">res</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="n">encs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
                    <span class="ne">TypeError</span><span class="p">,</span>
                    <span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span>
                    <span class="n">enc</span><span class="p">,</span>
                    <span class="s">&quot;test.badhandler&quot;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;utf-7&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;+x-&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;unicode-internal&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="k">with</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
                    <span class="c"># unicode-internal has been deprecated</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
                        <span class="ne">TypeError</span><span class="p">,</span>
                        <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span>
                        <span class="n">enc</span><span class="p">,</span>
                        <span class="s">&quot;test.badhandler&quot;</span>
                    <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_lookup"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">test_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">strict_errors</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;strict&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">strict_errors</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;strict&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">backslashreplace_errors</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;backslashreplace&quot;</span><span class="p">)</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_unencodablereplacement"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_unencodablereplacement">[docs]</a>    <span class="k">def</span> <span class="nf">test_unencodablereplacement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">unencrepl</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeEncodeError</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u4242</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.unencreplhandler&quot;</span><span class="p">,</span> <span class="n">unencrepl</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-15&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
                <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\u4242</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span>
                <span class="n">enc</span><span class="p">,</span>
                <span class="s">&quot;test.unencreplhandler&quot;</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badregistercall"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badregistercall">[docs]</a>    <span class="k">def</span> <span class="nf">test_badregistercall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Modules/_codecsmodule.c::register_error()</span>
        <span class="c"># Python/codecs.c::PyCodec_RegisterError()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">,</span> <span class="s">&quot;test.dummy&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_badlookupcall"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_badlookupcall">[docs]</a>    <span class="k">def</span> <span class="nf">test_badlookupcall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Modules/_codecsmodule.c::lookup_error()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_unknownhandler"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_unknownhandler">[docs]</a>    <span class="k">def</span> <span class="nf">test_unknownhandler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Modules/_codecsmodule.c::lookup_error()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">,</span> <span class="s">&quot;test.unknown&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_xmlcharrefvalues"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_xmlcharrefvalues">[docs]</a>    <span class="k">def</span> <span class="nf">test_xmlcharrefvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Python/codecs.c::PyCodec_XMLCharRefReplaceErrors()</span>
        <span class="c"># and inline implementations</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.xmlcharrefreplace&quot;</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">xmlcharrefreplace_errors</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;iso-8859-15&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">,</span> <span class="s">&quot;test.xmlcharrefreplace&quot;</span><span class="p">):</span>
                <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_decodehelper"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_decodehelper">[docs]</a>    <span class="k">def</span> <span class="nf">test_decodehelper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Objects/unicodeobject.c::unicode_decode_call_errorhandler()</span>
        <span class="c"># and callers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.unknown&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">baddecodereturn1</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">42</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">,</span> <span class="n">baddecodereturn1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">x0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">x0y&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">Uffffeeee&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">uyyyy&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;raw-unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn1&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">baddecodereturn2</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.baddecodereturn2&quot;</span><span class="p">,</span> <span class="n">baddecodereturn2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.baddecodereturn2&quot;</span><span class="p">)</span>

        <span class="n">handler</span> <span class="o">=</span> <span class="n">PosReturn</span><span class="p">()</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.posreturn&quot;</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>

        <span class="c"># Valid negative position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="s">&quot;&lt;?&gt;0&quot;</span><span class="p">)</span>

        <span class="c"># Valid negative position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="s">&quot;&lt;?&gt;&lt;?&gt;&quot;</span><span class="p">)</span>

        <span class="c"># Negative position out of bounds</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">)</span>

        <span class="c"># Valid positive position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="s">&quot;&lt;?&gt;0&quot;</span><span class="p">)</span>

        <span class="c"># Largest valid positive position (one beyond end of input)</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="s">&quot;&lt;?&gt;&quot;</span><span class="p">)</span>

        <span class="c"># Invalid positive position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">)</span>

        <span class="c"># Restart at the &quot;0&quot;</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">uyyyy0&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;raw-unicode-escape&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="s">&quot;&lt;?&gt;0&quot;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">:</span> <span class="bp">None</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_encodehelper"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_encodehelper">[docs]</a>    <span class="k">def</span> <span class="nf">test_encodehelper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Objects/unicodeobject.c::unicode_encode_call_errorhandler()</span>
        <span class="c"># and callers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.unknown&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">badencodereturn1</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">42</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.badencodereturn1&quot;</span><span class="p">,</span> <span class="n">badencodereturn1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.badencodereturn1&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">badencodereturn2</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.badencodereturn2&quot;</span><span class="p">,</span> <span class="n">badencodereturn2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.badencodereturn2&quot;</span><span class="p">)</span>

        <span class="n">handler</span> <span class="o">=</span> <span class="n">PosReturn</span><span class="p">()</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.posreturn&quot;</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>

        <span class="c"># Valid negative position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&lt;?&gt;0&quot;</span><span class="p">)</span>

        <span class="c"># Valid negative position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&lt;?&gt;&lt;?&gt;&quot;</span><span class="p">)</span>

        <span class="c"># Negative position out of bounds</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">)</span>

        <span class="c"># Valid positive position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&lt;?&gt;0&quot;</span><span class="p">)</span>

        <span class="c"># Largest valid positive position (one beyond end of input</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&lt;?&gt;&quot;</span><span class="p">)</span>

        <span class="c"># Invalid positive position</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">0&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">)</span>

        <span class="n">handler</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">,</span> <span class="s">&quot;backslashreplace&quot;</span><span class="p">,</span> <span class="s">&quot;test.posreturn&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">:</span> <span class="bp">None</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">D</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">:</span> <span class="mi">300</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_translatehelper"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_translatehelper">[docs]</a>    <span class="k">def</span> <span class="nf">test_translatehelper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># enhance coverage of:</span>
        <span class="c"># Objects/unicodeobject.c::unicode_encode_call_errorhandler()</span>
        <span class="c"># and callers</span>
        <span class="c"># (Unfortunately the errors argument is not directly accessible</span>
        <span class="c"># from Python, so we can&#39;t test that much)</span>
        <span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="c">#self.assertRaises(ValueError, &quot;\xff&quot;.translate, D())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">:</span> <span class="p">()})</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_bug828737"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_bug828737">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug828737</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">charmap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">ord</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">):</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span>
            <span class="nb">ord</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">):</span> <span class="s">&quot;&amp;lt;&quot;</span><span class="p">,</span>
            <span class="nb">ord</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">):</span> <span class="s">&quot;&amp;gt;&quot;</span><span class="p">,</span>
            <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">):</span> <span class="s">&quot;&amp;quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;abc&lt;def&gt;ghi&#39;</span><span class="o">*</span><span class="n">n</span>
            <span class="n">text</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">charmap</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecCallbackTest.test_mutatingdecodehandler"><a class="viewcode-back" href="../../test.html#test.test_codeccallbacks.CodecCallbackTest.test_mutatingdecodehandler">[docs]</a>    <span class="k">def</span> <span class="nf">test_mutatingdecodehandler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">baddata</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;utf-7&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;++&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span>  <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;utf-16&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;utf-32&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;unicode-escape&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">u123g&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;raw-unicode-escape&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">u123g&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;unicode-internal&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">replacing</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="mi">42</span>
                <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u4242</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.replacing&quot;</span><span class="p">,</span> <span class="n">replacing</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
            <span class="c"># unicode-internal has been deprecated</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">baddata</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;test.replacing&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mutating</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
                <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u4242</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;don&#39;t know how to handle </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">exc</span><span class="p">)</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;test.mutating&quot;</span><span class="p">,</span> <span class="n">mutating</span><span class="p">)</span>
        <span class="c"># If the decoder doesn&#39;t pick up the modified input the following</span>
        <span class="c"># will lead to an endless loop</span>
        <span class="k">with</span> <span class="n">test</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
            <span class="c"># unicode-internal has been deprecated</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">baddata</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;test.replacing&quot;</span><span class="p">)</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>