

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_importlib.test_util &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../../index.html"/>
        <link rel="up" title="test.test_importlib" href="../test_importlib.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../test_importlib.html">test.test_importlib</a> &raquo;</li>
      
    <li>test.test_importlib.test_util</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_importlib.test_util</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span> <span class="k">as</span> <span class="n">test_util</span>
<span class="n">frozen_init</span><span class="p">,</span> <span class="n">source_init</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib&#39;</span><span class="p">)</span>
<span class="n">frozen_machinery</span><span class="p">,</span> <span class="n">source_machinery</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib.machinery&#39;</span><span class="p">)</span>
<span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib.util&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<div class="viewcode-block" id="DecodeSourceBytesTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.DecodeSourceBytesTests">[docs]</a><span class="k">class</span> <span class="nc">DecodeSourceBytesTests</span><span class="p">:</span>

    <span class="n">source</span> <span class="o">=</span> <span class="s">&quot;string =&#39;Ã¼&#39;&quot;</span>

<div class="viewcode-block" id="DecodeSourceBytesTests.test_ut8_default"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.DecodeSourceBytesTests.test_ut8_default">[docs]</a>    <span class="k">def</span> <span class="nf">test_ut8_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">decode_source</span><span class="p">(</span><span class="n">source_bytes</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DecodeSourceBytesTests.test_specified_encoding"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.DecodeSourceBytesTests.test_specified_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_specified_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&#39;# coding=latin-1</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="n">source_bytes</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">source_bytes</span> <span class="o">!=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">decode_source</span><span class="p">(</span><span class="n">source_bytes</span><span class="p">),</span> <span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DecodeSourceBytesTests.test_universal_newlines"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.DecodeSourceBytesTests.test_universal_newlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_universal_newlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">])</span>
        <span class="n">source_bytes</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">decode_source</span><span class="p">(</span><span class="n">source_bytes</span><span class="p">),</span>
                         <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]))</span>
</div></div>
<span class="n">Frozen_DecodeSourceBytesTests</span><span class="p">,</span> <span class="n">Source_DecodeSourceBytesTests</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">DecodeSourceBytesTests</span><span class="p">,</span> <span class="n">util</span><span class="o">=</span><span class="p">[</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">])</span>


<div class="viewcode-block" id="ModuleForLoaderTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests">[docs]</a><span class="k">class</span> <span class="nc">ModuleForLoaderTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Tests for importlib.util.module_for_loader.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ModuleForLoaderTests.module_for_loader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.module_for_loader">[docs]</a>    <span class="k">def</span> <span class="nf">module_for_loader</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_for_loader</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_warning"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_warning">[docs]</a>    <span class="k">def</span> <span class="nf">test_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Should raise a PendingDeprecationWarning when used.</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
                <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_for_loader</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.return_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.return_module">[docs]</a>    <span class="k">def</span> <span class="nf">return_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_for_loader</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="n">module</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.raise_exception"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.raise_exception">[docs]</a>    <span class="k">def</span> <span class="nf">raise_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">to_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ImportError</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_for_loader</span><span class="p">(</span><span class="n">to_wrap</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fxn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_new_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_new_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that when no module exists in sys.modules a new module is</span>
        <span class="c"># created.</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="s">&#39;a.b.c&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">module_name</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_reload"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_reload">[docs]</a>    <span class="k">def</span> <span class="nf">test_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that a module is reused if already in sys.modules.</span>
        <span class="k">class</span> <span class="nc">FakeLoader</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="nd">@self.module_for_loader</span>
            <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">module</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;a.b.c&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;a.b.c&#39;</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">FakeLoader</span><span class="p">()</span>
            <span class="n">returned_module</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">returned_module</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__package__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_new_module_failure"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_new_module_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_module_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that a module is removed from sys.modules if added but an</span>
        <span class="c"># exception is raised.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;a.b.c&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_reload_failure"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_reload_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_reload_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that a failure on reload leaves the module in-place.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;a.b.c&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_decorator_attrs"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_decorator_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">test_decorator_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">fxn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span> <span class="k">pass</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_for_loader</span><span class="p">(</span><span class="n">fxn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapped</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">fxn</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapped</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">fxn</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_false_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_false_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_false_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If for some odd reason a module is considered false, still return it</span>
        <span class="c"># from sys.modules.</span>
        <span class="k">class</span> <span class="nc">FalseModule</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>

        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;mod&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">FalseModule</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">given</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">given</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModuleForLoaderTests.test_attributes_set"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ModuleForLoaderTests.test_attributes_set">[docs]</a>    <span class="k">def</span> <span class="nf">test_attributes_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># __name__, __loader__, and __package__ should be set (when</span>
        <span class="c"># is_package() is defined; undefined implicitly tested elsewhere).</span>
        <span class="k">class</span> <span class="nc">FakeLoader</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_package</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pkg</span> <span class="o">=</span> <span class="n">is_package</span>
            <span class="k">def</span> <span class="nf">is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pkg</span>
            <span class="nd">@self.module_for_loader</span>
            <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">module</span>

        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;pkg.mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">FakeLoader</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__package__</span><span class="p">,</span> <span class="s">&#39;pkg&#39;</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;pkg.sub&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">FakeLoader</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__package__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_ModuleForLoaderTests</span><span class="p">,</span> <span class="n">Source_ModuleForLoaderTests</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">ModuleForLoaderTests</span><span class="p">,</span> <span class="n">util</span><span class="o">=</span><span class="p">[</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">])</span>


<div class="viewcode-block" id="SetPackageTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests">[docs]</a><span class="k">class</span> <span class="nc">SetPackageTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Tests for importlib.util.set_package.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SetPackageTests.verify"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">expect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify the module has the expected value for __package__ after</span>
<span class="sd">        passing through set_package.&quot;&quot;&quot;</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">module</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">set_package</span><span class="p">(</span><span class="n">fxn</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="n">wrapped</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;__package__&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expect</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__package__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetPackageTests.test_top_level"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.test_top_level">[docs]</a>    <span class="k">def</span> <span class="nf">test_top_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># __package__ should be set to the empty string if a top-level module.</span>
        <span class="c"># Implicitly tests when package is set to None.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;module&#39;</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetPackageTests.test_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.test_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test setting __package__ for a package.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;pkg&#39;</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__path__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&lt;path&gt;&#39;</span><span class="p">]</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;pkg&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetPackageTests.test_submodule"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.test_submodule">[docs]</a>    <span class="k">def</span> <span class="nf">test_submodule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test __package__ for a module in a package.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;pkg.mod&#39;</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;pkg&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetPackageTests.test_setting_if_missing"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.test_setting_if_missing">[docs]</a>    <span class="k">def</span> <span class="nf">test_setting_if_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># __package__ should be set if it is missing.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;mod&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;__package__&#39;</span><span class="p">):</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;__package__&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetPackageTests.test_leaving_alone"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.test_leaving_alone">[docs]</a>    <span class="k">def</span> <span class="nf">test_leaving_alone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If __package__ is set and not None then leave it alone.</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;mod&#39;</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetPackageTests.test_decorator_attrs"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetPackageTests.test_decorator_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">test_decorator_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">fxn</span><span class="p">(</span><span class="n">module</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">set_package</span><span class="p">(</span><span class="n">fxn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapped</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">fxn</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">wrapped</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">,</span> <span class="n">fxn</span><span class="o">.</span><span class="n">__qualname__</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_SetPackageTests</span><span class="p">,</span> <span class="n">Source_SetPackageTests</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">SetPackageTests</span><span class="p">,</span> <span class="n">util</span><span class="o">=</span><span class="p">[</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">])</span>


<div class="viewcode-block" id="SetLoaderTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetLoaderTests">[docs]</a><span class="k">class</span> <span class="nc">SetLoaderTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Tests importlib.util.set_loader().&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SetLoaderTests.DummyLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetLoaderTests.DummyLoader">[docs]</a>    <span class="k">class</span> <span class="nc">DummyLoader</span><span class="p">:</span>
        <span class="nd">@util.set_loader</span>
<div class="viewcode-block" id="SetLoaderTests.DummyLoader.load_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetLoaderTests.DummyLoader.load_module">[docs]</a>        <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
</div></div>
<div class="viewcode-block" id="SetLoaderTests.test_no_attribute"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetLoaderTests.test_no_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DummyLoader</span><span class="p">()</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">loader</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__loader__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetLoaderTests.test_attribute_is_None"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetLoaderTests.test_attribute_is_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_attribute_is_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DummyLoader</span><span class="p">()</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__loader__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetLoaderTests.test_not_reset"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.SetLoaderTests.test_not_reset">[docs]</a>    <span class="k">def</span> <span class="nf">test_not_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DummyLoader</span><span class="p">()</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="n">loader</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__loader__</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Frozen_SetLoaderTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Frozen_SetLoaderTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_SetLoaderTests</span><span class="p">(</span><span class="n">SetLoaderTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="Frozen_SetLoaderTests.DummyLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Frozen_SetLoaderTests.DummyLoader">[docs]</a>    <span class="k">class</span> <span class="nc">DummyLoader</span><span class="p">:</span>
        <span class="nd">@frozen_util.set_loader</span>
<div class="viewcode-block" id="Frozen_SetLoaderTests.DummyLoader.load_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Frozen_SetLoaderTests.DummyLoader.load_module">[docs]</a>        <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
</div></div></div>
<div class="viewcode-block" id="Source_SetLoaderTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Source_SetLoaderTests">[docs]</a><span class="k">class</span> <span class="nc">Source_SetLoaderTests</span><span class="p">(</span><span class="n">SetLoaderTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="Source_SetLoaderTests.DummyLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Source_SetLoaderTests.DummyLoader">[docs]</a>    <span class="k">class</span> <span class="nc">DummyLoader</span><span class="p">:</span>
        <span class="nd">@source_util.set_loader</span>
<div class="viewcode-block" id="Source_SetLoaderTests.DummyLoader.load_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Source_SetLoaderTests.DummyLoader.load_module">[docs]</a>        <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>

</div></div></div>
<div class="viewcode-block" id="ResolveNameTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests">[docs]</a><span class="k">class</span> <span class="nc">ResolveNameTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Tests importlib.util.resolve_name().&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResolveNameTests.test_absolute"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests.test_absolute">[docs]</a>    <span class="k">def</span> <span class="nf">test_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bacon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;bacon&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s">&#39;bacon&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ResolveNameTests.test_aboslute_within_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests.test_aboslute_within_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_aboslute_within_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bacon in spam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;bacon&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s">&#39;bacon&#39;</span><span class="p">,</span> <span class="s">&#39;spam&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ResolveNameTests.test_no_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests.test_no_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># .bacon in &#39;&#39;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s">&#39;.bacon&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ResolveNameTests.test_in_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests.test_in_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_in_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># .bacon in spam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;spam.eggs.bacon&#39;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s">&#39;.bacon&#39;</span><span class="p">,</span> <span class="s">&#39;spam.eggs&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ResolveNameTests.test_other_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests.test_other_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_other_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># ..bacon in spam.bacon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;spam.bacon&#39;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s">&#39;..bacon&#39;</span><span class="p">,</span> <span class="s">&#39;spam.eggs&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ResolveNameTests.test_escape"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.ResolveNameTests.test_escape">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># ..bacon in spam</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s">&#39;..bacon&#39;</span><span class="p">,</span> <span class="s">&#39;spam&#39;</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_ResolveNameTests</span><span class="p">,</span> <span class="n">Source_ResolveNameTests</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">ResolveNameTests</span><span class="p">,</span>
        <span class="n">util</span><span class="o">=</span><span class="p">[</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">])</span>


<div class="viewcode-block" id="FindSpecTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests">[docs]</a><span class="k">class</span> <span class="nc">FindSpecTests</span><span class="p">:</span>

<div class="viewcode-block" id="FindSpecTests.FakeMetaFinder"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.FakeMetaFinder">[docs]</a>    <span class="k">class</span> <span class="nc">FakeMetaFinder</span><span class="p">:</span>
        <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FindSpecTests.FakeMetaFinder.find_spec"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.FakeMetaFinder.find_spec">[docs]</a>        <span class="k">def</span> <span class="nf">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span>
</div></div>
<div class="viewcode-block" id="FindSpecTests.test_sys_modules"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_sys_modules">[docs]</a>    <span class="k">def</span> <span class="nf">test_sys_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;some_mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="s">&#39;a loader!&#39;</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">ModuleSpec</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="n">loader</span>
            <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_sys_modules_without___loader__"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_sys_modules_without___loader__">[docs]</a>    <span class="k">def</span> <span class="nf">test_sys_modules_without___loader__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;some_mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="s">&#39;a loader!&#39;</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">ModuleSpec</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_sys_modules_spec_is_None"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_sys_modules_spec_is_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_sys_modules_spec_is_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;some_mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_sys_modules_loader_is_None"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_sys_modules_loader_is_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_sys_modules_loader_is_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;some_mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">ModuleSpec</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_sys_modules_spec_is_not_set"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_sys_modules_spec_is_not_set">[docs]</a>    <span class="k">def</span> <span class="nf">test_sys_modules_spec_is_not_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;some_mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_success"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_success">[docs]</a>    <span class="k">def</span> <span class="nf">test_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;some_mod&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">import_state</span><span class="p">(</span><span class="n">meta_path</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">FakeMetaFinder</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

<span class="c">#    def test_success_path(self):</span>
<span class="c">#        # Searching on a path should work.</span>
<span class="c">#        name = &#39;some_mod&#39;</span>
<span class="c">#        path = &#39;path to some place&#39;</span>
<span class="c">#        with test_util.uncache(name):</span>
<span class="c">#            with test_util.import_state(meta_path=[self.FakeMetaFinder]):</span>
<span class="c">#                self.assertEqual((name, path, None),</span>
<span class="c">#                                 self.util.find_spec(name, path))</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_nothing"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_nothing">[docs]</a>    <span class="k">def</span> <span class="nf">test_nothing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># None is returned upon failure to find a loader.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="s">&#39;nevergoingtofindthismodule&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_find_submodule"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_find_submodule">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_submodule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;spam&#39;</span>
        <span class="n">subname</span> <span class="o">=</span> <span class="s">&#39;ham&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">temp_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pkg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pkg_dir</span><span class="p">:</span>
            <span class="n">fullname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">submodule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">pkg_dir</span><span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="c"># Ensure successive calls behave the same.</span>
            <span class="n">spec_again</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">spec_again</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_find_submodule_parent_already_imported"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_find_submodule_parent_already_imported">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_submodule_parent_already_imported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;spam&#39;</span>
        <span class="n">subname</span> <span class="o">=</span> <span class="s">&#39;ham&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">temp_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pkg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pkg_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">fullname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">submodule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">pkg_dir</span><span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="c"># Ensure successive calls behave the same.</span>
            <span class="n">spec_again</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">spec_again</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_find_relative_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_find_relative_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_relative_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;spam&#39;</span>
        <span class="n">subname</span> <span class="o">=</span> <span class="s">&#39;ham&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">temp_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pkg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pkg_dir</span><span class="p">:</span>
            <span class="n">fullname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">submodule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">pkg_dir</span><span class="p">)</span>
            <span class="n">relname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">subname</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">relname</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="c"># Ensure successive calls behave the same.</span>
            <span class="n">spec_again</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">spec_again</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FindSpecTests.test_find_relative_module_missing_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.FindSpecTests.test_find_relative_module_missing_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_relative_module_missing_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;spam&#39;</span>
        <span class="n">subname</span> <span class="o">=</span> <span class="s">&#39;ham&#39;</span>
        <span class="k">with</span> <span class="n">test_util</span><span class="o">.</span><span class="n">temp_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pkg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pkg_dir</span><span class="p">:</span>
            <span class="n">fullname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">submodule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">pkg_dir</span><span class="p">)</span>
            <span class="n">relname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">subname</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">relname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="Frozen_FindSpecTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Frozen_FindSpecTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_FindSpecTests</span><span class="p">(</span><span class="n">FindSpecTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">init</span> <span class="o">=</span> <span class="n">frozen_init</span>
    <span class="n">machinery</span> <span class="o">=</span> <span class="n">frozen_machinery</span>
    <span class="n">util</span> <span class="o">=</span> <span class="n">frozen_util</span>
</div>
<div class="viewcode-block" id="Source_FindSpecTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.Source_FindSpecTests">[docs]</a><span class="k">class</span> <span class="nc">Source_FindSpecTests</span><span class="p">(</span><span class="n">FindSpecTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">init</span> <span class="o">=</span> <span class="n">source_init</span>
    <span class="n">machinery</span> <span class="o">=</span> <span class="n">source_machinery</span>
    <span class="n">util</span> <span class="o">=</span> <span class="n">source_util</span>

</div>
<div class="viewcode-block" id="MagicNumberTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.MagicNumberTests">[docs]</a><span class="k">class</span> <span class="nc">MagicNumberTests</span><span class="p">:</span>

<div class="viewcode-block" id="MagicNumberTests.test_length"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.MagicNumberTests.test_length">[docs]</a>    <span class="k">def</span> <span class="nf">test_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Should be 4 bytes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">MAGIC_NUMBER</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MagicNumberTests.test_incorporates_rn"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.MagicNumberTests.test_incorporates_rn">[docs]</a>    <span class="k">def</span> <span class="nf">test_incorporates_rn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The magic number uses \r\n to come out wrong when splitting on lines.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">MAGIC_NUMBER</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">))</span>
</div></div>
<span class="n">Frozen_MagicNumberTests</span><span class="p">,</span> <span class="n">Source_MagicNumberTests</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">MagicNumberTests</span><span class="p">,</span> <span class="n">util</span><span class="o">=</span><span class="p">[</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">])</span>


<div class="viewcode-block" id="PEP3147Tests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests">[docs]</a><span class="k">class</span> <span class="nc">PEP3147Tests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Tests of PEP 3147-related functions: cache_from_source and source_from_cache.&quot;&quot;&quot;</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">cache_tag</span>

    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">cache_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="s">&#39;requires sys.implementation.cache_tag not be None&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_cache_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given the path to a .py file, return the path to its PEP 3147</span>
        <span class="c"># defined .pyc file (i.e. under __pycache__).</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;qux.py&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                              <span class="s">&#39;qux.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_no_cache_tag"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_cache_from_source_no_cache_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_no_cache_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No cache tag means NotImplementedError.</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">swap_attr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="p">,</span> <span class="s">&#39;cache_tag&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s">&#39;whatever.py&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_no_dot"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_cache_from_source_no_dot">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_no_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Directory with a dot, filename without dot.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;file&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                              <span class="s">&#39;file{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_optimized"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_cache_from_source_optimized">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_optimized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given the path to a .py file, return the path to its PEP 3147</span>
        <span class="c"># defined .pyo file (i.e. under __pycache__).</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;qux.py&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                              <span class="s">&#39;qux.{}.pyo&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_cwd"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_cache_from_source_cwd">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;foo.py&#39;</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s">&#39;foo.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_cache_from_source_override"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_cache_from_source_override">[docs]</a>    <span class="k">def</span> <span class="nf">test_cache_from_source_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When debug_override is not None, it can be any true-ish or false-ish</span>
        <span class="c"># value.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz.py&#39;</span><span class="p">)</span>
        <span class="n">partial_expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;baz.{}.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[]),</span> <span class="n">partial_expect</span> <span class="o">+</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="mi">17</span><span class="p">]),</span>
                         <span class="n">partial_expect</span> <span class="o">+</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="c"># However if the bool-ishness can&#39;t be determined, the exception</span>
        <span class="c"># propagates.</span>
        <span class="k">class</span> <span class="nc">Bearish</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">RuntimeError</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s">&#39;/foo/bar/baz.py&#39;</span><span class="p">,</span> <span class="n">Bearish</span><span class="p">())</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
                     <span class="s">&#39;test meaningful only where os.altsep is defined&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PEP3147Tests.test_sep_altsep_and_sep_cache_from_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_sep_altsep_and_sep_cache_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_sep_altsep_and_sep_cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Windows path and PEP 3147 where sep is right of altsep.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">foo</span><span class="se">\\</span><span class="s">bar</span><span class="se">\\</span><span class="s">baz/qux.py&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
            <span class="s">&#39;</span><span class="se">\\</span><span class="s">foo</span><span class="se">\\</span><span class="s">bar</span><span class="se">\\</span><span class="s">baz</span><span class="se">\\</span><span class="s">__pycache__</span><span class="se">\\</span><span class="s">qux.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">cache_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="s">&#39;requires sys.implementation.cache_tag to not be &#39;</span>
                         <span class="s">&#39;None&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Given the path to a PEP 3147 defined .pyc file, return the path to</span>
        <span class="c"># its source.  This tests the good path.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span>
                            <span class="s">&#39;qux.{}.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;qux.py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_no_cache_tag"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache_no_cache_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_no_cache_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If sys.implementation.cache_tag is None, raise NotImplementedError.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="s">&#39;__pycache__&#39;</span><span class="p">,</span> <span class="s">&#39;whatever.pyc&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">swap_attr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="p">,</span> <span class="s">&#39;cache_tag&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_bad_path"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache_bad_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_bad_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When the path to a pyc file is not in PEP 3147 format, a ValueError</span>
        <span class="c"># is raised.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span> <span class="s">&#39;/foo/bar/bazqux.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_no_slash"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache_no_slash">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_no_slash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No slashes at all in path -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span> <span class="s">&#39;foo.cpython-32.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_too_few_dots"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache_too_few_dots">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_too_few_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Too few dots in final path component -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span> <span class="s">&#39;__pycache__/foo.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_too_many_dots"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache_too_many_dots">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_too_many_dots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Too many dots in final path component -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span>
            <span class="s">&#39;__pycache__/foo.cpython-32.foo.pyc&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PEP3147Tests.test_source_from_cache_no__pycache__"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_util.PEP3147Tests.test_source_from_cache_no__pycache__">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_from_cache_no__pycache__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Another problem with the path -&gt; ValueError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
            <span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">,</span>
            <span class="s">&#39;/foo/bar/foo.cpython-32.foo.pyc&#39;</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_PEP3147Tests</span><span class="p">,</span> <span class="n">Source_PEP3147Tests</span> <span class="o">=</span> <span class="n">test_util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">PEP3147Tests</span><span class="p">,</span>
        <span class="n">util</span><span class="o">=</span><span class="p">[</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>