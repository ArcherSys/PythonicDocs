

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_importlib.test_abc &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../../index.html"/>
        <link rel="up" title="test.test_importlib" href="../test_importlib.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../test_importlib.html">test.test_importlib</a> &raquo;</li>
      
    <li>test.test_importlib.test_abc</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_importlib.test_abc</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">marshal</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">mock</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>

<span class="n">frozen_init</span><span class="p">,</span> <span class="n">source_init</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib&#39;</span><span class="p">)</span>
<span class="n">frozen_abc</span><span class="p">,</span> <span class="n">source_abc</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib.abc&#39;</span><span class="p">)</span>
<span class="n">machinery</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib.machinery&#39;</span><span class="p">)</span>
<span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">import_importlib</span><span class="p">(</span><span class="s">&#39;importlib.util&#39;</span><span class="p">)</span>

<span class="c">##### Inheritance ##############################################################</span>
<div class="viewcode-block" id="InheritanceTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InheritanceTests">[docs]</a><span class="k">class</span> <span class="nc">InheritanceTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Test that the specified class is a subclass/superclass of the expected</span>
<span class="sd">    classes.&quot;&quot;&quot;</span>

    <span class="n">subclasses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">superclasses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">superclasses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">superclass_names</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;subclass_names&#39;</span><span class="p">):</span>
            <span class="c"># Because test.support.import_fresh_module() creates a new</span>
            <span class="c"># importlib._bootstrap per module, inheritance checks fail when</span>
            <span class="c"># checking across module boundaries (i.e. the _bootstrap in abc is</span>
            <span class="c"># not the same as the one in machinery). That means stealing one of</span>
            <span class="c"># the modules from the other to make sure the same instance is used.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subclasses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">machinery</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclass_names</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclasses</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">superclasses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
        <span class="n">testing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__test</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abc</span><span class="p">,</span> <span class="n">testing</span><span class="p">)</span>

<div class="viewcode-block" id="InheritanceTests.test_subclasses"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InheritanceTests.test_subclasses">[docs]</a>    <span class="k">def</span> <span class="nf">test_subclasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that the expected subclasses inherit.</span>
        <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclasses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test</span><span class="p">),</span>
                <span class="s">&quot;{0} is not a subclass of {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="InheritanceTests.test_superclasses"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InheritanceTests.test_superclasses">[docs]</a>    <span class="k">def</span> <span class="nf">test_superclasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that the class inherits from the expected superclasses.</span>
        <span class="k">for</span> <span class="n">superclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">superclasses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__test</span><span class="p">,</span> <span class="n">superclass</span><span class="p">),</span>
               <span class="s">&quot;{0} is not a superclass of {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">superclass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="create_inheritance_tests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.create_inheritance_tests">[docs]</a><span class="k">def</span> <span class="nf">create_inheritance_tests</span><span class="p">(</span><span class="n">base_class</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_frozen</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
        <span class="n">ns</span><span class="p">[</span><span class="s">&#39;abc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frozen_abc</span>
    <span class="k">def</span> <span class="nf">set_source</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
        <span class="n">ns</span><span class="p">[</span><span class="s">&#39;abc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_abc</span>

    <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">ns_set</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;Frozen&#39;</span><span class="p">,</span> <span class="n">set_frozen</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">,</span> <span class="n">set_source</span><span class="p">)]:</span>
        <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">prefix</span><span class="p">,</span> <span class="n">base_class</span><span class="o">.</span><span class="n">__name__</span><span class="p">]),</span>
                                       <span class="p">(</span><span class="n">base_class</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">),</span>
                                       <span class="n">exec_body</span><span class="o">=</span><span class="n">ns_set</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">classes</span>

</div>
<span class="k">class</span> <span class="nc">MetaPathFinder</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Finder&#39;</span><span class="p">]</span>
    <span class="n">subclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;BuiltinImporter&#39;</span><span class="p">,</span> <span class="s">&#39;FrozenImporter&#39;</span><span class="p">,</span> <span class="s">&#39;PathFinder&#39;</span><span class="p">,</span>
                      <span class="s">&#39;WindowsRegistryFinder&#39;</span><span class="p">]</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">MetaPathFinder</span><span class="p">)</span>
<span class="n">Frozen_MetaPathFinderInheritanceTests</span><span class="p">,</span> <span class="n">Source_MetaPathFinderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>


<span class="k">class</span> <span class="nc">PathEntryFinder</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Finder&#39;</span><span class="p">]</span>
    <span class="n">subclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;FileFinder&#39;</span><span class="p">]</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">PathEntryFinder</span><span class="p">)</span>
<span class="n">Frozen_PathEntryFinderInheritanceTests</span><span class="p">,</span> <span class="n">Source_PathEntryFinderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>


<span class="k">class</span> <span class="nc">ResourceLoader</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Loader&#39;</span><span class="p">]</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">ResourceLoader</span><span class="p">)</span>
<span class="n">Frozen_ResourceLoaderInheritanceTests</span><span class="p">,</span> <span class="n">Source_ResourceLoaderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>


<span class="k">class</span> <span class="nc">InspectLoader</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Loader&#39;</span><span class="p">]</span>
    <span class="n">subclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;BuiltinImporter&#39;</span><span class="p">,</span> <span class="s">&#39;FrozenImporter&#39;</span><span class="p">,</span> <span class="s">&#39;ExtensionFileLoader&#39;</span><span class="p">]</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">InspectLoader</span><span class="p">)</span>
<span class="n">Frozen_InspectLoaderInheritanceTests</span><span class="p">,</span> <span class="n">Source_InspectLoaderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>


<span class="k">class</span> <span class="nc">ExecutionLoader</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;InspectLoader&#39;</span><span class="p">]</span>
    <span class="n">subclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ExtensionFileLoader&#39;</span><span class="p">]</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">ExecutionLoader</span><span class="p">)</span>
<span class="n">Frozen_ExecutionLoaderInheritanceTests</span><span class="p">,</span> <span class="n">Source_ExecutionLoaderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>


<div class="viewcode-block" id="FileLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.FileLoader">[docs]</a><span class="k">class</span> <span class="nc">FileLoader</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ResourceLoader&#39;</span><span class="p">,</span> <span class="s">&#39;ExecutionLoader&#39;</span><span class="p">]</span>
    <span class="n">subclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SourceFileLoader&#39;</span><span class="p">,</span> <span class="s">&#39;SourcelessFileLoader&#39;</span><span class="p">]</span>
</div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">FileLoader</span><span class="p">)</span>
<span class="n">Frozen_FileLoaderInheritanceTests</span><span class="p">,</span> <span class="n">Source_FileLoaderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>


<span class="k">class</span> <span class="nc">SourceLoader</span><span class="p">(</span><span class="n">InheritanceTests</span><span class="p">):</span>
    <span class="n">superclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ResourceLoader&#39;</span><span class="p">,</span> <span class="s">&#39;ExecutionLoader&#39;</span><span class="p">]</span>
    <span class="n">subclass_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SourceFileLoader&#39;</span><span class="p">]</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">create_inheritance_tests</span><span class="p">(</span><span class="n">SourceLoader</span><span class="p">)</span>
<span class="n">Frozen_SourceLoaderInheritanceTests</span><span class="p">,</span> <span class="n">Source_SourceLoaderInheritanceTests</span> <span class="o">=</span> <span class="n">tests</span>

<span class="c">##### Default return values ####################################################</span>
<div class="viewcode-block" id="make_abc_subclasses"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.make_abc_subclasses">[docs]</a><span class="k">def</span> <span class="nf">make_abc_subclasses</span><span class="p">(</span><span class="n">base_class</span><span class="p">):</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">kind</span><span class="p">,</span> <span class="n">abc</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;Frozen&#39;</span><span class="p">,</span> <span class="n">frozen_abc</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">,</span> <span class="n">source_abc</span><span class="p">)]:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">kind</span><span class="p">,</span> <span class="n">base_class</span><span class="o">.</span><span class="n">__name__</span><span class="p">])</span>
        <span class="n">base_classes</span> <span class="o">=</span> <span class="n">base_class</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">abc</span><span class="p">,</span> <span class="n">base_class</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">base_classes</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">classes</span>
</div>
<div class="viewcode-block" id="make_return_value_tests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.make_return_value_tests">[docs]</a><span class="k">def</span> <span class="nf">make_return_value_tests</span><span class="p">(</span><span class="n">base_class</span><span class="p">,</span> <span class="n">test_class</span><span class="p">):</span>
    <span class="n">frozen_class</span><span class="p">,</span> <span class="n">source_class</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">base_class</span><span class="p">)</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">class_in_test</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;Frozen&#39;</span><span class="p">,</span> <span class="n">frozen_class</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">,</span> <span class="n">source_class</span><span class="p">)]:</span>
        <span class="k">def</span> <span class="nf">set_ns</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
            <span class="n">ns</span><span class="p">[</span><span class="s">&#39;ins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_in_test</span><span class="p">()</span>
        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">prefix</span><span class="p">,</span> <span class="n">test_class</span><span class="o">.</span><span class="n">__name__</span><span class="p">]),</span>
                                     <span class="p">(</span><span class="n">test_class</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">),</span>
                                     <span class="n">exec_body</span><span class="o">=</span><span class="n">set_ns</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tests</span>

</div>
<div class="viewcode-block" id="MetaPathFinder"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinder">[docs]</a><span class="k">class</span> <span class="nc">MetaPathFinder</span><span class="p">:</span>

<div class="viewcode-block" id="MetaPathFinder.find_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinder.find_module">[docs]</a>    <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_MPF</span><span class="p">,</span> <span class="n">Source_MPF</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">MetaPathFinder</span><span class="p">)</span>


<div class="viewcode-block" id="MetaPathFinderDefaultsTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderDefaultsTests">[docs]</a><span class="k">class</span> <span class="nc">MetaPathFinderDefaultsTests</span><span class="p">:</span>

<div class="viewcode-block" id="MetaPathFinderDefaultsTests.test_find_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderDefaultsTests.test_find_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Default should return None.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;something&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MetaPathFinderDefaultsTests.test_invalidate_caches"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderDefaultsTests.test_invalidate_caches">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalidate_caches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Calling the method is a no-op.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>

</div></div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">make_return_value_tests</span><span class="p">(</span><span class="n">MetaPathFinder</span><span class="p">,</span> <span class="n">MetaPathFinderDefaultsTests</span><span class="p">)</span>
<span class="n">Frozen_MPFDefaultTests</span><span class="p">,</span> <span class="n">Source_MPFDefaultTests</span> <span class="o">=</span> <span class="n">tests</span>


<div class="viewcode-block" id="PathEntryFinder"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinder">[docs]</a><span class="k">class</span> <span class="nc">PathEntryFinder</span><span class="p">:</span>

<div class="viewcode-block" id="PathEntryFinder.find_loader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinder.find_loader">[docs]</a>    <span class="k">def</span> <span class="nf">find_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">find_loader</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_PEF</span><span class="p">,</span> <span class="n">Source_PEF</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">PathEntryFinder</span><span class="p">)</span>


<div class="viewcode-block" id="PathEntryFinderDefaultsTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderDefaultsTests">[docs]</a><span class="k">class</span> <span class="nc">PathEntryFinderDefaultsTests</span><span class="p">:</span>

<div class="viewcode-block" id="PathEntryFinderDefaultsTests.test_find_loader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderDefaultsTests.test_find_loader">[docs]</a>    <span class="k">def</span> <span class="nf">test_find_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">find_loader</span><span class="p">(</span><span class="s">&#39;something&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PathEntryFinderDefaultsTests.find_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderDefaultsTests.find_module">[docs]</a>    <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;something&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PathEntryFinderDefaultsTests.test_invalidate_caches"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderDefaultsTests.test_invalidate_caches">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalidate_caches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Should be a no-op.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">invalidate_caches</span><span class="p">()</span>

</div></div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">make_return_value_tests</span><span class="p">(</span><span class="n">PathEntryFinder</span><span class="p">,</span> <span class="n">PathEntryFinderDefaultsTests</span><span class="p">)</span>
<span class="n">Frozen_PEFDefaultTests</span><span class="p">,</span> <span class="n">Source_PEFDefaultTests</span> <span class="o">=</span> <span class="n">tests</span>


<div class="viewcode-block" id="Loader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Loader">[docs]</a><span class="k">class</span> <span class="nc">Loader</span><span class="p">:</span>

<div class="viewcode-block" id="Loader.load_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Loader.load_module">[docs]</a>    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>

</div></div>
<span class="n">Frozen_L</span><span class="p">,</span> <span class="n">Source_L</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">Loader</span><span class="p">)</span>


<div class="viewcode-block" id="LoaderDefaultsTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderDefaultsTests">[docs]</a><span class="k">class</span> <span class="nc">LoaderDefaultsTests</span><span class="p">:</span>

<div class="viewcode-block" id="LoaderDefaultsTests.test_load_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderDefaultsTests.test_load_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s">&#39;something&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LoaderDefaultsTests.test_module_repr"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderDefaultsTests.test_module_repr">[docs]</a>    <span class="k">def</span> <span class="nf">test_module_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">module_repr</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">original_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span>
        <span class="c"># Should still return a proper repr.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>

</div></div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">make_return_value_tests</span><span class="p">(</span><span class="n">Loader</span><span class="p">,</span> <span class="n">LoaderDefaultsTests</span><span class="p">)</span>
<span class="n">Frozen_LDefaultTests</span><span class="p">,</span> <span class="n">SourceLDefaultTests</span> <span class="o">=</span> <span class="n">tests</span>


<div class="viewcode-block" id="ResourceLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ResourceLoader">[docs]</a><span class="k">class</span> <span class="nc">ResourceLoader</span><span class="p">(</span><span class="n">Loader</span><span class="p">):</span>

<div class="viewcode-block" id="ResourceLoader.get_data"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ResourceLoader.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

</div></div>
<span class="n">Frozen_RL</span><span class="p">,</span> <span class="n">Source_RL</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">ResourceLoader</span><span class="p">)</span>


<div class="viewcode-block" id="ResourceLoaderDefaultsTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ResourceLoaderDefaultsTests">[docs]</a><span class="k">class</span> <span class="nc">ResourceLoaderDefaultsTests</span><span class="p">:</span>

<div class="viewcode-block" id="ResourceLoaderDefaultsTests.test_get_data"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ResourceLoaderDefaultsTests.test_get_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IOError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s">&#39;/some/path&#39;</span><span class="p">)</span>

</div></div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">make_return_value_tests</span><span class="p">(</span><span class="n">ResourceLoader</span><span class="p">,</span> <span class="n">ResourceLoaderDefaultsTests</span><span class="p">)</span>
<span class="n">Frozen_RLDefaultTests</span><span class="p">,</span> <span class="n">Source_RLDefaultTests</span> <span class="o">=</span> <span class="n">tests</span>


<div class="viewcode-block" id="InspectLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoader">[docs]</a><span class="k">class</span> <span class="nc">InspectLoader</span><span class="p">(</span><span class="n">Loader</span><span class="p">):</span>

<div class="viewcode-block" id="InspectLoader.is_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoader.is_package">[docs]</a>    <span class="k">def</span> <span class="nf">is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_package</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoader.get_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoader.get_source">[docs]</a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>

</div></div>
<span class="n">Frozen_IL</span><span class="p">,</span> <span class="n">Source_IL</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">InspectLoader</span><span class="p">)</span>


<div class="viewcode-block" id="InspectLoaderDefaultsTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderDefaultsTests">[docs]</a><span class="k">class</span> <span class="nc">InspectLoaderDefaultsTests</span><span class="p">:</span>

<div class="viewcode-block" id="InspectLoaderDefaultsTests.test_is_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderDefaultsTests.test_is_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">is_package</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderDefaultsTests.test_get_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderDefaultsTests.test_get_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>

</div></div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">make_return_value_tests</span><span class="p">(</span><span class="n">InspectLoader</span><span class="p">,</span> <span class="n">InspectLoaderDefaultsTests</span><span class="p">)</span>
<span class="n">Frozen_ILDefaultTests</span><span class="p">,</span> <span class="n">Source_ILDefaultTests</span> <span class="o">=</span> <span class="n">tests</span>


<div class="viewcode-block" id="ExecutionLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoader">[docs]</a><span class="k">class</span> <span class="nc">ExecutionLoader</span><span class="p">(</span><span class="n">InspectLoader</span><span class="p">):</span>

<div class="viewcode-block" id="ExecutionLoader.get_filename"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoader.get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
</div></div>
<span class="n">Frozen_EL</span><span class="p">,</span> <span class="n">Source_EL</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">ExecutionLoader</span><span class="p">)</span>


<div class="viewcode-block" id="ExecutionLoaderDefaultsTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderDefaultsTests">[docs]</a><span class="k">class</span> <span class="nc">ExecutionLoaderDefaultsTests</span><span class="p">:</span>

<div class="viewcode-block" id="ExecutionLoaderDefaultsTests.test_get_filename"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderDefaultsTests.test_get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>

</div></div>
<span class="n">tests</span> <span class="o">=</span> <span class="n">make_return_value_tests</span><span class="p">(</span><span class="n">ExecutionLoader</span><span class="p">,</span> <span class="n">InspectLoaderDefaultsTests</span><span class="p">)</span>
<span class="n">Frozen_ELDefaultTests</span><span class="p">,</span> <span class="n">Source_ELDefaultsTests</span> <span class="o">=</span> <span class="n">tests</span>

<span class="c">##### MetaPathFinder concrete methods ##########################################</span>

<div class="viewcode-block" id="MetaPathFinderFindModuleTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderFindModuleTests">[docs]</a><span class="k">class</span> <span class="nc">MetaPathFinderFindModuleTests</span><span class="p">:</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="MetaPathFinderFindModuleTests.finder"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderFindModuleTests.finder">[docs]</a>    <span class="k">def</span> <span class="nf">finder</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MetaPathSpecFinder</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">MetaPathFinder</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">find_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_for</span> <span class="o">=</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span>
                <span class="k">return</span> <span class="n">spec</span>

        <span class="k">return</span> <span class="n">MetaPathSpecFinder</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="MetaPathFinderFindModuleTests.test_no_spec"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderFindModuleTests.test_no_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finder</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;blah&#39;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">finder</span><span class="o">.</span><span class="n">called_for</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">finder</span><span class="o">.</span><span class="n">called_for</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="MetaPathFinderFindModuleTests.test_spec"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.MetaPathFinderFindModuleTests.test_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_loader</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finder</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="p">)</span>

</div></div>
<span class="n">Frozen_MPFFindModuleTests</span><span class="p">,</span> <span class="n">Source_MPFFindModuleTests</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">MetaPathFinderFindModuleTests</span><span class="p">,</span>
        <span class="n">abc</span><span class="o">=</span><span class="p">(</span><span class="n">frozen_abc</span><span class="p">,</span> <span class="n">source_abc</span><span class="p">),</span>
        <span class="n">util</span><span class="o">=</span><span class="p">(</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">))</span>

<span class="c">##### PathEntryFinder concrete methods #########################################</span>

<div class="viewcode-block" id="PathEntryFinderFindLoaderTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderFindLoaderTests">[docs]</a><span class="k">class</span> <span class="nc">PathEntryFinderFindLoaderTests</span><span class="p">:</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="PathEntryFinderFindLoaderTests.finder"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderFindLoaderTests.finder">[docs]</a>    <span class="k">def</span> <span class="nf">finder</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">PathEntrySpecFinder</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">PathEntryFinder</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">find_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_for</span> <span class="o">=</span> <span class="n">fullname</span>
                <span class="k">return</span> <span class="n">spec</span>

        <span class="k">return</span> <span class="n">PathEntrySpecFinder</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PathEntryFinderFindLoaderTests.test_no_spec"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderFindLoaderTests.test_no_spec">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finder</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;blah&#39;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">find_loader</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">found</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">finder</span><span class="o">.</span><span class="n">called_for</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PathEntryFinderFindLoaderTests.test_spec_with_loader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderFindLoaderTests.test_spec_with_loader">[docs]</a>    <span class="k">def</span> <span class="nf">test_spec_with_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_loader</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finder</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">find_loader</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PathEntryFinderFindLoaderTests.test_spec_with_portions"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.PathEntryFinderFindLoaderTests.test_spec_with_portions">[docs]</a>    <span class="k">def</span> <span class="nf">test_spec_with_portions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">ModuleSpec</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">submodule_search_locations</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finder</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">find_loader</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">found</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

</div></div>
<span class="n">Frozen_PEFFindLoaderTests</span><span class="p">,</span> <span class="n">Source_PEFFindLoaderTests</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">PathEntryFinderFindLoaderTests</span><span class="p">,</span>
        <span class="n">abc</span><span class="o">=</span><span class="p">(</span><span class="n">frozen_abc</span><span class="p">,</span> <span class="n">source_abc</span><span class="p">),</span>
        <span class="n">machinery</span><span class="o">=</span><span class="n">machinery</span><span class="p">,</span>
        <span class="n">util</span><span class="o">=</span><span class="p">(</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">))</span>


<span class="c">##### Loader concrete methods ##################################################</span>
<div class="viewcode-block" id="LoaderLoadModuleTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderLoadModuleTests">[docs]</a><span class="k">class</span> <span class="nc">LoaderLoadModuleTests</span><span class="p">:</span>

<div class="viewcode-block" id="LoaderLoadModuleTests.loader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderLoadModuleTests.loader">[docs]</a>    <span class="k">def</span> <span class="nf">loader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">SpecLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Loader</span><span class="p">):</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">def</span> <span class="nf">exec_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="n">module</span>

            <span class="k">def</span> <span class="nf">is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Force some non-default module state to be set.&quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">SpecLoader</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="LoaderLoadModuleTests.test_fresh"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderLoadModuleTests.test_fresh">[docs]</a>    <span class="k">def</span> <span class="nf">test_fresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;blah&#39;</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">found</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">module</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span><span class="o">.</span><span class="n">loader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__path__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__path__</span><span class="p">,</span>
                             <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span><span class="o">.</span><span class="n">submodule_search_locations</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LoaderLoadModuleTests.test_reload"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.LoaderLoadModuleTests.test_reload">[docs]</a>    <span class="k">def</span> <span class="nf">test_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;blah&#39;</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">()</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__spec__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_loader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">loader</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="n">loader</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">found</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

</div></div>
<span class="n">Frozen_LoaderLoadModuleTests</span><span class="p">,</span> <span class="n">Source_LoaderLoadModuleTests</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">test_both</span><span class="p">(</span>
        <span class="n">LoaderLoadModuleTests</span><span class="p">,</span>
        <span class="n">abc</span><span class="o">=</span><span class="p">(</span><span class="n">frozen_abc</span><span class="p">,</span> <span class="n">source_abc</span><span class="p">),</span>
        <span class="n">util</span><span class="o">=</span><span class="p">(</span><span class="n">frozen_util</span><span class="p">,</span> <span class="n">source_util</span><span class="p">))</span>


<span class="c">##### InspectLoader concrete methods ###########################################</span>
<div class="viewcode-block" id="InspectLoaderSourceToCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderSourceToCodeTests">[docs]</a><span class="k">class</span> <span class="nc">InspectLoaderSourceToCodeTests</span><span class="p">:</span>

<div class="viewcode-block" id="InspectLoaderSourceToCodeTests.source_to_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderSourceToCodeTests.source_to_module">[docs]</a>    <span class="k">def</span> <span class="nf">source_to_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Help with source_to_code() tests.&quot;&quot;&quot;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">source_to_code</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">source_to_code</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">module</span>
</div>
<div class="viewcode-block" id="InspectLoaderSourceToCodeTests.test_source_to_code_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderSourceToCodeTests.test_source_to_code_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_to_code_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Since compile() can handle strings, so should source_to_code().</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&#39;attr = 42&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_to_module</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;attr&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderSourceToCodeTests.test_source_to_code_bytes"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderSourceToCodeTests.test_source_to_code_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_to_code_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Since compile() can handle bytes, so should source_to_code().</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;attr = 42&#39;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_to_module</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;attr&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderSourceToCodeTests.test_source_to_code_path"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderSourceToCodeTests.test_source_to_code_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_to_code_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Specifying a path should set it for the code object.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;path/to/somewhere&#39;</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">source_to_code</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderSourceToCodeTests.test_source_to_code_no_path"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderSourceToCodeTests.test_source_to_code_no_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_to_code_no_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Not setting a path should still work and be set to &lt;string&gt; since that</span>
        <span class="c"># is a pre-existing practice as a default to compile().</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">source_to_code</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Frozen_ILSourceToCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_ILSourceToCodeTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_ILSourceToCodeTests</span><span class="p">(</span><span class="n">InspectLoaderSourceToCodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">InspectLoaderSubclass</span> <span class="o">=</span> <span class="n">Frozen_IL</span>
</div>
<div class="viewcode-block" id="Source_ILSourceToCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Source_ILSourceToCodeTests">[docs]</a><span class="k">class</span> <span class="nc">Source_ILSourceToCodeTests</span><span class="p">(</span><span class="n">InspectLoaderSourceToCodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">InspectLoaderSubclass</span> <span class="o">=</span> <span class="n">Source_IL</span>

</div>
<div class="viewcode-block" id="InspectLoaderGetCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderGetCodeTests">[docs]</a><span class="k">class</span> <span class="nc">InspectLoaderGetCodeTests</span><span class="p">:</span>

<div class="viewcode-block" id="InspectLoaderGetCodeTests.test_get_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderGetCodeTests.test_get_code">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test success.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">,</span> <span class="s">&#39;get_source&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mocked</span><span class="p">:</span>
            <span class="n">mocked</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">&#39;attr = 42&#39;</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderGetCodeTests.test_get_code_source_is_None"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderGetCodeTests.test_get_code_source_is_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_source_is_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If get_source() is None then this should be None.</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">,</span> <span class="s">&#39;get_source&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mocked</span><span class="p">:</span>
            <span class="n">mocked</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderGetCodeTests.test_get_code_source_not_found"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderGetCodeTests.test_get_code_source_not_found">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_source_not_found</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If there is no source then there is no code object.</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Frozen_ILGetCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_ILGetCodeTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_ILGetCodeTests</span><span class="p">(</span><span class="n">InspectLoaderGetCodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">InspectLoaderSubclass</span> <span class="o">=</span> <span class="n">Frozen_IL</span>
</div>
<div class="viewcode-block" id="Source_ILGetCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Source_ILGetCodeTests">[docs]</a><span class="k">class</span> <span class="nc">Source_ILGetCodeTests</span><span class="p">(</span><span class="n">InspectLoaderGetCodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">InspectLoaderSubclass</span> <span class="o">=</span> <span class="n">Source_IL</span>

</div>
<div class="viewcode-block" id="InspectLoaderLoadModuleTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderLoadModuleTests">[docs]</a><span class="k">class</span> <span class="nc">InspectLoaderLoadModuleTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Test InspectLoader.load_module().&quot;&quot;&quot;</span>

    <span class="n">module_name</span> <span class="o">=</span> <span class="s">&#39;blah&#39;</span>

<div class="viewcode-block" id="InspectLoaderLoadModuleTests.setUp"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderLoadModuleTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">support</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderLoadModuleTests.mock_get_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderLoadModuleTests.mock_get_code">[docs]</a>    <span class="k">def</span> <span class="nf">mock_get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">,</span> <span class="s">&#39;get_code&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderLoadModuleTests.test_get_code_ImportError"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderLoadModuleTests.test_get_code_ImportError">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_ImportError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If get_code() raises ImportError, it should propagate.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_get_code</span><span class="p">()</span> <span class="k">as</span> <span class="n">mocked_get_code</span><span class="p">:</span>
            <span class="n">mocked_get_code</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">ImportError</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
                <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
                    <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderLoadModuleTests.test_get_code_None"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderLoadModuleTests.test_get_code_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If get_code() returns None, raise ImportError.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_get_code</span><span class="p">()</span> <span class="k">as</span> <span class="n">mocked_get_code</span><span class="p">:</span>
            <span class="n">mocked_get_code</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
                <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
                <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InspectLoaderLoadModuleTests.test_module_returned"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.InspectLoaderLoadModuleTests.test_module_returned">[docs]</a>    <span class="k">def</span> <span class="nf">test_module_returned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The loaded module should be returned.</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">&#39;attr = 42&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_get_code</span><span class="p">()</span> <span class="k">as</span> <span class="n">mocked_get_code</span><span class="p">:</span>
            <span class="n">mocked_get_code</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">code</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">InspectLoaderSubclass</span><span class="p">()</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="Frozen_ILLoadModuleTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_ILLoadModuleTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_ILLoadModuleTests</span><span class="p">(</span><span class="n">InspectLoaderLoadModuleTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">InspectLoaderSubclass</span> <span class="o">=</span> <span class="n">Frozen_IL</span>
</div>
<div class="viewcode-block" id="Source_ILLoadModuleTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Source_ILLoadModuleTests">[docs]</a><span class="k">class</span> <span class="nc">Source_ILLoadModuleTests</span><span class="p">(</span><span class="n">InspectLoaderLoadModuleTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">InspectLoaderSubclass</span> <span class="o">=</span> <span class="n">Source_IL</span>


<span class="c">##### ExecutionLoader concrete methods #########################################</span></div>
<div class="viewcode-block" id="ExecutionLoaderGetCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderGetCodeTests">[docs]</a><span class="k">class</span> <span class="nc">ExecutionLoaderGetCodeTests</span><span class="p">:</span>

<div class="viewcode-block" id="ExecutionLoaderGetCodeTests.mock_methods"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderGetCodeTests.mock_methods">[docs]</a>    <span class="k">def</span> <span class="nf">mock_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">get_source</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">get_filename</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">source_mock_context</span><span class="p">,</span> <span class="n">filename_mock_context</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">get_source</span><span class="p">:</span>
            <span class="n">source_mock_context</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExecutionLoaderSubclass</span><span class="p">,</span>
                                                    <span class="s">&#39;get_source&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_filename</span><span class="p">:</span>
            <span class="n">filename_mock_context</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExecutionLoaderSubclass</span><span class="p">,</span>
                                                      <span class="s">&#39;get_filename&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">source_mock_context</span><span class="p">,</span> <span class="n">filename_mock_context</span>
</div>
<div class="viewcode-block" id="ExecutionLoaderGetCodeTests.test_get_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderGetCodeTests.test_get_code">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;blah.py&#39;</span>
        <span class="n">source_mock_context</span><span class="p">,</span> <span class="n">filename_mock_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_methods</span><span class="p">(</span>
                <span class="n">get_source</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">get_filename</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">source_mock_context</span> <span class="k">as</span> <span class="n">source_mock</span><span class="p">,</span> <span class="n">filename_mock_context</span> <span class="k">as</span> <span class="n">name_mock</span><span class="p">:</span>
            <span class="n">source_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">&#39;attr = 42&#39;</span>
            <span class="n">name_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExecutionLoaderSubclass</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExecutionLoaderGetCodeTests.test_get_code_source_is_None"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderGetCodeTests.test_get_code_source_is_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_source_is_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If get_source() is None then this should be None.</span>
        <span class="n">source_mock_context</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_methods</span><span class="p">(</span><span class="n">get_source</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">source_mock_context</span> <span class="k">as</span> <span class="n">mocked</span><span class="p">:</span>
            <span class="n">mocked</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExecutionLoaderSubclass</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExecutionLoaderGetCodeTests.test_get_code_source_not_found"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderGetCodeTests.test_get_code_source_not_found">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_source_not_found</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If there is no source then there is no code object.</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExecutionLoaderSubclass</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
            <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExecutionLoaderGetCodeTests.test_get_code_no_path"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.ExecutionLoaderGetCodeTests.test_get_code_no_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code_no_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If get_filename() raises ImportError then simply skip setting the path</span>
        <span class="c"># on the code object.</span>
        <span class="n">source_mock_context</span><span class="p">,</span> <span class="n">filename_mock_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mock_methods</span><span class="p">(</span>
                <span class="n">get_source</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">get_filename</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">source_mock_context</span> <span class="k">as</span> <span class="n">source_mock</span><span class="p">,</span> <span class="n">filename_mock_context</span> <span class="k">as</span> <span class="n">name_mock</span><span class="p">:</span>
            <span class="n">source_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">&#39;attr = 42&#39;</span>
            <span class="n">name_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">ImportError</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExecutionLoaderSubclass</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Frozen_ELGetCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_ELGetCodeTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_ELGetCodeTests</span><span class="p">(</span><span class="n">ExecutionLoaderGetCodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">ExecutionLoaderSubclass</span> <span class="o">=</span> <span class="n">Frozen_EL</span>
</div>
<div class="viewcode-block" id="Source_ELGetCodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Source_ELGetCodeTests">[docs]</a><span class="k">class</span> <span class="nc">Source_ELGetCodeTests</span><span class="p">(</span><span class="n">ExecutionLoaderGetCodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">ExecutionLoaderSubclass</span> <span class="o">=</span> <span class="n">Source_EL</span>


<span class="c">##### SourceLoader concrete methods ############################################</span></div>
<span class="k">class</span> <span class="nc">SourceLoader</span><span class="p">:</span>

    <span class="c"># Globals that should be defined for all modules.</span>
    <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;_ = &#39;::&#39;.join([__name__, __file__, __cached__, __package__, &quot;</span>
              <span class="n">b</span><span class="s">&quot;repr(__loader__)])&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>

    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

    <span class="k">def</span> <span class="nf">module_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;module&gt;&#39;</span>


<span class="n">Frozen_SourceOnlyL</span><span class="p">,</span> <span class="n">Source_SourceOnlyL</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">SourceLoader</span><span class="p">)</span>


<div class="viewcode-block" id="SourceLoader"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoader">[docs]</a><span class="k">class</span> <span class="nc">SourceLoader</span><span class="p">(</span><span class="n">SourceLoader</span><span class="p">):</span>

    <span class="n">source_mtime</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytecode_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">magic</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">magic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">MAGIC_NUMBER</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">magic</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_w_long</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_mtime</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_w_long</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_size</span><span class="p">))</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">,</span>
                                <span class="n">dont_inherit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">marshal</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">code_object</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">written</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="SourceLoader.get_data"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoader.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytecode_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span>
</div>
<div class="viewcode-block" id="SourceLoader.path_stats"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoader.path_stats">[docs]</a>    <span class="k">def</span> <span class="nf">path_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;mtime&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_mtime</span><span class="p">,</span> <span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_size</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="SourceLoader.set_data"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoader.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">written</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytecode_path</span>

</div></div>
<span class="n">Frozen_SL</span><span class="p">,</span> <span class="n">Source_SL</span> <span class="o">=</span> <span class="n">make_abc_subclasses</span><span class="p">(</span><span class="n">SourceLoader</span><span class="p">)</span>
<span class="n">Frozen_SL</span><span class="o">.</span><span class="n">util</span> <span class="o">=</span> <span class="n">frozen_util</span>
<span class="n">Source_SL</span><span class="o">.</span><span class="n">util</span> <span class="o">=</span> <span class="n">source_util</span>
<span class="n">Frozen_SL</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">frozen_init</span>
<span class="n">Source_SL</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">source_init</span>


<div class="viewcode-block" id="SourceLoaderTestHarness"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderTestHarness">[docs]</a><span class="k">class</span> <span class="nc">SourceLoaderTestHarness</span><span class="p">:</span>

<div class="viewcode-block" id="SourceLoaderTestHarness.setUp"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderTestHarness.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">is_package</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package</span> <span class="o">=</span> <span class="s">&#39;pkg&#39;</span>
        <span class="k">if</span> <span class="n">is_package</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="s">&#39;mod&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;mod&#39;</span><span class="p">,</span> <span class="s">&#39;py&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="p">,</span> <span class="n">module_name</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader_mock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceLoaderTestHarness.verify_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderTestHarness.verify_module">[docs]</a>    <span class="k">def</span> <span class="nf">verify_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__file__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__cached__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__package__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__loader__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">package</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SourceLoaderTestHarness.verify_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderTestHarness.verify_code">[docs]</a>    <span class="k">def</span> <span class="nf">verify_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_object</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__file__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__cached__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__path__</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">code_object</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SourceOnlyLoaderTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests">[docs]</a><span class="k">class</span> <span class="nc">SourceOnlyLoaderTests</span><span class="p">(</span><span class="n">SourceLoaderTestHarness</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Test importlib.abc.SourceLoader for source-only loading.</span>

<span class="sd">    Reload testing is subsumed by the tests for</span>
<span class="sd">    importlib.util.module_for_loader.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SourceOnlyLoaderTests.test_get_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_get_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify the source code is returned as a string.</span>
        <span class="c"># If an OSError is raised by get_data then raise ImportError.</span>
        <span class="n">expected_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">expected_source</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">raise_OSError</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_data</span> <span class="o">=</span> <span class="n">raise_OSError</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceOnlyLoaderTests.test_is_package"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_is_package">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Properly detect when loading a package.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">is_package</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">is_package</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">is_package</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">is_package</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">is_package</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.__init__&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SourceOnlyLoaderTests.test_get_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_get_code">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify the code object is created.</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceOnlyLoaderTests.test_source_to_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_source_to_code">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_to_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify the compiled code object.</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_to_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceOnlyLoaderTests.test_load_module"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_load_module">[docs]</a>    <span class="k">def</span> <span class="nf">test_load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Loading a module should set __name__, __loader__, __package__,</span>
        <span class="c"># __path__ (for packages), __file__, and __cached__.</span>
        <span class="c"># The module should also be put into sys.modules.</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
                <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__path__</span><span class="p">,</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceOnlyLoaderTests.test_package_settings"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_package_settings">[docs]</a>    <span class="k">def</span> <span class="nf">test_package_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># __package__ needs to be set, while __path__ is set on if the module</span>
        <span class="c"># is a package.</span>
        <span class="c"># Testing the values for a package are covered by test_load_module.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">is_package</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">uncache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
                <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&#39;__path__&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SourceOnlyLoaderTests.test_get_source_encoding"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceOnlyLoaderTests.test_get_source_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_source_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Source is considered encoded in UTF-8 by default unless otherwise</span>
        <span class="c"># specified by an encoding line.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&quot;_ = &#39;ü&#39;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">returned_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">returned_source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&quot;# coding: latin-1</span><span class="se">\n</span><span class="s">_ = ü&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span>
        <span class="n">returned_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">returned_source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Frozen_SourceOnlyLTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_SourceOnlyLTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_SourceOnlyLTests</span><span class="p">(</span><span class="n">SourceOnlyLoaderTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">loader_mock</span> <span class="o">=</span> <span class="n">Frozen_SourceOnlyL</span>
    <span class="n">util</span> <span class="o">=</span> <span class="n">frozen_util</span>
</div>
<div class="viewcode-block" id="Source_SourceOnlyLTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Source_SourceOnlyLTests">[docs]</a><span class="k">class</span> <span class="nc">Source_SourceOnlyLTests</span><span class="p">(</span><span class="n">SourceOnlyLoaderTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">loader_mock</span> <span class="o">=</span> <span class="n">Source_SourceOnlyL</span>
    <span class="n">util</span> <span class="o">=</span> <span class="n">source_util</span>

</div>
<span class="nd">@unittest.skipIf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span><span class="p">,</span> <span class="s">&quot;sys.dont_write_bytecode is true&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="SourceLoaderBytecodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests">[docs]</a><span class="k">class</span> <span class="nc">SourceLoaderBytecodeTests</span><span class="p">(</span><span class="n">SourceLoaderTestHarness</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Test importlib.abc.SourceLoader&#39;s use of bytecode.</span>

<span class="sd">    Source-only testing handled by SourceOnlyLoaderTests.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SourceLoaderBytecodeTests.verify_code"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.verify_code">[docs]</a>    <span class="k">def</span> <span class="nf">verify_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_object</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">bytecode_written</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bytecode_written</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">written</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">MAGIC_NUMBER</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_w_long</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_mtime</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">_w_long</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_size</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">marshal</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">code_object</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">written</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_code_with_everything"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_code_with_everything">[docs]</a>    <span class="k">def</span> <span class="nf">test_code_with_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When everything should work.</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_no_bytecode"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_no_bytecode">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_bytecode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If no bytecode exists then move on to the source.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">bytecode_path</span> <span class="o">=</span> <span class="s">&quot;&lt;does not exist&gt;&quot;</span>
        <span class="c"># Sanity check</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">):</span>
            <span class="n">bytecode_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">bytecode_path</span><span class="p">)</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">,</span> <span class="n">bytecode_written</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_code_bad_timestamp"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_code_bad_timestamp">[docs]</a>    <span class="k">def</span> <span class="nf">test_code_bad_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Bytecode is only used when the timestamp matches the source EXACTLY.</span>
        <span class="k">for</span> <span class="n">source_mtime</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">source_mtime</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_mtime</span>
            <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_mtime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_mtime</span> <span class="o">=</span> <span class="n">source_mtime</span>
            <span class="c"># If bytecode is used then EOFError would be raised by marshal.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
            <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">,</span> <span class="n">bytecode_written</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">source_mtime</span> <span class="o">=</span> <span class="n">original</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_code_bad_magic"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_code_bad_magic">[docs]</a>    <span class="k">def</span> <span class="nf">test_code_bad_magic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Skip over bytecode with a bad magic number.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">magic</span><span class="o">=</span><span class="n">b</span><span class="s">&#39;0000&#39;</span><span class="p">)</span>
        <span class="c"># If bytecode is used then EOFError would be raised by marshal.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">,</span> <span class="n">bytecode_written</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_dont_write_bytecode"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_dont_write_bytecode">[docs]</a>    <span class="k">def</span> <span class="nf">test_dont_write_bytecode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Bytecode is not written if sys.dont_write_bytecode is true.</span>
        <span class="c"># Can assume it is false already thanks to the skipIf class decorator.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">bytecode_path</span> <span class="o">=</span> <span class="s">&quot;&lt;does not exist&gt;&quot;</span>
            <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">written</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_no_set_data"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_no_set_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># If set_data is not defined, one can still read bytecode.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">magic</span><span class="o">=</span><span class="n">b</span><span class="s">&#39;0000&#39;</span><span class="p">)</span>
        <span class="n">original_set_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span>
            <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span> <span class="o">=</span> <span class="n">original_set_data</span>
</div>
<div class="viewcode-block" id="SourceLoaderBytecodeTests.test_set_data_raises_exceptions"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderBytecodeTests.test_set_data_raises_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_data_raises_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Raising NotImplementedError or OSError is okay for set_data.</span>
        <span class="k">def</span> <span class="nf">raise_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">closure</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">exc</span>
            <span class="k">return</span> <span class="n">closure</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">magic</span><span class="o">=</span><span class="n">b</span><span class="s">&#39;0000&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">set_data</span> <span class="o">=</span> <span class="n">raise_exception</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">)</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_code</span><span class="p">(</span><span class="n">code_object</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Frozen_SLBytecodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_SLBytecodeTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_SLBytecodeTests</span><span class="p">(</span><span class="n">SourceLoaderBytecodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">loader_mock</span> <span class="o">=</span> <span class="n">Frozen_SL</span>
    <span class="n">init</span> <span class="o">=</span> <span class="n">frozen_init</span>
    <span class="n">util</span> <span class="o">=</span> <span class="n">frozen_util</span>
</div>
<div class="viewcode-block" id="SourceSLBytecodeTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceSLBytecodeTests">[docs]</a><span class="k">class</span> <span class="nc">SourceSLBytecodeTests</span><span class="p">(</span><span class="n">SourceLoaderBytecodeTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">loader_mock</span> <span class="o">=</span> <span class="n">Source_SL</span>
    <span class="n">init</span> <span class="o">=</span> <span class="n">source_init</span>
    <span class="n">util</span> <span class="o">=</span> <span class="n">source_util</span>

</div>
<div class="viewcode-block" id="SourceLoaderGetSourceTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderGetSourceTests">[docs]</a><span class="k">class</span> <span class="nc">SourceLoaderGetSourceTests</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Tests for importlib.abc.SourceLoader.get_source().&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SourceLoaderGetSourceTests.test_default_encoding"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderGetSourceTests.test_default_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_default_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Should have no problems with UTF-8 text.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;mod&#39;</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SourceOnlyLoaderMock</span><span class="p">(</span><span class="s">&#39;mod.file&#39;</span><span class="p">)</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&#39;x = &quot;ü&quot;&#39;</span>
        <span class="n">mock</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">returned_source</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">returned_source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceLoaderGetSourceTests.test_decoded_source"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderGetSourceTests.test_decoded_source">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoded_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Decoding should work.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;mod&#39;</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SourceOnlyLoaderMock</span><span class="p">(</span><span class="s">&quot;mod.file&quot;</span><span class="p">)</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&quot;# coding: Latin-1</span><span class="se">\n</span><span class="s">x=&#39;ü&#39;&quot;</span>
        <span class="k">assert</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">mock</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span>
        <span class="n">returned_source</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">returned_source</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SourceLoaderGetSourceTests.test_universal_newlines"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.SourceLoaderGetSourceTests.test_universal_newlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_universal_newlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># PEP 302 says universal newlines should be used.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;mod&#39;</span>
        <span class="n">mock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SourceOnlyLoaderMock</span><span class="p">(</span><span class="s">&#39;mod.file&#39;</span><span class="p">)</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">&quot;x = 42</span><span class="se">\r\n</span><span class="s">y = -13</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">mock</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">IncrementalNewlineDecoder</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">expect</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Frozen_SourceOnlyLGetSourceTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Frozen_SourceOnlyLGetSourceTests">[docs]</a><span class="k">class</span> <span class="nc">Frozen_SourceOnlyLGetSourceTests</span><span class="p">(</span><span class="n">SourceLoaderGetSourceTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">SourceOnlyLoaderMock</span> <span class="o">=</span> <span class="n">Frozen_SourceOnlyL</span>
</div>
<div class="viewcode-block" id="Source_SourceOnlyLGetSourceTests"><a class="viewcode-back" href="../../../test.test_importlib.html#test.test_importlib.test_abc.Source_SourceOnlyLGetSourceTests">[docs]</a><span class="k">class</span> <span class="nc">Source_SourceOnlyLGetSourceTests</span><span class="p">(</span><span class="n">SourceLoaderGetSourceTests</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">SourceOnlyLoaderMock</span> <span class="o">=</span> <span class="n">Source_SourceOnlyL</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>