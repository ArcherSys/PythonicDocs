

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_ftplib &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_ftplib</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_ftplib</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Test script for ftplib module.&quot;&quot;&quot;</span>

<span class="c"># Modified by Giampaolo Rodola&#39; to test FTP class, IPv6 and TLS</span>
<span class="c"># environment</span>

<span class="kn">import</span> <span class="nn">ftplib</span>
<span class="kn">import</span> <span class="nn">asyncore</span>
<span class="kn">import</span> <span class="nn">asynchat</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ssl</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">HAS_SNI</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ssl</span> <span class="kn">import</span> <span class="n">HAS_SNI</span>

<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">skipUnless</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="n">HOST</span><span class="p">,</span> <span class="n">HOSTv6</span>
<span class="n">threading</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;threading&#39;</span><span class="p">)</span>

<span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">3</span>
<span class="c"># the dummy data returned by server over the data channel when</span>
<span class="c"># RETR, LIST, NLST, MLSD commands are issued</span>
<span class="n">RETR_DATA</span> <span class="o">=</span> <span class="s">&#39;abcde12345</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1000</span>
<span class="n">LIST_DATA</span> <span class="o">=</span> <span class="s">&#39;foo</span><span class="se">\r\n</span><span class="s">bar</span><span class="se">\r\n</span><span class="s">&#39;</span>
<span class="n">NLST_DATA</span> <span class="o">=</span> <span class="s">&#39;foo</span><span class="se">\r\n</span><span class="s">bar</span><span class="se">\r\n</span><span class="s">&#39;</span>
<span class="n">MLSD_DATA</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;type=cdir;perm=el;unique==keVO1+ZF4; test</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=pdir;perm=e;unique==keVO1+d?3; ..</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=OS.unix=slink:/foobar;perm=;unique==keVO1+4G4; foobar</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=OS.unix=chr-13/29;perm=;unique==keVO1+5G4; device</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=OS.unix=blk-11/108;perm=;unique==keVO1+6G4; block</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=awr;unique==keVO1+8G4; writable</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=dir;perm=cpmel;unique==keVO1+7G4; promiscuous</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=dir;perm=;unique==keVO1+1t2; no-exec</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=r;unique==keVO1+EG4; two words</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=r;unique==keVO1+IH4;  leading space</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=r;unique==keVO1+1G4; file1</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=dir;perm=cpmel;unique==keVO1+7G4; incoming</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=r;unique==keVO1+1G4; file2</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=r;unique==keVO1+1G4; file3</span><span class="se">\r\n</span><span class="s">&quot;</span>
             <span class="s">&quot;type=file;perm=r;unique==keVO1+1G4; file4</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="DummyDTPHandler"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyDTPHandler">[docs]</a><span class="k">class</span> <span class="nc">DummyDTPHandler</span><span class="p">(</span><span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="p">):</span>
    <span class="n">dtp_conn_closed</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">baseclass</span><span class="p">):</span>
        <span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span> <span class="o">=</span> <span class="n">baseclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">last_received_data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<div class="viewcode-block" id="DummyDTPHandler.handle_read"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyDTPHandler.handle_read">[docs]</a>    <span class="k">def</span> <span class="nf">handle_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">last_received_data</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyDTPHandler.handle_close"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyDTPHandler.handle_close">[docs]</a>    <span class="k">def</span> <span class="nf">handle_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># XXX: this method can be called many times in a row for a single</span>
        <span class="c"># connection, including in clear-text (non-TLS) mode.</span>
        <span class="c"># (behaviour witnessed with test_data_connection)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtp_conn_closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;226 transfer complete&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtp_conn_closed</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="DummyDTPHandler.push"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyDTPHandler.push">[docs]</a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">next_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">what</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">next_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">next_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">what</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_when_done</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DummyDTPHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">what</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DummyDTPHandler.handle_error"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyDTPHandler.handle_error">[docs]</a>    <span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span>

</div></div>
<div class="viewcode-block" id="DummyFTPHandler"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler">[docs]</a><span class="k">class</span> <span class="nc">DummyFTPHandler</span><span class="p">(</span><span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="p">):</span>

    <span class="n">dtp_handler</span> <span class="o">=</span> <span class="n">DummyDTPHandler</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
        <span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
        <span class="c"># tells the socket to handle urgent data inline (ABOR command)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_OOBINLINE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_terminator</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_received_cmd</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_received_data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_response</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_retr_data</span> <span class="o">=</span> <span class="n">RETR_DATA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;220 welcome&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DummyFTPHandler.collect_incoming_data"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.collect_incoming_data">[docs]</a>    <span class="k">def</span> <span class="nf">collect_incoming_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.found_terminator"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.found_terminator">[docs]</a>    <span class="k">def</span> <span class="nf">found_terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_buffer</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_response</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_response</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_received_cmd</span> <span class="o">=</span> <span class="n">cmd</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">space</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">space</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;cmd_&#39;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;cmd_&#39;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">)</span>
            <span class="n">method</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;550 command &quot;</span><span class="si">%s</span><span class="s">&quot; not understood.&#39;</span> <span class="o">%</span><span class="n">cmd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.handle_error"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.handle_error">[docs]</a>    <span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.push"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.push">[docs]</a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_port"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_port">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">.</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">addr</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span><span class="p">)</span> <span class="o">+</span> <span class="n">addr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtp_handler</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">baseclass</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 active data connection established&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_pasv"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_pasv">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_pasv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">)</span>
            <span class="n">ip</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">);</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">port</span> <span class="o">/</span> <span class="mi">256</span><span class="p">;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">port</span> <span class="o">%</span> <span class="mi">256</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;227 entering passive mode (</span><span class="si">%s</span><span class="s">,</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>
            <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtp_handler</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">baseclass</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_eprt"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_eprt">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_eprt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">af</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtp_handler</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">baseclass</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 active data connection established&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_epsv"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_epsv">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_epsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;229 entering extended passive mode (|||</span><span class="si">%d</span><span class="s">|)&#39;</span> <span class="o">%</span><span class="n">port</span><span class="p">)</span>
            <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtp_handler</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">baseclass</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_echo"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_echo">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="c"># sends back the received string (used by the test suite)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_noop"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_noop">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_noop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 noop ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_user"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_user">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;331 username ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_pass"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_pass">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;230 password ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_acct"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_acct">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_acct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;230 acct ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_rnfr"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_rnfr">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_rnfr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;350 rnfr ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_rnto"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_rnto">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_rnto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;250 rnto ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_dele"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_dele">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_dele</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;250 dele ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_cwd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_cwd">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;250 cwd ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_size"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_size">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;250 1000&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_mkd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_mkd">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_mkd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;257 &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span><span class="n">arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_rmd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_rmd">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_rmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;250 rmd ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_pwd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_pwd">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_pwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;257 &quot;pwd ok&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_type"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_type">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 type ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_quit"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_quit">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;221 quit ok&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_abor"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_abor">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_abor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;226 abor ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_stor"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_stor">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_stor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;125 stor ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_rest"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_rest">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;350 rest ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_retr"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_retr">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_retr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;125 retr ok&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_retr_data</span><span class="p">[</span><span class="n">offset</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">close_when_done</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_list"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_list">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;125 list ok&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">LIST_DATA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">close_when_done</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_nlst"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_nlst">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_nlst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;125 nlst ok&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">NLST_DATA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">close_when_done</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_opts"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_opts">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 opts ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_mlsd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_mlsd">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_mlsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;125 mlsd ok&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">MLSD_DATA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtp</span><span class="o">.</span><span class="n">close_when_done</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyFTPHandler.cmd_setlongretr"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPHandler.cmd_setlongretr">[docs]</a>    <span class="k">def</span> <span class="nf">cmd_setlongretr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="c"># For testing. Next RETR will return long line.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_retr_data</span> <span class="o">=</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;125 setlongretr ok&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DummyFTPServer"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer">[docs]</a><span class="k">class</span> <span class="nc">DummyFTPServer</span><span class="p">(</span><span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="p">,</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">DummyFTPHandler</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">af</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_socket</span><span class="p">(</span><span class="n">af</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler_instance</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="DummyFTPServer.start"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flag</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flag</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyFTPServer.run"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flag</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="ow">and</span> <span class="n">asyncore</span><span class="o">.</span><span class="n">socket_map</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="n">asyncore</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">asyncore</span><span class="o">.</span><span class="n">close_all</span><span class="p">(</span><span class="n">ignore_all</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPServer.stop"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyFTPServer.handle_accepted"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.handle_accepted">[docs]</a>    <span class="k">def</span> <span class="nf">handle_accepted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyFTPServer.handle_connect"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.handle_connect">[docs]</a>    <span class="k">def</span> <span class="nf">handle_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    <span class="n">handle_read</span> <span class="o">=</span> <span class="n">handle_connect</span>

<div class="viewcode-block" id="DummyFTPServer.writable"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.writable">[docs]</a>    <span class="k">def</span> <span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="DummyFTPServer.handle_error"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyFTPServer.handle_error">[docs]</a>    <span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span>

</div></div>
<span class="k">if</span> <span class="n">ssl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

    <span class="n">CERTFILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;keycert3.pem&quot;</span><span class="p">)</span>
    <span class="n">CAFILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;pycacert.pem&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SSLConnection"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection">[docs]</a>    <span class="k">class</span> <span class="nc">SSLConnection</span><span class="p">(</span><span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An asyncore.dispatcher subclass supporting TLS/SSL.&quot;&quot;&quot;</span>

        <span class="n">_ssl_accepting</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">_ssl_closing</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="SSLConnection.secure_connection"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.secure_connection">[docs]</a>        <span class="k">def</span> <span class="nf">secure_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">socket</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">,</span> <span class="n">suppress_ragged_eofs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                     <span class="n">certfile</span><span class="o">=</span><span class="n">CERTFILE</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">do_handshake_on_connect</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                     <span class="n">ssl_version</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_SSLv23</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">del_channel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_socket</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_accepting</span> <span class="o">=</span> <span class="bp">True</span>
</div>
        <span class="k">def</span> <span class="nf">_do_ssl_handshake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">do_handshake</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_READ</span><span class="p">,</span>
                                   <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_WRITE</span><span class="p">):</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_EOF</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_close</span><span class="p">()</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ECONNABORTED</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_accepting</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">def</span> <span class="nf">_do_ssl_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_closing</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_READ</span><span class="p">,</span>
                                   <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_WRITE</span><span class="p">):</span>
                    <span class="k">return</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="c"># Any &quot;socket error&quot; corresponds to a SSL_ERROR_SYSCALL return</span>
                <span class="c"># from OpenSSL&#39;s SSL_shutdown(), corresponding to a</span>
                <span class="c"># closed socket condition. See also:</span>
                <span class="c"># http://www.mail-archive.com/openssl-users@openssl.org/msg60710.html</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_closing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_ccc&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

<div class="viewcode-block" id="SSLConnection.handle_read_event"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.handle_read_event">[docs]</a>        <span class="k">def</span> <span class="nf">handle_read_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_accepting</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_ssl_handshake</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_closing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_ssl_shutdown</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">handle_read_event</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSLConnection.handle_write_event"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.handle_write_event">[docs]</a>        <span class="k">def</span> <span class="nf">handle_write_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_accepting</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_ssl_handshake</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_closing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_ssl_shutdown</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">handle_write_event</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSLConnection.send"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.send">[docs]</a>        <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_EOF</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_ZERO_RETURN</span><span class="p">,</span>
                                   <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_READ</span><span class="p">,</span>
                                   <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_WRITE</span><span class="p">):</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="k">raise</span>
</div>
<div class="viewcode-block" id="SSLConnection.recv"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.recv">[docs]</a>        <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_READ</span><span class="p">,</span>
                                   <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_WRITE</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_EOF</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSL_ERROR_ZERO_RETURN</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">handle_close</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
                <span class="k">raise</span>
</div>
<div class="viewcode-block" id="SSLConnection.handle_error"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.handle_error">[docs]</a>        <span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span>
</div>
<div class="viewcode-block" id="SSLConnection.close"><a class="viewcode-back" href="../../test.html#test.test_ftplib.SSLConnection.close">[docs]</a>        <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">_sslobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_ssl_shutdown</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="DummyTLS_DTPHandler"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_DTPHandler">[docs]</a>    <span class="k">class</span> <span class="nc">DummyTLS_DTPHandler</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="n">DummyDTPHandler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A DummyDTPHandler subclass supporting TLS/SSL.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">baseclass</span><span class="p">):</span>
            <span class="n">DummyDTPHandler</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">baseclass</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseclass</span><span class="o">.</span><span class="n">secure_data_channel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secure_connection</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="DummyTLS_FTPHandler"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_FTPHandler">[docs]</a>    <span class="k">class</span> <span class="nc">DummyTLS_FTPHandler</span><span class="p">(</span><span class="n">SSLConnection</span><span class="p">,</span> <span class="n">DummyFTPHandler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A DummyFTPHandler subclass supporting TLS/SSL.&quot;&quot;&quot;</span>

        <span class="n">dtp_handler</span> <span class="o">=</span> <span class="n">DummyTLS_DTPHandler</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
            <span class="n">DummyFTPHandler</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secure_data_channel</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccc</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="DummyTLS_FTPHandler.cmd_auth"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_FTPHandler.cmd_auth">[docs]</a>        <span class="k">def</span> <span class="nf">cmd_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set up secure control channel.&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;234 AUTH TLS successful&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secure_connection</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyTLS_FTPHandler.cmd_ccc"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_FTPHandler.cmd_ccc">[docs]</a>        <span class="k">def</span> <span class="nf">cmd_ccc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;220 Reverting back to clear-text&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccc</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_ssl_shutdown</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DummyTLS_FTPHandler.cmd_pbsz"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_FTPHandler.cmd_pbsz">[docs]</a>        <span class="k">def</span> <span class="nf">cmd_pbsz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Negotiate size of buffer for secure data transfer.</span>
<span class="sd">            For TLS/SSL the only valid value for the parameter is &#39;0&#39;.</span>
<span class="sd">            Any other value is accepted but ignored.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 PBSZ=0 successful.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DummyTLS_FTPHandler.cmd_prot"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_FTPHandler.cmd_prot">[docs]</a>        <span class="k">def</span> <span class="nf">cmd_prot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Setup un/secure data channel.&quot;&quot;&quot;</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 Protection set to Clear&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secure_data_channel</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;200 Protection set to Private&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">secure_data_channel</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&quot;502 Unrecognized PROT type (use C or P).&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DummyTLS_FTPServer"><a class="viewcode-back" href="../../test.html#test.test_ftplib.DummyTLS_FTPServer">[docs]</a>    <span class="k">class</span> <span class="nc">DummyTLS_FTPServer</span><span class="p">(</span><span class="n">DummyFTPServer</span><span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">DummyTLS_FTPHandler</span>

</div>
<div class="viewcode-block" id="TestFTPClass"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass">[docs]</a><span class="k">class</span> <span class="nc">TestFTPClass</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestFTPClass.setUp"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">DummyFTPServer</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.tearDown"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestFTPClass.check_data"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.check_data">[docs]</a>    <span class="k">def</span> <span class="nf">check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">received</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">received</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">received</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_getwelcome"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_getwelcome">[docs]</a>    <span class="k">def</span> <span class="nf">test_getwelcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getwelcome</span><span class="p">(),</span> <span class="s">&#39;220 welcome&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_sanitize"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_sanitize">[docs]</a>    <span class="k">def</span> <span class="nf">test_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="s">&#39;pass 12345&#39;</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="s">&#39;pass *****&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="s">&#39;PASS 12345&#39;</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="s">&#39;PASS *****&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_exceptions"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">,</span> <span class="s">&#39;echo 400&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">,</span> <span class="s">&#39;echo 499&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_perm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">,</span> <span class="s">&#39;echo 500&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_perm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">,</span> <span class="s">&#39;echo 599&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_proto</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">,</span> <span class="s">&#39;echo 999&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_all_errors"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_all_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_all_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">exceptions</span> <span class="o">=</span> <span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_reply</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">error_temp</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">error_perm</span><span class="p">,</span>
                      <span class="n">ftplib</span><span class="o">.</span><span class="n">error_proto</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">x</span><span class="p">(</span><span class="s">&#39;exception not included in all_errors set&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">all_errors</span><span class="p">:</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_set_pasv"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_set_pasv">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_pasv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># passive mode is supposed to be enabled by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">passiveserver</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_pasv</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">passiveserver</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_pasv</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">passiveserver</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_voidcmd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_voidcmd">[docs]</a>    <span class="k">def</span> <span class="nf">test_voidcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidcmd</span><span class="p">(</span><span class="s">&#39;echo 200&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidcmd</span><span class="p">(</span><span class="s">&#39;echo 299&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_reply</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidcmd</span><span class="p">,</span> <span class="s">&#39;echo 199&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_reply</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidcmd</span><span class="p">,</span> <span class="s">&#39;echo 300&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_login"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_login">[docs]</a>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_acct"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_acct">[docs]</a>    <span class="k">def</span> <span class="nf">test_acct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">acct</span><span class="p">(</span><span class="s">&#39;passwd&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_rename"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_rename">[docs]</a>    <span class="k">def</span> <span class="nf">test_rename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">next_response</span> <span class="o">=</span> <span class="s">&#39;200&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_reply</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">rename</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_delete"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_delete">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">next_response</span> <span class="o">=</span> <span class="s">&#39;199&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_reply</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_size"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_mkd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_mkd">[docs]</a>    <span class="k">def</span> <span class="nf">test_mkd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mkd</span><span class="p">(</span><span class="s">&#39;/foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&#39;/foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_rmd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_rmd">[docs]</a>    <span class="k">def</span> <span class="nf">test_rmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">rmd</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_cwd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_cwd">[docs]</a>    <span class="k">def</span> <span class="nf">test_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="s">&#39;/foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&#39;250 cwd ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_pwd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_pwd">[docs]</a>    <span class="k">def</span> <span class="nf">test_pwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">&#39;pwd ok&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_quit"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_quit">[docs]</a>    <span class="k">def</span> <span class="nf">test_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">(),</span> <span class="s">&#39;221 quit ok&#39;</span><span class="p">)</span>
        <span class="c"># Ensure the connection gets closed; sock attribute should be None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_abort"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_abort">[docs]</a>    <span class="k">def</span> <span class="nf">test_abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_retrbinary"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_retrbinary">[docs]</a>    <span class="k">def</span> <span class="nf">test_retrbinary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s">&#39;retr&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_data</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">received</span><span class="p">),</span> <span class="n">RETR_DATA</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_retrbinary_rest"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_retrbinary_rest">[docs]</a>    <span class="k">def</span> <span class="nf">test_retrbinary_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">rest</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
            <span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s">&#39;retr&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">rest</span><span class="o">=</span><span class="n">rest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_data</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">received</span><span class="p">),</span> <span class="n">RETR_DATA</span><span class="p">[</span><span class="n">rest</span><span class="p">:])</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_retrlines"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_retrlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_retrlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrlines</span><span class="p">(</span><span class="s">&#39;retr&#39;</span><span class="p">,</span> <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_data</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">received</span><span class="p">),</span> <span class="n">RETR_DATA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_storbinary"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_storbinary">[docs]</a>    <span class="k">def</span> <span class="nf">test_storbinary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">RETR_DATA</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="s">&#39;stor&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_data</span><span class="p">,</span> <span class="n">RETR_DATA</span><span class="p">)</span>
        <span class="c"># test new callback arg</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="s">&#39;stor&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">flag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_storbinary_rest"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_storbinary_rest">[docs]</a>    <span class="k">def</span> <span class="nf">test_storbinary_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">RETR_DATA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;30&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="s">&#39;stor&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rest</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_storlines"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_storlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_storlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">RETR_DATA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storlines</span><span class="p">(</span><span class="s">&#39;stor&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_data</span><span class="p">,</span> <span class="n">RETR_DATA</span><span class="p">)</span>
        <span class="c"># test new callback arg</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storlines</span><span class="p">(</span><span class="s">&#39;stor foo&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">flag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">RETR_DATA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="c"># storlines() expects a binary file, not a text file</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">BytesWarning</span><span class="p">),</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storlines</span><span class="p">,</span> <span class="s">&#39;stor foo&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_nlst"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_nlst">[docs]</a>    <span class="k">def</span> <span class="nf">test_nlst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">nlst</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">nlst</span><span class="p">(),</span> <span class="n">NLST_DATA</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_dir"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_dir">[docs]</a>    <span class="k">def</span> <span class="nf">test_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">dir</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">LIST_DATA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_mlsd"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_mlsd">[docs]</a>    <span class="k">def</span> <span class="nf">test_mlsd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">())</span>
        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">facts</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">]))</span>

        <span class="n">ls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">facts</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">facts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">facts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;perm&#39;</span><span class="p">,</span> <span class="n">facts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">&#39;unique&#39;</span><span class="p">,</span> <span class="n">facts</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">next_data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">def</span> <span class="nf">test_entry</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="s">&#39;type&#39;</span> <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">type</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="s">&#39;perm&#39;</span> <span class="k">if</span> <span class="n">perm</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">perm</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="s">&#39;unique&#39;</span> <span class="k">if</span> <span class="n">unique</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">unique</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;name&#39;</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">name</span>
            <span class="n">set_data</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">_name</span><span class="p">,</span> <span class="n">facts</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;perm&#39;</span><span class="p">],</span> <span class="n">perm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">facts</span><span class="p">[</span><span class="s">&#39;unique&#39;</span><span class="p">],</span> <span class="n">unique</span><span class="p">)</span>

        <span class="c"># plain</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c"># &quot;=&quot; in fact value</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=ty=pe;perm=perm;unique=unique; name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;ty=pe&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type==type;perm=perm;unique=unique; name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;=type&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=t=y=pe;perm=perm;unique=unique; name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;t=y=pe&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=====;perm=perm;unique=unique; name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;====&quot;</span><span class="p">)</span>
        <span class="c"># spaces in name</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; na me</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;na me&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; name </span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;name &quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique;  name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot; name&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; n am  e</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;n am  e&quot;</span><span class="p">)</span>
        <span class="c"># &quot;;&quot; in name</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; na;me</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;na;me&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; ;name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;;name&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; ;name;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;;name;&quot;</span><span class="p">)</span>
        <span class="n">test_entry</span><span class="p">(</span><span class="s">&#39;type=type;perm=perm;unique=unique; ;;;;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;;;;;&quot;</span><span class="p">)</span>
        <span class="c"># case sensitiveness</span>
        <span class="n">set_data</span><span class="p">(</span><span class="s">&#39;Type=type;TyPe=perm;UNIQUE=unique; name</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">_name</span><span class="p">,</span> <span class="n">facts</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">facts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">islower</span><span class="p">())</span>
        <span class="c"># no data (directory empty)</span>
        <span class="n">set_data</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">())</span>
        <span class="n">set_data</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mlsd</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;unexpected data </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_makeport"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_makeport">[docs]</a>    <span class="k">def</span> <span class="nf">test_makeport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">makeport</span><span class="p">():</span>
            <span class="c"># IPv4 is in use, just make sure send_eprt has not been used</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span>
                                <span class="s">&#39;port&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_makepasv"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_makepasv">[docs]</a>    <span class="k">def</span> <span class="nf">test_makepasv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">makepasv</span><span class="p">()</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c"># IPv4 is in use, just make sure send_epsv has not been used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span> <span class="s">&#39;pasv&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_with_statement"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_with_statement">[docs]</a>    <span class="k">def</span> <span class="nf">test_with_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">is_client_connected</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">(</span><span class="s">&#39;noop&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="c"># base test</span>
        <span class="k">with</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span> <span class="k">as</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">(</span><span class="s">&#39;noop&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_client_connected</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span> <span class="s">&#39;quit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_client_connected</span><span class="p">())</span>

        <span class="c"># QUIT sent inside the with block</span>
        <span class="k">with</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span> <span class="k">as</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">(</span><span class="s">&#39;noop&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span> <span class="s">&#39;quit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_client_connected</span><span class="p">())</span>

        <span class="c"># force a wrong response code to be sent on QUIT: error_perm</span>
        <span class="c"># is expected and the connection is supposed to be closed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span> <span class="k">as</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">(</span><span class="s">&#39;noop&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">next_response</span> <span class="o">=</span> <span class="s">&#39;550 error on quit&#39;</span>
        <span class="k">except</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">error_perm</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="s">&#39;550 error on quit&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Exception not raised&#39;</span><span class="p">)</span>
        <span class="c"># needed to give the threaded server some time to set the attribute</span>
        <span class="c"># which otherwise would still be == &#39;noop&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span> <span class="s">&#39;quit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_client_connected</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_source_address"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_source_address">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">find_unused_port</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                                <span class="n">source_address</span><span class="o">=</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EADDRINUSE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;couldn&#39;t bind to port </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">port</span><span class="p">)</span>
            <span class="k">raise</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_source_address_passive_connection"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_source_address_passive_connection">[docs]</a>    <span class="k">def</span> <span class="nf">test_source_address_passive_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">find_unused_port</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">source_address</span> <span class="o">=</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">port</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EADDRINUSE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;couldn&#39;t bind to port </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">port</span><span class="p">)</span>
            <span class="k">raise</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_parse257"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_parse257">[docs]</a>    <span class="k">def</span> <span class="nf">test_parse257</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">(</span><span class="s">&#39;257 &quot;/foo/bar&quot;&#39;</span><span class="p">),</span> <span class="s">&#39;/foo/bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">(</span><span class="s">&#39;257 &quot;/foo/bar&quot; created&#39;</span><span class="p">),</span> <span class="s">&#39;/foo/bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">(</span><span class="s">&#39;257 &quot;&quot;&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">(</span><span class="s">&#39;257 &quot;&quot; created&#39;</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">error_reply</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">,</span> <span class="s">&#39;250 &quot;/foo/bar&quot;&#39;</span><span class="p">)</span>
        <span class="c"># The 257 response is supposed to include the directory</span>
        <span class="c"># name and in case it contains embedded double-quotes</span>
        <span class="c"># they must be doubled (see RFC-959, chapter 7, appendix 2).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">(</span><span class="s">&#39;257 &quot;/foo/b&quot;&quot;ar&quot;&#39;</span><span class="p">),</span> <span class="s">&#39;/foo/b&quot;ar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">parse257</span><span class="p">(</span><span class="s">&#39;257 &quot;/foo/b&quot;&quot;ar&quot; created&#39;</span><span class="p">),</span> <span class="s">&#39;/foo/b&quot;ar&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_line_too_long"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_line_too_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_line_too_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">,</span>
                          <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">maxline</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_retrlines_too_long"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_retrlines_too_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_retrlines_too_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sendcmd</span><span class="p">(</span><span class="s">&#39;SETLONGRETR </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">maxline</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrlines</span><span class="p">,</span> <span class="s">&#39;retr&#39;</span><span class="p">,</span> <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestFTPClass.test_storlines_too_long"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestFTPClass.test_storlines_too_long">[docs]</a>    <span class="k">def</span> <span class="nf">test_storlines_too_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">maxline</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ftplib</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">storlines</span><span class="p">,</span> <span class="s">&#39;stor&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

</div></div>
<span class="nd">@skipUnless</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">IPV6_ENABLED</span><span class="p">,</span> <span class="s">&quot;IPv6 not enabled&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestIPv6Environment"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment">[docs]</a><span class="k">class</span> <span class="nc">TestIPv6Environment</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestIPv6Environment.setUp"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">DummyFTPServer</span><span class="p">((</span><span class="n">HOSTv6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">af</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIPv6Environment.tearDown"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestIPv6Environment.test_af"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment.test_af">[docs]</a>    <span class="k">def</span> <span class="nf">test_af</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">af</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIPv6Environment.test_makeport"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment.test_makeport">[docs]</a>    <span class="k">def</span> <span class="nf">test_makeport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">makeport</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span>
                                <span class="s">&#39;eprt&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIPv6Environment.test_makepasv"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment.test_makepasv">[docs]</a>    <span class="k">def</span> <span class="nf">test_makepasv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">makepasv</span><span class="p">()</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handler_instance</span><span class="o">.</span><span class="n">last_received_cmd</span><span class="p">,</span> <span class="s">&#39;epsv&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestIPv6Environment.test_transfer"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestIPv6Environment.test_transfer">[docs]</a>    <span class="k">def</span> <span class="nf">test_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">retr</span><span class="p">():</span>
            <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">received</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
            <span class="n">received</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s">&#39;retr&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">received</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">RETR_DATA</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">received</span><span class="p">),</span> <span class="n">RETR_DATA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_pasv</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">retr</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_pasv</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">retr</span><span class="p">()</span>

</div></div>
<span class="nd">@skipUnless</span><span class="p">(</span><span class="n">ssl</span><span class="p">,</span> <span class="s">&quot;SSL not available&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestTLS_FTPClassMixin"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClassMixin">[docs]</a><span class="k">class</span> <span class="nc">TestTLS_FTPClassMixin</span><span class="p">(</span><span class="n">TestFTPClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Repeat TestFTPClass tests starting the TLS layer for both control</span>
<span class="sd">    and data connections first.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestTLS_FTPClassMixin.setUp"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClassMixin.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">DummyTLS_FTPServer</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="c"># enable TLS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">prot_p</span><span class="p">()</span>

</div></div>
<span class="nd">@skipUnless</span><span class="p">(</span><span class="n">ssl</span><span class="p">,</span> <span class="s">&quot;SSL not available&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TestTLS_FTPClass"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass">[docs]</a><span class="k">class</span> <span class="nc">TestTLS_FTPClass</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specific TLS_FTP class tests.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestTLS_FTPClass.setUp"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">DummyTLS_FTPServer</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.tearDown"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_control_connection"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_control_connection">[docs]</a>    <span class="k">def</span> <span class="nf">test_control_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_data_connection"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_data_connection">[docs]</a>    <span class="k">def</span> <span class="nf">test_data_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># clear text</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidresp</span><span class="p">(),</span> <span class="s">&quot;226 transfer complete&quot;</span><span class="p">)</span>

        <span class="c"># secured, after PROT P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">prot_p</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidresp</span><span class="p">(),</span> <span class="s">&quot;226 transfer complete&quot;</span><span class="p">)</span>

        <span class="c"># PROT C is issued, the connection must be in cleartext again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">prot_c</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">voidresp</span><span class="p">(),</span> <span class="s">&quot;226 transfer complete&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_login"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_login">[docs]</a>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># login() is supposed to implicitly secure the control connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="c"># make sure that AUTH TLS doesn&#39;t get issued again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_auth_issued_twice"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_auth_issued_twice">[docs]</a>    <span class="k">def</span> <span class="nf">test_auth_issued_twice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_auth_ssl"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_auth_ssl">[docs]</a>    <span class="k">def</span> <span class="nf">test_auth_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ssl_version</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_SSLv3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ssl_version</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLSv1</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_context"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_context">[docs]</a>    <span class="k">def</span> <span class="nf">test_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLSv1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">,</span> <span class="n">keyfile</span><span class="o">=</span><span class="n">CERTFILE</span><span class="p">,</span>
                          <span class="n">context</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">,</span> <span class="n">certfile</span><span class="o">=</span><span class="n">CERTFILE</span><span class="p">,</span>
                          <span class="n">context</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">,</span> <span class="n">certfile</span><span class="o">=</span><span class="n">CERTFILE</span><span class="p">,</span>
                          <span class="n">keyfile</span><span class="o">=</span><span class="n">CERTFILE</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">prot_p</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestTLS_FTPClass.test_ccc"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_ccc">[docs]</a>    <span class="k">def</span> <span class="nf">test_ccc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ccc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">secure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLSocket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ccc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">unwrap</span><span class="p">)</span>
</div>
    <span class="nd">@skipUnless</span><span class="p">(</span><span class="n">HAS_SNI</span><span class="p">,</span> <span class="s">&#39;No SNI support in ssl module&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestTLS_FTPClass.test_check_hostname"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTLS_FTPClass.test_check_hostname">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_hostname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLSv1</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="n">CAFILE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP_TLS</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>

        <span class="c"># 127.0.0.1 doesn&#39;t match SAN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">CertificateError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
        <span class="c"># exception quits connection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">prot_p</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">CertificateError</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">auth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">prot_p</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transfercmd</span><span class="p">(</span><span class="s">&quot;list&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="TestTimeouts"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts">[docs]</a><span class="k">class</span> <span class="nc">TestTimeouts</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestTimeouts.setUp"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">bind_port</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="c"># Wait for the server to be ready.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_port</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="o">.</span><span class="n">port</span>
        <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
</div>
<div class="viewcode-block" id="TestTimeouts.tearDown"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.server"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.server">[docs]</a>    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This method sets the evt 3 times:</span>
        <span class="c">#  1) when the connection is ready to be accepted.</span>
        <span class="c">#  2) when it is safe for the caller to close the connection</span>
        <span class="c">#  3) when we have closed the socket</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="c"># (1) Signal the caller that we are ready to accept the connection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;1 Hola mundo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_WR</span><span class="p">)</span>
            <span class="c"># (2) Signal the caller that it is safe to close the socket.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.testTimeoutDefault"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.testTimeoutDefault">[docs]</a>    <span class="k">def</span> <span class="nf">testTimeoutDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># default -- use global socket timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getdefaulttimeout</span><span class="p">())</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">HOST</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftp</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.testTimeoutNone"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.testTimeoutNone">[docs]</a>    <span class="k">def</span> <span class="nf">testTimeoutNone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># no timeout -- do not use global socket timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getdefaulttimeout</span><span class="p">())</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">ftp</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.testTimeoutValue"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.testTimeoutValue">[docs]</a>    <span class="k">def</span> <span class="nf">testTimeoutValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># a value</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftp</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.testTimeoutConnect"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.testTimeoutConnect">[docs]</a>    <span class="k">def</span> <span class="nf">testTimeoutConnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftp</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.testTimeoutDifferentOrder"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.testTimeoutDifferentOrder">[docs]</a>    <span class="k">def</span> <span class="nf">testTimeoutDifferentOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">HOST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftp</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestTimeouts.testTimeoutDirectAccess"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestTimeouts.testTimeoutDirectAccess">[docs]</a>    <span class="k">def</span> <span class="nf">testTimeoutDirectAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">HOST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ftp</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evt</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="TestNetrcDeprecation"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestNetrcDeprecation">[docs]</a><span class="k">class</span> <span class="nc">TestNetrcDeprecation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestNetrcDeprecation.test_deprecation"><a class="viewcode-back" href="../../test.html#test.test_ftplib.TestNetrcDeprecation.test_deprecation">[docs]</a>    <span class="k">def</span> <span class="nf">test_deprecation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">temp_cwd</span><span class="p">(),</span> <span class="n">support</span><span class="o">.</span><span class="n">EnvironmentVarGuard</span><span class="p">()</span> <span class="k">as</span> <span class="n">env</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="nb">open</span><span class="p">(</span><span class="s">&#39;.netrc&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
                <span class="n">ftplib</span><span class="o">.</span><span class="n">Netrc</span><span class="p">()</span>


</div></div>
<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_ftplib.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">():</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestFTPClass</span><span class="p">,</span> <span class="n">TestTimeouts</span><span class="p">,</span> <span class="n">TestNetrcDeprecation</span><span class="p">,</span>
             <span class="n">TestIPv6Environment</span><span class="p">,</span>
             <span class="n">TestTLS_FTPClassMixin</span><span class="p">,</span> <span class="n">TestTLS_FTPClass</span><span class="p">]</span>

    <span class="n">thread_info</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">threading_setup</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="o">*</span><span class="n">tests</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">support</span><span class="o">.</span><span class="n">threading_cleanup</span><span class="p">(</span><span class="o">*</span><span class="n">thread_info</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>