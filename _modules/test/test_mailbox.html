

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_mailbox &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_mailbox</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_mailbox</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">email</span>
<span class="kn">import</span> <span class="nn">email.message</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">mailbox</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">fcntl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="TestBase"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBase">[docs]</a><span class="k">class</span> <span class="nc">TestBase</span><span class="p">:</span>

    <span class="n">all_mailbox_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">,</span>
                         <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">,</span>
                         <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c"># Inspect a mailbox.Message representation of the sample message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_sample_headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">_sample_payloads</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">payload</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_sample_payloads</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIsInstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="c"># Delete a file or delete a directory recursively</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMailbox"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox">[docs]</a><span class="k">class</span> <span class="nc">TestMailbox</span><span class="p">(</span><span class="n">TestBase</span><span class="p">):</span>

    <span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="bp">None</span>     <span class="c"># Overridden by subclasses to reuse tests</span>
    <span class="n">_template</span> <span class="o">=</span> <span class="s">&#39;From: foo</span><span class="se">\n\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span>

<div class="viewcode-block" id="TestMailbox.setUp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.tearDown"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add">[docs]</a>    <span class="k">def</span> <span class="nf">test_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Add copies of a sample message</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</div>
    <span class="n">_nonascii_msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">            From: foo</span>
<span class="s">            Subject: Falinaptár házhozszállítással. Már rendeltél?</span>

<span class="s">            0</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TestMailbox.test_add_invalid_8bit_bytes_header"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_invalid_8bit_bytes_header">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_invalid_8bit_bytes_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonascii_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nonascii_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_invalid_nonascii_header_as_string"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_invalid_nonascii_header_as_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_nonascii_header_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">subj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonascii_msg</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subj</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="s">&#39;Subject: =?unknown-8bit?b?RmFsaW5hcHThciBo4Xpob3pzeuFsbO104XNz&#39;</span>
            <span class="s">&#39;YWwuIE3hciByZW5kZWx06Ww/?=</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_nonascii_string_header_raises"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_nonascii_string_header_raises">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_nonascii_string_header_raises</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;ASCII-only&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonascii_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertMailboxEmpty</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_that_raises_leaves_mailbox_empty"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_that_raises_leaves_mailbox_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_that_raises_leaves_mailbox_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">raiser</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;a fake error&quot;</span><span class="p">)</span>
        <span class="n">support</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">BytesGenerator</span><span class="p">,</span> <span class="s">&#39;flatten&#39;</span><span class="p">,</span> <span class="n">raiser</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="s">&quot;From: Alphöso&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertMailboxEmpty</span><span class="p">()</span>
</div>
    <span class="n">_non_latin_bin_msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">        From: foo@bar.com</span>
<span class="s">        To: báz</span>
<span class="s">        Subject: Maintenant je vous présente mon collègue, le pouf célèbre</span>
<span class="s">        </span><span class="se">\t</span><span class="s">Jean de Baddie</span>
<span class="s">        Mime-Version: 1.0</span>
<span class="s">        Content-Type: text/plain; charset=&quot;utf-8&quot;</span>
<span class="s">        Content-Transfer-Encoding: 8bit</span>

<span class="s">        Да, они летят.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TestMailbox.test_add_8bit_body"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_8bit_body">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_8bit_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_latin_bin_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_non_latin_bin_msg</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_non_latin_bin_msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span>
                        <span class="s">&quot;Да, они летят.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_binary_file"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_binary_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_binary_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="s">&#39;wb+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="n">_bytes_sample_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_binary_nonascii_file"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_binary_nonascii_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_binary_nonascii_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="s">&#39;wb+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_latin_bin_msg</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_non_latin_bin_msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_text_file_warns"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_text_file_warns">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_text_file_warns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="s">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="n">_bytes_sample_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_StringIO_warns"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_StringIO_warns">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_StringIO_warns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&quot;0&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_add_nonascii_StringIO_raises"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_add_nonascii_StringIO_raises">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_nonascii_StringIO_raises</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;ASCII-only&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonascii_msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertMailboxEmpty</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_remove"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_remove">[docs]</a>    <span class="k">def</span> <span class="nf">test_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Remove messages using remove()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_remove_or_delitem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_delitem"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_delitem">[docs]</a>    <span class="k">def</span> <span class="nf">test_delitem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Remove messages using __delitem__()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_remove_or_delitem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_remove_or_delitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="c"># (Used by test_remove() and test_delitem().)</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">method</span><span class="p">(</span><span class="n">key0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">method</span><span class="p">(</span><span class="n">key2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">method</span><span class="p">(</span><span class="n">key1</span><span class="p">))</span>

<div class="viewcode-block" id="TestMailbox.test_discard"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_discard">[docs]</a>    <span class="k">def</span> <span class="nf">test_discard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># Discard messages</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_get"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_get">[docs]</a>    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Retrieve messages using get()</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_getitem"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_getitem">[docs]</a>    <span class="k">def</span> <span class="nf">test_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Retrieve message using __getitem__()</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_get_message"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_get_message">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get Message representations of messages</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg0</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg0</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg0</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_get_bytes"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_get_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get bytes representations of messages</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span> <span class="n">_bytes_sample_message</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_get_string"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_get_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get string representations of messages</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                         <span class="n">_sample_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_get_file"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_get_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get file representations of messages</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">data0</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">data1</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data0</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                         <span class="n">_sample_message</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_get_file_can_be_closed_twice"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_get_file_can_be_closed_twice">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_file_can_be_closed_twice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 11700</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_iterkeys"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_iterkeys">[docs]</a>    <span class="k">def</span> <span class="nf">test_iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get keys using iterkeys()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">do_values</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_keys"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_keys">[docs]</a>    <span class="k">def</span> <span class="nf">test_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get keys using keys()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">do_values</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_itervalues"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">test_itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get values using itervalues()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">itervalues</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">do_values</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_iter"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_iter">[docs]</a>    <span class="k">def</span> <span class="nf">test_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get values using __iter__()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">__iter__</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">do_values</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_values"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_values">[docs]</a>    <span class="k">def</span> <span class="nf">test_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get values using values()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">do_values</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_iteritems"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">test_iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get keys and values using iteritems()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">iteritems</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">do_values</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_items"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_items">[docs]</a>    <span class="k">def</span> <span class="nf">test_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get keys and values using items()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">do_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">do_values</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">do_keys</span><span class="p">,</span> <span class="n">do_values</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">method</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;Not empty&quot;</span><span class="p">)</span>
        <span class="n">keys</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_keys</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_values</span><span class="p">:</span>
            <span class="n">returned_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">method</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">do_values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_keys</span><span class="p">:</span>
            <span class="n">returned_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">method</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">returned_keys</span><span class="p">,</span> <span class="n">returned_values</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">method</span><span class="p">():</span>
                <span class="n">returned_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">returned_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">returned_keys</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">returned_keys</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">do_values</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">returned_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="n">repetitions</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>

<div class="viewcode-block" id="TestMailbox.test_contains"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_contains">[docs]</a>    <span class="k">def</span> <span class="nf">test_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check existence of keys using __contains__()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_len"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_len">[docs]</a>    <span class="k">def</span> <span class="nf">test_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># Get message count</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="n">repetitions</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="n">repetitions</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_set_item"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_set_item">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Modify messages using __setitem__()</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sample_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span>
                          <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_clear"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_clear">[docs]</a>    <span class="k">def</span> <span class="nf">test_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># Remove all messages using clear()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_pop"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_pop">[docs]</a>    <span class="k">def</span> <span class="nf">test_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get and remove a message using pop()</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;2</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_popitem"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_popitem">[docs]</a>    <span class="k">def</span> <span class="nf">test_popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># Get and remove an arbitrary (key, message) using popitem()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()),</span> <span class="n">keys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_update"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Modify multiple messages using update()</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 1&#39;</span><span class="p">)</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 0&#39;</span><span class="p">,</span>
                          <span class="n">key2</span><span class="p">:</span> <span class="n">_sample_message</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">key2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 2&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 1&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">key0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;original 0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key2</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;changed 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span>
                          <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span>
                                          <span class="n">key0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&quot;changed 0&quot;</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&quot;changed 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key1</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&quot;changed 1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key2</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&quot;changed 2&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_flush"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_flush">[docs]</a>    <span class="k">def</span> <span class="nf">test_flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Write changes to disk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_flush_or_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_popitem_and_flush_twice"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_popitem_and_flush_twice">[docs]</a>    <span class="k">def</span> <span class="nf">test_popitem_and_flush_twice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># See #15036.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_lock_unlock"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_lock_unlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_lock_unlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Lock and unlock the mailbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lock_path</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lock_path</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lock_path</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="TestMailbox.test_close"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Close mailbox and flush changes to disk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_flush_or_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_test_flush_or_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">should_call_close</span><span class="p">):</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">oldbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">method</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">should_call_close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">contents</span><span class="p">)</span>
        <span class="n">oldbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="TestMailbox.test_dump_message"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailbox.test_dump_message">[docs]</a>    <span class="k">def</span> <span class="nf">test_dump_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Write message representations to disk</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">),</span>
                      <span class="n">_sample_message</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">)):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_dump_message</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
                <span class="n">_bytes_sample_message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span>
                          <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_dump_message</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">_get_lock_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Return the path of the dot lock file. May be overridden.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">+</span> <span class="s">&#39;.lock&#39;</span>

</div>
<div class="viewcode-block" id="TestMailboxSuperclass"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailboxSuperclass">[docs]</a><span class="k">class</span> <span class="nc">TestMailboxSuperclass</span><span class="p">(</span><span class="n">TestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestMailboxSuperclass.test_notimplemented"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMailboxSuperclass.test_notimplemented">[docs]</a>    <span class="k">def</span> <span class="nf">test_notimplemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that all Mailbox methods raise NotImplementedException.</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Mailbox</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()</span><span class="o">.</span><span class="n">__next__</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">__iter__</span><span class="p">()</span><span class="o">.</span><span class="n">__next__</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span><span class="o">.</span><span class="n">__next__</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="s">&#39;&#39;</span> <span class="ow">in</span> <span class="n">box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">__contains__</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">__len__</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">clear</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">popitem</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">update</span><span class="p">(((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">unlock</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>

</div></div>
<div class="viewcode-block" id="TestMaildir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir">[docs]</a><span class="k">class</span> <span class="nc">TestMaildir</span><span class="p">(</span><span class="n">TestMailbox</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">:</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

<div class="viewcode-block" id="TestMaildir.setUp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">TestMailbox</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;nt&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;cygwin&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">colon</span> <span class="o">=</span> <span class="s">&#39;!&#39;</span>
</div>
<div class="viewcode-block" id="TestMaildir.assertMailboxEmpty"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.assertMailboxEmpty">[docs]</a>    <span class="k">def</span> <span class="nf">assertMailboxEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">)),</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_add_MM"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_add_MM">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_MM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Add a MaildirMessage instance</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;cur&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">foo&#39;</span> <span class="o">%</span>
                                                 <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">colon</span><span class="p">))))</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_get_MM"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_get_MM">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_MM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get a MaildirMessage instance</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;RF&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">msg_returned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg_returned</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;FR&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_set_MM"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_set_MM">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_MM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Set with a MaildirMessage instance</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;TP&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg0</span><span class="p">)</span>
        <span class="n">msg_returned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;PT&#39;</span><span class="p">)</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg1</span>
        <span class="n">msg_returned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">msg2</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="s">&#39;2,S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">3</span>
        <span class="n">msg_returned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg_returned</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;3</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_consistent_factory"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_consistent_factory">[docs]</a>    <span class="k">def</span> <span class="nf">test_consistent_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Add a message.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;RF&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># Create new mailbox with</span>
        <span class="k">class</span> <span class="nc">FakeMessage</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">FakeMessage</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">colon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">colon</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg2</span><span class="p">,</span> <span class="n">FakeMessage</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_initialize_new"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_initialize_new">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize a non-existent mailbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_basics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_basics</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_initialize_existing"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_initialize_existing">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize an existing mailbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="s">&#39;cur&#39;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_basics</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_check_basics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># (Used by test_open_new() and test_open_existing().)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_factory</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="s">&#39;cur&#39;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_MODE</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">S_ISDIR</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="s">&quot;Not a directory: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

<div class="viewcode-block" id="TestMaildir.test_list_folders"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_list_folders">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># List folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span>
                     <span class="nb">set</span><span class="p">((</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_get_folder"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_get_folder">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Open folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">)</span>
        <span class="n">folder0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_folder</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">)</span>
        <span class="n">folder0</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;.foo.bar&#39;</span><span class="p">)))</span>
        <span class="n">folder1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_folder</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">folder1</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">folder1</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_add_and_remove_folders"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_add_and_remove_folders">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_and_remove_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Delete folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;two&#39;</span><span class="p">,)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;two&#39;</span><span class="p">,)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">(),</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_clean"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_clean">[docs]</a>    <span class="k">def</span> <span class="nf">test_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Remove old files from &#39;tmp&#39;</span>
        <span class="n">foo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">bar_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">foo_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bar_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">foo_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bar_path</span><span class="p">))</span>
        <span class="n">foo_stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">foo_path</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">foo_path</span><span class="p">,</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">129600</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="n">foo_stat</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">foo_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bar_path</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_create_tmp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_create_tmp">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_tmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># Create files in tmp directory</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span>
            <span class="n">hostname</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">r&#39;\057&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">hostname</span><span class="p">:</span>
            <span class="n">hostname</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">r&#39;\072&#39;</span><span class="p">)</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(?P&lt;time&gt;\d+)\.M(?P&lt;M&gt;\d{1,6})P(?P&lt;P&gt;\d+)&quot;</span>
                             <span class="s">r&quot;Q(?P&lt;Q&gt;\d+)\.(?P&lt;host&gt;[^:/]+)&quot;</span><span class="p">)</span>
        <span class="n">previous_groups</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
            <span class="n">tmp_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_create_tmp</span><span class="p">()</span>
            <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span>
                                                                <span class="s">&quot;tmp&quot;</span><span class="p">)),</span>
                             <span class="s">&quot;File in wrong location: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">head</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="s">&quot;Invalid file name: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">tail</span><span class="p">)</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">previous_groups</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                             <span class="s">&quot;Non-monotonic seconds: &#39;</span><span class="si">%s</span><span class="s">&#39; before &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="s">&quot;Non-monotonic milliseconds: &#39;</span><span class="si">%s</span><span class="s">&#39; before &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">pid</span><span class="p">,</span>
                             <span class="s">&quot;Process ID mismatch: &#39;</span><span class="si">%s</span><span class="s">&#39; should be &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pid</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="s">&quot;Non-sequential counter: &#39;</span><span class="si">%s</span><span class="s">&#39; before &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">previous_groups</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">hostname</span><span class="p">,</span>
                             <span class="s">&quot;Host name mismatch: &#39;</span><span class="si">%s</span><span class="s">&#39; should be &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">hostname</span><span class="p">))</span>
            <span class="n">previous_groups</span> <span class="o">=</span> <span class="n">groups</span>
            <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">)</span>
            <span class="n">tmp_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tmp_file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">_bytes_sample_message</span><span class="p">)</span>
            <span class="n">tmp_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">file_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&quot;tmp&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">file_count</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">,</span>
                     <span class="s">&quot;Wrong file count: &#39;</span><span class="si">%s</span><span class="s">&#39; should be &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">file_count</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_refresh"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_refresh">[docs]</a>    <span class="k">def</span> <span class="nf">test_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Update the table of contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{</span><span class="n">key0</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key0</span><span class="p">),</span>
                                          <span class="n">key1</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key1</span><span class="p">)})</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{</span><span class="n">key0</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key0</span><span class="p">),</span>
                                          <span class="n">key1</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key1</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{</span><span class="n">key0</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key0</span><span class="p">),</span>
                                          <span class="n">key1</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key1</span><span class="p">),</span>
                                          <span class="n">key2</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key2</span><span class="p">)})</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_refresh_after_safety_period"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_refresh_after_safety_period">[docs]</a>    <span class="k">def</span> <span class="nf">test_refresh_after_safety_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #13254: Call _refresh after the &quot;file system safety</span>
        <span class="c"># period&quot; of 2 seconds has passed; _toc should still be</span>
        <span class="c"># updated because this is the first call to _refresh.</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c"># Emulate sleeping. Instead of sleeping for 2 seconds, use the</span>
        <span class="c"># skew factor to make _refresh think that the filesystem</span>
        <span class="c"># safety period has passed and re-reading the _toc is only</span>
        <span class="c"># required if mtimes differ.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_skewfactor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_lookup"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">test_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Look up message subpaths in the TOC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">))</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">key0</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key0</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{</span><span class="n">key0</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">,</span> <span class="n">key0</span><span class="p">)})</span>
        <span class="c"># Be sure that the TOC is read back from disk (see issue #6896</span>
        <span class="c"># about bad mtime behaviour on some systems).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">key0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span><span class="p">,</span> <span class="p">{})</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_lock_unlock"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_lock_unlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_lock_unlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Lock and unlock the mailbox. For Maildir, this does nothing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_folder"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_folder">[docs]</a>    <span class="k">def</span> <span class="nf">test_folder</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test for bug #1569790: verify that folders returned by .get_folder()</span>
        <span class="c"># use the same factory function.</span>
        <span class="k">def</span> <span class="nf">dummy_factory</span> <span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">dummy_factory</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;folder1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">_factory</span><span class="p">,</span> <span class="n">dummy_factory</span><span class="p">)</span>

        <span class="n">folder1_alias</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get_folder</span><span class="p">(</span><span class="s">&#39;folder1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">folder1_alias</span><span class="o">.</span><span class="n">_factory</span><span class="p">,</span> <span class="n">dummy_factory</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_directory_in_folder"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_directory_in_folder">[docs]</a>    <span class="k">def</span> <span class="nf">test_directory_in_folder</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test that mailboxes still work if there&#39;s a stray extra directory</span>
        <span class="c"># in a folder.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">))</span>

        <span class="c"># Create a stray directory</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;cur&#39;</span><span class="p">,</span> <span class="s">&#39;stray-dir&#39;</span><span class="p">))</span>

        <span class="c"># Check that looping still works with the directory present.</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;umask&#39;</span><span class="p">),</span> <span class="s">&#39;test needs os.umask()&#39;</span><span class="p">)</span>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;stat&#39;</span><span class="p">),</span> <span class="s">&#39;test needs os.stat()&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestMaildir.test_file_permissions"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_file_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verify that message files are created without execute permissions</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">orig_umask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">orig_umask</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o111</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;umask&#39;</span><span class="p">),</span> <span class="s">&#39;test needs os.umask()&#39;</span><span class="p">)</span>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;stat&#39;</span><span class="p">),</span> <span class="s">&#39;test needs os.stat()&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestMaildir.test_folder_file_perms"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_folder_file_perms">[docs]</a>    <span class="k">def</span> <span class="nf">test_folder_file_perms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># From bug #3228, we want to verify that the file created inside a Maildir</span>
        <span class="c"># subfolder isn&#39;t marked as executable.</span>
        <span class="n">orig_umask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subfolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;subfolder&#39;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">orig_umask</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subfolder</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;maildirfolder&#39;</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">((</span><span class="n">perms</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o111</span><span class="p">))</span> <span class="c"># Execute bits should all be off.</span>
</div>
<div class="viewcode-block" id="TestMaildir.test_reread"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildir.test_reread">[docs]</a>    <span class="k">def</span> <span class="nf">test_reread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Do an initial unconditional refresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_refresh</span><span class="p">()</span>

        <span class="c"># Put the last modified times more than two seconds into the past</span>
        <span class="c"># (because mtime may have a two second granularity)</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="p">,)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># Because mtime has a two second granularity in worst case (FAT), a</span>
        <span class="c"># refresh is done unconditionally if called for within</span>
        <span class="c"># two-second-plus-a-bit of the last one, just in case the mbox has</span>
        <span class="c"># changed; so now we have to wait for that interval to expire.</span>
        <span class="c">#</span>
        <span class="c"># Because this is a test, emulate sleeping. Instead of</span>
        <span class="c"># sleeping for 2 seconds, use the skew factor to make _refresh</span>
        <span class="c"># think that 2 seconds have passed and re-reading the _toc is</span>
        <span class="c"># only required if mtimes differ.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_skewfactor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>

        <span class="c"># Re-reading causes the ._toc attribute to be assigned a new dictionary</span>
        <span class="c"># object, so we&#39;ll check that the ._toc attribute isn&#39;t a different</span>
        <span class="c"># object.</span>
        <span class="n">orig_toc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span>
        <span class="k">def</span> <span class="nf">refreshed</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_toc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">orig_toc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">refreshed</span><span class="p">())</span>

        <span class="c"># Now, write something into cur and remove it.  This changes</span>
        <span class="c"># the mtime and should cause a re-read. Note that &quot;sleep</span>
        <span class="c"># emulation&quot; is still in effect, as skewfactor is -3.</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;cur&#39;</span><span class="p">,</span> <span class="s">&#39;stray-file&#39;</span><span class="p">)</span>
        <span class="n">support</span><span class="o">.</span><span class="n">create_empty_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">refreshed</span><span class="p">())</span>

</div></div>
<span class="k">class</span> <span class="nc">_TestSingleFile</span><span class="p">(</span><span class="n">TestMailbox</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Common tests for single-file mailboxes&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">test_add_doesnt_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># When only adding messages, flush() should not rewrite the</span>
        <span class="c"># mailbox file. See issue #9559.</span>

        <span class="c"># Inode number changes if the contents are written to another</span>
        <span class="c"># file which is then renamed over the original file. So we</span>
        <span class="c"># must check that the inode number doesn&#39;t change.</span>
        <span class="n">inode_before</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_ino</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">inode_after</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_ino</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">inode_before</span><span class="p">,</span> <span class="n">inode_after</span><span class="p">)</span>

        <span class="c"># Make sure the message was really added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_permissions_after_flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># See issue #5346</span>

        <span class="c"># Make the mailbox world writable. It&#39;s unlikely that the new</span>
        <span class="c"># mailbox file would have these permissions after flush(),</span>
        <span class="c"># because umask usually prevents it.</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">|</span> <span class="mi">0</span><span class="n">o666</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c"># Need to remove one message to make flush() create a new file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_TestMboxMMDF</span><span class="p">(</span><span class="n">_TestSingleFile</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lock_remnant</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">lock_remnant</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">assertMailboxEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">test_add_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Add a string starting with &#39;From &#39; to the mailbox</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;From foo@bar blah</span><span class="se">\n</span><span class="s">From: foo</span><span class="se">\n\n</span><span class="s">0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_from</span><span class="p">(),</span> <span class="s">&#39;foo@bar blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_add_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Add a byte string starting with &#39;From &#39; to the mailbox</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;From foo@bar blah</span><span class="se">\n</span><span class="s">From: foo</span><span class="se">\n\n</span><span class="s">0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_from</span><span class="p">(),</span> <span class="s">&#39;foo@bar blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_add_mbox_or_mmdf_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Add an mboxMessage or MMDFMessage</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="s">&#39;From foo@bar blah</span><span class="se">\n</span><span class="s">From: foo</span><span class="se">\n\n</span><span class="s">0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_open_close_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Open and inspect previously-created mailbox</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_add_and_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Verifying that closing a mailbox doesn&#39;t change added items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>

    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;fork&#39;</span><span class="p">),</span> <span class="s">&quot;Test needs fork().&quot;</span><span class="p">)</span>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s">&#39;socketpair&#39;</span><span class="p">),</span> <span class="s">&quot;Test needs socketpair().&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_lock_conflict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Fork off a child process that will lock the mailbox temporarily,</span>
        <span class="c"># unlock it and exit.</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socketpair</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>

        <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># child</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># lock the mailbox, and signal the parent it can proceed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;c&#39;</span><span class="p">)</span>

                <span class="c"># wait until the parent is done, and unlock the mailbox</span>
                <span class="n">c</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># In the parent, wait until the child signals it locked the mailbox.</span>
        <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">ExternalClashError</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c"># Signal the child it can now release the lock and exit.</span>
            <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;p&#39;</span><span class="p">)</span>
            <span class="c"># Wait for child to exit.  Locking should now succeed.</span>
            <span class="n">exited_pid</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_relock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test case for bug #1575506: the mailbox class was locking the</span>
        <span class="c"># wrong file object in its flush() method.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Subject: sub</span><span class="se">\n\n</span><span class="s">body</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_locked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<div class="viewcode-block" id="TestMbox"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMbox">[docs]</a><span class="k">class</span> <span class="nc">TestMbox</span><span class="p">(</span><span class="n">_TestMboxMMDF</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">:</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mbox</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;umask&#39;</span><span class="p">),</span> <span class="s">&#39;test needs os.umask()&#39;</span><span class="p">)</span>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;stat&#39;</span><span class="p">),</span> <span class="s">&#39;test needs os.stat()&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TestMbox.test_file_perms"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMbox.test_file_perms">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_perms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># From bug #3228, we want to verify that the mailbox file isn&#39;t executable,</span>
        <span class="c"># even if the umask is set to something that would leave executable bits set.</span>
        <span class="c"># We only run this test on platforms that support umask.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old_umask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o077</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="n">old_umask</span><span class="p">)</span>

        <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">((</span><span class="n">perms</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o111</span><span class="p">))</span> <span class="c"># Execute bits should all be off.</span>
</div>
<div class="viewcode-block" id="TestMbox.test_terminating_newline"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMbox.test_terminating_newline">[docs]</a>    <span class="k">def</span> <span class="nf">test_terminating_newline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">()</span>
        <span class="n">message</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;john@example.com&#39;</span>
        <span class="n">message</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s">&#39;No newline at the end&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c"># A newline should have been appended to the payload</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(),</span> <span class="s">&#39;No newline at the end</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMbox.test_message_separator"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMbox.test_message_separator">[docs]</a>    <span class="k">def</span> <span class="nf">test_message_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check there&#39;s always a single blank line after each message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;From: foo</span><span class="se">\n\n</span><span class="s">0&#39;</span><span class="p">)</span>  <span class="c"># No newline at the end</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="s">&#39;0</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;From: foo</span><span class="se">\n\n</span><span class="s">0</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>  <span class="c"># Newline at the end</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="s">&#39;0</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestMMDF"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMMDF">[docs]</a><span class="k">class</span> <span class="nc">TestMMDF</span><span class="p">(</span><span class="n">_TestMboxMMDF</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">:</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDF</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestMH"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH">[docs]</a><span class="k">class</span> <span class="nc">TestMH</span><span class="p">(</span><span class="n">TestMailbox</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">:</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MH</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

<div class="viewcode-block" id="TestMH.assertMailboxEmpty"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.assertMailboxEmpty">[docs]</a>    <span class="k">def</span> <span class="nf">assertMailboxEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">),</span> <span class="p">[</span><span class="s">&#39;.mh_sequences&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMH.test_list_folders"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_list_folders">[docs]</a>    <span class="k">def</span> <span class="nf">test_list_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># List folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span>
                     <span class="nb">set</span><span class="p">((</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestMH.test_get_folder"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_get_folder">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Open folders</span>
        <span class="k">def</span> <span class="nf">dummy_factory</span> <span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">dummy_factory</span><span class="p">)</span>

        <span class="n">new_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">)</span>
        <span class="n">folder0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_folder</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">)</span>
        <span class="n">folder0</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;foo.bar&#39;</span><span class="p">)))</span>
        <span class="n">folder1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_folder</span><span class="p">(</span><span class="s">&#39;foo.bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">folder1</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">folder1</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="s">&#39;bar&#39;</span><span class="p">)</span>

        <span class="c"># Test for bug #1569790: verify that folders returned by .get_folder()</span>
        <span class="c"># use the same factory function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">new_folder</span><span class="o">.</span><span class="n">_factory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_factory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">folder0</span><span class="o">.</span><span class="n">_factory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_factory</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMH.test_add_and_remove_folders"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_add_and_remove_folders">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_and_remove_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Delete folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;two&#39;</span><span class="p">,)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="nb">set</span><span class="p">((</span><span class="s">&#39;two&#39;</span><span class="p">,)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">list_folders</span><span class="p">(),</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestMH.test_sequences"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_sequences">[docs]</a>    <span class="k">def</span> <span class="nf">test_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get and set sequences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">{})</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">]})</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">msg1</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">])</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                     <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">],</span> <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="n">key1</span><span class="p">],</span> <span class="s">&#39;replied&#39;</span><span class="p">:[</span><span class="n">key1</span><span class="p">]})</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;flagged&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                     <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="n">key1</span><span class="p">],</span> <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="n">key1</span><span class="p">],</span> <span class="s">&#39;replied&#39;</span><span class="p">:[</span><span class="n">key1</span><span class="p">],</span>
                      <span class="s">&#39;flagged&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;flagged&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">]})</span>
</div>
<div class="viewcode-block" id="TestMH.test_issue2625"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_issue2625">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue2625</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg0</span><span class="p">)</span>
        <span class="n">refmsg0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMH.test_issue7627"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_issue7627">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue7627</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestMH.test_pack"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMH.test_pack">[docs]</a>    <span class="k">def</span> <span class="nf">test_pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Pack the contents of the mailbox</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">msg3</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;unseen&#39;</span><span class="p">])</span>
        <span class="n">msg1</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">])</span>
        <span class="n">msg2</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">])</span>
        <span class="n">msg3</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">])</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg0</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg2</span><span class="p">)</span>
        <span class="n">key3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                     <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">,</span><span class="n">key1</span><span class="p">,</span><span class="n">key2</span><span class="p">,</span><span class="n">key3</span><span class="p">],</span> <span class="s">&#39;unseen&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">],</span>
                      <span class="s">&#39;flagged&#39;</span><span class="p">:[</span><span class="n">key2</span><span class="p">],</span> <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="n">key3</span><span class="p">],</span> <span class="s">&#39;replied&#39;</span><span class="p">:[</span><span class="n">key3</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                     <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">,</span><span class="n">key1</span><span class="p">,</span><span class="n">key3</span><span class="p">],</span> <span class="s">&#39;unseen&#39;</span><span class="p">:[</span><span class="n">key0</span><span class="p">],</span> <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="n">key3</span><span class="p">],</span>
                      <span class="s">&#39;replied&#39;</span><span class="p">:[</span><span class="n">key3</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="n">key0</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="n">key1</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                     <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s">&#39;unseen&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;replied&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">]})</span>

        <span class="c"># Test case for packing while holding the mailbox locked.</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">key2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="n">key3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                     <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                      <span class="s">&#39;unseen&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">],</span> <span class="s">&#39;replied&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">]})</span>
</div>
    <span class="k">def</span> <span class="nf">_get_lock_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;.mh_sequences.lock&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestBabyl"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabyl">[docs]</a><span class="k">class</span> <span class="nc">TestBabyl</span><span class="p">(</span><span class="n">_TestSingleFile</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="bp">None</span><span class="p">:</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Babyl</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

<div class="viewcode-block" id="TestBabyl.assertMailboxEmpty"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabyl.assertMailboxEmpty">[docs]</a>    <span class="k">def</span> <span class="nf">assertMailboxEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestBabyl.tearDown"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabyl.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lock_remnant</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">lock_remnant</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestBabyl.test_labels"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabyl.test_labels">[docs]</a>    <span class="k">def</span> <span class="nf">test_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get labels from the mailbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="n">msg0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">key0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">])</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">msg1</span><span class="o">.</span><span class="n">set_labels</span><span class="p">([</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">])</span>
        <span class="n">key1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_labels</span><span class="p">()),</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]))</span>
        <span class="n">msg0</span><span class="o">.</span><span class="n">set_labels</span><span class="p">([</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="s">&#39;filed&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_labels</span><span class="p">()),</span>
                     <span class="nb">set</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;blah&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">get_labels</span><span class="p">()),</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;blah&#39;</span><span class="p">]))</span>

</div></div>
<div class="viewcode-block" id="FakeFileLikeObject"><a class="viewcode-back" href="../../test.html#test.test_mailbox.FakeFileLikeObject">[docs]</a><span class="k">class</span> <span class="nc">FakeFileLikeObject</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="FakeFileLikeObject.close"><a class="viewcode-back" href="../../test.html#test.test_mailbox.FakeFileLikeObject.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="bp">True</span>

</div></div>
<div class="viewcode-block" id="FakeMailBox"><a class="viewcode-back" href="../../test.html#test.test_mailbox.FakeMailBox">[docs]</a><span class="k">class</span> <span class="nc">FakeMailBox</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">Mailbox</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mailbox</span><span class="o">.</span><span class="n">Mailbox</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="nb">file</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">FakeFileLikeObject</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<div class="viewcode-block" id="FakeMailBox.get_file"><a class="viewcode-back" href="../../test.html#test.test_mailbox.FakeMailBox.get_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

</div></div>
<div class="viewcode-block" id="TestFakeMailBox"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestFakeMailBox">[docs]</a><span class="k">class</span> <span class="nc">TestFakeMailBox</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestFakeMailBox.test_closing_fd"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestFakeMailBox.test_closing_fd">[docs]</a>    <span class="k">def</span> <span class="nf">test_closing_fd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">FakeMailBox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">box</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TestMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage">[docs]</a><span class="k">class</span> <span class="nc">TestMessage</span><span class="p">(</span><span class="n">TestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span>      <span class="c"># Overridden by subclasses to reuse tests</span>

<div class="viewcode-block" id="TestMessage.setUp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
</div>
<div class="viewcode-block" id="TestMessage.tearDown"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessage.test_initialize_with_eMM"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_initialize_with_eMM">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_with_eMM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize based on email.message.Message instance</span>
        <span class="n">eMM</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="n">eMM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_initialize_hook</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessage.test_initialize_with_string"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_initialize_with_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_with_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize based on string</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_initialize_hook</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessage.test_initialize_with_file"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_initialize_with_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_with_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize based on contents of file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post_initialize_hook</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessage.test_initialize_with_binary_file"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_initialize_with_binary_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_with_binary_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize based on contents of binary file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;wb+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post_initialize_hook</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessage.test_initialize_with_nothing"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_initialize_with_nothing">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_with_nothing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize without arguments</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_initialize_hook</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestMessage.test_initialize_incorrectly"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_initialize_incorrectly">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_incorrectly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize with invalid argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="nb">object</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="TestMessage.test_all_eMM_attribues_exist"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_all_eMM_attribues_exist">[docs]</a>    <span class="k">def</span> <span class="nf">test_all_eMM_attribues_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue 12537</span>
        <span class="n">eMM</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">eMM</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                <span class="s">&#39;{} attribute does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMessage.test_become_message"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_become_message">[docs]</a>    <span class="k">def</span> <span class="nf">test_become_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Take on the state of another message</span>
        <span class="n">eMM</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">_become_message</span><span class="p">(</span><span class="n">eMM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessage.test_explain_to"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessage.test_explain_to">[docs]</a>    <span class="k">def</span> <span class="nf">test_explain_to</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Copy self&#39;s format-specific data to other message formats.</span>
        <span class="c"># This test is superficial; better ones are in TestMessageConversion.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
            <span class="n">other_msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">_explain_to</span><span class="p">(</span><span class="n">other_msg</span><span class="p">)</span>
        <span class="n">other_msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">_explain_to</span><span class="p">(</span><span class="n">other_msg</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">_post_initialize_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c"># Overridden by subclasses to check extra things after initialization</span>
        <span class="k">pass</span>

</div>
<div class="viewcode-block" id="TestMaildirMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildirMessage">[docs]</a><span class="k">class</span> <span class="nc">TestMaildirMessage</span><span class="p">(</span><span class="n">TestMessage</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span>

    <span class="k">def</span> <span class="nf">_post_initialize_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">_subdir</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TestMaildirMessage.test_subdir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildirMessage.test_subdir">[docs]</a>    <span class="k">def</span> <span class="nf">test_subdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use get_subdir() and set_subdir()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;tmp&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildirMessage.test_flags"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildirMessage.test_flags">[docs]</a>    <span class="k">def</span> <span class="nf">test_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use get_flags(), set_flags(), add_flag(), remove_flag()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;SDTP&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;DPST&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_flag</span><span class="p">(</span><span class="s">&#39;FT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;DFPST&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_flag</span><span class="p">(</span><span class="s">&#39;TDRP&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;FS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;new&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildirMessage.test_date"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildirMessage.test_date">[docs]</a>    <span class="k">def</span> <span class="nf">test_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use get_date() and set_date()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_date</span><span class="p">()</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_date</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_date</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildirMessage.test_info"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildirMessage.test_info">[docs]</a>    <span class="k">def</span> <span class="nf">test_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use get_info() and set_info()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="s">&#39;1,foo=bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;1,foo=bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMaildirMessage.test_info_and_flags"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMaildirMessage.test_info_and_flags">[docs]</a>    <span class="k">def</span> <span class="nf">test_info_and_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Test interaction of info and flag methods</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;SF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;FS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;2,FS&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="s">&#39;1,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;1,&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_flag</span><span class="p">(</span><span class="s">&#39;RPT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;1,&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_flag</span><span class="p">(</span><span class="s">&#39;D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_info</span><span class="p">(),</span> <span class="s">&#39;2,D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

</div></div>
<span class="k">class</span> <span class="nc">_TestMboxMMDFMessage</span><span class="p">:</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">_mboxMMDFMessage</span>

    <span class="k">def</span> <span class="nf">_post_initialize_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_from</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_initialize_with_unixfrom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize with a message that already has a _unixfrom attribute</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_unixfrom</span><span class="p">(</span><span class="s">&#39;From foo@bar blah&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_from</span><span class="p">(),</span> <span class="s">&#39;foo@bar blah&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_from</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get and set &quot;From &quot; line</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_from</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_from</span><span class="p">(</span><span class="s">&#39;foo bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_from</span><span class="p">(),</span> <span class="s">&#39;foo bar&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_from</span><span class="p">(</span><span class="s">&#39;foo@bar&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_from</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;foo@bar&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_from</span><span class="p">(</span><span class="s">&#39;blah@temp&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_from</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;blah@temp&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use get_flags(), set_flags(), add_flag(), remove_flag()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;XODR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;RODX&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_flag</span><span class="p">(</span><span class="s">&#39;FA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;RODFAX&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_flag</span><span class="p">(</span><span class="s">&#39;FDXA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;RO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Check contents of &quot;From &quot; line</span>
        <span class="k">if</span> <span class="n">sender</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="s">&quot;MAILER-DAEMON&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                <span class="n">sender</span> <span class="o">+</span> <span class="s">r&quot; \w{3} \w{3} [\d ]\d [\d ]\d:\d{2}:\d{2} \d{4}&quot;</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">get_from</span><span class="p">()))</span>


<div class="viewcode-block" id="TestMboxMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMboxMessage">[docs]</a><span class="k">class</span> <span class="nc">TestMboxMessage</span><span class="p">(</span><span class="n">_TestMboxMMDFMessage</span><span class="p">,</span> <span class="n">TestMessage</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span>

</div>
<div class="viewcode-block" id="TestMHMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMHMessage">[docs]</a><span class="k">class</span> <span class="nc">TestMHMessage</span><span class="p">(</span><span class="n">TestMessage</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span>

    <span class="k">def</span> <span class="nf">_post_initialize_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">_sequences</span><span class="p">,</span> <span class="p">[])</span>

<div class="viewcode-block" id="TestMHMessage.test_sequences"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMHMessage.test_sequences">[docs]</a>    <span class="k">def</span> <span class="nf">test_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get, set, join, and leave sequences</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_sequence</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;flagged&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;foobar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;flagged&#39;</span><span class="p">,</span> <span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_sequence</span><span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;flagged&#39;</span><span class="p">,</span> <span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_sequences</span><span class="p">([</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="TestBabylMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabylMessage">[docs]</a><span class="k">class</span> <span class="nc">TestBabylMessage</span><span class="p">(</span><span class="n">TestMessage</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span>

    <span class="k">def</span> <span class="nf">_post_initialize_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">_labels</span><span class="p">,</span> <span class="p">[])</span>

<div class="viewcode-block" id="TestBabylMessage.test_labels"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabylMessage.test_labels">[docs]</a>    <span class="k">def</span> <span class="nf">test_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get, set, join, and leave labels</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_labels</span><span class="p">([</span><span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_labels</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="s">&#39;filed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;filed&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="s">&#39;resent&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;resent&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="s">&#39;resent&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;resent&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_label</span><span class="p">(</span><span class="s">&#39;filed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;resent&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="s">&#39;foobar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;resent&#39;</span><span class="p">,</span> <span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">remove_label</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;resent&#39;</span><span class="p">,</span> <span class="s">&#39;foobar&#39;</span><span class="p">])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_labels</span><span class="p">([</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestBabylMessage.test_visible"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestBabylMessage.test_visible">[docs]</a>    <span class="k">def</span> <span class="nf">test_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get, set, and update visible headers</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
        <span class="n">visible</span><span class="p">[</span><span class="s">&#39;User-Agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;FooBar 1.0&#39;</span>
        <span class="n">visible</span><span class="p">[</span><span class="s">&#39;X-Whatever&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Blah&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s">&#39;X-Whatever&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="p">[</span><span class="s">&#39;User-Agent&#39;</span><span class="p">],</span> <span class="s">&#39;FooBar 1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="p">[</span><span class="s">&#39;X-Whatever&#39;</span><span class="p">],</span> <span class="s">&#39;Blah&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">update_visible</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s">&#39;X-Whatever&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">get_payload</span><span class="p">())</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s">&#39;Date&#39;</span><span class="p">,</span> <span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="s">&#39;To&#39;</span><span class="p">,</span>
                                          <span class="s">&#39;Subject&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s">&#39;Date&#39;</span><span class="p">,</span> <span class="s">&#39;From&#39;</span><span class="p">,</span> <span class="s">&#39;To&#39;</span><span class="p">,</span> <span class="s">&#39;Subject&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">visible</span><span class="p">[</span><span class="n">header</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="n">header</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="TestMMDFMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMMDFMessage">[docs]</a><span class="k">class</span> <span class="nc">TestMMDFMessage</span><span class="p">(</span><span class="n">_TestMboxMMDFMessage</span><span class="p">,</span> <span class="n">TestMessage</span><span class="p">):</span>

    <span class="n">_factory</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span>

</div>
<div class="viewcode-block" id="TestMessageConversion"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion">[docs]</a><span class="k">class</span> <span class="nc">TestMessageConversion</span><span class="p">(</span><span class="n">TestBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestMessageConversion.test_plain_to_x"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_plain_to_x">[docs]</a>    <span class="k">def</span> <span class="nf">test_plain_to_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert Message to all formats</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
            <span class="n">msg_plain</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">msg_plain</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_x_to_plain"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_x_to_plain">[docs]</a>    <span class="k">def</span> <span class="nf">test_x_to_plain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert all formats to Message</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg_plain</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg_plain</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_x_from_bytes"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_x_from_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">test_x_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert all formats to Message</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">_bytes_sample_message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_x_to_invalid"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_x_to_invalid">[docs]</a>    <span class="k">def</span> <span class="nf">test_x_to_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert all formats to an invalid format</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">class_</span><span class="p">(</span><span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_type_specific_attributes_removed_on_conversion"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_type_specific_attributes_removed_on_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">test_type_specific_attributes_removed_on_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="p">{</span><span class="n">class_</span><span class="p">:</span> <span class="n">class_</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span><span class="o">.</span><span class="n">__dict__</span>
                        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">class1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">class2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_mailbox_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">class1</span> <span class="ow">is</span> <span class="n">class2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">class1</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">class2</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="n">type_specific</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">[</span><span class="n">class1</span><span class="p">]</span>
                                   <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reference</span><span class="p">[</span><span class="n">class2</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">type_specific</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">__dict__</span><span class="p">,</span>
                        <span class="s">&quot;while converting {} to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class1</span><span class="p">,</span> <span class="n">class2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_maildir_to_maildir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_maildir_to_maildir">[docs]</a>    <span class="k">def</span> <span class="nf">test_maildir_to_maildir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MaildirMessage to MaildirMessage</span>
        <span class="n">msg_maildir</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;DFPRST&#39;</span><span class="p">)</span>
        <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">msg_maildir</span><span class="o">.</span><span class="n">get_date</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg_maildir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sample</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;DFPRST&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_date</span><span class="p">(),</span> <span class="n">date</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_maildir_to_mboxmmdf"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_maildir_to_mboxmmdf">[docs]</a>    <span class="k">def</span> <span class="nf">test_maildir_to_mboxmmdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MaildirMessage to mboxmessage and MMDFMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;DFPRST&#39;</span><span class="p">,</span> <span class="s">&#39;RDFA&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="n">msg_maildir</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_date</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">msg_maildir</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_from</span><span class="p">(),</span> <span class="s">&#39;MAILER-DAEMON </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                             <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)))</span>
            <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s">&#39;cur&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">class_</span><span class="p">(</span><span class="n">msg_maildir</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;RODFA&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_maildir_to_mh"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_maildir_to_mh">[docs]</a>    <span class="k">def</span> <span class="nf">test_maildir_to_mh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MaildirMessage to MHMessage</span>
        <span class="n">msg_maildir</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">]),</span>
                 <span class="p">(</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                 <span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;DFPRST&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">msg_maildir</span><span class="p">)</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                             <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_maildir_to_babyl"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_maildir_to_babyl">[docs]</a>    <span class="k">def</span> <span class="nf">test_maildir_to_babyl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MaildirMessage to Babyl</span>
        <span class="n">msg_maildir</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span>
                 <span class="p">(</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">]),</span>
                 <span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">]),</span>
                 <span class="p">(</span><span class="s">&#39;DFPRST&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg_maildir</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">msg_maildir</span><span class="p">)</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span>
                             <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mboxmmdf_to_maildir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mboxmmdf_to_maildir">[docs]</a>    <span class="k">def</span> <span class="nf">test_mboxmmdf_to_maildir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert mboxMessage and MMDFMessage to MaildirMessage</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="n">msg_mboxMMDF</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg_mboxMMDF</span><span class="o">.</span><span class="n">set_from</span><span class="p">(</span><span class="s">&#39;foo@bar&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;RODFA&#39;</span><span class="p">,</span> <span class="s">&#39;FRST&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">msg_mboxMMDF</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg_mboxMMDF</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_date</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">msg_mboxMMDF</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg_mboxMMDF</span><span class="p">)</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span>
                             <span class="s">&#39;cur&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mboxmmdf_to_mboxmmdf"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mboxmmdf_to_mboxmmdf">[docs]</a>    <span class="k">def</span> <span class="nf">test_mboxmmdf_to_mboxmmdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert mboxMessage and MMDFMessage to mboxMessage and MMDFMessage</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="n">msg_mboxMMDF</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg_mboxMMDF</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s">&#39;RODFA&#39;</span><span class="p">)</span>
            <span class="n">msg_mboxMMDF</span><span class="o">.</span><span class="n">set_from</span><span class="p">(</span><span class="s">&#39;foo@bar&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">class2_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
                <span class="n">msg2</span> <span class="o">=</span> <span class="n">class2_</span><span class="p">(</span><span class="n">msg_mboxMMDF</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;RODFA&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_from</span><span class="p">(),</span> <span class="s">&#39;foo@bar&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mboxmmdf_to_mh"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mboxmmdf_to_mh">[docs]</a>    <span class="k">def</span> <span class="nf">test_mboxmmdf_to_mh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert mboxMessage and MMDFMessage to MHMessage</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="n">msg_mboxMMDF</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;RODFA&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">msg_mboxMMDF</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">msg_mboxMMDF</span><span class="p">)</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                                 <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mboxmmdf_to_babyl"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mboxmmdf_to_babyl">[docs]</a>    <span class="k">def</span> <span class="nf">test_mboxmmdf_to_babyl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert mboxMessage and MMDFMessage to BabylMessage</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;RODFA&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mh_to_maildir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mh_to_maildir">[docs]</a>    <span class="k">def</span> <span class="nf">test_mh_to_maildir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MHMessage to MaildirMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="s">&#39;RS&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">,</span> <span class="s">&#39;FS&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mh_to_mboxmmdf"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mh_to_mboxmmdf">[docs]</a>    <span class="k">def</span> <span class="nf">test_mh_to_mboxmmdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MHMessage to mboxMessage and MMDFMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="s">&#39;ROA&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">,</span> <span class="s">&#39;ROF&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">class_</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">class_</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;OFA&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mh_to_mh"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mh_to_mh">[docs]</a>    <span class="k">def</span> <span class="nf">test_mh_to_mh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MHMessage to MHMessage</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="s">&#39;flagged&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_mh_to_babyl"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_mh_to_babyl">[docs]</a>    <span class="k">def</span> <span class="nf">test_mh_to_babyl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert MHMessage to BabylMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;answered&#39;</span><span class="p">]),</span>
                 <span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;replied&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">add_sequence</span><span class="p">(</span><span class="s">&#39;flagged&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_babyl_to_maildir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_babyl_to_maildir">[docs]</a>    <span class="k">def</span> <span class="nf">test_babyl_to_maildir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert BabylMessage to MaildirMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;ST&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;RS&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;forwarded&#39;</span><span class="p">,</span> <span class="s">&#39;PS&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s">&#39;resent&#39;</span><span class="p">,</span> <span class="s">&#39;PS&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">,</span>
                      <span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="s">&#39;resent&#39;</span><span class="p">):</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;PRT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MaildirMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span> <span class="s">&#39;cur&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_babyl_to_mboxmmdf"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_babyl_to_mboxmmdf">[docs]</a>    <span class="k">def</span> <span class="nf">test_babyl_to_mboxmmdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert BabylMessage to mboxMessage and MMDFMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;ROD&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;RO&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;ROA&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;forwarded&#39;</span><span class="p">,</span> <span class="s">&#39;RO&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="s">&#39;RO&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s">&#39;resent&#39;</span><span class="p">,</span> <span class="s">&#39;RO&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">class_</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">,</span>
                      <span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="s">&#39;resent&#39;</span><span class="p">):</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">,</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">MMDFMessage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">class_</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span> <span class="s">&#39;ODA&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_babyl_to_mh"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_babyl_to_mh">[docs]</a>    <span class="k">def</span> <span class="nf">test_babyl_to_mh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert BabylMessage to MHMessage</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                 <span class="p">(</span><span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;replied&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="s">&#39;forwarded&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                 <span class="p">(</span><span class="s">&#39;resent&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">for</span> <span class="n">setting</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">,</span>
                      <span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="s">&#39;resent&#39;</span><span class="p">):</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">MHMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">get_sequences</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;replied&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestMessageConversion.test_babyl_to_babyl"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestMessageConversion.test_babyl_to_babyl">[docs]</a>    <span class="k">def</span> <span class="nf">test_babyl_to_babyl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Convert BabylMessage to BabylMessage</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">_sample_message</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">update_visible</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;filed&#39;</span><span class="p">,</span> <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">,</span>
                      <span class="s">&#39;edited&#39;</span><span class="p">,</span> <span class="s">&#39;resent&#39;</span><span class="p">):</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">BabylMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;unseen&#39;</span><span class="p">,</span> <span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="s">&#39;filed&#39;</span><span class="p">,</span>
                                             <span class="s">&#39;answered&#39;</span><span class="p">,</span> <span class="s">&#39;forwarded&#39;</span><span class="p">,</span> <span class="s">&#39;edited&#39;</span><span class="p">,</span>
                                             <span class="s">&#39;resent&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">msg2</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()[</span><span class="n">key</span><span class="p">],</span> <span class="n">msg2</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()[</span><span class="n">key</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="TestProxyFileBase"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFileBase">[docs]</a><span class="k">class</span> <span class="nc">TestProxyFileBase</span><span class="p">(</span><span class="n">TestBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_test_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c"># Read by byte</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;ar&#39;</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;ba&#39;</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;ar&#39;</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c"># Read by line</span>
        <span class="n">linesep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;foo&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;bar&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;fred&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;bob&#39;</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;o&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;fred&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;fr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;ed&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c"># Read multiple lines</span>
        <span class="n">linesep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="p">[</span><span class="n">b</span><span class="s">&#39;foo&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">,</span>
                                           <span class="n">b</span><span class="s">&#39;bar&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">,</span>
                                           <span class="n">b</span><span class="s">&#39;fred&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;bob&#39;</span><span class="p">])</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">b</span><span class="s">&#39;foo&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">])</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">linesep</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">linesep</span><span class="p">)),</span>
                     <span class="p">[</span><span class="n">b</span><span class="s">&#39;bar&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;fred&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">])</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="p">[</span><span class="n">linesep</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;bar&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">,</span>
                                               <span class="n">b</span><span class="s">&#39;fred&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;bob&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_test_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c"># Iterate by line</span>
        <span class="n">linesep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;foo&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;bar&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;fred&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;bob&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">iterator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_seek_and_tell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c"># Seek and use tell to check position</span>
        <span class="n">linesep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linesep</span><span class="p">)),</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">linesep</span><span class="p">)),</span> <span class="n">b</span><span class="s">&#39;r&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">linesep</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;o&#39;</span> <span class="o">+</span> <span class="n">linesep</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;bar&#39;</span> <span class="o">+</span> <span class="n">linesep</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="c"># Close a file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>
        <span class="c"># Issue 11700 subsequent closes should be a no-op.</span>
        <span class="n">proxy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestProxyFile"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile">[docs]</a><span class="k">class</span> <span class="nc">TestProxyFile</span><span class="p">(</span><span class="n">TestProxyFileBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestProxyFile.setUp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;wb+&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestProxyFile.tearDown"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_initialize"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize and check position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">proxy0</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy0</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">proxy1</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy1</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">pos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_read"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_read</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_readline"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">fred</span><span class="si">%s</span><span class="s">bob&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span>
                                                  <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_readline</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_readlines"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_readlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">fred</span><span class="si">%s</span><span class="s">bob&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span>
                                                  <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_readlines</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_iteration"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_iteration">[docs]</a>    <span class="k">def</span> <span class="nf">test_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">fred</span><span class="si">%s</span><span class="s">bob&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span>
                                                  <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_iteration</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_seek_and_tell"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_seek_and_tell">[docs]</a>    <span class="k">def</span> <span class="nf">test_seek_and_tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_seek_and_tell</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestProxyFile.test_close"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestProxyFile.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_close</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_ProxyFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="TestPartialFile"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile">[docs]</a><span class="k">class</span> <span class="nc">TestPartialFile</span><span class="p">(</span><span class="n">TestProxyFileBase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestPartialFile.setUp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s">&#39;wb+&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartialFile.tearDown"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_initialize"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize and check position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span> <span class="o">+</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">pos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_read"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;***bar***&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_read</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_readline"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;!!!!!foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">fred</span><span class="si">%s</span><span class="s">bob!!!!!&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_readline</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                                                 <span class="mi">18</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_readlines"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_readlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">fred</span><span class="si">%s</span><span class="s">bob?????&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_readlines</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                  <span class="mi">13</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_iteration"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_iteration">[docs]</a>    <span class="k">def</span> <span class="nf">test_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;____foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">fred</span><span class="si">%s</span><span class="s">bob####&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_iteration</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                                                  <span class="mi">17</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_seek_and_tell"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_seek_and_tell">[docs]</a>    <span class="k">def</span> <span class="nf">test_seek_and_tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;(((foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">$$$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_seek_and_tell</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                                      <span class="mi">9</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestPartialFile.test_close"><a class="viewcode-back" href="../../test.html#test.test_mailbox.TestPartialFile.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;&amp;foo</span><span class="si">%s</span><span class="s">bar</span><span class="si">%s</span><span class="s">^&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">),</span> <span class="s">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_close</span><span class="p">(</span><span class="n">mailbox</span><span class="o">.</span><span class="n">_PartialFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                              <span class="mi">6</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)))</span>


<span class="c">## Start: tests from the original module (for backward compatibility).</span>
</div></div>
<span class="n">FROM_</span> <span class="o">=</span> <span class="s">&quot;From some.body@dummy.domain  Sat Jul 24 13:43:35 2004</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="n">DUMMY_MESSAGE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: some.body@dummy.domain</span>
<span class="s">To: me@my.domain</span>
<span class="s">Subject: Simple Test</span>

<span class="s">This is a dummy message.</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MaildirTestCase"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase">[docs]</a><span class="k">class</span> <span class="nc">MaildirTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="MaildirTestCase.setUp"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># create a new maildir mailbox to work with:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dir</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">):</span>
            <span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;cur&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;tmp&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msgfiles</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="MaildirTestCase.tearDown"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgfiles</span><span class="p">))</span>
        <span class="n">support</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;cur&quot;</span><span class="p">))</span>
        <span class="n">support</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;tmp&quot;</span><span class="p">))</span>
        <span class="n">support</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">))</span>
        <span class="n">support</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MaildirTestCase.createMessage"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.createMessage">[docs]</a>    <span class="k">def</span> <span class="nf">createMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">mbox</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">%</span> <span class="mi">1000000</span><span class="p">)</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="s">&quot;myhostname&quot;</span><span class="p">,</span> <span class="s">&quot;mydomain&quot;</span><span class="p">))</span>
        <span class="n">tmpname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="s">&quot;tmp&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msgfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mbox</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">FROM_</span><span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">DUMMY_MESSAGE</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;link&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">tmpname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">newname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">DUMMY_MESSAGE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msgfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmpname</span>
</div>
<div class="viewcode-block" id="MaildirTestCase.test_empty_maildir"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.test_empty_maildir">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_maildir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test an empty maildir mailbox&quot;&quot;&quot;</span>
        <span class="c"># Test for regression on bug #117490:</span>
        <span class="c"># Make sure the boxes attribute actually gets set.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="c">#self.assertTrue(hasattr(self.mbox, &quot;boxes&quot;))</span>
        <span class="c">#self.assertEqual(len(self.mbox.boxes), 0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="MaildirTestCase.test_nonempty_maildir_cur"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.test_nonempty_maildir_cur">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonempty_maildir_cur</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createMessage</span><span class="p">(</span><span class="s">&quot;cur&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="c">#self.assertEqual(len(self.mbox.boxes), 1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="MaildirTestCase.test_nonempty_maildir_new"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.test_nonempty_maildir_new">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonempty_maildir_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createMessage</span><span class="p">(</span><span class="s">&quot;new&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="c">#self.assertEqual(len(self.mbox.boxes), 1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="MaildirTestCase.test_nonempty_maildir_both"><a class="viewcode-back" href="../../test.html#test.test_mailbox.MaildirTestCase.test_nonempty_maildir_both">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonempty_maildir_both</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createMessage</span><span class="p">(</span><span class="s">&quot;cur&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createMessage</span><span class="p">(</span><span class="s">&quot;new&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="c">#self.assertEqual(len(self.mbox.boxes), 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>

<span class="c">## End: tests from the original module (for backward compatibility).</span>

</div></div>
<span class="n">_sample_message</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Return-Path: &lt;gkj@gregorykjohnson.com&gt;</span>
<span class="s">X-Original-To: gkj+person@localhost</span>
<span class="s">Delivered-To: gkj+person@localhost</span>
<span class="s">Received: from localhost (localhost [127.0.0.1])</span>
<span class="s">        by andy.gregorykjohnson.com (Postfix) with ESMTP id 356ED9DD17</span>
<span class="s">        for &lt;gkj+person@localhost&gt;; Wed, 13 Jul 2005 17:23:16 -0400 (EDT)</span>
<span class="s">Delivered-To: gkj@sundance.gregorykjohnson.com</span>
<span class="s">Received: from localhost [127.0.0.1]</span>
<span class="s">        by localhost with POP3 (fetchmail-6.2.5)</span>
<span class="s">        for gkj+person@localhost (single-drop); Wed, 13 Jul 2005 17:23:16 -0400 (EDT)</span>
<span class="s">Received: from andy.gregorykjohnson.com (andy.gregorykjohnson.com [64.32.235.228])</span>
<span class="s">        by sundance.gregorykjohnson.com (Postfix) with ESMTP id 5B056316746</span>
<span class="s">        for &lt;gkj@gregorykjohnson.com&gt;; Wed, 13 Jul 2005 17:23:11 -0400 (EDT)</span>
<span class="s">Received: by andy.gregorykjohnson.com (Postfix, from userid 1000)</span>
<span class="s">        id 490CD9DD17; Wed, 13 Jul 2005 17:23:11 -0400 (EDT)</span>
<span class="s">Date: Wed, 13 Jul 2005 17:23:11 -0400</span>
<span class="s">From: &quot;Gregory K. Johnson&quot; &lt;gkj@gregorykjohnson.com&gt;</span>
<span class="s">To: gkj@gregorykjohnson.com</span>
<span class="s">Subject: Sample message</span>
<span class="s">Message-ID: &lt;20050713212311.GC4701@andy.gregorykjohnson.com&gt;</span>
<span class="s">Mime-Version: 1.0</span>
<span class="s">Content-Type: multipart/mixed; boundary=&quot;NMuMz9nt05w80d4+&quot;</span>
<span class="s">Content-Disposition: inline</span>
<span class="s">User-Agent: Mutt/1.5.9i</span>


<span class="s">--NMuMz9nt05w80d4+</span>
<span class="s">Content-Type: text/plain; charset=us-ascii</span>
<span class="s">Content-Disposition: inline</span>

<span class="s">This is a sample message.</span>

<span class="s">--</span>
<span class="s">Gregory K. Johnson</span>

<span class="s">--NMuMz9nt05w80d4+</span>
<span class="s">Content-Type: application/octet-stream</span>
<span class="s">Content-Disposition: attachment; filename=&quot;text.gz&quot;</span>
<span class="s">Content-Transfer-Encoding: base64</span>

<span class="s">H4sICM2D1UIAA3RleHQAC8nILFYAokSFktSKEoW0zJxUPa7wzJIMhZLyfIWczLzUYj0uAHTs</span>
<span class="s">3FYlAAAA</span>

<span class="s">--NMuMz9nt05w80d4+--</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">_bytes_sample_message</span> <span class="o">=</span> <span class="n">_sample_message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>

<span class="n">_sample_headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;Return-Path&quot;</span><span class="p">:</span><span class="s">&quot;&lt;gkj@gregorykjohnson.com&gt;&quot;</span><span class="p">,</span>
    <span class="s">&quot;X-Original-To&quot;</span><span class="p">:</span><span class="s">&quot;gkj+person@localhost&quot;</span><span class="p">,</span>
    <span class="s">&quot;Delivered-To&quot;</span><span class="p">:</span><span class="s">&quot;gkj+person@localhost&quot;</span><span class="p">,</span>
    <span class="s">&quot;Received&quot;</span><span class="p">:</span><span class="s">&quot;&quot;&quot;from localhost (localhost [127.0.0.1])</span>
<span class="s">        by andy.gregorykjohnson.com (Postfix) with ESMTP id 356ED9DD17</span>
<span class="s">        for &lt;gkj+person@localhost&gt;; Wed, 13 Jul 2005 17:23:16 -0400 (EDT)&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;Delivered-To&quot;</span><span class="p">:</span><span class="s">&quot;gkj@sundance.gregorykjohnson.com&quot;</span><span class="p">,</span>
    <span class="s">&quot;Received&quot;</span><span class="p">:</span><span class="s">&quot;&quot;&quot;from localhost [127.0.0.1]</span>
<span class="s">        by localhost with POP3 (fetchmail-6.2.5)</span>
<span class="s">        for gkj+person@localhost (single-drop); Wed, 13 Jul 2005 17:23:16 -0400 (EDT)&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;Received&quot;</span><span class="p">:</span><span class="s">&quot;&quot;&quot;from andy.gregorykjohnson.com (andy.gregorykjohnson.com [64.32.235.228])</span>
<span class="s">        by sundance.gregorykjohnson.com (Postfix) with ESMTP id 5B056316746</span>
<span class="s">        for &lt;gkj@gregorykjohnson.com&gt;; Wed, 13 Jul 2005 17:23:11 -0400 (EDT)&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;Received&quot;</span><span class="p">:</span><span class="s">&quot;&quot;&quot;by andy.gregorykjohnson.com (Postfix, from userid 1000)</span>
<span class="s">        id 490CD9DD17; Wed, 13 Jul 2005 17:23:11 -0400 (EDT)&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;Date&quot;</span><span class="p">:</span><span class="s">&quot;Wed, 13 Jul 2005 17:23:11 -0400&quot;</span><span class="p">,</span>
    <span class="s">&quot;From&quot;</span><span class="p">:</span><span class="s">&quot;&quot;&quot;&quot;Gregory K. Johnson&quot; &lt;gkj@gregorykjohnson.com&gt;&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;To&quot;</span><span class="p">:</span><span class="s">&quot;gkj@gregorykjohnson.com&quot;</span><span class="p">,</span>
    <span class="s">&quot;Subject&quot;</span><span class="p">:</span><span class="s">&quot;Sample message&quot;</span><span class="p">,</span>
    <span class="s">&quot;Mime-Version&quot;</span><span class="p">:</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s">&quot;Content-Type&quot;</span><span class="p">:</span><span class="s">&quot;&quot;&quot;multipart/mixed; boundary=&quot;NMuMz9nt05w80d4+</span><span class="se">\&quot;</span><span class="s">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;Content-Disposition&quot;</span><span class="p">:</span><span class="s">&quot;inline&quot;</span><span class="p">,</span>
    <span class="s">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s">&quot;Mutt/1.5.9i&quot;</span> <span class="p">}</span>

<span class="n">_sample_payloads</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;This is a sample message.</span>

<span class="s">--</span>
<span class="s">Gregory K. Johnson</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">,</span>
<span class="sd">&quot;&quot;&quot;H4sICM2D1UIAA3RleHQAC8nILFYAokSFktSKEoW0zJxUPa7wzJIMhZLyfIWczLzUYj0uAHTs</span>
<span class="sd">3FYlAAAA</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="test_main"><a class="viewcode-back" href="../../test.html#test.test_mailbox.test_main">[docs]</a><span class="k">def</span> <span class="nf">test_main</span><span class="p">():</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="p">(</span><span class="n">TestMailboxSuperclass</span><span class="p">,</span> <span class="n">TestMaildir</span><span class="p">,</span> <span class="n">TestMbox</span><span class="p">,</span> <span class="n">TestMMDF</span><span class="p">,</span> <span class="n">TestMH</span><span class="p">,</span>
             <span class="n">TestBabyl</span><span class="p">,</span> <span class="n">TestMessage</span><span class="p">,</span> <span class="n">TestMaildirMessage</span><span class="p">,</span> <span class="n">TestMboxMessage</span><span class="p">,</span>
             <span class="n">TestMHMessage</span><span class="p">,</span> <span class="n">TestBabylMessage</span><span class="p">,</span> <span class="n">TestMMDFMessage</span><span class="p">,</span>
             <span class="n">TestMessageConversion</span><span class="p">,</span> <span class="n">TestProxyFile</span><span class="p">,</span> <span class="n">TestPartialFile</span><span class="p">,</span>
             <span class="n">MaildirTestCase</span><span class="p">,</span> <span class="n">TestFakeMailBox</span><span class="p">)</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="o">*</span><span class="n">tests</span><span class="p">)</span>
    <span class="n">support</span><span class="o">.</span><span class="n">reap_children</span><span class="p">()</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>