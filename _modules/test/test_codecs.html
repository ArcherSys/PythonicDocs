

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>test.test_codecs &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>test.test_codecs</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for test.test_codecs</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">encodings</span>

<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">:</span>
    <span class="n">VISTA_OR_LATER</span> <span class="o">=</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getwindowsversion</span><span class="p">()</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">VISTA_OR_LATER</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ctypes</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ctypes</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">SIZEOF_WCHAR_T</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">SIZEOF_WCHAR_T</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar</span><span class="p">)</span>

<div class="viewcode-block" id="coding_checker"><a class="viewcode-back" href="../../test.html#test.test_codecs.coding_checker">[docs]</a><span class="k">def</span> <span class="nf">coding_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">expect</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">coder</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="p">(</span><span class="n">expect</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">check</span>
</div>
<div class="viewcode-block" id="Queue"><a class="viewcode-back" href="../../test.html#test.test_codecs.Queue">[docs]</a><span class="k">class</span> <span class="nc">Queue</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    queue: write bytes at one end, read bytes from the other end</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="nb">buffer</span>

<div class="viewcode-block" id="Queue.write"><a class="viewcode-back" href="../../test.html#test.test_codecs.Queue.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">+=</span> <span class="n">chars</span>
</div>
<div class="viewcode-block" id="Queue.read"><a class="viewcode-back" href="../../test.html#test.test_codecs.Queue.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">size</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="c"># make empty</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">s</span>
</div></div>
<div class="viewcode-block" id="MixInCheckStateHandling"><a class="viewcode-back" href="../../test.html#test.test_codecs.MixInCheckStateHandling">[docs]</a><span class="k">class</span> <span class="nc">MixInCheckStateHandling</span><span class="p">:</span>
<div class="viewcode-block" id="MixInCheckStateHandling.check_state_handling_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.MixInCheckStateHandling.check_state_handling_decode">[docs]</a>    <span class="k">def</span> <span class="nf">check_state_handling_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)()</span>
            <span class="n">part1</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">getstate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
            <span class="c"># Check that the condition stated in the documentation for</span>
            <span class="c"># IncrementalDecoder.getstate() holds</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c"># reset decoder to the default state without anything buffered</span>
                <span class="n">d</span><span class="o">.</span><span class="n">setstate</span><span class="p">((</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
                <span class="c"># Feeding the previous input may not produce any output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="c"># The decoder must return to the same state</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">getstate</span><span class="p">())</span>
            <span class="c"># Create a new decoder and set it to the state</span>
            <span class="c"># we extracted from the old one</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)()</span>
            <span class="n">d</span><span class="o">.</span><span class="n">setstate</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">part2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">part1</span><span class="o">+</span><span class="n">part2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MixInCheckStateHandling.check_state_handling_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.MixInCheckStateHandling.check_state_handling_encode">[docs]</a>    <span class="k">def</span> <span class="nf">check_state_handling_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)()</span>
            <span class="n">part1</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">getstate</span><span class="p">()</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)()</span>
            <span class="n">d</span><span class="o">.</span><span class="n">setstate</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">part2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">part1</span><span class="o">+</span><span class="n">part2</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ReadTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest">[docs]</a><span class="k">class</span> <span class="nc">ReadTest</span><span class="p">(</span><span class="n">MixInCheckStateHandling</span><span class="p">):</span>
<div class="viewcode-block" id="ReadTest.check_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.check_partial">[docs]</a>    <span class="k">def</span> <span class="nf">check_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">partialresults</span><span class="p">):</span>
        <span class="c"># get a StreamReader for the encoding and feed the bytestring version</span>
        <span class="c"># of input to the reader byte by byte. Read everything available from</span>
        <span class="c"># the StreamReader and check that the results equal the appropriate</span>
        <span class="c"># entries from partialresults.</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">partialresult</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">partialresults</span><span class="p">):</span>
            <span class="n">q</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">partialresult</span><span class="p">)</span>
        <span class="c"># check that there&#39;s nothing left in the buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">bytebuffer</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># do the check again, this time using a incremental decoder</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">partialresult</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">partialresults</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">partialresult</span><span class="p">)</span>
        <span class="c"># check that there&#39;s nothing left in the buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># Check whether the reset method works properly</span>
        <span class="n">d</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">partialresult</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">partialresults</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">partialresult</span><span class="p">)</span>
        <span class="c"># check that there&#39;s nothing left in the buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># check iterdecode()</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">input</span><span class="p">,</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">([</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encoded</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadTest.test_readline"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">getreader</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">readalllines</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">keepends</span><span class="o">=</span><span class="n">keepends</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;foo</span><span class="se">\n</span><span class="s">bar</span><span class="se">\r\n</span><span class="s">baz</span><span class="se">\r</span><span class="s">spam</span><span class="se">\u2028</span><span class="s">eggs&quot;</span>
        <span class="n">sexpected</span> <span class="o">=</span> <span class="s">&quot;foo</span><span class="se">\n</span><span class="s">|bar</span><span class="se">\r\n</span><span class="s">|baz</span><span class="se">\r</span><span class="s">|spam</span><span class="se">\u2028</span><span class="s">|eggs&quot;</span>
        <span class="n">sexpectednoends</span> <span class="o">=</span> <span class="s">&quot;foo|bar|baz|spam|eggs&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">readalllines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">sexpected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">readalllines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span> <span class="n">sexpectednoends</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">readalllines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sexpected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">readalllines</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sexpectednoends</span><span class="p">)</span>

        <span class="n">lineends</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u2028</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="c"># Test long lines (multiple calls to read() in readline())</span>
        <span class="n">vw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vwo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lineend</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lineends</span><span class="p">):</span>
            <span class="n">vw</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">200</span><span class="o">+</span><span class="mi">200</span><span class="p">)</span><span class="o">*</span><span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">lineend</span><span class="p">)</span>
            <span class="n">vwo</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">200</span><span class="o">+</span><span class="mi">200</span><span class="p">)</span><span class="o">*</span><span class="s">&quot;</span><span class="se">\u3042</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">readalllines</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vw</span><span class="p">),</span> <span class="bp">True</span><span class="p">),</span> <span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">readalllines</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vw</span><span class="p">),</span> <span class="bp">False</span><span class="p">),</span> <span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vwo</span><span class="p">))</span>

        <span class="c"># Test lines where the first read might end with \r, so the</span>
        <span class="c"># reader has to look ahead whether this is a lone \r or a \r\n</span>
        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">80</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lineend</span> <span class="ow">in</span> <span class="n">lineends</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="s">&quot;a&quot;</span> <span class="o">+</span> <span class="n">lineend</span> <span class="o">+</span> <span class="s">&quot;xxx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                        <span class="n">size</span><span class="o">*</span><span class="s">&quot;a&quot;</span> <span class="o">+</span> <span class="n">lineend</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                        <span class="s">&quot;xxx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                        <span class="n">size</span><span class="o">*</span><span class="s">&quot;a&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                        <span class="s">&quot;xxx&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadTest.test_mixed_readline_and_read"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_mixed_readline_and_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_mixed_readline_and_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Humpty Dumpty sat on a wall,</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Humpty Dumpty had a great fall.</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span>
                 <span class="s">&quot;All the king&#39;s horses and all the king&#39;s men</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span>
                 <span class="s">&quot;Couldn&#39;t put Humpty together again.&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">getreader</span><span class="p">():</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>

        <span class="c"># Issue #8260: Test readline() followed by read()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># Issue #16636: Test readline() followed by readlines()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># Test read() followed by read()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># Issue #12446: Test read() followed by readlines()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">getreader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="p">[</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">:]]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadTest.test_bug1175396"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_bug1175396">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug1175396</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;&lt;%!--===================================================</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    BLOG index page: show recent articles,</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    today</span><span class="se">\&#39;</span><span class="s">s articles, or articles of a specific date.</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;========================================================--%&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;%@inputencoding=&quot;ISO-8859-1&quot;%&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;%@pagetemplate=TEMPLATE.y%&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;%@import=import frog.util, frog%&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;%@import=import frog.objects%&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;%@import=from frog.storageerrors import StorageError%&gt;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;%</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;import logging</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;log=logging.getLogger(&quot;Snakelets.logger&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;user=self.SessionCtx.user</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;storageEngine=self.SessionCtx.storageEngine</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;def readArticlesFromDate(date, count=None):</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    entryids=storageEngine.listBlogEntries(date)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    entryids.reverse() # descending</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    if count:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        entryids=entryids[:count]</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    try:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        return [ frog.objects.BlogEntry.load(storageEngine, date, Id) for Id in entryids ]</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    except StorageError,x:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        log.error(&quot;Error loading articles: &quot;+str(x))</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        self.abort(&quot;cannot load articles&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;showdate=None</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;arg=self.Request.getArg()</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;if arg==&quot;today&quot;:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    #-------------------- TODAY</span><span class="se">\&#39;</span><span class="s">S ARTICLES</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    self.write(&quot;&lt;h2&gt;Today</span><span class="se">\&#39;</span><span class="s">s articles&lt;/h2&gt;&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    showdate = frog.util.isodatestr() </span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    entries = readArticlesFromDate(showdate)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;elif arg==&quot;active&quot;:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    #-------------------- ACTIVE ARTICLES redirect</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    self.Yredirect(&quot;active.y&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;elif arg==&quot;login&quot;:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    #-------------------- LOGIN PAGE redirect</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    self.Yredirect(&quot;login.y&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;elif arg==&quot;date&quot;:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    #-------------------- ARTICLES OF A SPECIFIC DATE</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    showdate = self.Request.getParameter(&quot;date&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    self.write(&quot;&lt;h2&gt;Articles written on </span><span class="si">%s</span><span class="s">&lt;/h2&gt;&quot;</span><span class="si">% f</span><span class="s">rog.util.mediumdatestr(showdate))</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    entries = readArticlesFromDate(showdate)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;else:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    #-------------------- RECENT ARTICLES</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    self.write(&quot;&lt;h2&gt;Recent articles&lt;/h2&gt;&quot;)</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    dates=storageEngine.listBlogEntryDates()</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;    if dates:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        entries=[]</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        SHOWAMOUNT=10</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;        for showdate in dates:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;            entries.extend( readArticlesFromDate(showdate, SHOWAMOUNT-len(entries)) )</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;            if len(entries)&gt;=SHOWAMOUNT:</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;                break</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="s">&#39;                </span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ReadTest.test_readlinequeue"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_readlinequeue">[docs]</a>    <span class="k">def</span> <span class="nf">test_readlinequeue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>

        <span class="c"># No lineends</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;foo</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">bar</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="s">&quot;baz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># Lineends</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;foo</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;foo</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">bar</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;bar</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;baz&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;foo</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;foo</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadTest.test_bug1098990_a"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_bug1098990_a">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug1098990_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="s">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="s">&quot;offending line: ladfj askldfj klasdj fskla dfzaskdj fasklfj laskd fjasklfzzzzaa%whereisthis!!!</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="s">&quot;next line.</span><span class="se">\r\n</span><span class="s">&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="n">s3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadTest.test_bug1098990_b"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_bug1098990_b">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug1098990_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="s">&quot;aaaaaaaaaaaaaaaaaaaaaaaa</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="s">&quot;bbbbbbbbbbbbbbbbbbbbbbbb</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="s">&quot;stillokay:bbbbxx</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">s4</span> <span class="o">=</span> <span class="s">&quot;broken!!!!badbad</span><span class="se">\r\n</span><span class="s">&quot;</span>
        <span class="n">s5</span> <span class="o">=</span> <span class="s">&quot;againokay.</span><span class="se">\r\n</span><span class="s">&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="n">s3</span><span class="o">+</span><span class="n">s4</span><span class="o">+</span><span class="n">s5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="n">s5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">(),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
    <span class="n">ill_formed_sequence_replace</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span>

<div class="viewcode-block" id="ReadTest.test_lone_surrogates"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadTest.test_lone_surrogates">[docs]</a>    <span class="k">def</span> <span class="nf">test_lone_surrogates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\ud800</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;backslashreplace&quot;</span><span class="p">),</span>
                         <span class="s">&quot;[</span><span class="se">\\</span><span class="s">udc80]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">),</span>
                         <span class="s">&quot;[&amp;#56448;]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span>
                         <span class="s">&quot;[]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                         <span class="s">&quot;[?]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>

        <span class="n">bom</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&quot;</span><span class="se">\U00010fff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;[&quot;</span><span class="p">,</span> <span class="s">&quot;]&quot;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U00010fff</span><span class="s">&quot;</span><span class="p">)]:</span>
            <span class="n">before_sequence</span> <span class="o">=</span> <span class="n">before</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">bom</span><span class="p">):]</span>
            <span class="n">after_sequence</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">bom</span><span class="p">):]</span>
            <span class="n">test_string</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\uDC80</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">after</span>
            <span class="n">test_sequence</span> <span class="o">=</span> <span class="p">(</span><span class="n">bom</span> <span class="o">+</span> <span class="n">before_sequence</span> <span class="o">+</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">ill_formed_sequence</span> <span class="o">+</span> <span class="n">after_sequence</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">test_sequence</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                                <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                             <span class="n">test_sequence</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_sequence</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                                  <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                             <span class="n">test_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_sequence</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span>
                             <span class="n">before</span> <span class="o">+</span> <span class="n">after</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_sequence</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                             <span class="n">before</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ill_formed_sequence_replace</span> <span class="o">+</span> <span class="n">after</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="UTF32Test"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test">[docs]</a><span class="k">class</span> <span class="nc">UTF32Test</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-32&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s">&#39;little&#39;</span><span class="p">:</span>
        <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\xdc\x00\x00</span><span class="s">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\xdc\x80</span><span class="s">&quot;</span>

    <span class="n">spamle</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xfe\x00\x00</span><span class="s">&#39;</span>
              <span class="n">b</span><span class="s">&#39;s</span><span class="se">\x00\x00\x00</span><span class="s">p</span><span class="se">\x00\x00\x00</span><span class="s">a</span><span class="se">\x00\x00\x00</span><span class="s">m</span><span class="se">\x00\x00\x00</span><span class="s">&#39;</span>
              <span class="n">b</span><span class="s">&#39;s</span><span class="se">\x00\x00\x00</span><span class="s">p</span><span class="se">\x00\x00\x00</span><span class="s">a</span><span class="se">\x00\x00\x00</span><span class="s">m</span><span class="se">\x00\x00\x00</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">spambe</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\xfe\xff</span><span class="s">&#39;</span>
              <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00</span><span class="s">s</span><span class="se">\x00\x00\x00</span><span class="s">p</span><span class="se">\x00\x00\x00</span><span class="s">a</span><span class="se">\x00\x00\x00</span><span class="s">m&#39;</span>
              <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x00</span><span class="s">s</span><span class="se">\x00\x00\x00</span><span class="s">p</span><span class="se">\x00\x00\x00</span><span class="s">a</span><span class="se">\x00\x00\x00</span><span class="s">m&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="UTF32Test.test_only_one_bom"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_only_one_bom">[docs]</a>    <span class="k">def</span> <span class="nf">test_only_one_bom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">reader</span><span class="p">,</span><span class="n">writer</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="c"># encode some stream</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="c"># check whether there is exactly one BOM in it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamle</span> <span class="ow">or</span> <span class="n">d</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">spambe</span><span class="p">)</span>
        <span class="c"># try to read it back</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&quot;spamspam&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32Test.test_badbom"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_badbom">[docs]</a>    <span class="k">def</span> <span class="nf">test_badbom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32Test.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># first byte of BOM read</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># second byte of BOM read</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># third byte of BOM read</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># fourth byte of BOM read =&gt; byteorder known</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32Test.test_handlers"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">test_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UTF32Test.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_decode</span><span class="p">,</span>
                          <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32Test.test_decoder_state"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_decoder_state">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoder_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                         <span class="s">&quot;spamspam&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                         <span class="s">&quot;spamspam&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spambe</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32Test.test_issue8941"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32Test.test_issue8941">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue8941</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #8941: insufficient result allocation when decoding into</span>
        <span class="c"># surrogate pairs on UCS-2 builds.</span>
        <span class="n">encoded_le</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xfe\x00\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x01\x00</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U00010000</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_decode</span><span class="p">(</span><span class="n">encoded_le</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">encoded_be</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\xfe\xff</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01\x00\x00</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U00010000</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_decode</span><span class="p">(</span><span class="n">encoded_be</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</div></div>
<div class="viewcode-block" id="UTF32LETest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32LETest">[docs]</a><span class="k">class</span> <span class="nc">UTF32LETest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-32-le&quot;</span>
    <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\xdc\x00\x00</span><span class="s">&quot;</span>

<div class="viewcode-block" id="UTF32LETest.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32LETest.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32LETest.test_simple"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32LETest.test_simple">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\U00010203</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x03\x02\x01\x00</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32LETest.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32LETest.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_le_decode</span><span class="p">,</span>
                          <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32LETest.test_issue8941"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32LETest.test_issue8941">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue8941</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #8941: insufficient result allocation when decoding into</span>
        <span class="c"># surrogate pairs on UCS-2 builds.</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x00\x01\x00</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U00010000</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_le_decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</div></div>
<div class="viewcode-block" id="UTF32BETest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32BETest">[docs]</a><span class="k">class</span> <span class="nc">UTF32BETest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-32-be&quot;</span>
    <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\xdc\x80</span><span class="s">&quot;</span>

<div class="viewcode-block" id="UTF32BETest.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32BETest.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32BETest.test_simple"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32BETest.test_simple">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\U00010203</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02\x03</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32BETest.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32BETest.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_be_decode</span><span class="p">,</span>
                          <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF32BETest.test_issue8941"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF32BETest.test_issue8941">[docs]</a>    <span class="k">def</span> <span class="nf">test_issue8941</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #8941: insufficient result allocation when decoding into</span>
        <span class="c"># surrogate pairs on UCS-2 builds.</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\x01\x00\x00</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U00010000</span><span class="s">&#39;</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_be_decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="UTF16Test"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test">[docs]</a><span class="k">class</span> <span class="nc">UTF16Test</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-16&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s">&#39;little&#39;</span><span class="p">:</span>
        <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\xdc</span><span class="s">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xdc\x80</span><span class="s">&quot;</span>

    <span class="n">spamle</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xfe</span><span class="s">s</span><span class="se">\x00</span><span class="s">p</span><span class="se">\x00</span><span class="s">a</span><span class="se">\x00</span><span class="s">m</span><span class="se">\x00</span><span class="s">s</span><span class="se">\x00</span><span class="s">p</span><span class="se">\x00</span><span class="s">a</span><span class="se">\x00</span><span class="s">m</span><span class="se">\x00</span><span class="s">&#39;</span>
    <span class="n">spambe</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfe\xff\x00</span><span class="s">s</span><span class="se">\x00</span><span class="s">p</span><span class="se">\x00</span><span class="s">a</span><span class="se">\x00</span><span class="s">m</span><span class="se">\x00</span><span class="s">s</span><span class="se">\x00</span><span class="s">p</span><span class="se">\x00</span><span class="s">a</span><span class="se">\x00</span><span class="s">m&#39;</span>

<div class="viewcode-block" id="UTF16Test.test_only_one_bom"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_only_one_bom">[docs]</a>    <span class="k">def</span> <span class="nf">test_only_one_bom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">reader</span><span class="p">,</span><span class="n">writer</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="c"># encode some stream</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="c"># check whether there is exactly one BOM in it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamle</span> <span class="ow">or</span> <span class="n">d</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">spambe</span><span class="p">)</span>
        <span class="c"># try to read it back</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&quot;spamspam&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16Test.test_badbom"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_badbom">[docs]</a>    <span class="k">def</span> <span class="nf">test_badbom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\xff</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xff\xff\xff\xff</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16Test.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># first byte of BOM read</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># second byte of BOM read =&gt; byteorder known</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16Test.test_handlers"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_handlers">[docs]</a>    <span class="k">def</span> <span class="nf">test_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UTF16Test.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_decode</span><span class="p">,</span>
                          <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16Test.test_decoder_state"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_decoder_state">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoder_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                         <span class="s">&quot;spamspam&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                         <span class="s">&quot;spamspam&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spambe</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16Test.test_bug691291"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16Test.test_bug691291">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug691291</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Files are always opened in binary mode, even if no binary mode was</span>
        <span class="c"># specified.  This means that no automatic conversion of &#39;\n&#39; is done</span>
        <span class="c"># on reading and writing.</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="s">&#39;Hello</span><span class="se">\r\n</span><span class="s">world</span><span class="se">\r\n</span><span class="s">&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">reader</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">s1</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="UTF16LETest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16LETest">[docs]</a><span class="k">class</span> <span class="nc">UTF16LETest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-16-le&quot;</span>
    <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\xdc</span><span class="s">&quot;</span>

<div class="viewcode-block" id="UTF16LETest.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16LETest.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16LETest.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16LETest.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;A</span><span class="se">\x00</span><span class="s">Z&#39;</span><span class="p">,</span> <span class="s">&#39;A</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;A</span><span class="se">\x00</span><span class="s">B</span><span class="se">\x00</span><span class="s">C</span><span class="se">\x00</span><span class="s">D</span><span class="se">\x00</span><span class="s">Z&#39;</span><span class="p">,</span> <span class="s">&#39;ABCD</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xd8</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xd8</span><span class="s">A&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xd8</span><span class="s">A</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">A&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xdc</span><span class="s">A</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">A&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_le_decode</span><span class="p">,</span>
                              <span class="n">raw</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-16le&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16LETest.test_nonbmp"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16LETest.test_nonbmp">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonbmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\U00010203</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xd8\x03\xde</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00\xd8\x03\xde</span><span class="s">&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span>
                         <span class="s">&quot;</span><span class="se">\U00010203</span><span class="s">&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="UTF16BETest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16BETest">[docs]</a><span class="k">class</span> <span class="nc">UTF16BETest</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-16-be&quot;</span>
    <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xdc\x80</span><span class="s">&quot;</span>

<div class="viewcode-block" id="UTF16BETest.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16BETest.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u0100\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16BETest.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16BETest.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">A</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;A</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">A</span><span class="se">\x00</span><span class="s">B</span><span class="se">\x00</span><span class="s">C</span><span class="se">\x00</span><span class="s">DZ&#39;</span><span class="p">,</span> <span class="s">&#39;ABCD</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\x00\xdc</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\x00\x00</span><span class="s">A&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">A&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xdc\x00\x00</span><span class="s">A&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">A&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_be_decode</span><span class="p">,</span>
                              <span class="n">raw</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-16be&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16BETest.test_nonbmp"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16BETest.test_nonbmp">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonbmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\U00010203</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\x00\xde\x03</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\x00\xde\x03</span><span class="s">&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span>
                         <span class="s">&quot;</span><span class="se">\U00010203</span><span class="s">&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="UTF8Test"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8Test">[docs]</a><span class="k">class</span> <span class="nc">UTF8Test</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span>
    <span class="n">ill_formed_sequence</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xed\xb2\x80</span><span class="s">&quot;</span>
    <span class="n">ill_formed_sequence_replace</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span> <span class="o">*</span> <span class="mi">3</span>

<div class="viewcode-block" id="UTF8Test.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8Test.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\x00\xff\u07ff\u0800\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF8Test.test_decoder_state"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8Test.test_decoder_state">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoder_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x00\x7f\x80\xff\u0100\u07ff\u0800\uffff\U0010ffff</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                                         <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UTF8Test.test_lone_surrogates"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8Test.test_lone_surrogates">[docs]</a>    <span class="k">def</span> <span class="nf">test_lone_surrogates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">test_lone_surrogates</span><span class="p">()</span>
        <span class="c"># not sure if this is making sense for</span>
        <span class="c"># UTF-16 and UTF-32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;[</span><span class="se">\x80</span><span class="s">]&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF8Test.test_surrogatepass_handler"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8Test.test_surrogatepass_handler">[docs]</a>    <span class="k">def</span> <span class="nf">test_surrogatepass_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;abc</span><span class="se">\ud800</span><span class="s">def&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;abc</span><span class="se">\xed\xa0\x80</span><span class="s">def&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abc</span><span class="se">\xed\xa0\x80</span><span class="s">def&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="s">&quot;abc</span><span class="se">\ud800</span><span class="s">def&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\U00010fff\uD800</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xf0\x90\xbf\xbf\xed\xa0\x80</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xf0\x90\xbf\xbf\xed\xa0\x80</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="s">&quot;</span><span class="se">\U00010fff\uD800</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;surrogatepass&quot;</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">):</span>
            <span class="n">b</span><span class="s">&quot;abc</span><span class="se">\xed\xa0</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">):</span>
            <span class="n">b</span><span class="s">&quot;abc</span><span class="se">\xed\xa0</span><span class="s">z&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">)</span>
</div></div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span>
                     <span class="s">&#39;cp65001 is a Windows-only codec&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="CP65001Test"><a class="viewcode-back" href="../../test.html#test.test_codecs.CP65001Test">[docs]</a><span class="k">class</span> <span class="nc">CP65001Test</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;cp65001&quot;</span>

<div class="viewcode-block" id="CP65001Test.test_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.CP65001Test.test_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\xe9\u20ac</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>  <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc3\xa9\xe2\x82\xac</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\U0010ffff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xf4\x8f\xbf\xbf</span><span class="s">&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">VISTA_OR_LATER</span><span class="p">:</span>
            <span class="n">tests</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span>
                <span class="p">(</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;?&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;backslashreplace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">udc80&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;surrogatepass&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xed\xb2\x80</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xed\xb2\x80</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">encoded</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;cp65001&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Unable to encode %a to cp65001 with &#39;</span>
                              <span class="s">&#39;errors=</span><span class="si">%r</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span>
                    <span class="s">&#39;%a.encode(&quot;cp65001&quot;, </span><span class="si">%r</span><span class="s">)=%a != %a&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">encoded</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CP65001Test.test_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.CP65001Test.test_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc3\xa9\xe2\x82\xac</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xe9\u20ac</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf4\x8f\xbf\xbf</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\U0010ffff</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xef\xbf\xbd</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xc3\xa9</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\xe9</span><span class="s">]&#39;</span><span class="p">),</span>
            <span class="c"># invalid bytes</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\ufffd</span><span class="s">]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;surrogateescape&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\udcff</span><span class="s">]&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">VISTA_OR_LATER</span><span class="p">:</span>
            <span class="n">tests</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span>
                <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xed\xb2\x80</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xed\xb2\x80</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xed\xb2\x80</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\ufffd\ufffd\ufffd</span><span class="s">]&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tests</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span>
                <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xed\xb2\x80</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\udc80</span><span class="s">]&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">decoded</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;cp65001&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Unable to decode %a from cp65001 with &#39;</span>
                              <span class="s">&#39;errors=</span><span class="si">%r</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span>
                    <span class="s">&#39;%a.decode(&quot;cp65001&quot;, </span><span class="si">%r</span><span class="s">)=%a != %a&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">decoded</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                    <span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&#39;cp65001&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">VISTA_OR_LATER</span><span class="p">,</span> <span class="s">&#39;require Windows Vista or later&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="CP65001Test.test_lone_surrogates"><a class="viewcode-back" href="../../test.html#test.test_codecs.CP65001Test.test_lone_surrogates">[docs]</a>    <span class="k">def</span> <span class="nf">test_lone_surrogates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\ud800</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;cp65001&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xed\xa0\x80</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;cp65001&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;backslashreplace&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;[</span><span class="se">\\</span><span class="s">udc80]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;xmlcharrefreplace&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;[&amp;#56448;]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;[</span><span class="se">\x80</span><span class="s">]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;[]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;[</span><span class="se">\uDC80</span><span class="s">]&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;[?]&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">VISTA_OR_LATER</span><span class="p">,</span> <span class="s">&#39;require Windows Vista or later&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="CP65001Test.test_surrogatepass_handler"><a class="viewcode-back" href="../../test.html#test.test_codecs.CP65001Test.test_surrogatepass_handler">[docs]</a>    <span class="k">def</span> <span class="nf">test_surrogatepass_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;abc</span><span class="se">\ud800</span><span class="s">def&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;abc</span><span class="se">\xed\xa0\x80</span><span class="s">def&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abc</span><span class="se">\xed\xa0\x80</span><span class="s">def&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="s">&quot;abc</span><span class="se">\ud800</span><span class="s">def&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\U00010fff\uD800</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xf0\x90\xbf\xbf\xed\xa0\x80</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xf0\x90\xbf\xbf\xed\xa0\x80</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;cp65001&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">),</span>
                         <span class="s">&quot;</span><span class="se">\U00010fff\uD800</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">lookup_error</span><span class="p">(</span><span class="s">&quot;surrogatepass&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CP65001Test.test_readline"><a class="viewcode-back" href="../../test.html#test.test_codecs.CP65001Test.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&quot;issue #20571: code page 65001 codec does not &quot;</span>
                      <span class="s">&quot;support partial decoder yet&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="UTF7Test"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF7Test">[docs]</a><span class="k">class</span> <span class="nc">UTF7Test</span><span class="p">(</span><span class="n">ReadTest</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-7&quot;</span>

<div class="viewcode-block" id="UTF7Test.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF7Test.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e</span><span class="se">\U00010000</span><span class="s">f&#39;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&#39;a&#39;</span><span class="p">,</span>
                <span class="s">&#39;a&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e</span><span class="se">\U00010000</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="s">&#39;a+-b</span><span class="se">\x00</span><span class="s">c</span><span class="se">\x80</span><span class="s">d</span><span class="se">\u0100</span><span class="s">e</span><span class="se">\U00010000</span><span class="s">f&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF7Test.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF7Test.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a</span><span class="se">\xff</span><span class="s">b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\ufffd</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IK&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IK-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\ufffd</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IK,b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\ufffd</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKx&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKx-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\ufffd</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKwgr&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKwgr-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\ufffd</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKwgr,&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKwgr,-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\ufffd</span><span class="s">-b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKwgrB&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\u20ac\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+IKwgrB-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\u20ac\u20ac\ufffd</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+/,+IKw-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\ufffd\u20ac</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+//,+IKw-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\ufffd\u20ac</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+///,+IKw-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\uffff\ufffd\u20ac</span><span class="s">b&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;a+////,+IKw-b&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\uffff\ufffd\u20ac</span><span class="s">b&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_7_decode</span><span class="p">,</span>
                                <span class="n">raw</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-7&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF7Test.test_nonbmp"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF7Test.test_nonbmp">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonbmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U000104A0</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;+2AHcoA-&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\ud801\udca0</span><span class="s">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;+2AHcoA-&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;+2AHcoA-&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\U000104A0</span><span class="s">&#39;</span><span class="p">)</span>
</div>
    <span class="n">test_lone_surrogates</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="UTF16ExTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16ExTest">[docs]</a><span class="k">class</span> <span class="nc">UTF16ExTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="UTF16ExTest.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16ExTest.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_ex_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF16ExTest.test_bad_args"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF16ExTest.test_bad_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_ex_decode</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ReadBufferTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadBufferTest">[docs]</a><span class="k">class</span> <span class="nc">ReadBufferTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="ReadBufferTest.test_array"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadBufferTest.test_array">[docs]</a>    <span class="k">def</span> <span class="nf">test_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">readbuffer_encode</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;spam&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadBufferTest.test_empty"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadBufferTest.test_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">readbuffer_encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ReadBufferTest.test_bad_args"><a class="viewcode-back" href="../../test.html#test.test_codecs.ReadBufferTest.test_bad_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">readbuffer_encode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">readbuffer_encode</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="UTF8SigTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8SigTest">[docs]</a><span class="k">class</span> <span class="nc">UTF8SigTest</span><span class="p">(</span><span class="n">UTF8Test</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8-sig&quot;</span>

<div class="viewcode-block" id="UTF8SigTest.test_partial"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8SigTest.test_partial">[docs]</a>    <span class="k">def</span> <span class="nf">test_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_partial</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c"># First BOM has been read and skipped</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># Second BOM has been read and emitted</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># &quot;\x00&quot; read and emitted</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># First byte of encoded &quot;\xff&quot; read</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># Second byte of encoded &quot;\xff&quot; read</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># First byte of encoded &quot;\u07ff&quot; read</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff</span><span class="s">&quot;</span><span class="p">,</span> <span class="c"># Second byte of encoded &quot;\u07ff&quot; read</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800\uffff</span><span class="s">&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\ufeff\x00\xff\u07ff\u0800\uffff\U00010000</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF8SigTest.test_bug1601501"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8SigTest.test_bug1601501">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug1601501</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># SF bug #1601501: check that the codec works with a buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xef\xbb\xbf</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;utf-8-sig&quot;</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF8SigTest.test_bom"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8SigTest.test_bom">[docs]</a>    <span class="k">def</span> <span class="nf">test_bom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="s">&quot;utf-8-sig&quot;</span><span class="p">)()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;spam&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8-sig&quot;</span><span class="p">)),</span> <span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF8SigTest.test_stream_bom"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8SigTest.test_stream_bom">[docs]</a>    <span class="k">def</span> <span class="nf">test_stream_bom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unistring</span> <span class="o">=</span> <span class="s">&quot;ABC</span><span class="se">\u00A1\u2200</span><span class="s">XYZ&quot;</span>
        <span class="n">bytestring</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF8</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;ABC</span><span class="se">\xC2\xA1\xE2\x88\x80</span><span class="s">XYZ&quot;</span>

        <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="s">&quot;utf-8-sig&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sizehint</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]:</span>
            <span class="n">istream</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestring</span><span class="p">))</span>
            <span class="n">ostream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sizehint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">istream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sizehint</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">istream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">ostream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">got</span> <span class="o">=</span> <span class="n">ostream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">unistring</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UTF8SigTest.test_stream_bare"><a class="viewcode-back" href="../../test.html#test.test_codecs.UTF8SigTest.test_stream_bare">[docs]</a>    <span class="k">def</span> <span class="nf">test_stream_bare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">unistring</span> <span class="o">=</span> <span class="s">&quot;ABC</span><span class="se">\u00A1\u2200</span><span class="s">XYZ&quot;</span>
        <span class="n">bytestring</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;ABC</span><span class="se">\xC2\xA1\xE2\x88\x80</span><span class="s">XYZ&quot;</span>

        <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="s">&quot;utf-8-sig&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sizehint</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]:</span>
            <span class="n">istream</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">bytestring</span><span class="p">))</span>
            <span class="n">ostream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sizehint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">istream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sizehint</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">istream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">ostream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">got</span> <span class="o">=</span> <span class="n">ostream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">got</span><span class="p">,</span> <span class="n">unistring</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="EscapeDecodeTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.EscapeDecodeTest">[docs]</a><span class="k">class</span> <span class="nc">EscapeDecodeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="EscapeDecodeTest.test_empty"><a class="viewcode-back" href="../../test.html#test.test_codecs.EscapeDecodeTest.test_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">escape_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EscapeDecodeTest.test_raw"><a class="viewcode-back" href="../../test.html#test.test_codecs.EscapeDecodeTest.test_raw">[docs]</a>    <span class="k">def</span> <span class="nf">test_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">escape_decode</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EscapeDecodeTest.test_escape"><a class="viewcode-back" href="../../test.html#test.test_codecs.EscapeDecodeTest.test_escape">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">escape_decode</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">coding_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decode</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;[</span><span class="se">\\\n</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&#39;[</span><span class="se">\&quot;</span><span class="s">]&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[&quot;]&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\&#39;</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[&#39;]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\\</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;[\]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\a</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x07</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\b</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x08</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\t</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x09</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\n</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x0a</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\v</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x0b</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\f</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x0c</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\r</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x0d</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\7</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x07</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\8]&quot;</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;[\8]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\7</span><span class="s">8]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\x07</span><span class="s">8]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\41</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[!]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\41</span><span class="s">8]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[!8]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\101</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[A]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\101</span><span class="s">0]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[A0]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\501</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[A]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\x41</span><span class="s">]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[A]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\X41]&quot;</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;[\X41]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\x41</span><span class="s">0]&quot;</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;[A0]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="se">\&#39;\\</span><span class="s">abtnvfr01234567x&#39;</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">])</span>
                <span class="n">check</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EscapeDecodeTest.test_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.EscapeDecodeTest.test_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">escape_decode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;\x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;[\x]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\x]\x&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;[]&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\x]\x&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;[?]?&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;\x0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;[\x0]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\x0]\x0&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;[]&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\x0]\x0&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;[?]?&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="RecodingTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.RecodingTest">[docs]</a><span class="k">class</span> <span class="nc">RecodingTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="RecodingTest.test_recoding"><a class="viewcode-back" href="../../test.html#test.test_codecs.RecodingTest.test_recoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_recoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">EncodedFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;unicode_internal&quot;</span><span class="p">,</span> <span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">f2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c"># Python used to crash on this at exit because of a refcount</span>
        <span class="c"># bug in _codecsmodule.c</span>

<span class="c"># From RFC 3492</span></div></div>
<span class="n">punycode_testcases</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># A Arabic (Egyptian):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u0644\u064A\u0647\u0645\u0627\u0628\u062A\u0643\u0644</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0645\u0648\u0634\u0639\u0631\u0628\u064A\u061F</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;egbpdaj6bu4bxfgehfvwxn&quot;</span><span class="p">),</span>
    <span class="c"># B Chinese (simplified):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u4ED6\u4EEC\u4E3A\u4EC0\u4E48\u4E0D\u8BF4\u4E2D\u6587</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;ihqwcrb4cv8a8dqg056pqjye&quot;</span><span class="p">),</span>
    <span class="c"># C Chinese (traditional):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u4ED6\u5011\u7232\u4EC0\u9EBD\u4E0D\u8AAA\u4E2D\u6587</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;ihqwctvzc91f659drss3x8bo0yb&quot;</span><span class="p">),</span>
    <span class="c"># D Czech: Pro&lt;ccaron&gt;prost&lt;ecaron&gt;nemluv&lt;iacute&gt;&lt;ccaron&gt;esky</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u0050\u0072\u006F\u010D\u0070\u0072\u006F\u0073\u0074</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u011B\u006E\u0065\u006D\u006C\u0075\u0076\u00ED\u010D</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0065\u0073\u006B\u0079</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;Proprostnemluvesky-uyb24dma41a&quot;</span><span class="p">),</span>
    <span class="c"># E Hebrew:</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u05DC\u05DE\u05D4\u05D4\u05DD\u05E4\u05E9\u05D5\u05D8</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u05DC\u05D0\u05DE\u05D3\u05D1\u05E8\u05D9\u05DD\u05E2</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u05D1\u05E8\u05D9\u05EA</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;4dbcagdahymbxekheh6e0a7fei0b&quot;</span><span class="p">),</span>
    <span class="c"># F Hindi (Devanagari):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u092F\u0939\u0932\u094B\u0917\u0939\u093F\u0928\u094D</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0926\u0940\u0915\u094D\u092F\u094B\u0902\u0928\u0939</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0940\u0902\u092C\u094B\u0932\u0938\u0915\u0924\u0947</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0939\u0948\u0902</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;i1baa7eci9glrd9b2ae1bj0hfcgg6iyaf8o0a1dig0cd&quot;</span><span class="p">),</span>

    <span class="c">#(G) Japanese (kanji and hiragana):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u306A\u305C\u307F\u3093\u306A\u65E5\u672C\u8A9E\u3092</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u8A71\u3057\u3066\u304F\u308C\u306A\u3044\u306E\u304B</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;n8jok5ay5dzabd5bym9f0cm5685rrjetr6pdxa&quot;</span><span class="p">),</span>

    <span class="c"># (H) Korean (Hangul syllables):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\uC138\uACC4\uC758\uBAA8\uB4E0\uC0AC\uB78C\uB4E4\uC774</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\uD55C\uAD6D\uC5B4\uB97C\uC774\uD574\uD55C\uB2E4\uBA74</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\uC5BC\uB9C8\uB098\uC88B\uC744\uAE4C</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;989aomsvi5e83db1d2a355cv1e0vak1dwrv93d5xbh15a0dt30a5j&quot;</span>
     <span class="n">b</span><span class="s">&quot;psd879ccm6fea98c&quot;</span><span class="p">),</span>

    <span class="c"># (I) Russian (Cyrillic):</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u043F\u043E\u0447\u0435\u043C\u0443\u0436\u0435\u043E</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u043D\u0438\u043D\u0435\u0433\u043E\u0432\u043E\u0440</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u044F\u0442\u043F\u043E\u0440\u0443\u0441\u0441\u043A</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0438</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;b1abfaaepdrnnbgefbaDotcwatmq2g4l&quot;</span><span class="p">),</span>

    <span class="c"># (J) Spanish: Porqu&lt;eacute&gt;nopuedensimplementehablarenEspa&lt;ntilde&gt;ol</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u0050\u006F\u0072\u0071\u0075\u00E9\u006E\u006F\u0070</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0075\u0065\u0064\u0065\u006E\u0073\u0069\u006D\u0070</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u006C\u0065\u006D\u0065\u006E\u0074\u0065\u0068\u0061</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0062\u006C\u0061\u0072\u0065\u006E\u0045\u0073\u0070</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0061\u00F1\u006F\u006C</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;PorqunopuedensimplementehablarenEspaol-fmd56a&quot;</span><span class="p">),</span>

    <span class="c"># (K) Vietnamese:</span>
    <span class="c">#  T&lt;adotbelow&gt;isaoh&lt;odotbelow&gt;kh&lt;ocirc&gt;ngth&lt;ecirchookabove&gt;ch\</span>
    <span class="c">#   &lt;ihookabove&gt;n&lt;oacute&gt;iti&lt;ecircacute&gt;ngVi&lt;ecircdotbelow&gt;t</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u0054\u1EA1\u0069\u0073\u0061\u006F\u0068\u1ECD\u006B</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0068\u00F4\u006E\u0067\u0074\u0068\u1EC3\u0063\u0068</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u1EC9\u006E\u00F3\u0069\u0074\u0069\u1EBF\u006E\u0067</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0056\u0069\u1EC7\u0074</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;TisaohkhngthchnitingVit-kjcr8268qyxafd2f1b9g&quot;</span><span class="p">),</span>

    <span class="c">#(L) 3&lt;nen&gt;B&lt;gumi&gt;&lt;kinpachi&gt;&lt;sensei&gt;</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u0033\u5E74\u0042\u7D44\u91D1\u516B\u5148\u751F</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;3B-ww4c5e180e575a65lsy2b&quot;</span><span class="p">),</span>

    <span class="c"># (M) &lt;amuro&gt;&lt;namie&gt;-with-SUPER-MONKEYS</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u5B89\u5BA4\u5948\u7F8E\u6075\u002D\u0077\u0069\u0074</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0068\u002D\u0053\u0055\u0050\u0045\u0052\u002D\u004D</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u004F\u004E\u004B\u0045\u0059\u0053</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;-with-SUPER-MONKEYS-pc58ag80a8qai00g7n9n&quot;</span><span class="p">),</span>

    <span class="c"># (N) Hello-Another-Way-&lt;sorezore&gt;&lt;no&gt;&lt;basho&gt;</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u0048\u0065\u006C\u006C\u006F\u002D\u0041\u006E\u006F</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u0074\u0068\u0065\u0072\u002D\u0057\u0061\u0079\u002D</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u305D\u308C\u305E\u308C\u306E\u5834\u6240</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;Hello-Another-Way--fc4qua05auwb3674vfr0b&quot;</span><span class="p">),</span>

    <span class="c"># (O) &lt;hitotsu&gt;&lt;yane&gt;&lt;no&gt;&lt;shita&gt;2</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u3072\u3068\u3064\u5C4B\u6839\u306E\u4E0B\u0032</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;2-u9tlzr9756bt3uc0v&quot;</span><span class="p">),</span>

    <span class="c"># (P) Maji&lt;de&gt;Koi&lt;suru&gt;5&lt;byou&gt;&lt;mae&gt;</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u004D\u0061\u006A\u0069\u3067\u004B\u006F\u0069\u3059</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u308B\u0035\u79D2\u524D</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;MajiKoi5-783gue6qz075azm5e&quot;</span><span class="p">),</span>

     <span class="c"># (Q) &lt;pafii&gt;de&lt;runba&gt;</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u30D1\u30D5\u30A3\u30FC\u0064\u0065\u30EB\u30F3\u30D0</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;de-jg4avhby1noc0d&quot;</span><span class="p">),</span>

    <span class="c"># (R) &lt;sono&gt;&lt;supiido&gt;&lt;de&gt;</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u305D\u306E\u30B9\u30D4\u30FC\u30C9\u3067</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;d9juau41awczczp&quot;</span><span class="p">),</span>

    <span class="c"># (S) -&gt; $1.00 &lt;-</span>
    <span class="p">(</span><span class="s">&quot;</span><span class="se">\u002D\u003E\u0020\u0024\u0031\u002E\u0030\u0030\u0020</span><span class="s">&quot;</span>
     <span class="s">&quot;</span><span class="se">\u003C\u002D</span><span class="s">&quot;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&quot;-&gt; $1.00 &lt;--&quot;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">punycode_testcases</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<div class="viewcode-block" id="PunycodeTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.PunycodeTest">[docs]</a><span class="k">class</span> <span class="nc">PunycodeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="PunycodeTest.test_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.PunycodeTest.test_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">uni</span><span class="p">,</span> <span class="n">puny</span> <span class="ow">in</span> <span class="n">punycode_testcases</span><span class="p">:</span>
            <span class="c"># Need to convert both strings to lower case, since</span>
            <span class="c"># some of the extended encodings use upper case, but our</span>
            <span class="c"># code produces only lower case. Converting just puny to</span>
            <span class="c"># lower is also insufficient, since some of the input characters</span>
            <span class="c"># are upper case.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">uni</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;punycode&quot;</span><span class="p">),</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">puny</span><span class="p">,</span> <span class="s">&quot;ascii&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="PunycodeTest.test_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.PunycodeTest.test_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">uni</span><span class="p">,</span> <span class="n">puny</span> <span class="ow">in</span> <span class="n">punycode_testcases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">uni</span><span class="p">,</span> <span class="n">puny</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;punycode&quot;</span><span class="p">))</span>
            <span class="n">puny</span> <span class="o">=</span> <span class="n">puny</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">uni</span><span class="p">,</span> <span class="n">puny</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;punycode&quot;</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="UnicodeInternalTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeInternalTest">[docs]</a><span class="k">class</span> <span class="nc">UnicodeInternalTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;specific to 32-bit wchar_t&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="UnicodeInternalTest.test_bug1251300"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeInternalTest.test_bug1251300">[docs]</a>    <span class="k">def</span> <span class="nf">test_bug1251300</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Decoding with unicode_internal used to not correctly handle &quot;code</span>
        <span class="c"># points&quot; above 0x10ffff on UCS-4 builds.</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x10\xff\xff</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U0010ffff</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x01\x01</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U00000101</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">not_ok</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\x7f\xff\xff\xff</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80\x00\x00\x00</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\x81\x00\x00\x00</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">internal</span><span class="p">,</span> <span class="n">uni</span> <span class="ow">in</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s">&quot;little&quot;</span><span class="p">:</span>
                <span class="n">internal</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">internal</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">uni</span><span class="p">,</span> <span class="n">internal</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">internal</span> <span class="ow">in</span> <span class="n">not_ok</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s">&quot;little&quot;</span><span class="p">:</span>
                <span class="n">internal</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">internal</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;unicode_internal codec has been &#39;</span>
                                         <span class="s">&#39;deprecated&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">internal</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span>
                                  <span class="s">&quot;unicode_internal&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s">&quot;little&quot;</span><span class="p">:</span>
            <span class="n">invalid</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x11\x00</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">invalid</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x11\x00\x00</span><span class="s">&quot;</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                              <span class="n">invalid</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="s">&quot;unicode_internal&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">invalid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                             <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;specific to 32-bit wchar_t&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="UnicodeInternalTest.test_decode_error_attributes"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeInternalTest.test_decode_error_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_error_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;unicode_internal codec has been &#39;</span>
                                         <span class="s">&#39;deprecated&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
                <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x11\x11\x00</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x11\x11\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">()</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">SIZEOF_WCHAR_T</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;specific to 32-bit wchar_t&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="UnicodeInternalTest.test_decode_callback"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeInternalTest.test_decode_callback">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s">&quot;UnicodeInternalTest&quot;</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">)</span>
        <span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;unicode_internal codec has been &#39;</span>
                                     <span class="s">&#39;deprecated&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="s">&quot;ab&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">ignored</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\x22\x22\x22\x22</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ab</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">ab</span><span class="p">[</span><span class="mi">4</span><span class="p">:]),</span>
                                    <span class="s">&quot;ascii&quot;</span><span class="p">),</span>
                              <span class="s">&quot;UnicodeInternalTest&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">ignored</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UnicodeInternalTest.test_encode_length"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeInternalTest.test_encode_length">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">((</span><span class="s">&#39;unicode_internal codec has been &#39;</span>
                                     <span class="s">&#39;deprecated&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)):</span>
            <span class="c"># Issue 3739</span>
            <span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">(</span><span class="s">&quot;unicode_internal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xe9\u0142</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">escape_encode</span><span class="p">(</span><span class="n">br</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>

<span class="c"># From http://www.gnu.org/software/libidn/draft-josefsson-idn-test-vectors.html</span></div></div>
<span class="n">nameprep_tests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># 3.1 Map to nothing.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xc2\xad\xcd\x8f\xe1\xa0\x86\xe1\xa0\x8b</span><span class="s">bar&#39;</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe2\x80\x8b\xe2\x81\xa0</span><span class="s">baz</span><span class="se">\xef\xb8\x80\xef\xb8\x88\xef</span><span class="s">&#39;</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xb8\x8f\xef\xbb\xbf</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;foobarbaz&#39;</span><span class="p">),</span>
    <span class="c"># 3.2 Case folding ASCII U+0043 U+0041 U+0046 U+0045.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;CAFE&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;cafe&#39;</span><span class="p">),</span>
    <span class="c"># 3.3 Case folding 8bit U+00DF (german sharp s).</span>
    <span class="c"># The original test case is bogus; it says \xc3\xdf</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc3\x9f</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;ss&#39;</span><span class="p">),</span>
    <span class="c"># 3.4 Case folding U+0130 (turkish capital I with dot).</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc4\xb0</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;i</span><span class="se">\xcc\x87</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.5 Case folding multibyte U+0143 U+037A.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc5\x83\xcd\xba</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc5\x84</span><span class="s"> </span><span class="se">\xce\xb9</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.6 Case folding U+2121 U+33C6 U+1D7BB.</span>
    <span class="c"># XXX: skip this as it fails in UCS-2 mode</span>
    <span class="c">#(&#39;\xe2\x84\xa1\xe3\x8f\x86\xf0\x9d\x9e\xbb&#39;,</span>
    <span class="c"># &#39;telc\xe2\x88\x95kg\xcf\x83&#39;),</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.7 Normalization of U+006a U+030c U+00A0 U+00AA.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;j</span><span class="se">\xcc\x8c\xc2\xa0\xc2\xaa</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc7\xb0</span><span class="s"> a&#39;</span><span class="p">),</span>
    <span class="c"># 3.8 Case folding U+1FB7 and normalization.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xbe\xb7</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xbe\xb6\xce\xb9</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.9 Self-reverting case folding U+01F0 and normalization.</span>
    <span class="c"># The original test case is bogus, it says `\xc7\xf0&#39;</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc7\xb0</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xc7\xb0</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.10 Self-reverting case folding U+0390 and normalization.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xce\x90</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xce\x90</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.11 Self-reverting case folding U+03B0 and normalization.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xce\xb0</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xce\xb0</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.12 Self-reverting case folding U+1E96 and normalization.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xba\x96</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xba\x96</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.13 Self-reverting case folding U+1F56 and normalization.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xbd\x96</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xbd\x96</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.14 ASCII space character U+0020.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39; &#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39; &#39;</span><span class="p">),</span>
    <span class="c"># 3.15 Non-ASCII 8bit space character U+00A0.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc2\xa0</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39; &#39;</span><span class="p">),</span>
    <span class="c"># 3.16 Non-ASCII multibyte space character U+1680.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\x9a\x80</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.17 Non-ASCII multibyte space character U+2000.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe2\x80\x80</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39; &#39;</span><span class="p">),</span>
    <span class="c"># 3.18 Zero Width Space U+200b.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe2\x80\x8b</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="c"># 3.19 Non-ASCII multibyte space character U+3000.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe3\x80\x80</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39; &#39;</span><span class="p">),</span>
    <span class="c"># 3.20 ASCII control characters U+0010 U+007F.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x10\x7f</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\x10\x7f</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.21 Non-ASCII 8bit control character U+0085.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc2\x85</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.22 Non-ASCII multibyte control character U+180E.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe1\xa0\x8e</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.23 Zero Width No-Break Space U+FEFF.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xef\xbb\xbf</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">),</span>
    <span class="c"># 3.24 Non-ASCII control character U+1D175.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf0\x9d\x85\xb5</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.25 Plane 0 private use character U+F123.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xef\x84\xa3</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.26 Plane 15 private use character U+F1234.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf3\xb1\x88\xb4</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.27 Plane 16 private use character U+10F234.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf4\x8f\x88\xb4</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.28 Non-character code point U+8FFFE.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf2\x8f\xbf\xbe</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.29 Non-character code point U+10FFFF.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf4\x8f\xbf\xbf</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.30 Surrogate code U+DF42.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xed\xbd\x82</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.31 Non-plain text character U+FFFD.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xef\xbf\xbd</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.32 Ideographic description character U+2FF5.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe2\xbf\xb5</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.33 Display property character U+0341.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xcd\x81</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xcc\x81</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.34 Left-to-right mark U+200E.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe2\x80\x8e</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.35 Deprecated U+202A.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe2\x80\xaa</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.36 Language tagging character U+E0001.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf3\xa0\x80\x81</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.37 Language tagging character U+E0042.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xf3\xa0\x81\x82</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.38 Bidi: RandALCat character U+05BE and LCat characters.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xd6\xbe</span><span class="s">bar&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.39 Bidi: RandALCat character U+FD50 and LCat characters.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xef\xb5\x90</span><span class="s">bar&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.40 Bidi: RandALCat character U+FB38 and LCat characters.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;foo</span><span class="se">\xef\xb9\xb6</span><span class="s">bar&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;foo </span><span class="se">\xd9\x8e</span><span class="s">bar&#39;</span><span class="p">),</span>
    <span class="c"># 3.41 Bidi: RandALCat without trailing RandALCat U+0627 U+0031.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\xa7</span><span class="s">1&#39;</span><span class="p">,</span>
     <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.42 Bidi: RandALCat character U+0627 U+0031 U+0628.</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\xa7</span><span class="s">1</span><span class="se">\xd8\xa8</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xd8\xa7</span><span class="s">1</span><span class="se">\xd8\xa8</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="c"># 3.43 Unassigned code point U+E0002.</span>
    <span class="c"># Skip this test as we allow unassigned</span>
    <span class="c">#(b&#39;\xf3\xa0\x80\x82&#39;,</span>
    <span class="c"># None),</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="c"># 3.44 Larger test (shrinking).</span>
    <span class="c"># Original test case reads \xc3\xdf</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;X</span><span class="se">\xc2\xad\xc3\x9f\xc4\xb0\xe2\x84\xa1</span><span class="s">j</span><span class="se">\xcc\x8c\xc2\xa0\xc2</span><span class="s">&#39;</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xaa\xce\xb0\xe2\x80\x80</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;xssi</span><span class="se">\xcc\x87</span><span class="s">tel</span><span class="se">\xc7\xb0</span><span class="s"> a</span><span class="se">\xce\xb0</span><span class="s"> &#39;</span><span class="p">),</span>
    <span class="c"># 3.45 Larger test (expanding).</span>
    <span class="c"># Original test case reads \xc3\x9f</span>
    <span class="p">(</span><span class="n">b</span><span class="s">&#39;X</span><span class="se">\xc3\x9f\xe3\x8c\x96\xc4\xb0\xe2\x84\xa1\xe2\x92\x9f\xe3\x8c</span><span class="s">&#39;</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\x80</span><span class="s">&#39;</span><span class="p">,</span>
     <span class="n">b</span><span class="s">&#39;xss</span><span class="se">\xe3\x82\xad\xe3\x83\xad\xe3\x83\xa1\xe3\x83\xbc\xe3</span><span class="s">&#39;</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\x83\x88\xe3\x83\xab</span><span class="s">i</span><span class="se">\xcc\x87</span><span class="s">tel</span><span class="se">\x28</span><span class="s">d</span><span class="se">\x29\xe3\x82</span><span class="s">&#39;</span>
     <span class="n">b</span><span class="s">&#39;</span><span class="se">\xa2\xe3\x83\x91\xe3\x83\xbc\xe3\x83\x88</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="p">]</span>


<div class="viewcode-block" id="NameprepTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.NameprepTest">[docs]</a><span class="k">class</span> <span class="nc">NameprepTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="NameprepTest.test_nameprep"><a class="viewcode-back" href="../../test.html#test.test_codecs.NameprepTest.test_nameprep">[docs]</a>    <span class="k">def</span> <span class="nf">test_nameprep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">encodings.idna</span> <span class="kn">import</span> <span class="n">nameprep</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">prepped</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nameprep_tests</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">orig</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Skipped</span>
                <span class="k">continue</span>
            <span class="c"># The Unicode strings are given in UTF-8</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prepped</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Input contains prohibited characters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="n">nameprep</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prepped</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">prepped</span><span class="p">,</span> <span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogatepass&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nameprep</span><span class="p">(</span><span class="n">orig</span><span class="p">),</span> <span class="n">prepped</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">support</span><span class="o">.</span><span class="n">TestFailed</span><span class="p">(</span><span class="s">&quot;Test 3.</span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</div></div>
<div class="viewcode-block" id="IDNACodecTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.IDNACodecTest">[docs]</a><span class="k">class</span> <span class="nc">IDNACodecTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="IDNACodecTest.test_builtin_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.IDNACodecTest.test_builtin_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_builtin_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;python.org&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="s">&quot;python.org&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;python.org.&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="s">&quot;python.org.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;xn--pythn-mua.org&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;xn--pythn-mua.org.&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IDNACodecTest.test_builtin_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.IDNACodecTest.test_builtin_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_builtin_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;python.org&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;python.org&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;python.org.&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;python.org.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;xn--pythn-mua.org&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org.&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;xn--pythn-mua.org.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IDNACodecTest.test_stream"><a class="viewcode-back" href="../../test.html#test.test_codecs.IDNACodecTest.test_stream">[docs]</a>    <span class="k">def</span> <span class="nf">test_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">)(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;abc&quot;</span><span class="p">))</span>
        <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IDNACodecTest.test_incremental_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.IDNACodecTest.test_incremental_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_incremental_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">((</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&quot;python.org&quot;</span><span class="p">),</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="s">&quot;python.org&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">((</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&quot;python.org.&quot;</span><span class="p">),</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="s">&quot;python.org.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">((</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&quot;xn--pythn-mua.org.&quot;</span><span class="p">),</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">((</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&quot;xn--pythn-mua.org.&quot;</span><span class="p">),</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org.&quot;</span>
        <span class="p">)</span>

        <span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">)()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;xn--xam&quot;</span><span class="p">,</span> <span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;ple-9ta.o&quot;</span><span class="p">,</span> <span class="p">),</span> <span class="s">&quot;</span><span class="se">\xe4</span><span class="s">xample.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;rg&quot;</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="s">&quot;org&quot;</span><span class="p">)</span>

        <span class="n">decoder</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;xn--xam&quot;</span><span class="p">,</span> <span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;ple-9ta.o&quot;</span><span class="p">,</span> <span class="p">),</span> <span class="s">&quot;</span><span class="se">\xe4</span><span class="s">xample.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;rg.&quot;</span><span class="p">),</span> <span class="s">&quot;org.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IDNACodecTest.test_incremental_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.IDNACodecTest.test_incremental_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_incremental_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="s">&quot;python.org&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="n">b</span><span class="s">&quot;python.org&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="s">&quot;python.org.&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="n">b</span><span class="s">&quot;python.org.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org.&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="n">b</span><span class="s">&quot;xn--pythn-mua.org.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="s">&quot;pyth</span><span class="se">\xf6</span><span class="s">n.org.&quot;</span><span class="p">,</span> <span class="s">&quot;idna&quot;</span><span class="p">)),</span>
            <span class="n">b</span><span class="s">&quot;xn--pythn-mua.org.&quot;</span>
        <span class="p">)</span>

        <span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">)()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xe4</span><span class="s">x&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ample.org&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;xn--xample-9ta.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;org&quot;</span><span class="p">)</span>

        <span class="n">encoder</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\xe4</span><span class="s">x&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ample.org.&quot;</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;xn--xample-9ta.org.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="CodecsModuleTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest">[docs]</a><span class="k">class</span> <span class="nc">CodecsModuleTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="CodecsModuleTest.test_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;latin-1&#39;</span><span class="p">),</span>
                         <span class="s">&#39;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">),</span> <span class="s">&#39;abc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;latin-1&#39;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe4\xf6\xfc</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;__spam__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xff</span><span class="s">ff&#39;</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_register"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_register">[docs]</a>    <span class="k">def</span> <span class="nf">test_register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">register</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_lookup"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">test_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">,</span> <span class="s">&quot;__spam__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_getencoder"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_getencoder">[docs]</a>    <span class="k">def</span> <span class="nf">test_getencoder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">,</span> <span class="s">&quot;__spam__&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_getdecoder"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_getdecoder">[docs]</a>    <span class="k">def</span> <span class="nf">test_getdecoder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">,</span> <span class="s">&quot;__spam__&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_getreader"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_getreader">[docs]</a>    <span class="k">def</span> <span class="nf">test_getreader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">,</span> <span class="s">&quot;__spam__&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_getwriter"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_getwriter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getwriter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">,</span> <span class="s">&quot;__spam__&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodecsModuleTest.test_lookup_issue1813"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodecsModuleTest.test_lookup_issue1813">[docs]</a>    <span class="k">def</span> <span class="nf">test_lookup_issue1813</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue #1813: under Turkish locales, lookup of some codecs failed</span>
        <span class="c"># because &#39;I&#39; is lowercased as &quot;&quot; (dotless i)</span>
        <span class="n">oldlocale</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_CTYPE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">,</span> <span class="n">locale</span><span class="o">.</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">oldlocale</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="s">&#39;tr_TR&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">locale</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="c"># Unsupported locale on this system</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s">&#39;test needs Turkish locale&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&#39;ASCII&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="StreamReaderTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.StreamReaderTest">[docs]</a><span class="k">class</span> <span class="nc">StreamReaderTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="StreamReaderTest.setUp"><a class="viewcode-back" href="../../test.html#test.test_codecs.StreamReaderTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xed\x95\x9c\n\xea\xb8\x80</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StreamReaderTest.test_readlines"><a class="viewcode-back" href="../../test.html#test.test_codecs.StreamReaderTest.test_readlines">[docs]</a>    <span class="k">def</span> <span class="nf">test_readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\ud55c\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\uae00</span><span class="s">&#39;</span><span class="p">])</span>
</div></div>
<div class="viewcode-block" id="EncodedFileTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.EncodedFileTest">[docs]</a><span class="k">class</span> <span class="nc">EncodedFileTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="EncodedFileTest.test_basic"><a class="viewcode-back" href="../../test.html#test.test_codecs.EncodedFileTest.test_basic">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xed\x95\x9c\n\xea\xb8\x80</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">ef</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">EncodedFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;utf-16-le&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ef</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\\xd5\n\x00\x00\xae</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">ef</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">EncodedFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s">&#39;latin-1&#39;</span><span class="p">)</span>
        <span class="n">ef</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xc3\xbc</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xfc</span><span class="s">&#39;</span><span class="p">)</span>
</div></div>
<span class="n">all_unicode_encodings</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;ascii&quot;</span><span class="p">,</span>
    <span class="s">&quot;big5&quot;</span><span class="p">,</span>
    <span class="s">&quot;big5hkscs&quot;</span><span class="p">,</span>
    <span class="s">&quot;charmap&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp037&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1006&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1026&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1125&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1140&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1250&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1251&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1252&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1253&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1254&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1255&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1256&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1257&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp1258&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp424&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp437&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp500&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp720&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp737&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp775&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp850&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp852&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp855&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp856&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp857&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp858&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp860&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp861&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp862&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp863&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp864&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp865&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp866&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp869&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp874&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp875&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp932&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp949&quot;</span><span class="p">,</span>
    <span class="s">&quot;cp950&quot;</span><span class="p">,</span>
    <span class="s">&quot;euc_jis_2004&quot;</span><span class="p">,</span>
    <span class="s">&quot;euc_jisx0213&quot;</span><span class="p">,</span>
    <span class="s">&quot;euc_jp&quot;</span><span class="p">,</span>
    <span class="s">&quot;euc_kr&quot;</span><span class="p">,</span>
    <span class="s">&quot;gb18030&quot;</span><span class="p">,</span>
    <span class="s">&quot;gb2312&quot;</span><span class="p">,</span>
    <span class="s">&quot;gbk&quot;</span><span class="p">,</span>
    <span class="s">&quot;hp_roman8&quot;</span><span class="p">,</span>
    <span class="s">&quot;hz&quot;</span><span class="p">,</span>
    <span class="s">&quot;idna&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_jp&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_jp_1&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_jp_2&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_jp_2004&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_jp_3&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_jp_ext&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso2022_kr&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_1&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_10&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_11&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_13&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_14&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_15&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_16&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_2&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_3&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_4&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_5&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_6&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_7&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_8&quot;</span><span class="p">,</span>
    <span class="s">&quot;iso8859_9&quot;</span><span class="p">,</span>
    <span class="s">&quot;johab&quot;</span><span class="p">,</span>
    <span class="s">&quot;koi8_r&quot;</span><span class="p">,</span>
    <span class="s">&quot;koi8_u&quot;</span><span class="p">,</span>
    <span class="s">&quot;latin_1&quot;</span><span class="p">,</span>
    <span class="s">&quot;mac_cyrillic&quot;</span><span class="p">,</span>
    <span class="s">&quot;mac_greek&quot;</span><span class="p">,</span>
    <span class="s">&quot;mac_iceland&quot;</span><span class="p">,</span>
    <span class="s">&quot;mac_latin2&quot;</span><span class="p">,</span>
    <span class="s">&quot;mac_roman&quot;</span><span class="p">,</span>
    <span class="s">&quot;mac_turkish&quot;</span><span class="p">,</span>
    <span class="s">&quot;palmos&quot;</span><span class="p">,</span>
    <span class="s">&quot;ptcp154&quot;</span><span class="p">,</span>
    <span class="s">&quot;punycode&quot;</span><span class="p">,</span>
    <span class="s">&quot;raw_unicode_escape&quot;</span><span class="p">,</span>
    <span class="s">&quot;shift_jis&quot;</span><span class="p">,</span>
    <span class="s">&quot;shift_jis_2004&quot;</span><span class="p">,</span>
    <span class="s">&quot;shift_jisx0213&quot;</span><span class="p">,</span>
    <span class="s">&quot;tis_620&quot;</span><span class="p">,</span>
    <span class="s">&quot;unicode_escape&quot;</span><span class="p">,</span>
    <span class="s">&quot;unicode_internal&quot;</span><span class="p">,</span>
    <span class="s">&quot;utf_16&quot;</span><span class="p">,</span>
    <span class="s">&quot;utf_16_be&quot;</span><span class="p">,</span>
    <span class="s">&quot;utf_16_le&quot;</span><span class="p">,</span>
    <span class="s">&quot;utf_7&quot;</span><span class="p">,</span>
    <span class="s">&quot;utf_8&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">codecs</span><span class="p">,</span> <span class="s">&quot;mbcs_encode&quot;</span><span class="p">):</span>
    <span class="n">all_unicode_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;mbcs&quot;</span><span class="p">)</span>

<span class="c"># The following encoding is not tested, because it&#39;s not supposed</span>
<span class="c"># to work:</span>
<span class="c">#    &quot;undefined&quot;</span>

<span class="c"># The following encodings don&#39;t work in stateful mode</span>
<span class="n">broken_unicode_with_streams</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;punycode&quot;</span><span class="p">,</span>
    <span class="s">&quot;unicode_internal&quot;</span>
<span class="p">]</span>
<span class="n">broken_incremental_coders</span> <span class="o">=</span> <span class="n">broken_unicode_with_streams</span> <span class="o">+</span> <span class="p">[</span>
    <span class="s">&quot;idna&quot;</span><span class="p">,</span>
<span class="p">]</span>

<div class="viewcode-block" id="BasicUnicodeTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest">[docs]</a><span class="k">class</span> <span class="nc">BasicUnicodeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">MixInCheckStateHandling</span><span class="p">):</span>
<div class="viewcode-block" id="BasicUnicodeTest.test_basics"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_basics">[docs]</a>    <span class="k">def</span> <span class="nf">test_basics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;abc123&quot;</span>  <span class="c"># all codecs should be able to encode these</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">all_unicode_encodings</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">encoding</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;_codec&quot;</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s">&quot;_codec&quot;</span>
            <span class="k">elif</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s">&quot;latin_1&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;latin_1&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoding</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">))</span>

            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
                <span class="c"># unicode-internal has been deprecated</span>
                <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">broken_unicode_with_streams</span><span class="p">:</span>
                <span class="c"># check stream reader/writer</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">writer</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>
                <span class="n">encodedresult</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">chunk</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
                    <span class="n">encodedresult</span> <span class="o">+=</span> <span class="n">chunk</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">q</span><span class="p">)</span>
                <span class="n">decodedresult</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encodedresult</span><span class="p">:</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
                    <span class="n">decodedresult</span> <span class="o">+=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decodedresult</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">broken_incremental_coders</span><span class="p">:</span>
                <span class="c"># check incremental decoder/encoder and iterencode()/iterdecode()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)()</span>
                <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>  <span class="c"># no IncrementalEncoder</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># check incremental decoder/encoder</span>
                    <span class="n">encodedresult</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">encodedresult</span> <span class="o">+=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">encodedresult</span> <span class="o">+=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)()</span>
                    <span class="n">decodedresult</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encodedresult</span><span class="p">:</span>
                        <span class="n">decodedresult</span> <span class="o">+=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
                    <span class="n">decodedresult</span> <span class="o">+=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decodedresult</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                                     <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>

                    <span class="c"># check iterencode()/iterdecode()</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">(</span>
                            <span class="n">codecs</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="p">),</span> <span class="n">encoding</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>

                    <span class="c"># check iterencode()/iterdecode() with empty string</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">iterdecode</span><span class="p">(</span>
                            <span class="n">codecs</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="p">),</span> <span class="n">encoding</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">,</span> <span class="s">&quot;mbcs&quot;</span><span class="p">):</span>
                    <span class="c"># check incremental decoder/encoder with errors argument</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>  <span class="c"># no IncrementalEncoder</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">encodedresult</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span>
                        <span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
                        <span class="n">decodedresult</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
                                                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encodedresult</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decodedresult</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                                         <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
</div>
    <span class="nd">@support.cpython_only</span>
<div class="viewcode-block" id="BasicUnicodeTest.test_basics_capi"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_basics_capi">[docs]</a>    <span class="k">def</span> <span class="nf">test_basics_capi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">_testcapi</span> <span class="kn">import</span> <span class="n">codec_incrementalencoder</span><span class="p">,</span> <span class="n">codec_incrementaldecoder</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;abc123&quot;</span>  <span class="c"># all codecs should be able to encode these</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">all_unicode_encodings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">broken_incremental_coders</span><span class="p">:</span>
                <span class="c"># check incremental decoder/encoder (fetched via the C API)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cencoder</span> <span class="o">=</span> <span class="n">codec_incrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>  <span class="c"># no IncrementalEncoder</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># check C API</span>
                    <span class="n">encodedresult</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">encodedresult</span> <span class="o">+=</span> <span class="n">cencoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">encodedresult</span> <span class="o">+=</span> <span class="n">cencoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="n">cdecoder</span> <span class="o">=</span> <span class="n">codec_incrementaldecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                    <span class="n">decodedresult</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encodedresult</span><span class="p">:</span>
                        <span class="n">decodedresult</span> <span class="o">+=</span> <span class="n">cdecoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
                    <span class="n">decodedresult</span> <span class="o">+=</span> <span class="n">cdecoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decodedresult</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                                     <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">,</span> <span class="s">&quot;mbcs&quot;</span><span class="p">):</span>
                    <span class="c"># check incremental decoder/encoder with errors argument</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cencoder</span> <span class="o">=</span> <span class="n">codec_incrementalencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>  <span class="c"># no IncrementalEncoder</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">encodedresult</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cencoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span>
                        <span class="n">cdecoder</span> <span class="o">=</span> <span class="n">codec_incrementaldecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">)</span>
                        <span class="n">decodedresult</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cdecoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]))</span>
                                                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encodedresult</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decodedresult</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                                         <span class="s">&quot;encoding=</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BasicUnicodeTest.test_seek"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_seek">[docs]</a>    <span class="k">def</span> <span class="nf">test_seek</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># all codecs should be able to encode these</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="s">&quot;abc123&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="s">&quot;def456&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">all_unicode_encodings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s">&quot;idna&quot;</span><span class="p">:</span> <span class="c"># FIXME: See SF bug #1163178</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">broken_unicode_with_streams</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="c"># Test that calling seek resets the internal codec state and buffers</span>
                <span class="n">reader</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BasicUnicodeTest.test_bad_decode_args"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_bad_decode_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_decode_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">all_unicode_encodings</span><span class="p">:</span>
            <span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;idna&quot;</span><span class="p">,</span> <span class="s">&quot;punycode&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BasicUnicodeTest.test_bad_encode_args"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_bad_encode_args">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_encode_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">all_unicode_encodings</span><span class="p">:</span>
            <span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">check_warnings</span><span class="p">():</span>
                <span class="c"># unicode-internal has been deprecated</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BasicUnicodeTest.test_encoding_map_type_initialized"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_encoding_map_type_initialized">[docs]</a>    <span class="k">def</span> <span class="nf">test_encoding_map_type_initialized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">encodings</span> <span class="kn">import</span> <span class="n">cp1140</span>
        <span class="c"># This used to crash, we are only verifying there&#39;s no crash.</span>
        <span class="n">table_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">cp1140</span><span class="o">.</span><span class="n">encoding_table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">table_type</span><span class="p">,</span> <span class="n">table_type</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BasicUnicodeTest.test_decoder_state"><a class="viewcode-back" href="../../test.html#test.test_codecs.BasicUnicodeTest.test_decoder_state">[docs]</a>    <span class="k">def</span> <span class="nf">test_decoder_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check that getstate() and setstate() handle the state properly</span>
        <span class="n">u</span> <span class="o">=</span> <span class="s">&quot;abc123&quot;</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">all_unicode_encodings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">broken_incremental_coders</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state_handling_encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="CharmapTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.CharmapTest">[docs]</a><span class="k">class</span> <span class="nc">CharmapTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="CharmapTest.test_decode_with_string_map"><a class="viewcode-back" href="../../test.html#test.test_codecs.CharmapTest.test_decode_with_string_map">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_with_string_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="s">&quot;abc&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U0010FFFF</span><span class="s">bc&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\U0010FFFF</span><span class="s">bc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="s">&quot;ab&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span> <span class="s">&quot;ab</span><span class="se">\ufffe</span><span class="s">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span> <span class="s">&quot;ab&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span> <span class="s">&quot;ab</span><span class="se">\ufffe</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="s">&quot;ab&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="s">&quot;ab</span><span class="se">\ufffe</span><span class="s">&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">allbytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">allbytes</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">allbytes</span><span class="p">))</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CharmapTest.test_decode_with_int2str_map"><a class="viewcode-back" href="../../test.html#test.test_codecs.CharmapTest.test_decode_with_int2str_map">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_with_int2str_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;c&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Aa&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Bb&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Cc&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;AaBbCc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">\U0010FFFF</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;c&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\U0010FFFF</span><span class="s">bc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c"># Issue #14850</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">\ufffe</span><span class="s">&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="bp">None</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c"># Issue #14850</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">\ufffe</span><span class="s">&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="bp">None</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c"># Issue #14850</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">\ufffe</span><span class="s">&#39;</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">allbytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">allbytes</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">allbytes</span><span class="p">))</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="CharmapTest.test_decode_with_int2int_map"><a class="viewcode-back" href="../../test.html#test.test_codecs.CharmapTest.test_decode_with_int2int_map">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_with_int2int_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c"># Issue #15379</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mh">0x10FFFF</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;</span><span class="se">\U0010FFFF</span><span class="s">bc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="p">}),</span>
            <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;bc&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;strict&quot;</span><span class="p">,</span>
                                   <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mh">0xFFFE</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mh">0xFFFE</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x00\x01\x02</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">,</span>
                                  <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mh">0xFFFE</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

</div></div>
<div class="viewcode-block" id="WithStmtTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.WithStmtTest">[docs]</a><span class="k">class</span> <span class="nc">WithStmtTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="WithStmtTest.test_encodedfile"><a class="viewcode-back" href="../../test.html#test.test_codecs.WithStmtTest.test_encodedfile">[docs]</a>    <span class="k">def</span> <span class="nf">test_encodedfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xc3\xbc</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">EncodedFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ef</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ef</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\xfc</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WithStmtTest.test_streamreaderwriter"><a class="viewcode-back" href="../../test.html#test.test_codecs.WithStmtTest.test_streamreaderwriter">[docs]</a>    <span class="k">def</span> <span class="nf">test_streamreaderwriter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xc3\xbc</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">StreamReaderWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">streamreader</span><span class="p">,</span>
                                       <span class="n">info</span><span class="o">.</span><span class="n">streamwriter</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">srw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">srw</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&quot;</span><span class="se">\xfc</span><span class="s">&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="TypesTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.TypesTest">[docs]</a><span class="k">class</span> <span class="nc">TypesTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TypesTest.test_decode_unicode"><a class="viewcode-back" href="../../test.html#test.test_codecs.TypesTest.test_decode_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Most decoders don&#39;t accept unicode input</span>
        <span class="n">decoders</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_7_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_8_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_le_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_be_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_16_ex_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_le_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_be_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">utf_32_ex_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">latin_1_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">ascii_decode</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">codecs</span><span class="p">,</span> <span class="s">&quot;mbcs_decode&quot;</span><span class="p">):</span>
            <span class="n">decoders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">mbcs_decode</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">decoder</span> <span class="ow">in</span> <span class="n">decoders</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="s">&quot;xxx&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TypesTest.test_unicode_escape"><a class="viewcode-back" href="../../test.html#test.test_codecs.TypesTest.test_unicode_escape">[docs]</a>    <span class="k">def</span> <span class="nf">test_unicode_escape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Escape-decoding an unicode string is supported ang gives the same</span>
        <span class="c"># result as decoding the equivalent ASCII bytes string.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span><span class="p">(</span><span class="s">r&quot;\u1234&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u1234</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\u1234</span><span class="s">&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u1234</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span><span class="p">(</span><span class="s">r&quot;\u1234&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u1234</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\u1234</span><span class="s">&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\u1234</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span><span class="p">(</span><span class="s">r&quot;\U00110000&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span><span class="p">(</span><span class="s">r&quot;\U00110000&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="UnicodeEscapeTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest">[docs]</a><span class="k">class</span> <span class="nc">UnicodeEscapeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="UnicodeEscapeTest.test_empty"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest.test_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UnicodeEscapeTest.test_raw_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest.test_raw_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_raw_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">encode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_encode</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">127</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">]),</span> <span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UnicodeEscapeTest.test_raw_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest.test_raw_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_raw_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">])</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UnicodeEscapeTest.test_escape_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest.test_escape_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">encode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_encode</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">coding_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encode</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">&#39;</span><span class="se">\t\n\r</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="n">check</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">x</span><span class="si">%02x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">256</span><span class="p">):</span>
            <span class="n">check</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">x</span><span class="si">%02x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u20ac</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\u20ac</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U0001d120</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\U0001d120</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UnicodeEscapeTest.test_escape_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest.test_escape_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">coding_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decode</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;[</span><span class="se">\\\n</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&#39;[</span><span class="se">\&quot;</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;[&quot;]&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\&#39;</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[&#39;]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\\</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">r&quot;[\]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\a</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x07</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\b</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x08</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\t</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x09</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\n</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x0a</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\v</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x0b</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\f</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x0c</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\r</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x0d</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\7</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x07</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[\8]&quot;</span><span class="p">,</span> <span class="s">r&quot;[\8]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\7</span><span class="s">8]&quot;</span><span class="p">,</span> <span class="s">&quot;[</span><span class="se">\x07</span><span class="s">8]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\41</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[!]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\41</span><span class="s">8]&quot;</span><span class="p">,</span> <span class="s">&quot;[!8]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\101</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[A]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\101</span><span class="s">0]&quot;</span><span class="p">,</span> <span class="s">&quot;[A0]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\x41</span><span class="s">]&quot;</span><span class="p">,</span> <span class="s">&quot;[A]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;[</span><span class="se">\x41</span><span class="s">0]&quot;</span><span class="p">,</span> <span class="s">&quot;[A0]&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\u20ac</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u20ac</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\U0001d120</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U0001d120</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="se">\&#39;\\</span><span class="s">abtnvfr01234567xuUN&#39;</span><span class="p">:</span>
                <span class="n">check</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">]),</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="UnicodeEscapeTest.test_decode_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.UnicodeEscapeTest.test_decode_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">unicode_escape_decode</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span>
                                  <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span>
                                  <span class="n">b</span><span class="s">&quot;[</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;]&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;]</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;[]&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s">&quot;[</span><span class="se">\ufffd</span><span class="s">]</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="RawUnicodeEscapeTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest">[docs]</a><span class="k">class</span> <span class="nc">RawUnicodeEscapeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="RawUnicodeEscapeTest.test_empty"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest.test_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_encode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="RawUnicodeEscapeTest.test_raw_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest.test_raw_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_raw_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">encode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_encode</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">]),</span> <span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="RawUnicodeEscapeTest.test_raw_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest.test_raw_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_raw_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">])</span> <span class="o">+</span> <span class="n">b</span><span class="s">&#39;0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="RawUnicodeEscapeTest.test_escape_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest.test_escape_encode">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">encode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_encode</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">coding_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encode</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&#39;uU&#39;</span><span class="p">:</span>
                <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">]))</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\u20ac</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\u20ac</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\U0001d120</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">br</span><span class="s">&#39;</span><span class="se">\U0001d120</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RawUnicodeEscapeTest.test_escape_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest.test_escape_decode">[docs]</a>    <span class="k">def</span> <span class="nf">test_escape_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">coding_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decode</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="s">&#39;uU&#39;</span><span class="p">:</span>
                <span class="n">check</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">]),</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\u20ac</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\u20ac</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">check</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\U0001d120</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\U0001d120</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RawUnicodeEscapeTest.test_decode_errors"><a class="viewcode-back" href="../../test.html#test.test_codecs.RawUnicodeEscapeTest.test_decode_errors">[docs]</a>    <span class="k">def</span> <span class="nf">test_decode_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">raw_unicode_escape_decode</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span>
                                  <span class="n">b</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span>
                                  <span class="n">b</span><span class="s">&quot;[</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;]&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;[</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;]</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;0&quot;</span><span class="o">*</span><span class="n">i</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;[]&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s">&quot;[</span><span class="se">\ufffd</span><span class="s">]</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ignore&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">br</span><span class="s">&quot;</span><span class="se">\U00110000</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;replace&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\ufffd</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="SurrogateEscapeTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.SurrogateEscapeTest">[docs]</a><span class="k">class</span> <span class="nc">SurrogateEscapeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="SurrogateEscapeTest.test_utf8"><a class="viewcode-back" href="../../test.html#test.test_codecs.SurrogateEscapeTest.test_utf8">[docs]</a>    <span class="k">def</span> <span class="nf">test_utf8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Bad byte</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;foo</span><span class="se">\x80</span><span class="s">bar&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="s">&quot;foo</span><span class="se">\udc80</span><span class="s">bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;foo</span><span class="se">\udc80</span><span class="s">bar&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;foo</span><span class="se">\x80</span><span class="s">bar&quot;</span><span class="p">)</span>
        <span class="c"># bad-utf-8 encoded surrogate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\xed\xb0\x80</span><span class="s">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="s">&quot;</span><span class="se">\udced\udcb0\udc80</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\udced\udcb0\udc80</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xed\xb0\x80</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SurrogateEscapeTest.test_ascii"><a class="viewcode-back" href="../../test.html#test.test_codecs.SurrogateEscapeTest.test_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">test_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bad byte</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;foo</span><span class="se">\x80</span><span class="s">bar&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="s">&quot;foo</span><span class="se">\udc80</span><span class="s">bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;foo</span><span class="se">\udc80</span><span class="s">bar&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;foo</span><span class="se">\x80</span><span class="s">bar&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SurrogateEscapeTest.test_charmap"><a class="viewcode-back" href="../../test.html#test.test_codecs.SurrogateEscapeTest.test_charmap">[docs]</a>    <span class="k">def</span> <span class="nf">test_charmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># bad byte: \xa5 is unmapped in iso-8859-3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;foo</span><span class="se">\xa5</span><span class="s">bar&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;iso-8859-3&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="s">&quot;foo</span><span class="se">\udca5</span><span class="s">bar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;foo</span><span class="se">\udca5</span><span class="s">bar&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;iso-8859-3&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;foo</span><span class="se">\xa5</span><span class="s">bar&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SurrogateEscapeTest.test_latin1"><a class="viewcode-back" href="../../test.html#test.test_codecs.SurrogateEscapeTest.test_latin1">[docs]</a>    <span class="k">def</span> <span class="nf">test_latin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Issue6373</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\udce4\udceb\udcef\udcf6\udcfc</span><span class="s">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;latin-1&quot;</span><span class="p">,</span> <span class="s">&quot;surrogateescape&quot;</span><span class="p">),</span>
                         <span class="n">b</span><span class="s">&quot;</span><span class="se">\xe4\xeb\xef\xf6\xfc</span><span class="s">&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="BomTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.BomTest">[docs]</a><span class="k">class</span> <span class="nc">BomTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="BomTest.test_seek0"><a class="viewcode-back" href="../../test.html#test.test_codecs.BomTest.test_seek0">[docs]</a>    <span class="k">def</span> <span class="nf">test_seek0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;1234567890&quot;</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;utf-16&quot;</span><span class="p">,</span>
                 <span class="s">&quot;utf-16-le&quot;</span><span class="p">,</span>
                 <span class="s">&quot;utf-16-be&quot;</span><span class="p">,</span>
                 <span class="s">&quot;utf-32&quot;</span><span class="p">,</span>
                 <span class="s">&quot;utf-32-le&quot;</span><span class="p">,</span>
                 <span class="s">&quot;utf-32-be&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">unlink</span><span class="p">,</span> <span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="c"># Check if the BOM is written only once</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c"># Check that the BOM is written after a seek(0)</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span><span class="p">)</span>

            <span class="c"># (StreamWriter) Check that the BOM is written after a seek(0)</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span><span class="p">)</span>

            <span class="c"># Check that the BOM is not written after a seek() at a position</span>
            <span class="c"># different than the start</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c"># (StreamWriter) Check that the BOM is not written after a seek()</span>
            <span class="c"># at a position different than the start</span>
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">TESTFN</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

</div></div>
<span class="n">bytes_transform_encodings</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;base64_codec&quot;</span><span class="p">,</span>
    <span class="s">&quot;uu_codec&quot;</span><span class="p">,</span>
    <span class="s">&quot;quopri_codec&quot;</span><span class="p">,</span>
    <span class="s">&quot;hex_codec&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">transform_aliases</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;base64_codec&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;base64&quot;</span><span class="p">,</span> <span class="s">&quot;base_64&quot;</span><span class="p">],</span>
    <span class="s">&quot;uu_codec&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;uu&quot;</span><span class="p">],</span>
    <span class="s">&quot;quopri_codec&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;quopri&quot;</span><span class="p">,</span> <span class="s">&quot;quoted_printable&quot;</span><span class="p">,</span> <span class="s">&quot;quotedprintable&quot;</span><span class="p">],</span>
    <span class="s">&quot;hex_codec&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;hex&quot;</span><span class="p">],</span>
    <span class="s">&quot;rot_13&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;rot13&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">zlib</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">zlib</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">bytes_transform_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;zlib_codec&quot;</span><span class="p">)</span>
    <span class="n">transform_aliases</span><span class="p">[</span><span class="s">&quot;zlib_codec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;zip&quot;</span><span class="p">,</span> <span class="s">&quot;zlib&quot;</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">bz2</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">bytes_transform_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;bz2_codec&quot;</span><span class="p">)</span>
    <span class="n">transform_aliases</span><span class="p">[</span><span class="s">&quot;bz2_codec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;bz2&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="TransformCodecTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest">[docs]</a><span class="k">class</span> <span class="nc">TransformCodecTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TransformCodecTest.test_basics"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_basics">[docs]</a>    <span class="k">def</span> <span class="nf">test_basics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">binput</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">bytes_transform_encodings</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">):</span>
                <span class="c"># generic codecs interface</span>
                <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">binput</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">binput</span><span class="p">))</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">o</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">binput</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_read"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_read">[docs]</a>    <span class="k">def</span> <span class="nf">test_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">bytes_transform_encodings</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">):</span>
                <span class="n">sin</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x80</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">sin</span><span class="p">))</span>
                <span class="n">sout</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sout</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_readline"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_readline">[docs]</a>    <span class="k">def</span> <span class="nf">test_readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">bytes_transform_encodings</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">):</span>
                <span class="n">sin</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\x80</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">sin</span><span class="p">))</span>
                <span class="n">sout</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sout</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x80</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_buffer_api_usage"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_buffer_api_usage">[docs]</a>    <span class="k">def</span> <span class="nf">test_buffer_api_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># We check all the transform codecs accept memoryview input</span>
        <span class="c"># for encoding and decoding</span>
        <span class="c"># and also that they roundtrip correctly</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;12345</span><span class="se">\x80</span><span class="s">&quot;</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">bytes_transform_encodings</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">original</span>
                <span class="n">view</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="n">view_encoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view_encoded</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">view</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
                <span class="n">view_decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view_decoded</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_text_to_binary_blacklists_binary_transforms"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_text_to_binary_blacklists_binary_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">test_text_to_binary_blacklists_binary_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check binary -&gt; binary codecs give a good error for str input</span>
        <span class="n">bad_input</span> <span class="o">=</span> <span class="s">&quot;bad input type&quot;</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">bytes_transform_encodings</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">):</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&quot;{!r} is not a text encoding; &quot;</span>
                        <span class="s">&quot;use codecs.encode\(\) to handle arbitrary codecs&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">as</span> <span class="n">failure</span><span class="p">:</span>
                    <span class="n">bad_input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__cause__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_text_to_binary_blacklists_text_transforms"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_text_to_binary_blacklists_text_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">test_text_to_binary_blacklists_text_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check str.encode gives a good error message for str -&gt; str codecs</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">r&quot;^&#39;rot_13&#39; is not a text encoding; &quot;</span>
                <span class="s">&quot;use codecs.encode\(\) to handle arbitrary codecs&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="s">&quot;just an example message&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;rot_13&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_binary_to_text_blacklists_binary_transforms"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_binary_to_text_blacklists_binary_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_to_text_blacklists_binary_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check bytes.decode and bytearray.decode give a good error</span>
        <span class="c"># message for binary -&gt; binary codecs</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;encode first to ensure we meet any format restrictions&quot;</span>
        <span class="k">for</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">bytes_transform_encodings</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">):</span>
                <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="s">r&quot;{!r} is not a text encoding; &quot;</span>
                        <span class="s">&quot;use codecs.decode\(\) to handle arbitrary codecs&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
                    <span class="n">encoded_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
                    <span class="nb">bytearray</span><span class="p">(</span><span class="n">encoded_data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_binary_to_text_blacklists_text_transforms"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_binary_to_text_blacklists_text_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_to_text_blacklists_text_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check str -&gt; str codec gives a good error for binary input</span>
        <span class="k">for</span> <span class="n">bad_input</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b</span><span class="s">&quot;immutable&quot;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;mutable&quot;</span><span class="p">)):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">bad_input</span><span class="o">=</span><span class="n">bad_input</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">r&quot;^&#39;rot_13&#39; is not a text encoding; &quot;</span>
                        <span class="s">&quot;use codecs.decode\(\) to handle arbitrary codecs&quot;</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">as</span> <span class="n">failure</span><span class="p">:</span>
                    <span class="n">bad_input</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&quot;rot_13&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__cause__</span><span class="p">)</span>
</div>
    <span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">zlib</span><span class="p">,</span> <span class="s">&quot;Requires zlib support&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TransformCodecTest.test_custom_zlib_error_is_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_custom_zlib_error_is_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_custom_zlib_error_is_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check zlib codec gives a good error for malformed input</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;^decoding with &#39;zlib_codec&#39; codec failed&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">as</span> <span class="n">failure</span><span class="p">:</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;zlib_codec&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__cause__</span><span class="p">,</span>
                                                <span class="nb">type</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">exception</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TransformCodecTest.test_custom_hex_error_is_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_custom_hex_error_is_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_custom_hex_error_is_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Check hex codec gives a good error for malformed input</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;^decoding with &#39;hex_codec&#39; codec failed&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">as</span> <span class="n">failure</span><span class="p">:</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;hex_codec&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__cause__</span><span class="p">,</span>
                                                <span class="nb">type</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">exception</span><span class="p">))</span>

    <span class="c"># Unfortunately, the bz2 module throws OSError, which the codec</span>
    <span class="c"># machinery currently can&#39;t wrap :(</span>

    <span class="c"># Ensure codec aliases from http://bugs.python.org/issue7475 work</span></div>
<div class="viewcode-block" id="TransformCodecTest.test_aliases"><a class="viewcode-back" href="../../test.html#test.test_codecs.TransformCodecTest.test_aliases">[docs]</a>    <span class="k">def</span> <span class="nf">test_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">codec_name</span><span class="p">,</span> <span class="n">aliases</span> <span class="ow">in</span> <span class="n">transform_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">expected_name</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">codec_name</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">):</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">expected_name</span><span class="p">)</span>


<span class="c"># The codec system tries to wrap exceptions in order to ensure the error</span>
<span class="c"># mentions the operation being performed and the codec involved. We</span>
<span class="c"># currently *only* want this to happen for relatively stateless</span>
<span class="c"># exceptions, where the only significant information they contain is their</span>
<span class="c"># type and a single str argument.</span>

<span class="c"># Use a local codec registry to avoid appearing to leak objects when</span>
<span class="c"># registering multiple seach functions</span></div></div>
<span class="n">_TEST_CODECS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">_get_test_codec</span><span class="p">(</span><span class="n">codec_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_TEST_CODECS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">codec_name</span><span class="p">)</span>
<span class="n">codecs</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_get_test_codec</span><span class="p">)</span> <span class="c"># Returns None, not usable as a decorator</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># Issue #22166: Also need to clear the internal cache in CPython</span>
    <span class="kn">from</span> <span class="nn">_codecs</span> <span class="kn">import</span> <span class="n">_forget_codec</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_forget_codec</span><span class="p">(</span><span class="n">codec_name</span><span class="p">):</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="ExceptionChainingTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest">[docs]</a><span class="k">class</span> <span class="nc">ExceptionChainingTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="ExceptionChainingTest.setUp"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># There&#39;s no way to unregister a codec search function, so we just</span>
        <span class="c"># ensure we render this one fairly harmless after the test</span>
        <span class="c"># case finishes by using the test case repr as the codec name</span>
        <span class="c"># The codecs module normalizes codec names, although this doesn&#39;t</span>
        <span class="c"># appear to be formally documented...</span>
        <span class="c"># We also make sure we use a truly unique id for the custom codec</span>
        <span class="c"># to avoid issues with the codec cache when running these tests</span>
        <span class="c"># multiple times (e.g. when hunting for refleaks)</span>
        <span class="n">unique_id</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span> <span class="o">=</span> <span class="n">encodings</span><span class="o">.</span><span class="n">normalize_encoding</span><span class="p">(</span><span class="n">unique_id</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c"># We store the object to raise on the instance because of a bad</span>
        <span class="c"># interaction between the codec caching (which means we can&#39;t</span>
        <span class="c"># recreate the codec entry) and regrtest refleak hunting (which</span>
        <span class="c"># runs the same test instance multiple times). This means we</span>
        <span class="c"># need to ensure the codecs call back in to the instance to find</span>
        <span class="c"># out which exception to raise rather than binding them in a</span>
        <span class="c"># closure to an object that may change on the next run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_to_raise</span> <span class="o">=</span> <span class="ne">RuntimeError</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.tearDown"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_TEST_CODECS</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="c"># Issue #22166: Also pop from caches to avoid appearance of ref leaks</span>
        <span class="n">encodings</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_forget_codec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.set_codec"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.set_codec">[docs]</a>    <span class="k">def</span> <span class="nf">set_codec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encode</span><span class="p">,</span> <span class="n">decode</span><span class="p">):</span>
        <span class="n">codec_info</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">CodecInfo</span><span class="p">(</span><span class="n">encode</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span>
                                      <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="n">_TEST_CODECS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">codec_info</span>
</div>
    <span class="nd">@contextlib.contextmanager</span>
<div class="viewcode-block" id="ExceptionChainingTest.assertWrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.assertWrapped">[docs]</a>    <span class="k">def</span> <span class="nf">assertWrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">full_msg</span> <span class="o">=</span> <span class="s">r&quot;{} with {!r} codec failed \({}: {}\)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                  <span class="n">operation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">full_msg</span><span class="p">)</span> <span class="k">as</span> <span class="n">caught</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">caught</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">caught</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__cause__</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">caught</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">__cause__</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.raise_obj"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.raise_obj">[docs]</a>    <span class="k">def</span> <span class="nf">raise_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c"># Helper to dynamically change the object raised by a test codec</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_to_raise</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.check_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.check_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">check_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_to_raise</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">exc_type</span><span class="o">=</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_to_raise</span> <span class="o">=</span> <span class="n">obj_to_raise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_codec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raise_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_obj</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWrapped</span><span class="p">(</span><span class="s">&quot;encoding&quot;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="s">&quot;str_input&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWrapped</span><span class="p">(</span><span class="s">&quot;encoding&quot;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;str_input&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWrapped</span><span class="p">(</span><span class="s">&quot;decoding&quot;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWrapped</span><span class="p">(</span><span class="s">&quot;decoding&quot;</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_raise_by_type"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_raise_by_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_raise_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapped</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_raise_by_value"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_raise_by_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_raise_by_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;This should be wrapped&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapped</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_raise_grandchild_subclass_exact_size"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_raise_grandchild_subclass_exact_size">[docs]</a>    <span class="k">def</span> <span class="nf">test_raise_grandchild_subclass_exact_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;This should be wrapped&quot;</span>
        <span class="k">class</span> <span class="nc">MyRuntimeError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">__slots__</span> <span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapped</span><span class="p">(</span><span class="n">MyRuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">MyRuntimeError</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_raise_subclass_with_weakref_support"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_raise_subclass_with_weakref_support">[docs]</a>    <span class="k">def</span> <span class="nf">test_raise_subclass_with_weakref_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;This should be wrapped&quot;</span>
        <span class="k">class</span> <span class="nc">MyRuntimeError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_wrapped</span><span class="p">(</span><span class="n">MyRuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">MyRuntimeError</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.check_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.check_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">check_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_to_raise</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">raise_obj</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">obj_to_raise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_codec</span><span class="p">(</span><span class="n">raise_obj</span><span class="p">,</span> <span class="n">raise_obj</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="s">&quot;str input&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;str input&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_init_override_is_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_init_override_is_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_init_override_is_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">CustomInit</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_not_wrapped</span><span class="p">(</span><span class="n">CustomInit</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_new_override_is_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_new_override_is_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_override_is_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">CustomNew</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_not_wrapped</span><span class="p">(</span><span class="n">CustomNew</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_instance_attribute_is_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_instance_attribute_is_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_instance_attribute_is_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;This should NOT be wrapped&quot;</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">exc</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_not_wrapped</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="s">&quot;^{}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_non_str_arg_is_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_non_str_arg_is_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_non_str_arg_is_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_not_wrapped</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_multiple_args_is_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_multiple_args_is_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_multiple_args_is_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg_re</span> <span class="o">=</span> <span class="s">r&quot;^\(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;\)$&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_not_wrapped</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="n">msg_re</span><span class="p">)</span>

    <span class="c"># http://bugs.python.org/issue19609</span></div>
<div class="viewcode-block" id="ExceptionChainingTest.test_codec_lookup_failure_not_wrapped"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_codec_lookup_failure_not_wrapped">[docs]</a>    <span class="k">def</span> <span class="nf">test_codec_lookup_failure_not_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;^unknown encoding: {}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="c"># The initial codec lookup should not be wrapped</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="s">&quot;str input&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;str input&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExceptionChainingTest.test_unflagged_non_text_codec_handling"><a class="viewcode-back" href="../../test.html#test.test_codecs.ExceptionChainingTest.test_unflagged_non_text_codec_handling">[docs]</a>    <span class="k">def</span> <span class="nf">test_unflagged_non_text_codec_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># The stdlib non-text codecs are now marked so they&#39;re</span>
        <span class="c"># pre-emptively skipped by the text model related methods</span>
        <span class="c"># However, third party codecs won&#39;t be flagged, so we still make</span>
        <span class="c"># sure the case where an inappropriate output type is produced is</span>
        <span class="c"># handled appropriately</span>
        <span class="k">def</span> <span class="nf">encode_to_str</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;not bytes!&quot;</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">def</span> <span class="nf">decode_to_bytes</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="s">&quot;not str!&quot;</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_codec</span><span class="p">(</span><span class="n">encode_to_str</span><span class="p">,</span> <span class="n">decode_to_bytes</span><span class="p">)</span>
        <span class="c"># No input or output type checks on the codecs module functions</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="s">&quot;not bytes!&quot;</span><span class="p">)</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;not str!&quot;</span><span class="p">)</span>
        <span class="c"># Text model methods should complain</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="s">r&quot;^{!r} encoder returned &#39;str&#39; instead of &#39;bytes&#39;; &quot;</span>
                <span class="s">&quot;use codecs.encode\(\) to encode to arbitrary types$&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="s">&quot;str_input&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="s">r&quot;^{!r} decoder returned &#39;bytes&#39; instead of &#39;str&#39;; &quot;</span>
                <span class="s">&quot;use codecs.decode\(\) to decode to arbitrary types$&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
            <span class="n">b</span><span class="s">&quot;bytes input&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codec_name</span><span class="p">)</span>


</div></div>
<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span>
                     <span class="s">&#39;code pages are specific to Windows&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="CodePageTest"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest">[docs]</a><span class="k">class</span> <span class="nc">CodePageTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># CP_UTF8 is already tested by CP65001Test</span>
    <span class="n">CP_UTF8</span> <span class="o">=</span> <span class="mi">65001</span>

<div class="viewcode-block" id="CodePageTest.test_invalid_code_page"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_invalid_code_page">[docs]</a>    <span class="k">def</span> <span class="nf">test_invalid_code_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_encode</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_encode</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodePageTest.test_code_page_name"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_code_page_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_code_page_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="s">&#39;cp932&#39;</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_encode</span><span class="p">,</span> <span class="mi">932</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="s">&#39;cp932&#39;</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">,</span> <span class="mi">932</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\x00</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="s">&#39;CP_UTF8&#39;</span><span class="p">,</span>
            <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CP_UTF8</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodePageTest.check_decode"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.check_decode">[docs]</a>    <span class="k">def</span> <span class="nf">check_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">tests</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">raw</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Unable to decode %a from &quot;cp</span><span class="si">%s</span><span class="s">&quot; with &#39;</span>
                              <span class="s">&#39;errors=</span><span class="si">%r</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span>
                    <span class="s">&#39;%a.decode(&quot;cp</span><span class="si">%s</span><span class="s">&quot;, </span><span class="si">%r</span><span class="s">)=%a != %a&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">decoded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">expected</span><span class="p">))</span>
                <span class="c"># assert 0 &lt;= decoded[1] &lt;= len(raw)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertGreaterEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                    <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodePageTest.check_encode"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.check_encode">[docs]</a>    <span class="k">def</span> <span class="nf">check_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">tests</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">encoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_encode</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&#39;Unable to encode %a to &quot;cp</span><span class="si">%s</span><span class="s">&quot; with &#39;</span>
                              <span class="s">&#39;errors=</span><span class="si">%r</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span>
                    <span class="s">&#39;%a.encode(&quot;cp</span><span class="si">%s</span><span class="s">&quot;, </span><span class="si">%r</span><span class="s">)=%a != %a&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">encoded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">expected</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">encoded</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                    <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_encode</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CodePageTest.test_cp932"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_cp932">[docs]</a>    <span class="k">def</span> <span class="nf">test_cp932</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_encode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\uff44\u9a3e</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x82\x84\xe9\x80</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="c"># test error handlers</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[y]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;[</span><span class="se">\u20ac</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[?]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;backslashreplace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[</span><span class="se">\\</span><span class="s">xff]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;xmlcharrefreplace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[&amp;#255;]&#39;</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_decode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x82\x84\xe9\x80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\uff44\u9a3e</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="c"># invalid bytes</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\ufffd</span><span class="s">]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;surrogateescape&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\udcff</span><span class="s">]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\x00</span><span class="s">abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\x00</span><span class="s">abc&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x81\x00</span><span class="s">abc&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd\x00</span><span class="s">abc&#39;</span><span class="p">),</span>
        <span class="p">))</span>
</div>
<div class="viewcode-block" id="CodePageTest.test_cp1252"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_cp1252">[docs]</a>    <span class="k">def</span> <span class="nf">test_cp1252</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_encode</span><span class="p">(</span><span class="mi">1252</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\xe9\u20ac</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>  <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe9\x80</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\u0141</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\u0141</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\u0141</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;L&#39;</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_decode</span><span class="p">(</span><span class="mi">1252</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xe9\x80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xe9\u20ac</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xff</span><span class="s">&#39;</span><span class="p">),</span>
        <span class="p">))</span>
</div>
<div class="viewcode-block" id="CodePageTest.test_cp_utf7"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_cp_utf7">[docs]</a>    <span class="k">def</span> <span class="nf">test_cp_utf7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="mi">65000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_encode</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\xe9\u20ac</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>  <span class="n">b</span><span class="s">&#39;+AOkgrA-&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\U0010ffff</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>  <span class="n">b</span><span class="s">&#39;+2//f/w-&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;+3IA-&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;+//0-&#39;</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_decode</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;+AOkgrA-&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xe9\u20ac</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;+2//f/w-&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\U0010ffff</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;+3IA-&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\udc80</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;+//0-&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="c"># invalid bytes</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[+/]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;[</span><span class="se">\xff</span><span class="s">]&#39;</span><span class="p">),</span>
        <span class="p">))</span>
</div>
<div class="viewcode-block" id="CodePageTest.test_multibyte_encoding"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_multibyte_encoding">[docs]</a>    <span class="k">def</span> <span class="nf">test_multibyte_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_decode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x84\xe9\x80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\u9a3e</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x84\xe9\x80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd\u9a3e</span><span class="s">&#39;</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CP_UTF8</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xf4\x8f\xbf\xbf</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\U0010ffff</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\xff\xf4\x8f\xbf\xbf</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\ufffd\U0010ffff</span><span class="s">&#39;</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="n">VISTA_OR_LATER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CP_UTF8</span><span class="p">,</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&#39;[</span><span class="se">\U0010ffff\uDC80</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[</span><span class="se">\xf4\x8f\xbf\xbf</span><span class="s">]&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;[</span><span class="se">\U0010ffff\uDC80</span><span class="s">]&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;[</span><span class="se">\xf4\x8f\xbf\xbf</span><span class="s">?]&#39;</span><span class="p">),</span>
            <span class="p">))</span>
</div>
<div class="viewcode-block" id="CodePageTest.test_incremental"><a class="viewcode-back" href="../../test.html#test.test_codecs.CodePageTest.test_incremental">[docs]</a>    <span class="k">def</span> <span class="nf">test_incremental</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x82</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span>
                                          <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe9\x80\xe9</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>
                                          <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\u9a3e</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span>
                                          <span class="n">b</span><span class="s">&#39;</span><span class="se">\xe9\x80\xe9\x80</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>
                                          <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\u9a3e\u9a3e</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">decoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">code_page_decode</span><span class="p">(</span><span class="mi">932</span><span class="p">,</span>
                                          <span class="n">b</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">,</span>
                                          <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>