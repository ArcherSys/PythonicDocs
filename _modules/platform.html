

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>platform &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>platform</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for platform</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot; This module tries to retrieve as much platform-identifying data as</span>
<span class="sd">    possible. It makes this information available via function APIs.</span>

<span class="sd">    If called from the command line, it prints the platform</span>
<span class="sd">    information concatenated as single string to stdout. The output</span>
<span class="sd">    format is useable as part of a filename.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c">#    This module is maintained by Marc-Andre Lemburg &lt;mal@egenix.com&gt;.</span>
<span class="c">#    If you find problems, please submit bug reports/patches via the</span>
<span class="c">#    Python bug tracker (http://bugs.python.org) and assign them to &quot;lemburg&quot;.</span>
<span class="c">#</span>
<span class="c">#    Still needed:</span>
<span class="c">#    * more support for WinCE</span>
<span class="c">#    * support for MS-DOS (PythonDX ?)</span>
<span class="c">#    * support for Amiga and other still unsupported platforms running Python</span>
<span class="c">#    * support for additional Linux distributions</span>
<span class="c">#</span>
<span class="c">#    Many thanks to all those who helped adding platform-specific</span>
<span class="c">#    checks (in no particular order):</span>
<span class="c">#</span>
<span class="c">#      Charles G Waldman, David Arnold, Gordon McMillan, Ben Darnell,</span>
<span class="c">#      Jeff Bauer, Cliff Crawford, Ivan Van Laningham, Josef</span>
<span class="c">#      Betancourt, Randall Hopper, Karl Putland, John Farrell, Greg</span>
<span class="c">#      Andruk, Just van Rossum, Thomas Heller, Mark R. Levinson, Mark</span>
<span class="c">#      Hammond, Bill Tutt, Hans Nowak, Uwe Zessin (OpenVMS support),</span>
<span class="c">#      Colin Kong, Trent Mick, Guido van Rossum, Anthony Baxter</span>
<span class="c">#</span>
<span class="c">#    History:</span>
<span class="c">#</span>
<span class="c">#    &lt;see CVS and SVN checkin messages for history&gt;</span>
<span class="c">#</span>
<span class="c">#    1.0.7 - added DEV_NULL</span>
<span class="c">#    1.0.6 - added linux_distribution()</span>
<span class="c">#    1.0.5 - fixed Java support to allow running the module on Jython</span>
<span class="c">#    1.0.4 - added IronPython support</span>
<span class="c">#    1.0.3 - added normalization of Windows system name</span>
<span class="c">#    1.0.2 - added more Windows support</span>
<span class="c">#    1.0.1 - reformatted to make doc.py happy</span>
<span class="c">#    1.0.0 - reformatted a bit and checked into Python CVS</span>
<span class="c">#    0.8.0 - added sys.version parser and various new access</span>
<span class="c">#            APIs (python_version(), python_compiler(), etc.)</span>
<span class="c">#    0.7.2 - fixed architecture() to use sizeof(pointer) where available</span>
<span class="c">#    0.7.1 - added support for Caldera OpenLinux</span>
<span class="c">#    0.7.0 - some fixes for WinCE; untabified the source file</span>
<span class="c">#    0.6.2 - support for OpenVMS - requires version 1.5.2-V006 or higher and</span>
<span class="c">#            vms_lib.getsyi() configured</span>
<span class="c">#    0.6.1 - added code to prevent &#39;uname -p&#39; on platforms which are</span>
<span class="c">#            known not to support it</span>
<span class="c">#    0.6.0 - fixed win32_ver() to hopefully work on Win95,98,NT and Win2k;</span>
<span class="c">#            did some cleanup of the interfaces - some APIs have changed</span>
<span class="c">#    0.5.5 - fixed another type in the MacOS code... should have</span>
<span class="c">#            used more coffee today ;-)</span>
<span class="c">#    0.5.4 - fixed a few typos in the MacOS code</span>
<span class="c">#    0.5.3 - added experimental MacOS support; added better popen()</span>
<span class="c">#            workarounds in _syscmd_ver() -- still not 100% elegant</span>
<span class="c">#            though</span>
<span class="c">#    0.5.2 - fixed uname() to return &#39;&#39; instead of &#39;unknown&#39; in all</span>
<span class="c">#            return values (the system uname command tends to return</span>
<span class="c">#            &#39;unknown&#39; instead of just leaving the field emtpy)</span>
<span class="c">#    0.5.1 - included code for slackware dist; added exception handlers</span>
<span class="c">#            to cover up situations where platforms don&#39;t have os.popen</span>
<span class="c">#            (e.g. Mac) or fail on socket.gethostname(); fixed libc</span>
<span class="c">#            detection RE</span>
<span class="c">#    0.5.0 - changed the API names referring to system commands to *syscmd*;</span>
<span class="c">#            added java_ver(); made syscmd_ver() a private</span>
<span class="c">#            API (was system_ver() in previous versions) -- use uname()</span>
<span class="c">#            instead; extended the win32_ver() to also return processor</span>
<span class="c">#            type information</span>
<span class="c">#    0.4.0 - added win32_ver() and modified the platform() output for WinXX</span>
<span class="c">#    0.3.4 - fixed a bug in _follow_symlinks()</span>
<span class="c">#    0.3.3 - fixed popen() and &quot;file&quot; command invokation bugs</span>
<span class="c">#    0.3.2 - added architecture() API and support for it in platform()</span>
<span class="c">#    0.3.1 - fixed syscmd_ver() RE to support Windows NT</span>
<span class="c">#    0.3.0 - added system alias support</span>
<span class="c">#    0.2.3 - removed &#39;wince&#39; again... oh well.</span>
<span class="c">#    0.2.2 - added &#39;wince&#39; to syscmd_ver() supported platforms</span>
<span class="c">#    0.2.1 - added cache logic and changed the platform string format</span>
<span class="c">#    0.2.0 - changed the API to use functions instead of module globals</span>
<span class="c">#            since some action take too long to be run on module import</span>
<span class="c">#    0.1.0 - first release</span>
<span class="c">#</span>
<span class="c">#    You can always get the latest version of this module at:</span>
<span class="c">#</span>
<span class="c">#             http://www.egenix.com/files/python/platform.py</span>
<span class="c">#</span>
<span class="c">#    If that URL should fail, try contacting the author.</span>

<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    Copyright (c) 1999-2000, Marc-Andre Lemburg; mailto:mal@lemburg.com</span>
<span class="s">    Copyright (c) 2000-2010, eGenix.com Software GmbH; mailto:info@egenix.com</span>

<span class="s">    Permission to use, copy, modify, and distribute this software and its</span>
<span class="s">    documentation for any purpose and without fee or royalty is hereby granted,</span>
<span class="s">    provided that the above copyright notice appear in all copies and that</span>
<span class="s">    both that copyright notice and this permission notice appear in</span>
<span class="s">    supporting documentation or portions thereof, including modifications,</span>
<span class="s">    that you make.</span>

<span class="s">    EGENIX.COM SOFTWARE GMBH DISCLAIMS ALL WARRANTIES WITH REGARD TO</span>
<span class="s">    THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND</span>
<span class="s">    FITNESS, IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL,</span>
<span class="s">    INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING</span>
<span class="s">    FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,</span>
<span class="s">    NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION</span>
<span class="s">    WITH THE USE OR PERFORMANCE OF THIS SOFTWARE !</span>

<span class="s">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.0.7&#39;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">subprocess</span>

<span class="c">### Globals &amp; Constants</span>

<span class="c"># Determine the platform&#39;s /dev/null device</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">DEV_NULL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">devnull</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="c"># os.devnull was added in Python 2.4, so emulate it for earlier</span>
    <span class="c"># Python versions</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;dos&#39;</span><span class="p">,</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c"># Use the old CP/M NUL as device name</span>
        <span class="n">DEV_NULL</span> <span class="o">=</span> <span class="s">&#39;NUL&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Standard Unix uses /dev/null</span>
        <span class="n">DEV_NULL</span> <span class="o">=</span> <span class="s">&#39;/dev/null&#39;</span>

<span class="c"># Directory to search for configuration information on Unix.</span>
<span class="c"># Constant used by test_platform to test linux_distribution().</span>
<span class="n">_UNIXCONFDIR</span> <span class="o">=</span> <span class="s">&#39;/etc&#39;</span>

<span class="c">### Platform specific APIs</span>

<span class="n">_libc_search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;(__libc_init)&#39;</span>
                          <span class="n">b</span><span class="s">&#39;|&#39;</span>
                          <span class="n">b</span><span class="s">&#39;(GLIBC_([0-9.]+))&#39;</span>
                          <span class="n">b</span><span class="s">&#39;|&#39;</span>
                          <span class="n">br</span><span class="s">&#39;(libc(_\w+)?\.so(?:\.(\d[0-9.]*))?)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<div class="viewcode-block" id="libc_ver"><a class="viewcode-back" href="../platform.html#platform.libc_ver">[docs]</a><span class="k">def</span> <span class="nf">libc_ver</span><span class="p">(</span><span class="n">executable</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">lib</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>

             <span class="n">chunksize</span><span class="o">=</span><span class="mi">16384</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries to determine the libc version that the file executable</span>
<span class="sd">        (which defaults to the Python interpreter) is linked against.</span>

<span class="sd">        Returns a tuple of strings (lib,version) which default to the</span>
<span class="sd">        given parameters in case the lookup fails.</span>

<span class="sd">        Note that the function has intimate knowledge of how different</span>
<span class="sd">        libc versions add symbols to the executable and thus is probably</span>
<span class="sd">        only useable for executables compiled using gcc.</span>

<span class="sd">        The file is read and scanned in chunks of chunksize bytes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;realpath&#39;</span><span class="p">):</span>
        <span class="c"># Python 2.2 introduced os.path.realpath(); it is used</span>
        <span class="c"># here to work around problems with Cygwin not being</span>
        <span class="c"># able to open symlinks for reading</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">executable</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">executable</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span><span class="s">&#39;libc&#39;</span> <span class="ow">in</span> <span class="n">binary</span> <span class="ow">or</span> <span class="n">b</span><span class="s">&#39;GLIBC&#39;</span> <span class="ow">in</span> <span class="n">binary</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">_libc_search</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">binary</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">binary</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">continue</span>
        <span class="n">libcinit</span><span class="p">,</span> <span class="n">glibc</span><span class="p">,</span> <span class="n">glibcversion</span><span class="p">,</span> <span class="n">so</span><span class="p">,</span> <span class="n">threads</span><span class="p">,</span> <span class="n">soversion</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;latin1&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">s</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">libcinit</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lib</span><span class="p">:</span>
            <span class="n">lib</span> <span class="o">=</span> <span class="s">&#39;libc&#39;</span>
        <span class="k">elif</span> <span class="n">glibc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lib</span> <span class="o">!=</span> <span class="s">&#39;glibc&#39;</span><span class="p">:</span>
                <span class="n">lib</span> <span class="o">=</span> <span class="s">&#39;glibc&#39;</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">glibcversion</span>
            <span class="k">elif</span> <span class="n">glibcversion</span> <span class="o">&gt;</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">glibcversion</span>
        <span class="k">elif</span> <span class="n">so</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lib</span> <span class="o">!=</span> <span class="s">&#39;glibc&#39;</span><span class="p">:</span>
                <span class="n">lib</span> <span class="o">=</span> <span class="s">&#39;libc&#39;</span>
                <span class="k">if</span> <span class="n">soversion</span> <span class="ow">and</span> <span class="n">soversion</span> <span class="o">&gt;</span> <span class="n">version</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="n">soversion</span>
                <span class="k">if</span> <span class="n">threads</span> <span class="ow">and</span> <span class="n">version</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">threads</span><span class="p">):]</span> <span class="o">!=</span> <span class="n">threads</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="o">+</span> <span class="n">threads</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lib</span><span class="p">,</span> <span class="n">version</span>
</div>
<span class="k">def</span> <span class="nf">_dist_try_harder</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries some special tricks to get the distribution</span>
<span class="sd">        information in case the default method fails.</span>

<span class="sd">        Currently supports older SuSE Linux, Caldera OpenLinux and</span>
<span class="sd">        Slackware Linux distributions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/var/adm/inst-log/info&#39;</span><span class="p">):</span>
        <span class="c"># SuSE Linux stores distribution information in that file</span>
        <span class="n">distname</span> <span class="o">=</span> <span class="s">&#39;SuSE&#39;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/var/adm/inst-log/info&#39;</span><span class="p">):</span>
            <span class="n">tv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tag</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">tv</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;MIN_DIST_VERSION&#39;</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;DIST_IDENT&#39;</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/etc/.installed&#39;</span><span class="p">):</span>
        <span class="c"># Caldera OpenLinux has some infos in that file (thanks to Colin Kong)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/etc/.installed&#39;</span><span class="p">):</span>
            <span class="n">pkg</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">pkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;OpenLinux&#39;</span><span class="p">:</span>
                <span class="c"># XXX does Caldera support non Intel platforms ? If yes,</span>
                <span class="c">#     where can we find the needed id ?</span>
                <span class="k">return</span> <span class="s">&#39;OpenLinux&#39;</span><span class="p">,</span> <span class="n">pkg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">id</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s">&#39;/usr/lib/setup&#39;</span><span class="p">):</span>
        <span class="c"># Check for slackware version tag file (thanks to Greg Andruk)</span>
        <span class="n">verfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;/usr/lib/setup&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verfiles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verfiles</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;slack-version-&#39;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">verfiles</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">verfiles</span><span class="p">:</span>
            <span class="n">verfiles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">distname</span> <span class="o">=</span> <span class="s">&#39;slackware&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">verfiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">14</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

    <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

<span class="n">_release_filename</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\w+)[-_](release|version)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
<span class="n">_lsb_release_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(.+)&#39;</span>
                                   <span class="s">&#39; release &#39;</span>
                                   <span class="s">&#39;([\d.]+)&#39;</span>
                                   <span class="s">&#39;[^(]*(?:\((.+)\))?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
<span class="n">_release_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;([^0-9]+)&#39;</span>
                               <span class="s">&#39;(?: release )?&#39;</span>
                               <span class="s">&#39;([\d.]+)&#39;</span>
                               <span class="s">&#39;[^(]*(?:\((.+)\))?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<span class="c"># See also http://www.novell.com/coolsolutions/feature/11251.html</span>
<span class="c"># and http://linuxmafia.com/faq/Admin/release-files.html</span>
<span class="c"># and http://data.linux-ntfs.org/rpm/whichrpm</span>
<span class="c"># and http://www.die.net/doc/linux/man/man1/lsb_release.1.html</span>

<span class="n">_supported_dists</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;SuSE&#39;</span><span class="p">,</span> <span class="s">&#39;debian&#39;</span><span class="p">,</span> <span class="s">&#39;fedora&#39;</span><span class="p">,</span> <span class="s">&#39;redhat&#39;</span><span class="p">,</span> <span class="s">&#39;centos&#39;</span><span class="p">,</span>
    <span class="s">&#39;mandrake&#39;</span><span class="p">,</span> <span class="s">&#39;mandriva&#39;</span><span class="p">,</span> <span class="s">&#39;rocks&#39;</span><span class="p">,</span> <span class="s">&#39;slackware&#39;</span><span class="p">,</span> <span class="s">&#39;yellowdog&#39;</span><span class="p">,</span> <span class="s">&#39;gentoo&#39;</span><span class="p">,</span>
    <span class="s">&#39;UnitedLinux&#39;</span><span class="p">,</span> <span class="s">&#39;turbolinux&#39;</span><span class="p">,</span> <span class="s">&#39;arch&#39;</span><span class="p">,</span> <span class="s">&#39;mageia&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_parse_release_file</span><span class="p">(</span><span class="n">firstline</span><span class="p">):</span>

    <span class="c"># Default to empty &#39;version&#39; and &#39;id&#39; strings.  Both defaults are used</span>
    <span class="c"># when &#39;firstline&#39; is empty.  &#39;id&#39; defaults to empty when an id can not</span>
    <span class="c"># be deduced.</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># Parse the first line</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_lsb_release_version</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">firstline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># LSB format: &quot;distro release x.x (codename)&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

    <span class="c"># Pre-LSB format: &quot;distro x.x (codename)&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_release_version</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">firstline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

    <span class="c"># Unknown format... take the first two words</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">firstline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

<div class="viewcode-block" id="linux_distribution"><a class="viewcode-back" href="../platform.html#platform.linux_distribution">[docs]</a><span class="k">def</span> <span class="nf">linux_distribution</span><span class="p">(</span><span class="n">distname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>

                       <span class="n">supported_dists</span><span class="o">=</span><span class="n">_supported_dists</span><span class="p">,</span>
                       <span class="n">full_distribution_name</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries to determine the name of the Linux OS distribution name.</span>

<span class="sd">        The function first looks for a distribution release file in</span>
<span class="sd">        /etc and then reverts to _dist_try_harder() in case no</span>
<span class="sd">        suitable files are found.</span>

<span class="sd">        supported_dists may be given to define the set of Linux</span>
<span class="sd">        distributions to look for. It defaults to a list of currently</span>
<span class="sd">        supported Linux distributions identified by their release file</span>
<span class="sd">        name.</span>

<span class="sd">        If full_distribution_name is true (default), the full</span>
<span class="sd">        distribution read from the OS is returned. Otherwise the short</span>
<span class="sd">        name taken from supported_dists is used.</span>

<span class="sd">        Returns a tuple (distname, version, id) which default to the</span>
<span class="sd">        args given as parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">etc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">_UNIXCONFDIR</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="c"># Probably not a Unix system</span>
        <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>
    <span class="n">etc</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">etc</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">_release_filename</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_distname</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_distname</span> <span class="ow">in</span> <span class="n">supported_dists</span><span class="p">:</span>
                <span class="n">distname</span> <span class="o">=</span> <span class="n">_distname</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_dist_try_harder</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="c"># Read the first line</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_UNIXCONFDIR</span><span class="p">,</span> <span class="nb">file</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">,</span>
              <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;surrogateescape&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">firstline</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">_distname</span><span class="p">,</span> <span class="n">_version</span><span class="p">,</span> <span class="n">_id</span> <span class="o">=</span> <span class="n">_parse_release_file</span><span class="p">(</span><span class="n">firstline</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_distname</span> <span class="ow">and</span> <span class="n">full_distribution_name</span><span class="p">:</span>
        <span class="n">distname</span> <span class="o">=</span> <span class="n">_distname</span>
    <span class="k">if</span> <span class="n">_version</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">_version</span>
    <span class="k">if</span> <span class="n">_id</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">_id</span>
    <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

<span class="c"># To maintain backwards compatibility:</span>
</div>
<div class="viewcode-block" id="dist"><a class="viewcode-back" href="../platform.html#platform.dist">[docs]</a><span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">distname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>

         <span class="n">supported_dists</span><span class="o">=</span><span class="n">_supported_dists</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries to determine the name of the Linux OS distribution name.</span>

<span class="sd">        The function first looks for a distribution release file in</span>
<span class="sd">        /etc and then reverts to _dist_try_harder() in case no</span>
<span class="sd">        suitable files are found.</span>

<span class="sd">        Returns a tuple (distname, version, id) which default to the</span>
<span class="sd">        args given as parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">linux_distribution</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span>
                              <span class="n">supported_dists</span><span class="o">=</span><span class="n">supported_dists</span><span class="p">,</span>
                              <span class="n">full_distribution_name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="popen"><a class="viewcode-back" href="../platform.html#platform.popen">[docs]</a><span class="k">def</span> <span class="nf">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Portable popen() interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;use os.popen instead&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_norm_version</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Normalize the version and build strings and return a single</span>
<span class="sd">        version string using the format major.minor.build (or patchlevel).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">build</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="n">l</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ints</span><span class="p">))</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">version</span>

<span class="n">_ver_output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(?:([\w ]+) ([\w.]+) &#39;</span>
                         <span class="s">&#39;.*&#39;</span>
                         <span class="s">&#39;\[.* ([\d.]+)\])&#39;</span><span class="p">)</span>

<span class="c"># Examples of VER command output:</span>
<span class="c">#</span>
<span class="c">#   Windows 2000:  Microsoft Windows 2000 [Version 5.00.2195]</span>
<span class="c">#   Windows XP:    Microsoft Windows XP [Version 5.1.2600]</span>
<span class="c">#   Windows Vista: Microsoft Windows [Version 6.0.6002]</span>
<span class="c">#</span>
<span class="c"># Note that the &quot;Version&quot; string gets localized on different</span>
<span class="c"># Windows versions.</span>

<span class="k">def</span> <span class="nf">_syscmd_ver</span><span class="p">(</span><span class="n">system</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">release</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>

               <span class="n">supported_platforms</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;win16&#39;</span><span class="p">,</span> <span class="s">&#39;dos&#39;</span><span class="p">)):</span>

    <span class="sd">&quot;&quot;&quot; Tries to figure out the OS version used and returns</span>
<span class="sd">        a tuple (system, release, version).</span>

<span class="sd">        It uses the &quot;ver&quot; shell command for this which is known</span>
<span class="sd">        to exists on Windows, DOS. XXX Others too ?</span>

<span class="sd">        In case this fails, the given parameters are used as</span>
<span class="sd">        defaults.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_platforms</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

    <span class="c"># Try some common cmd strings</span>
    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ver&#39;</span><span class="p">,</span> <span class="s">&#39;command /c ver&#39;</span><span class="p">,</span> <span class="s">&#39;cmd /c ver&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pipe</span> <span class="o">=</span> <span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pipe</span><span class="o">.</span><span class="n">close</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;command failed&#39;</span><span class="p">)</span>
            <span class="c"># XXX How can I suppress shell errors from being written</span>
            <span class="c">#     to stderr ?</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
            <span class="c">#print &#39;Command %s failed: %s&#39; % (cmd, why)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

    <span class="c"># Parse the output</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_ver_output</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="c"># Strip trailing dots from version and release</span>
        <span class="k">if</span> <span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">version</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># Normalize the version and build strings (eliminating additional</span>
        <span class="c"># zeros)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">_norm_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

<span class="k">def</span> <span class="nf">_win32_getvalue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Read a value for name from the registry key.</span>

<span class="sd">        In case this fails, default is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Use win32api if available</span>
        <span class="kn">from</span> <span class="nn">win32api</span> <span class="kn">import</span> <span class="n">RegQueryValueEx</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c"># On Python 2.0 and later, emulate using winreg</span>
        <span class="kn">import</span> <span class="nn">winreg</span>
        <span class="n">RegQueryValueEx</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">QueryValueEx</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RegQueryValueEx</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>

<div class="viewcode-block" id="win32_ver"><a class="viewcode-back" href="../platform.html#platform.win32_ver">[docs]</a><span class="k">def</span> <span class="nf">win32_ver</span><span class="p">(</span><span class="n">release</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">csd</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Get additional version information from the Windows Registry</span>
<span class="sd">        and return a tuple (version, csd, ptype) referring to version</span>
<span class="sd">        number, CSD level (service pack), and OS type (multi/single</span>
<span class="sd">        processor).</span>

<span class="sd">        As a hint: ptype returns &#39;Uniprocessor Free&#39; on single</span>
<span class="sd">        processor NT machines and &#39;Multiprocessor Free&#39; on multi</span>
<span class="sd">        processor machines. The &#39;Free&#39; refers to the OS version being</span>
<span class="sd">        free of debugging code. It could also state &#39;Checked&#39; which</span>
<span class="sd">        means the OS version uses debugging code, i.e. code that</span>
<span class="sd">        checks arguments, ranges, etc. (Thomas Heller).</span>

<span class="sd">        Note: this function works best with Mark Hammond&#39;s win32</span>
<span class="sd">        package installed, but also on Python 2.3 and later. It</span>
<span class="sd">        obviously only runs on Win32 compatible platforms.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># XXX Is there any way to find out the processor type on WinXX ?</span>
    <span class="c"># XXX Is win32 available on Windows CE ?</span>
    <span class="c">#</span>
    <span class="c"># Adapted from code posted by Karl Putland to comp.lang.python.</span>
    <span class="c">#</span>
    <span class="c"># The mappings between reg. values and release names can be found</span>
    <span class="c"># here: http://msdn.microsoft.com/library/en-us/sysinfo/base/osversioninfo_str.asp</span>

    <span class="c"># Import the needed APIs</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">win32api</span> <span class="kn">import</span> <span class="n">RegQueryValueEx</span><span class="p">,</span> <span class="n">RegOpenKeyEx</span><span class="p">,</span> \
             <span class="n">RegCloseKey</span><span class="p">,</span> <span class="n">GetVersionEx</span>
        <span class="kn">from</span> <span class="nn">win32con</span> <span class="kn">import</span> <span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">VER_PLATFORM_WIN32_NT</span><span class="p">,</span> \
             <span class="n">VER_PLATFORM_WIN32_WINDOWS</span><span class="p">,</span> <span class="n">VER_NT_WORKSTATION</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c"># Emulate the win32api module using Python APIs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">getwindowsversion</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c"># No emulation possible, so return the defaults...</span>
            <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Emulation using winreg (added in Python 2.0) and</span>
            <span class="c"># sys.getwindowsversion() (added in Python 2.3)</span>
            <span class="kn">import</span> <span class="nn">winreg</span>
            <span class="n">GetVersionEx</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getwindowsversion</span>
            <span class="n">RegQueryValueEx</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">QueryValueEx</span>
            <span class="n">RegOpenKeyEx</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKeyEx</span>
            <span class="n">RegCloseKey</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">CloseKey</span>
            <span class="n">HKEY_LOCAL_MACHINE</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span>
            <span class="n">VER_PLATFORM_WIN32_WINDOWS</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">VER_PLATFORM_WIN32_NT</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">VER_NT_WORKSTATION</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">VER_NT_SERVER</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">REG_SZ</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c"># Find out the registry key and some general version infos</span>
    <span class="n">winver</span> <span class="o">=</span> <span class="n">GetVersionEx</span><span class="p">()</span>
    <span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">csd</span> <span class="o">=</span> <span class="n">winver</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">.</span><span class="si">%i</span><span class="s">.</span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">buildno</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">winver</span><span class="p">,</span> <span class="s">&quot;service_pack&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">winver</span><span class="o">.</span><span class="n">service_pack</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">csd</span> <span class="o">=</span> <span class="s">&#39;SP</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">winver</span><span class="o">.</span><span class="n">service_pack_major</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">csd</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Service Pack &#39;</span><span class="p">:</span>
            <span class="n">csd</span> <span class="o">=</span> <span class="s">&#39;SP&#39;</span> <span class="o">+</span> <span class="n">csd</span><span class="p">[</span><span class="mi">13</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">plat</span> <span class="o">==</span> <span class="n">VER_PLATFORM_WIN32_WINDOWS</span><span class="p">:</span>
        <span class="n">regkey</span> <span class="o">=</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Windows</span><span class="se">\\</span><span class="s">CurrentVersion&#39;</span>
        <span class="c"># Try to guess the release name</span>
        <span class="k">if</span> <span class="n">maj</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;95&#39;</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;98&#39;</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;Me&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;postMe&#39;</span>
        <span class="k">elif</span> <span class="n">maj</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;2000&#39;</span>

    <span class="k">elif</span> <span class="n">plat</span> <span class="o">==</span> <span class="n">VER_PLATFORM_WIN32_NT</span><span class="p">:</span>
        <span class="n">regkey</span> <span class="o">=</span> <span class="s">&#39;SOFTWARE</span><span class="se">\\</span><span class="s">Microsoft</span><span class="se">\\</span><span class="s">Windows NT</span><span class="se">\\</span><span class="s">CurrentVersion&#39;</span>
        <span class="k">if</span> <span class="n">maj</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;NT&#39;</span>
        <span class="k">elif</span> <span class="n">maj</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;2000&#39;</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;XP&#39;</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;2003Server&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;post2003&#39;</span>
        <span class="k">elif</span> <span class="n">maj</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">winver</span><span class="p">,</span> <span class="s">&quot;product_type&quot;</span><span class="p">):</span>
                <span class="n">product_type</span> <span class="o">=</span> <span class="n">winver</span><span class="o">.</span><span class="n">product_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">product_type</span> <span class="o">=</span> <span class="n">VER_NT_WORKSTATION</span>
                <span class="c"># Without an OSVERSIONINFOEX capable sys.getwindowsversion(),</span>
                <span class="c"># or help from the registry, we cannot properly identify</span>
                <span class="c"># non-workstation versions.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">RegOpenKeyEx</span><span class="p">(</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">regkey</span><span class="p">)</span>
                    <span class="n">name</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">RegQueryValueEx</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;ProductName&quot;</span><span class="p">)</span>
                    <span class="c"># Discard any type that isn&#39;t REG_SZ</span>
                    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="n">REG_SZ</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Server&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">product_type</span> <span class="o">=</span> <span class="n">VER_NT_SERVER</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="c"># Use default of VER_NT_WORKSTATION</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">product_type</span> <span class="o">==</span> <span class="n">VER_NT_WORKSTATION</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;Vista&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;2008Server&#39;</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">product_type</span> <span class="o">==</span> <span class="n">VER_NT_WORKSTATION</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;7&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;2008ServerR2&#39;</span>
            <span class="k">elif</span> <span class="nb">min</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">product_type</span> <span class="o">==</span> <span class="n">VER_NT_WORKSTATION</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;8&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;2012Server&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;post2012Server&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">release</span><span class="p">:</span>
            <span class="c"># E.g. Win3.1 with win32s</span>
            <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">.</span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span>

    <span class="c"># Open the registry key</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">keyCurVer</span> <span class="o">=</span> <span class="n">RegOpenKeyEx</span><span class="p">(</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">regkey</span><span class="p">)</span>
        <span class="c"># Get a value to make sure the key exists...</span>
        <span class="n">RegQueryValueEx</span><span class="p">(</span><span class="n">keyCurVer</span><span class="p">,</span> <span class="s">&#39;SystemRoot&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span>

    <span class="c"># Parse values</span>
    <span class="c">#subversion = _win32_getvalue(keyCurVer,</span>
    <span class="c">#                            &#39;SubVersionNumber&#39;,</span>
    <span class="c">#                            (&#39;&#39;,1))[0]</span>
    <span class="c">#if subversion:</span>
    <span class="c">#   release = release + subversion # 95a, 95b, etc.</span>
    <span class="n">build</span> <span class="o">=</span> <span class="n">_win32_getvalue</span><span class="p">(</span><span class="n">keyCurVer</span><span class="p">,</span>
                            <span class="s">&#39;CurrentBuildNumber&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="n">_win32_getvalue</span><span class="p">(</span><span class="n">keyCurVer</span><span class="p">,</span>
                           <span class="s">&#39;CurrentType&#39;</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">ptype</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># Normalize version</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">_norm_version</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">build</span><span class="p">)</span>

    <span class="c"># Close key</span>
    <span class="n">RegCloseKey</span><span class="p">(</span><span class="n">keyCurVer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span>
</div>
<span class="k">def</span> <span class="nf">_mac_ver_xml</span><span class="p">():</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="s">&#39;/System/Library/CoreServices/SystemVersion.plist&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">plistlib</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">release</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="s">&#39;ProductVersion&#39;</span><span class="p">]</span>
    <span class="n">versioninfo</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">machine</span>
    <span class="k">if</span> <span class="n">machine</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ppc&#39;</span><span class="p">,</span> <span class="s">&#39;Power Macintosh&#39;</span><span class="p">):</span>
        <span class="c"># Canonical name</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="s">&#39;PowerPC&#39;</span>

    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">versioninfo</span><span class="p">,</span> <span class="n">machine</span>


<div class="viewcode-block" id="mac_ver"><a class="viewcode-back" href="../platform.html#platform.mac_ver">[docs]</a><span class="k">def</span> <span class="nf">mac_ver</span><span class="p">(</span><span class="n">release</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">versioninfo</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">machine</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Get MacOS version information and return it as tuple (release,</span>
<span class="sd">        versioninfo, machine) with versioninfo being a tuple (version,</span>
<span class="sd">        dev_stage, non_release_version).</span>

<span class="sd">        Entries which cannot be determined are set to the parameter values</span>
<span class="sd">        which default to &#39;&#39;. All tuple entries are strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># First try reading the information from an XML file which should</span>
    <span class="c"># always be present</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">_mac_ver_xml</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="c"># If that also doesn&#39;t work return the default values</span>
    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">versioninfo</span><span class="p">,</span> <span class="n">machine</span>
</div>
<span class="k">def</span> <span class="nf">_java_getprop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">java.lang</span> <span class="kn">import</span> <span class="n">System</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>

<div class="viewcode-block" id="java_ver"><a class="viewcode-back" href="../platform.html#platform.java_ver">[docs]</a><span class="k">def</span> <span class="nf">java_ver</span><span class="p">(</span><span class="n">release</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">vendor</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">vminfo</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">osinfo</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)):</span>

    <span class="sd">&quot;&quot;&quot; Version interface for Jython.</span>

<span class="sd">        Returns a tuple (release, vendor, vminfo, osinfo) with vminfo being</span>
<span class="sd">        a tuple (vm_name, vm_release, vm_vendor) and osinfo being a</span>
<span class="sd">        tuple (os_name, os_version, os_arch).</span>

<span class="sd">        Values which cannot be determined are set to the defaults</span>
<span class="sd">        given as parameters (which all default to &#39;&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Import the needed APIs</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">java.lang</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="n">osinfo</span>

    <span class="n">vendor</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.vendor&#39;</span><span class="p">,</span> <span class="n">vendor</span><span class="p">)</span>
    <span class="n">release</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.version&#39;</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
    <span class="n">vm_name</span><span class="p">,</span> <span class="n">vm_release</span><span class="p">,</span> <span class="n">vm_vendor</span> <span class="o">=</span> <span class="n">vminfo</span>
    <span class="n">vm_name</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.vm.name&#39;</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">)</span>
    <span class="n">vm_vendor</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.vm.vendor&#39;</span><span class="p">,</span> <span class="n">vm_vendor</span><span class="p">)</span>
    <span class="n">vm_release</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.vm.version&#39;</span><span class="p">,</span> <span class="n">vm_release</span><span class="p">)</span>
    <span class="n">vminfo</span> <span class="o">=</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">vm_release</span><span class="p">,</span> <span class="n">vm_vendor</span>
    <span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span> <span class="o">=</span> <span class="n">osinfo</span>
    <span class="n">os_arch</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.os.arch&#39;</span><span class="p">,</span> <span class="n">os_arch</span><span class="p">)</span>
    <span class="n">os_name</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.os.name&#39;</span><span class="p">,</span> <span class="n">os_name</span><span class="p">)</span>
    <span class="n">os_version</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s">&#39;java.os.version&#39;</span><span class="p">,</span> <span class="n">os_version</span><span class="p">)</span>
    <span class="n">osinfo</span> <span class="o">=</span> <span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span>

    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="n">osinfo</span>

<span class="c">### System name aliasing</span>
</div>
<div class="viewcode-block" id="system_alias"><a class="viewcode-back" href="../platform.html#platform.system_alias">[docs]</a><span class="k">def</span> <span class="nf">system_alias</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Returns (system, release, version) aliased to common</span>
<span class="sd">        marketing names used for some systems.</span>

<span class="sd">        It also does some reordering of the information in some cases</span>
<span class="sd">        where it would otherwise cause confusion.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Rhapsody&#39;</span><span class="p">:</span>
        <span class="c"># Apple&#39;s BSD derivative</span>
        <span class="c"># XXX How can we determine the marketing release number ?</span>
        <span class="k">return</span> <span class="s">&#39;MacOS X Server&#39;</span><span class="p">,</span> <span class="n">system</span><span class="o">+</span><span class="n">release</span><span class="p">,</span> <span class="n">version</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;SunOS&#39;</span><span class="p">:</span>
        <span class="c"># Sun&#39;s OS</span>
        <span class="k">if</span> <span class="n">release</span> <span class="o">&lt;</span> <span class="s">&#39;5&#39;</span><span class="p">:</span>
            <span class="c"># These releases use the old name SunOS</span>
            <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>
        <span class="c"># Modify release (marketing release = SunOS release - 3)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="n">major</span> <span class="o">-</span> <span class="mi">3</span>
                <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">major</span><span class="p">)</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">release</span> <span class="o">&lt;</span> <span class="s">&#39;6&#39;</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># XXX Whatever the new SunOS marketing name is...</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Solaris&#39;</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;IRIX64&#39;</span><span class="p">:</span>
        <span class="c"># IRIX reports IRIX64 on platforms with 64-bit support; yet it</span>
        <span class="c"># is really a version and not a different platform, since 32-bit</span>
        <span class="c"># apps are also supported..</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;IRIX&#39;</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="o">+</span> <span class="s">&#39; (64bit)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;64bit&#39;</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c"># In case one of the other tricks</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Windows&#39;</span>

    <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

<span class="c">### Various internal helpers</span>
</div>
<span class="k">def</span> <span class="nf">_platform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Helper to format the platform string in a filename</span>
<span class="sd">        compatible format e.g. &quot;system-version-machine&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Format the platform string</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>

    <span class="c"># Cleanup some possible filename obstacles...</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>

    <span class="c"># No need to report &#39;unknown&#39; information...</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;unknown&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c"># Fold &#39;--&#39;s and remove trailing &#39;-&#39;</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cleaned</span> <span class="o">==</span> <span class="n">platform</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">cleaned</span>
    <span class="k">while</span> <span class="n">platform</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">platform</span>

<span class="k">def</span> <span class="nf">_node</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Helper to determine the node name of this machine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">socket</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c"># No sockets...</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="c"># Still not working...</span>
        <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">_follow_symlinks</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; In case filepath is a symlink, follow it until a</span>
<span class="sd">        real file is reached.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">filepath</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">filepath</span>

<span class="k">def</span> <span class="nf">_syscmd_uname</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Interface to the system&#39;s uname command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;dos&#39;</span><span class="p">,</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c"># XXX Others too ?</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&#39;uname </span><span class="si">%s</span><span class="s"> 2&gt; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">DEV_NULL</span><span class="p">))</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">or</span> <span class="n">rc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">_syscmd_file</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Interface to the system&#39;s file command.</span>

<span class="sd">        The function uses the -b option of the file command to have it</span>
<span class="sd">        omit the filename in its output. Follow the symlinks. It returns</span>
<span class="sd">        default in case the command should fail.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;dos&#39;</span><span class="p">,</span> <span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c"># XXX Others too ?</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">_follow_symlinks</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">],</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;latin-1&#39;</span><span class="p">)</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">or</span> <span class="n">rc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>

<span class="c">### Information about the used architecture</span>

<span class="c"># Default values for architecture; non-empty strings override the</span>
<span class="c"># defaults given as parameters</span>
<span class="n">_default_architecture</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;win32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;WindowsPE&#39;</span><span class="p">),</span>
    <span class="s">&#39;win16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Windows&#39;</span><span class="p">),</span>
    <span class="s">&#39;dos&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;MSDOS&#39;</span><span class="p">),</span>
<span class="p">}</span>

<div class="viewcode-block" id="architecture"><a class="viewcode-back" href="../platform.html#platform.architecture">[docs]</a><span class="k">def</span> <span class="nf">architecture</span><span class="p">(</span><span class="n">executable</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">bits</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Queries the given executable (defaults to the Python interpreter</span>
<span class="sd">        binary) for various architecture information.</span>

<span class="sd">        Returns a tuple (bits, linkage) which contains information about</span>
<span class="sd">        the bit architecture and the linkage format used for the</span>
<span class="sd">        executable. Both values are returned as strings.</span>

<span class="sd">        Values that cannot be determined are returned as given by the</span>
<span class="sd">        parameter presets. If bits is given as &#39;&#39;, the sizeof(pointer)</span>
<span class="sd">        (or sizeof(long) on Python version &lt; 1.5.2) is used as</span>
<span class="sd">        indicator for the supported pointer size.</span>

<span class="sd">        The function relies on the system&#39;s &quot;file&quot; command to do the</span>
<span class="sd">        actual work. This is available on most if not all Unix</span>
<span class="sd">        platforms. On some non-Unix platforms where the &quot;file&quot; command</span>
<span class="sd">        does not exist and the executable is set to the Python interpreter</span>
<span class="sd">        binary defaults from _default_architecture are used.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Use the sizeof(pointer) as default number of bits if nothing</span>
    <span class="c"># else is given as default.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">bits</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">struct</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s">&#39;P&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="c"># Older installations can only query longs</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;bit&#39;</span>

    <span class="c"># Get data from the &#39;file&#39; system command</span>
    <span class="k">if</span> <span class="n">executable</span><span class="p">:</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">_syscmd_file</span><span class="p">(</span><span class="n">executable</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fileout</span> <span class="ow">and</span> \
       <span class="n">executable</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">:</span>
        <span class="c"># &quot;file&quot; command did not return anything; we&#39;ll try to provide</span>
        <span class="c"># some sensible defaults then...</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="n">_default_architecture</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">_default_architecture</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">bits</span> <span class="o">=</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
                <span class="n">linkage</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">return</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span>

    <span class="k">if</span> <span class="s">&#39;executable&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="c"># Format not supported</span>
        <span class="k">return</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span>

    <span class="c"># Bits</span>
    <span class="k">if</span> <span class="s">&#39;32-bit&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s">&#39;32bit&#39;</span>
    <span class="k">elif</span> <span class="s">&#39;N32&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="c"># On Irix only</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s">&#39;n32bit&#39;</span>
    <span class="k">elif</span> <span class="s">&#39;64-bit&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s">&#39;64bit&#39;</span>

    <span class="c"># Linkage</span>
    <span class="k">if</span> <span class="s">&#39;ELF&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">linkage</span> <span class="o">=</span> <span class="s">&#39;ELF&#39;</span>
    <span class="k">elif</span> <span class="s">&#39;PE&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="c"># E.g. Windows uses this format</span>
        <span class="k">if</span> <span class="s">&#39;Windows&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
            <span class="n">linkage</span> <span class="o">=</span> <span class="s">&#39;WindowsPE&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">linkage</span> <span class="o">=</span> <span class="s">&#39;PE&#39;</span>
    <span class="k">elif</span> <span class="s">&#39;COFF&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">linkage</span> <span class="o">=</span> <span class="s">&#39;COFF&#39;</span>
    <span class="k">elif</span> <span class="s">&#39;MS-DOS&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">linkage</span> <span class="o">=</span> <span class="s">&#39;MSDOS&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># XXX the A.OUT format also falls under this class...</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span>

<span class="c">### Portable uname() interface</span>
</div>
<span class="n">uname_result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;uname_result&quot;</span><span class="p">,</span>
                    <span class="s">&quot;system node release version machine processor&quot;</span><span class="p">)</span>

<span class="n">_uname_cache</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="uname"><a class="viewcode-back" href="../platform.html#platform.uname">[docs]</a><span class="k">def</span> <span class="nf">uname</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Fairly portable uname interface. Returns a tuple</span>
<span class="sd">        of strings (system, node, release, version, machine, processor)</span>
<span class="sd">        identifying the underlying platform.</span>

<span class="sd">        Note that unlike the os.uname function this also returns</span>
<span class="sd">        possible processor information as an additional tuple entry.</span>

<span class="sd">        Entries which cannot be determined are set to &#39;&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_uname_cache</span>
    <span class="n">no_os_uname</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">_uname_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_uname_cache</span>

    <span class="n">processor</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># Get some infos from the builtin os.uname API...</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">no_os_uname</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">no_os_uname</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span><span class="p">))):</span>
        <span class="c"># Hmm, no there is either no uname or uname has returned</span>
        <span class="c">#&#39;unknowns&#39;... we&#39;ll have to poke around the system then.</span>
        <span class="k">if</span> <span class="n">no_os_uname</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>
            <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">_node</span><span class="p">()</span>
            <span class="n">machine</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="n">use_syscmd_ver</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c"># Try win32_ver() on win32 platforms</span>
        <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span> <span class="o">=</span> <span class="n">win32_ver</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">release</span> <span class="ow">and</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">use_syscmd_ver</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># Try to use the PROCESSOR_* environment variables</span>
            <span class="c"># available on Win XP and later; see</span>
            <span class="c"># http://support.microsoft.com/kb/888731 and</span>
            <span class="c"># http://www.geocities.com/rick_lively/MANUALS/ENV/MSWIN/PROCESSI.HTM</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">machine</span><span class="p">:</span>
                <span class="c"># WOW64 processes mask the native architecture</span>
                <span class="k">if</span> <span class="s">&quot;PROCESSOR_ARCHITEW6432&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                    <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;PROCESSOR_ARCHITEW6432&quot;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PROCESSOR_ARCHITECTURE&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">processor</span><span class="p">:</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PROCESSOR_IDENTIFIER&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>

        <span class="c"># Try the &#39;ver&#39; system command available on some</span>
        <span class="c"># platforms</span>
        <span class="k">if</span> <span class="n">use_syscmd_ver</span><span class="p">:</span>
            <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">_syscmd_ver</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
            <span class="c"># Normalize system to what win32_ver() normally returns</span>
            <span class="c"># (_syscmd_ver() tends to return the vendor name as well)</span>
            <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Microsoft Windows&#39;</span><span class="p">:</span>
                <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Windows&#39;</span>
            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Microsoft&#39;</span> <span class="ow">and</span> <span class="n">release</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span><span class="p">:</span>
                <span class="c"># Under Windows Vista and Windows Server 2008,</span>
                <span class="c"># Microsoft changed the output of the ver command. The</span>
                <span class="c"># release is no longer printed.  This causes the</span>
                <span class="c"># system and release to be misidentified.</span>
                <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Windows&#39;</span>
                <span class="k">if</span> <span class="s">&#39;6.0&#39;</span> <span class="o">==</span> <span class="n">version</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;Vista&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># In case we still don&#39;t know anything useful, we&#39;ll try to</span>
        <span class="c"># help ourselves</span>
        <span class="k">if</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">,</span> <span class="s">&#39;win16&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;win32&#39;</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;32bit&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;16bit&#39;</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Windows&#39;</span>

        <span class="k">elif</span> <span class="n">system</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;java&#39;</span><span class="p">:</span>
            <span class="n">release</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="n">osinfo</span> <span class="o">=</span> <span class="n">java_ver</span><span class="p">()</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Java&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vminfo</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">vendor</span>

    <span class="c"># System specific extensions</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;OpenVMS&#39;</span><span class="p">:</span>
        <span class="c"># OpenVMS seems to have release and version mixed up</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">release</span> <span class="ow">or</span> <span class="n">release</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">version</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c"># Get processor information</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">vms_lib</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">csid</span><span class="p">,</span> <span class="n">cpu_number</span> <span class="o">=</span> <span class="n">vms_lib</span><span class="o">.</span><span class="n">getsyi</span><span class="p">(</span><span class="s">&#39;SYI$_CPU&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cpu_number</span> <span class="o">&gt;=</span> <span class="mi">128</span><span class="p">):</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="s">&#39;Alpha&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="s">&#39;VAX&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">processor</span><span class="p">:</span>
        <span class="c"># Get processor information from the uname system command</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="n">_syscmd_uname</span><span class="p">(</span><span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c">#If any unknowns still exist, replace them with &#39;&#39;s, which are more portable</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">release</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">machine</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">processor</span> <span class="o">==</span> <span class="s">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c">#  normalize name</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Microsoft&#39;</span> <span class="ow">and</span> <span class="n">release</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s">&#39;Windows&#39;</span>
        <span class="n">release</span> <span class="o">=</span> <span class="s">&#39;Vista&#39;</span>

    <span class="n">_uname_cache</span> <span class="o">=</span> <span class="n">uname_result</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span>
                                <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_uname_cache</span>

<span class="c">### Direct interfaces to some of the uname() return values</span>
</div>
<div class="viewcode-block" id="system"><a class="viewcode-back" href="../platform.html#platform.system">[docs]</a><span class="k">def</span> <span class="nf">system</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the system/OS name, e.g. &#39;Linux&#39;, &#39;Windows&#39; or &#39;Java&#39;.</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">system</span>
</div>
<div class="viewcode-block" id="node"><a class="viewcode-back" href="../platform.html#platform.node">[docs]</a><span class="k">def</span> <span class="nf">node</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the computer&#39;s network name (which may not be fully</span>
<span class="sd">        qualified)</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">node</span>
</div>
<div class="viewcode-block" id="release"><a class="viewcode-back" href="../platform.html#platform.release">[docs]</a><span class="k">def</span> <span class="nf">release</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the system&#39;s release, e.g. &#39;2.2.0&#39; or &#39;NT&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">release</span>
</div>
<div class="viewcode-block" id="version"><a class="viewcode-back" href="../platform.html#platform.version">[docs]</a><span class="k">def</span> <span class="nf">version</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the system&#39;s release version, e.g. &#39;#3 on degas&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">version</span>
</div>
<div class="viewcode-block" id="machine"><a class="viewcode-back" href="../platform.html#platform.machine">[docs]</a><span class="k">def</span> <span class="nf">machine</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the machine type, e.g. &#39;i386&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">machine</span>
</div>
<div class="viewcode-block" id="processor"><a class="viewcode-back" href="../platform.html#platform.processor">[docs]</a><span class="k">def</span> <span class="nf">processor</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the (true) processor name, e.g. &#39;amdk6&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be</span>
<span class="sd">        determined. Note that many platforms do not provide this</span>
<span class="sd">        information or simply return the same value as for machine(),</span>
<span class="sd">        e.g.  NetBSD does this.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">processor</span>

<span class="c">### Various APIs for extracting information from sys.version</span>
</div>
<span class="n">_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">r&#39;([\w.+]+)\s*&#39;</span>
    <span class="s">&#39;\(#?([^,]+),\s*([\w ]+),\s*([\w :]+)\)\s*&#39;</span>
    <span class="s">&#39;\[([^\]]+)\]?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<span class="n">_ironpython_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">r&#39;IronPython\s*&#39;</span>
    <span class="s">&#39;([\d\.]+)&#39;</span>
    <span class="s">&#39;(?: \(([\d\.]+)\))?&#39;</span>
    <span class="s">&#39; on (.NET [\d\.]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<span class="c"># IronPython covering 2.6 and 2.7</span>
<span class="n">_ironpython26_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">r&#39;([\d.]+)\s*&#39;</span>
    <span class="s">&#39;\(IronPython\s*&#39;</span>
    <span class="s">&#39;[\d.]+\s*&#39;</span>
    <span class="s">&#39;\(([\d.]+)\) on ([\w.]+ [\d.]+(?: \(\d+-bit\))?)\)&#39;</span>
<span class="p">)</span>

<span class="n">_pypy_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s">r&#39;([\w.+]+)\s*&#39;</span>
    <span class="s">&#39;\(#?([^,]+),\s*([\w ]+),\s*([\w :]+)\)\s*&#39;</span>
    <span class="s">&#39;\[PyPy [^\]]+\]?&#39;</span><span class="p">)</span>

<span class="n">_sys_version_cache</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">_sys_version</span><span class="p">(</span><span class="n">sys_version</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Returns a parsed version of Python&#39;s sys.version as tuple</span>
<span class="sd">        (name, version, branch, revision, buildno, builddate, compiler)</span>
<span class="sd">        referring to the Python implementation name, version, branch,</span>
<span class="sd">        revision, build number, build date/time as string and the compiler</span>
<span class="sd">        identification string.</span>

<span class="sd">        Note that unlike the Python sys.version, the returned value</span>
<span class="sd">        for the Python version will always include the patchlevel (it</span>
<span class="sd">        defaults to &#39;.0&#39;).</span>

<span class="sd">        The function returns empty strings for tuple entries that</span>
<span class="sd">        cannot be determined.</span>

<span class="sd">        sys_version may be given to parse an alternative version</span>
<span class="sd">        string, e.g. if the version was read from a different Python</span>
<span class="sd">        interpreter.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Get the Python version</span>
    <span class="k">if</span> <span class="n">sys_version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sys_version</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>

    <span class="c"># Try the cache first</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_sys_version_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sys_version</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c"># Parse it</span>
    <span class="k">if</span> <span class="s">&#39;IronPython&#39;</span> <span class="ow">in</span> <span class="n">sys_version</span><span class="p">:</span>
        <span class="c"># IronPython</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;IronPython&#39;</span>
        <span class="k">if</span> <span class="n">sys_version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;IronPython&#39;</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_ironpython_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_ironpython26_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&#39;failed to parse IronPython sys.version: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>

        <span class="n">version</span><span class="p">,</span> <span class="n">alt_version</span><span class="p">,</span> <span class="n">compiler</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">buildno</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">builddate</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;java&#39;</span><span class="p">):</span>
        <span class="c"># Jython</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Jython&#39;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&#39;failed to parse Jython sys.version: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">buildtime</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>

    <span class="k">elif</span> <span class="s">&quot;PyPy&quot;</span> <span class="ow">in</span> <span class="n">sys_version</span><span class="p">:</span>
        <span class="c"># PyPy</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PyPy&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_pypy_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;failed to parse PyPy sys.version: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                             <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">buildtime</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c"># CPython</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&#39;failed to parse CPython sys.version: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">buildtime</span><span class="p">,</span> <span class="n">compiler</span> <span class="o">=</span> \
              <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CPython&#39;</span>
        <span class="n">builddate</span> <span class="o">=</span> <span class="n">builddate</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">buildtime</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;_mercurial&#39;</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_mercurial</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;subversion&#39;</span><span class="p">):</span>
        <span class="c"># sys.subversion was added in Python 2.5</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">subversion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># Add the patchlevel version if missing</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="c"># Build and cache the result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">compiler</span><span class="p">)</span>
    <span class="n">_sys_version_cache</span><span class="p">[</span><span class="n">sys_version</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="python_implementation"><a class="viewcode-back" href="../platform.html#platform.python_implementation">[docs]</a><span class="k">def</span> <span class="nf">python_implementation</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the Python implementation.</span>

<span class="sd">        Currently, the following implementations are identified:</span>
<span class="sd">          &#39;CPython&#39; (C implementation of Python),</span>
<span class="sd">          &#39;IronPython&#39; (.NET implementation of Python),</span>
<span class="sd">          &#39;Jython&#39; (Java implementation of Python),</span>
<span class="sd">          &#39;PyPy&#39; (Python implementation of Python).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="python_version"><a class="viewcode-back" href="../platform.html#platform.python_version">[docs]</a><span class="k">def</span> <span class="nf">python_version</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the Python version as string &#39;major.minor.patchlevel&#39;</span>

<span class="sd">        Note that unlike the Python sys.version, the returned value</span>
<span class="sd">        will always include the patchlevel (it defaults to 0).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="python_version_tuple"><a class="viewcode-back" href="../platform.html#platform.python_version_tuple">[docs]</a><span class="k">def</span> <span class="nf">python_version_tuple</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the Python version as tuple (major, minor, patchlevel)</span>
<span class="sd">        of strings.</span>

<span class="sd">        Note that unlike the Python sys.version, the returned value</span>
<span class="sd">        will always include the patchlevel (it defaults to 0).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_sys_version</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="python_branch"><a class="viewcode-back" href="../platform.html#platform.python_branch">[docs]</a><span class="k">def</span> <span class="nf">python_branch</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the Python implementation</span>
<span class="sd">        branch.</span>

<span class="sd">        For CPython this is the Subversion branch from which the</span>
<span class="sd">        Python binary was built.</span>

<span class="sd">        If not available, an empty string is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="python_revision"><a class="viewcode-back" href="../platform.html#platform.python_revision">[docs]</a><span class="k">def</span> <span class="nf">python_revision</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the Python implementation</span>
<span class="sd">        revision.</span>

<span class="sd">        For CPython this is the Subversion revision from which the</span>
<span class="sd">        Python binary was built.</span>

<span class="sd">        If not available, an empty string is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="python_build"><a class="viewcode-back" href="../platform.html#platform.python_build">[docs]</a><span class="k">def</span> <span class="nf">python_build</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a tuple (buildno, builddate) stating the Python</span>
<span class="sd">        build number and date as strings.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="python_compiler"><a class="viewcode-back" href="../platform.html#platform.python_compiler">[docs]</a><span class="k">def</span> <span class="nf">python_compiler</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the compiler used for compiling</span>
<span class="sd">        Python.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">6</span><span class="p">]</span>

<span class="c">### The Opus Magnum of platform strings :-)</span>
</div>
<span class="n">_platform_cache</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="platform"><a class="viewcode-back" href="../platform.html#platform.platform">[docs]</a><span class="k">def</span> <span class="nf">platform</span><span class="p">(</span><span class="n">aliased</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">terse</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Returns a single string identifying the underlying platform</span>
<span class="sd">        with as much useful information as possible (but no more :).</span>

<span class="sd">        The output is intended to be human readable rather than</span>
<span class="sd">        machine parseable. It may look different on different</span>
<span class="sd">        platforms and this is intended.</span>

<span class="sd">        If &quot;aliased&quot; is true, the function will use aliases for</span>
<span class="sd">        various platforms that report system names which differ from</span>
<span class="sd">        their common names, e.g. SunOS will be reported as</span>
<span class="sd">        Solaris. The system_alias() function is used to implement</span>
<span class="sd">        this.</span>

<span class="sd">        Setting terse to true causes the function to return only the</span>
<span class="sd">        absolute minimum information needed to identify the platform.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_platform_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">aliased</span><span class="p">,</span> <span class="n">terse</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c"># Get uname information and then apply platform specific cosmetics</span>
    <span class="c"># to it...</span>
    <span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span> <span class="o">=</span> <span class="n">uname</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">machine</span> <span class="o">==</span> <span class="n">processor</span><span class="p">:</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">aliased</span><span class="p">:</span>
        <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">system_alias</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span><span class="p">:</span>
        <span class="c"># MS platforms</span>
        <span class="n">rel</span><span class="p">,</span> <span class="n">vers</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span> <span class="o">=</span> <span class="n">win32_ver</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Linux&#39;</span><span class="p">,):</span>
        <span class="c"># Linux based systems</span>
        <span class="n">distname</span><span class="p">,</span> <span class="n">distversion</span><span class="p">,</span> <span class="n">distid</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span>
                                 <span class="s">&#39;with&#39;</span><span class="p">,</span>
                                 <span class="n">distname</span><span class="p">,</span> <span class="n">distversion</span><span class="p">,</span> <span class="n">distid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If the distribution name is unknown check for libc vs. glibc</span>
            <span class="n">libcname</span><span class="p">,</span> <span class="n">libcversion</span> <span class="o">=</span> <span class="n">libc_ver</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span>
                                 <span class="s">&#39;with&#39;</span><span class="p">,</span>
                                 <span class="n">libcname</span><span class="o">+</span><span class="n">libcversion</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;Java&#39;</span><span class="p">:</span>
        <span class="c"># Java platforms</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="p">(</span><span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span><span class="p">)</span> <span class="o">=</span> <span class="n">java_ver</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">terse</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os_name</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span>
                                 <span class="s">&#39;on&#39;</span><span class="p">,</span>
                                 <span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;MacOS&#39;</span><span class="p">:</span>
        <span class="c"># MacOS platforms</span>
        <span class="k">if</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Generic handler</span>
        <span class="k">if</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span> <span class="o">=</span> <span class="n">architecture</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span>
                                 <span class="n">processor</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span><span class="p">)</span>

    <span class="n">_platform_cache</span><span class="p">[(</span><span class="n">aliased</span><span class="p">,</span> <span class="n">terse</span><span class="p">)]</span> <span class="o">=</span> <span class="n">platform</span>
    <span class="k">return</span> <span class="n">platform</span>

<span class="c">### Command line interface</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Default is to print the aliased verbose platform string</span>
    <span class="n">terse</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;terse&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s">&#39;--terse&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">aliased</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;nonaliased&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;--nonaliased&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="n">aliased</span><span class="p">,</span> <span class="n">terse</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>