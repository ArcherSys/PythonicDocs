

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ipaddress &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>ipaddress</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for ipaddress</h1><div class="highlight"><pre>
<span class="c"># Copyright 2007 Google Inc.</span>
<span class="c">#  Licensed to PSF under a Contributor Agreement.</span>

<span class="sd">&quot;&quot;&quot;A fast, lightweight IPv4/IPv6 manipulation library in Python.</span>

<span class="sd">This library is used to create/poke/manipulate IPv4 and IPv6 addresses</span>
<span class="sd">and networks.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.0&#39;</span>


<span class="kn">import</span> <span class="nn">functools</span>

<span class="n">IPV4LENGTH</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">IPV6LENGTH</span> <span class="o">=</span> <span class="mi">128</span>

<div class="viewcode-block" id="AddressValueError"><a class="viewcode-back" href="../ipaddress.html#ipaddress.AddressValueError">[docs]</a><span class="k">class</span> <span class="nc">AddressValueError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Value Error related to the address.&quot;&quot;&quot;</span>

</div>
<div class="viewcode-block" id="NetmaskValueError"><a class="viewcode-back" href="../ipaddress.html#ipaddress.NetmaskValueError">[docs]</a><span class="k">class</span> <span class="nc">NetmaskValueError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Value Error related to the netmask.&quot;&quot;&quot;</span>

</div>
<div class="viewcode-block" id="ip_address"><a class="viewcode-back" href="../ipaddress.html#ipaddress.ip_address">[docs]</a><span class="k">def</span> <span class="nf">ip_address</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take an IP string/int and return an object of the correct type.</span>

<span class="sd">    Args:</span>
<span class="sd">        address: A string or integer, the IP address.  Either IPv4 or</span>
<span class="sd">          IPv6 addresses may be supplied; integers less than 2**32 will</span>
<span class="sd">          be considered to be IPv4 by default.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An IPv4Address or IPv6Address object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the *address* passed isn&#39;t either a v4 or a v6</span>
<span class="sd">          address</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">AddressValueError</span><span class="p">,</span> <span class="n">NetmaskValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">AddressValueError</span><span class="p">,</span> <span class="n">NetmaskValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> does not appear to be an IPv4 or IPv6 address&#39;</span> <span class="o">%</span>
                     <span class="n">address</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ip_network"><a class="viewcode-back" href="../ipaddress.html#ipaddress.ip_network">[docs]</a><span class="k">def</span> <span class="nf">ip_network</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take an IP string/int and return an object of the correct type.</span>

<span class="sd">    Args:</span>
<span class="sd">        address: A string or integer, the IP network.  Either IPv4 or</span>
<span class="sd">          IPv6 networks may be supplied; integers less than 2**32 will</span>
<span class="sd">          be considered to be IPv4 by default.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An IPv4Network or IPv6Network object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the string passed isn&#39;t either a v4 or a v6</span>
<span class="sd">          address. Or if the network has host bits set.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">AddressValueError</span><span class="p">,</span> <span class="n">NetmaskValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">AddressValueError</span><span class="p">,</span> <span class="n">NetmaskValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> does not appear to be an IPv4 or IPv6 network&#39;</span> <span class="o">%</span>
                     <span class="n">address</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ip_interface"><a class="viewcode-back" href="../ipaddress.html#ipaddress.ip_interface">[docs]</a><span class="k">def</span> <span class="nf">ip_interface</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take an IP string/int and return an object of the correct type.</span>

<span class="sd">    Args:</span>
<span class="sd">        address: A string or integer, the IP address.  Either IPv4 or</span>
<span class="sd">          IPv6 addresses may be supplied; integers less than 2**32 will</span>
<span class="sd">          be considered to be IPv4 by default.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An IPv4Interface or IPv6Interface object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the string passed isn&#39;t either a v4 or a v6</span>
<span class="sd">          address.</span>

<span class="sd">    Notes:</span>
<span class="sd">        The IPv?Interface classes describe an Address on a particular</span>
<span class="sd">        Network, so they&#39;re basically a combination of both the Address</span>
<span class="sd">        and Network classes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IPv4Interface</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">AddressValueError</span><span class="p">,</span> <span class="n">NetmaskValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IPv6Interface</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">AddressValueError</span><span class="p">,</span> <span class="n">NetmaskValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> does not appear to be an IPv4 or IPv6 interface&#39;</span> <span class="o">%</span>
                     <span class="n">address</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="v4_int_to_packed"><a class="viewcode-back" href="../ipaddress.html#ipaddress.v4_int_to_packed">[docs]</a><span class="k">def</span> <span class="nf">v4_int_to_packed</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent an address as 4 packed bytes in network (big-endian) order.</span>

<span class="sd">    Args:</span>
<span class="sd">        address: An integer representation of an IPv4 IP address.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The integer address packed as 4 bytes in network (big-endian) order.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the integer is negative or too large to be an</span>
<span class="sd">          IPv4 IP address.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">address</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Address negative or too large for IPv4&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="v6_int_to_packed"><a class="viewcode-back" href="../ipaddress.html#ipaddress.v6_int_to_packed">[docs]</a><span class="k">def</span> <span class="nf">v6_int_to_packed</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent an address as 16 packed bytes in network (big-endian) order.</span>

<span class="sd">    Args:</span>
<span class="sd">        address: An integer representation of an IPv6 IP address.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The integer address packed as 16 bytes in network (big-endian) order.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">address</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Address negative or too large for IPv6&quot;</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_split_optional_netmask</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper to split the netmask and raise AddressValueError if needed&quot;&quot;&quot;</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&quot;Only one &#39;/&#39; permitted in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">address</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">addr</span>


<span class="k">def</span> <span class="nf">_find_address_range</span><span class="p">(</span><span class="n">addresses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find a sequence of IPv#Address.</span>

<span class="sd">    Args:</span>
<span class="sd">        addresses: a list of IPv#Address objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing the first and last IP addresses in the sequence.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">last</span> <span class="o">=</span> <span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">ip</span><span class="o">.</span><span class="n">_ip</span> <span class="o">==</span> <span class="n">last</span><span class="o">.</span><span class="n">_ip</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_count_righthand_zero_bits</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">bits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Count the number of zero bits on the right hand side.</span>

<span class="sd">    Args:</span>
<span class="sd">        number: an integer.</span>
<span class="sd">        bits: maximum number of bits to count.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The number of zero bits on the right hand side of the number.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bits</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bits</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="c"># All bits of interest were zero, even if there are more in the number</span>
    <span class="k">return</span> <span class="n">bits</span>


<div class="viewcode-block" id="summarize_address_range"><a class="viewcode-back" href="../ipaddress.html#ipaddress.summarize_address_range">[docs]</a><span class="k">def</span> <span class="nf">summarize_address_range</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summarize a network range given the first and last IP addresses.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; list(summarize_address_range(IPv4Address(&#39;192.0.2.0&#39;),</span>
<span class="sd">        ...                              IPv4Address(&#39;192.0.2.130&#39;)))</span>
<span class="sd">        ...                                #doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        [IPv4Network(&#39;192.0.2.0/25&#39;), IPv4Network(&#39;192.0.2.128/31&#39;),</span>
<span class="sd">         IPv4Network(&#39;192.0.2.130/32&#39;)]</span>

<span class="sd">    Args:</span>
<span class="sd">        first: the first IPv4Address or IPv6Address in the range.</span>
<span class="sd">        last: the last IPv4Address or IPv6Address in the range.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An iterator of the summarized IPv(4|6) network objects.</span>

<span class="sd">    Raise:</span>
<span class="sd">        TypeError:</span>
<span class="sd">            If the first and last objects are not IP addresses.</span>
<span class="sd">            If the first and last objects are not the same version.</span>
<span class="sd">        ValueError:</span>
<span class="sd">            If the last object is not greater than the first.</span>
<span class="sd">            If the version of the first address is not 4 or 6.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">)</span> <span class="ow">and</span>
             <span class="nb">isinstance</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;first and last must be IP addresses, not networks&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">last</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&quot;</span> <span class="o">%</span> <span class="p">(</span>
                         <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">first</span> <span class="o">&gt;</span> <span class="n">last</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;last IP address must be greater than first&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">IPv4Network</span>
    <span class="k">elif</span> <span class="n">first</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">IPv6Network</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknown IP version&#39;</span><span class="p">)</span>

    <span class="n">ip_bits</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">_max_prefixlen</span>
    <span class="n">first_int</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">_ip</span>
    <span class="n">last_int</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">_ip</span>
    <span class="k">while</span> <span class="n">first_int</span> <span class="o">&lt;=</span> <span class="n">last_int</span><span class="p">:</span>
        <span class="n">nbits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">_count_righthand_zero_bits</span><span class="p">(</span><span class="n">first_int</span><span class="p">,</span> <span class="n">ip_bits</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">last_int</span> <span class="o">-</span> <span class="n">first_int</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">ip</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">ip_bits</span> <span class="o">-</span> <span class="n">nbits</span><span class="p">))</span>
        <span class="k">yield</span> <span class="n">net</span>
        <span class="n">first_int</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">nbits</span>
        <span class="k">if</span> <span class="n">first_int</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">ip</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">first_int</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_collapse_addresses_recursive</span><span class="p">(</span><span class="n">addresses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loops through the addresses, collapsing concurrent netblocks.</span>

<span class="sd">    Example:</span>

<span class="sd">        ip1 = IPv4Network(&#39;192.0.2.0/26&#39;)</span>
<span class="sd">        ip2 = IPv4Network(&#39;192.0.2.64/26&#39;)</span>
<span class="sd">        ip3 = IPv4Network(&#39;192.0.2.128/26&#39;)</span>
<span class="sd">        ip4 = IPv4Network(&#39;192.0.2.192/26&#39;)</span>

<span class="sd">        _collapse_addresses_recursive([ip1, ip2, ip3, ip4]) -&gt;</span>
<span class="sd">          [IPv4Network(&#39;192.0.2.0/24&#39;)]</span>

<span class="sd">        This shouldn&#39;t be called directly; it is called via</span>
<span class="sd">          collapse_addresses([]).</span>

<span class="sd">    Args:</span>
<span class="sd">        addresses: A list of IPv4Network&#39;s or IPv6Network&#39;s</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of IPv4Network&#39;s or IPv6Network&#39;s depending on what we were</span>
<span class="sd">        passed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">last_addr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">ret_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">optimized</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">cur_addr</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret_array</span><span class="p">:</span>
                <span class="n">last_addr</span> <span class="o">=</span> <span class="n">cur_addr</span>
                <span class="n">ret_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_addr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">cur_addr</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&gt;=</span> <span class="n">last_addr</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">and</span>
                <span class="n">cur_addr</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="o">&lt;=</span> <span class="n">last_addr</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">):</span>
                <span class="n">optimized</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">cur_addr</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">last_addr</span><span class="o">.</span><span class="n">supernet</span><span class="p">()</span><span class="o">.</span><span class="n">subnets</span><span class="p">())[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ret_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_addr</span> <span class="o">=</span> <span class="n">last_addr</span><span class="o">.</span><span class="n">supernet</span><span class="p">()</span>
                <span class="n">optimized</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_addr</span> <span class="o">=</span> <span class="n">cur_addr</span>
                <span class="n">ret_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_addr</span><span class="p">)</span>

        <span class="n">addresses</span> <span class="o">=</span> <span class="n">ret_array</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">optimized</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addresses</span>


<div class="viewcode-block" id="collapse_addresses"><a class="viewcode-back" href="../ipaddress.html#ipaddress.collapse_addresses">[docs]</a><span class="k">def</span> <span class="nf">collapse_addresses</span><span class="p">(</span><span class="n">addresses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Collapse a list of IP objects.</span>

<span class="sd">    Example:</span>
<span class="sd">        collapse_addresses([IPv4Network(&#39;192.0.2.0/25&#39;),</span>
<span class="sd">                            IPv4Network(&#39;192.0.2.128/25&#39;)]) -&gt;</span>
<span class="sd">                           [IPv4Network(&#39;192.0.2.0/24&#39;)]</span>

<span class="sd">    Args:</span>
<span class="sd">        addresses: An iterator of IPv4Network or IPv6Network objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An iterator of the collapsed IPv(4|6)Network objects.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If passed a list of mixed version objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">addrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ips</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># split IP addresses and networks</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ips</span> <span class="ow">and</span> <span class="n">ips</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">ip</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">ip</span><span class="p">,</span> <span class="n">ips</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ip</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">==</span> <span class="n">ip</span><span class="o">.</span><span class="n">_max_prefixlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ips</span> <span class="ow">and</span> <span class="n">ips</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">ip</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">ip</span><span class="p">,</span> <span class="n">ips</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">ips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nets</span> <span class="ow">and</span> <span class="n">nets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">ip</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">ip</span><span class="p">,</span> <span class="n">nets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">nets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>

    <span class="c"># sort and dedup</span>
    <span class="n">ips</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ips</span><span class="p">))</span>
    <span class="n">nets</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nets</span><span class="p">))</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ips</span><span class="p">):</span>
        <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="o">=</span> <span class="n">_find_address_range</span><span class="p">(</span><span class="n">ips</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">ips</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">addrs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">summarize_address_range</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_collapse_addresses_recursive</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span>
        <span class="n">addrs</span> <span class="o">+</span> <span class="n">nets</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_BaseNetwork</span><span class="o">.</span><span class="n">_get_networks_key</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="get_mixed_type_key"><a class="viewcode-back" href="../ipaddress.html#ipaddress.get_mixed_type_key">[docs]</a><span class="k">def</span> <span class="nf">get_mixed_type_key</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a key suitable for sorting between networks and addresses.</span>

<span class="sd">    Address and Network objects are not sortable by default; they&#39;re</span>
<span class="sd">    fundamentally different so the expression</span>

<span class="sd">        IPv4Address(&#39;192.0.2.0&#39;) &lt;= IPv4Network(&#39;192.0.2.0/24&#39;)</span>

<span class="sd">    doesn&#39;t make any sense.  There are some times however, where you may wish</span>
<span class="sd">    to have ipaddress sort these for you anyway. If you need to do this, you</span>
<span class="sd">    can use this function as the key= argument to sorted().</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: either a Network or Address object.</span>
<span class="sd">    Returns:</span>
<span class="sd">      appropriate key.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_BaseNetwork</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_networks_key</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">_get_address_key</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>

</div>
<span class="k">class</span> <span class="nc">_TotalOrderingMixin</span><span class="p">:</span>
    <span class="c"># Helper that derives the other comparison operations from</span>
    <span class="c"># __lt__ and __eq__</span>
    <span class="c"># We avoid functools.total_ordering because it doesn&#39;t handle</span>
    <span class="c"># NotImplemented correctly yet (http://bugs.python.org/issue10042)</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">equal</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">equal</span>
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">less</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">less</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">less</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">less</span>
    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">less</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">less</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="n">equal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">equal</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">less</span> <span class="ow">or</span> <span class="n">equal</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">less</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">less</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">less</span>

<span class="k">class</span> <span class="nc">_IPAddressBase</span><span class="p">(</span><span class="n">_TotalOrderingMixin</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The mother class.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exploded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the longhand version of the IP address as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_explode_shorthand_ip_string</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">compressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the shorthand version of the IP address as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%200s</span><span class="s"> has no version specified&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_int_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> (&lt; 0) is not permitted as an IPv</span><span class="si">%d</span><span class="s"> address&quot;</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> (&gt;= 2**</span><span class="si">%d</span><span class="s">) is not permitted as an IPv</span><span class="si">%d</span><span class="s"> address&quot;</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_check_packed_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">expected_len</span><span class="p">):</span>
        <span class="n">address_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">address_len</span> <span class="o">!=</span> <span class="n">expected_len</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%r</span><span class="s"> (len </span><span class="si">%d</span><span class="s"> != </span><span class="si">%d</span><span class="s">) is not permitted as an IPv</span><span class="si">%d</span><span class="s"> address&quot;</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">address_len</span><span class="p">,</span>
                                           <span class="n">expected_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ip_int_from_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefixlen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn the prefix length into a bitwise netmask</span>

<span class="sd">        Args:</span>
<span class="sd">            prefixlen: An integer, the prefix length.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An integer.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span> <span class="o">^</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span> <span class="o">&gt;&gt;</span> <span class="n">prefixlen</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prefix_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return prefix length from the bitwise netmask.</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_int: An integer, the netmask in axpanded bitwise format</span>

<span class="sd">        Returns:</span>
<span class="sd">            An integer, the prefix length.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the input intermingles zeroes &amp; ones</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trailing_zeroes</span> <span class="o">=</span> <span class="n">_count_righthand_zero_bits</span><span class="p">(</span><span class="n">ip_int</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span><span class="p">)</span>
        <span class="n">prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span> <span class="o">-</span> <span class="n">trailing_zeroes</span>
        <span class="n">leading_ones</span> <span class="o">=</span> <span class="n">ip_int</span> <span class="o">&gt;&gt;</span> <span class="n">trailing_zeroes</span>
        <span class="n">all_ones</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">prefixlen</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">leading_ones</span> <span class="o">!=</span> <span class="n">all_ones</span><span class="p">:</span>
            <span class="n">byteslen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span> <span class="o">//</span> <span class="mi">8</span>
            <span class="n">details</span> <span class="o">=</span> <span class="n">ip_int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">byteslen</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Netmask pattern </span><span class="si">%r</span><span class="s"> mixes zeroes &amp; ones&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prefixlen</span>

    <span class="k">def</span> <span class="nf">_report_invalid_netmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netmask_str</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not a valid netmask&#39;</span> <span class="o">%</span> <span class="n">netmask_str</span>
        <span class="k">raise</span> <span class="n">NetmaskValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_prefix_from_prefix_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefixlen_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return prefix length from a numeric string</span>

<span class="sd">        Args:</span>
<span class="sd">            prefixlen_str: The string to be converted</span>

<span class="sd">        Returns:</span>
<span class="sd">            An integer, the prefix length.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NetmaskValueError: If the input is not a valid netmask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># int allows a leading +/- as well as surrounding whitespace,</span>
        <span class="c"># so we ensure that isn&#39;t the case</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_BaseV4</span><span class="o">.</span><span class="n">_DECIMAL_DIGITS</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">prefixlen_str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_invalid_netmask</span><span class="p">(</span><span class="n">prefixlen_str</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prefixlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prefixlen_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_invalid_netmask</span><span class="p">(</span><span class="n">prefixlen_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prefixlen</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_invalid_netmask</span><span class="p">(</span><span class="n">prefixlen_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prefixlen</span>

    <span class="k">def</span> <span class="nf">_prefix_from_ip_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn a netmask/hostmask string into a prefix length</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_str: The netmask/hostmask to be converted</span>

<span class="sd">        Returns:</span>
<span class="sd">            An integer, the prefix length.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NetmaskValueError: If the input is not a valid netmask/hostmask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Parse the netmask/hostmask like an IP address.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ip_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_string</span><span class="p">(</span><span class="n">ip_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AddressValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_invalid_netmask</span><span class="p">(</span><span class="n">ip_str</span><span class="p">)</span>

        <span class="c"># Try matching a netmask (this would be /1*0*/ as a bitwise regexp).</span>
        <span class="c"># Note that the two ambiguous cases (all-ones and all-zeroes) are</span>
        <span class="c"># treated as netmasks.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_from_ip_int</span><span class="p">(</span><span class="n">ip_int</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># Invert the bits, and try matching a /0+1+/ hostmask instead.</span>
        <span class="n">ip_int</span> <span class="o">^=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_from_ip_int</span><span class="p">(</span><span class="n">ip_int</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_invalid_netmask</span><span class="p">(</span><span class="n">ip_str</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_BaseAddress</span><span class="p">(</span><span class="n">_IPAddressBase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A generic IP object.</span>

<span class="sd">    This IP class contains the version independent methods which are</span>
<span class="sd">    used by single IP addresses.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&quot;Unexpected &#39;/&#39; in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">address</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_ip</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&#39;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same type&#39;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_ip</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_ip</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="c"># Shorthand for Integer addition and subtraction. This is not</span>
    <span class="c"># meant to ever support addition/subtraction of addresses.</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_get_address_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_BaseNetwork</span><span class="p">(</span><span class="n">_IPAddressBase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A generic IP network object.</span>

<span class="sd">    This IP class contains the version independent methods which are</span>
<span class="sd">    used by networks.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate Iterator over usable hosts in a network.</span>

<span class="sd">        This is like __iter__ except it doesn&#39;t return the network</span>
<span class="sd">        or broadcast addresses.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>
        <span class="n">broadcast</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">network</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">broadcast</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">network</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>
        <span class="n">broadcast</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">broadcast</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">network</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>
        <span class="n">broadcast</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">network</span> <span class="o">+</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">broadcast</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="n">network</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">broadcast</span> <span class="o">+</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">network</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="n">broadcast</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&#39;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_BaseNetwork</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same type&#39;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">network_address</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">network_address</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">netmask</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">netmask</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">and</span>
                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">netmask</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c"># always false if one is v4 and the other is v6.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c"># dealing with another network.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_BaseNetwork</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c"># dealing with another address</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># address</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span> <span class="o">&lt;=</span>
                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tell if self is partly contained in other.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">in</span> <span class="n">other</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="ow">in</span> <span class="n">other</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">other</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">broadcast_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;broadcast_address&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">|</span>
                                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostmask</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s">&#39;broadcast_address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hostmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;hostmask&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">)</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s">&#39;hostmask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_prefixlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_netmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_hostmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostmask</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of hosts in the current subnet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_address_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Returning bare address objects (rather than interfaces) allows for</span>
        <span class="c"># more consistent behaviour across the network address, broadcast</span>
        <span class="c"># address and individual host addresses.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%200s</span><span class="s"> has no associated address class&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prefixlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span>

    <span class="k">def</span> <span class="nf">address_exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove an address from a larger block.</span>

<span class="sd">        For example:</span>

<span class="sd">            addr1 = ip_network(&#39;192.0.2.0/28&#39;)</span>
<span class="sd">            addr2 = ip_network(&#39;192.0.2.1/32&#39;)</span>
<span class="sd">            addr1.address_exclude(addr2) =</span>
<span class="sd">                [IPv4Network(&#39;192.0.2.0/32&#39;), IPv4Network(&#39;192.0.2.2/31&#39;),</span>
<span class="sd">                IPv4Network(&#39;192.0.2.4/30&#39;), IPv4Network(&#39;192.0.2.8/29&#39;)]</span>

<span class="sd">        or IPv6:</span>

<span class="sd">            addr1 = ip_network(&#39;2001:db8::1/32&#39;)</span>
<span class="sd">            addr2 = ip_network(&#39;2001:db8::1/128&#39;)</span>
<span class="sd">            addr1.address_exclude(addr2) =</span>
<span class="sd">                [ip_network(&#39;2001:db8::1/128&#39;),</span>
<span class="sd">                ip_network(&#39;2001:db8::2/127&#39;),</span>
<span class="sd">                ip_network(&#39;2001:db8::4/126&#39;),</span>
<span class="sd">                ip_network(&#39;2001:db8::8/125&#39;),</span>
<span class="sd">                ...</span>
<span class="sd">                ip_network(&#39;2001:db8:8000::/33&#39;)]</span>

<span class="sd">        Args:</span>
<span class="sd">            other: An IPv4Network or IPv6Network object of the same type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An iterator of the IPv(4|6)Network objects which is self</span>
<span class="sd">            minus other.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If self and other are of differing address</span>
<span class="sd">              versions, or if other is not a network object.</span>
<span class="sd">            ValueError: If other is not completely contained by self.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same version&quot;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_BaseNetwork</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not a network object&quot;</span> <span class="o">%</span> <span class="n">other</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">and</span>
                <span class="n">other</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> not contained in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

        <span class="c"># Make sure we&#39;re comparing the network of other.</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span>
                                           <span class="n">other</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">))</span>

        <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subnets</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">other</span> <span class="ow">and</span> <span class="n">s2</span> <span class="o">!=</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&gt;=</span> <span class="n">s1</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">and</span>
                <span class="n">other</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="o">&lt;=</span> <span class="n">s1</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">s2</span>
                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">subnets</span><span class="p">()</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&gt;=</span> <span class="n">s2</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">and</span>
                  <span class="n">other</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="o">&lt;=</span> <span class="n">s2</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">s1</span>
                <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">subnets</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># If we got here, there&#39;s a bug somewhere.</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;Error performing exclusion: &#39;</span>
                                     <span class="s">&#39;s1: </span><span class="si">%s</span><span class="s"> s2: </span><span class="si">%s</span><span class="s"> other: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                                     <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">s1</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">s2</span>
        <span class="k">elif</span> <span class="n">s2</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">s1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If we got here, there&#39;s a bug somewhere.</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;Error performing exclusion: &#39;</span>
                                 <span class="s">&#39;s1: </span><span class="si">%s</span><span class="s"> s2: </span><span class="si">%s</span><span class="s"> other: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">compare_networks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare two IP objects.</span>

<span class="sd">        This is only concerned about the comparison of the integer</span>
<span class="sd">        representation of the network addresses.  This means that the</span>
<span class="sd">        host bits aren&#39;t considered at all in this method.  If you want</span>
<span class="sd">        to compare host bits, you can easily enough do a</span>
<span class="sd">        &#39;HostA._ip &lt; HostB._ip&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            other: An IP object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If the IP versions of self and other are the same, returns:</span>

<span class="sd">            -1 if self &lt; other:</span>
<span class="sd">              eg: IPv4Network(&#39;192.0.2.0/25&#39;) &lt; IPv4Network(&#39;192.0.2.128/25&#39;)</span>
<span class="sd">              IPv6Network(&#39;2001:db8::1000/124&#39;) &lt;</span>
<span class="sd">                  IPv6Network(&#39;2001:db8::2000/124&#39;)</span>
<span class="sd">            0 if self == other</span>
<span class="sd">              eg: IPv4Network(&#39;192.0.2.0/24&#39;) == IPv4Network(&#39;192.0.2.0/24&#39;)</span>
<span class="sd">              IPv6Network(&#39;2001:db8::1000/124&#39;) ==</span>
<span class="sd">                  IPv6Network(&#39;2001:db8::1000/124&#39;)</span>
<span class="sd">            1 if self &gt; other</span>
<span class="sd">              eg: IPv4Network(&#39;192.0.2.128/25&#39;) &gt; IPv4Network(&#39;192.0.2.0/25&#39;)</span>
<span class="sd">                  IPv6Network(&#39;2001:db8::2000/124&#39;) &gt;</span>
<span class="sd">                      IPv6Network(&#39;2001:db8::1000/124&#39;)</span>

<span class="sd">          Raises:</span>
<span class="sd">              TypeError if the IP versions are different.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># does this need to raise a ValueError?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> are not of the same type&#39;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c"># self._version == other._version below here:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">network_address</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">network_address</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="c"># self.network_address == other.network_address below here:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">netmask</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">netmask</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_get_networks_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Network-only key function.</span>

<span class="sd">        Returns an object that identifies this address&#39; network and</span>
<span class="sd">        netmask. This function is a suitable &quot;key&quot; argument for sorted()</span>
<span class="sd">        and list.sort().</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subnets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefixlen_diff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The subnets which join to make the current subnet.</span>

<span class="sd">        In the case that self contains only one IP</span>
<span class="sd">        (self._prefixlen == 32 for IPv4 or self._prefixlen == 128</span>
<span class="sd">        for IPv6), yield an iterator with just ourself.</span>

<span class="sd">        Args:</span>
<span class="sd">            prefixlen_diff: An integer, the amount the prefix length</span>
<span class="sd">              should be increased by. This should not be set if</span>
<span class="sd">              new_prefix is also set.</span>
<span class="sd">            new_prefix: The desired new prefix length. This must be a</span>
<span class="sd">              larger number (smaller prefix) than the existing prefix.</span>
<span class="sd">              This should not be set if prefixlen_diff is also set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An iterator of IPv(4|6) objects.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: The prefixlen_diff is too small or too large.</span>
<span class="sd">                OR</span>
<span class="sd">            prefixlen_diff and new_prefix are both set or new_prefix</span>
<span class="sd">              is a smaller number than the current prefix (smaller</span>
<span class="sd">              number means a larger network)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">new_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_prefix</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;new prefix must be longer&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefixlen_diff</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cannot set prefixlen_diff and new_prefix&#39;</span><span class="p">)</span>
            <span class="n">prefixlen_diff</span> <span class="o">=</span> <span class="n">new_prefix</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span>

        <span class="k">if</span> <span class="n">prefixlen_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;prefix length diff must be &gt; 0&#39;</span><span class="p">)</span>
        <span class="n">new_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">+</span> <span class="n">prefixlen_diff</span>

        <span class="k">if</span> <span class="n">new_prefixlen</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&#39;prefix length diff </span><span class="si">%d</span><span class="s"> is invalid for netblock </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">new_prefixlen</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">+</span> <span class="n">prefixlen_diff</span><span class="p">))</span>

        <span class="k">yield</span> <span class="n">first</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">first</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">broadcast</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">broadcast_address</span>
            <span class="k">if</span> <span class="n">broadcast</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">new_addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">broadcast</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_addr</span><span class="p">,</span>
                                                <span class="n">new_prefixlen</span><span class="p">))</span>

            <span class="k">yield</span> <span class="n">current</span>

    <span class="k">def</span> <span class="nf">supernet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefixlen_diff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The supernet containing the current network.</span>

<span class="sd">        Args:</span>
<span class="sd">            prefixlen_diff: An integer, the amount the prefix length of</span>
<span class="sd">              the network should be decreased by.  For example, given a</span>
<span class="sd">              /24 network and a prefixlen_diff of 3, a supernet with a</span>
<span class="sd">              /21 netmask is returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An IPv4 network object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If self.prefixlen - prefixlen_diff &lt; 0. I.e., you have</span>
<span class="sd">              a negative prefix length.</span>
<span class="sd">                OR</span>
<span class="sd">            If prefixlen_diff and new_prefix are both set or new_prefix is a</span>
<span class="sd">              larger number than the current prefix (larger number means a</span>
<span class="sd">              smaller network)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">new_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_prefix</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;new prefix must be shorter&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefixlen_diff</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cannot set prefixlen_diff and new_prefix&#39;</span><span class="p">)</span>
            <span class="n">prefixlen_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">-</span> <span class="n">new_prefix</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefixlen</span> <span class="o">-</span> <span class="n">prefixlen_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&#39;current prefixlen is </span><span class="si">%d</span><span class="s">, cannot have a prefixlen_diff of </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">,</span> <span class="n">prefixlen_diff</span><span class="p">))</span>
        <span class="c"># TODO (pmoody): optimize this.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">prefixlen</span> <span class="o">-</span> <span class="n">prefixlen_diff</span><span class="p">),</span>
                                     <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">network_address</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_multicast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for multicast use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is a multicast address.</span>
<span class="sd">            See RFC 2373 2.7 for details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_multicast</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_multicast</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_reserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is otherwise IETF reserved.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is within one of the</span>
<span class="sd">            reserved IPv6 Network ranges.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_reserved</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_reserved</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_link_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for link-local.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per RFC 4291.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_link_local</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_link_local</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_private</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if this address is allocated for private networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per</span>
<span class="sd">            iana-ipv4-special-registry or iana-ipv6-special-registry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_private</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_private</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if this address is allocated for public networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is not reserved per</span>
<span class="sd">            iana-ipv4-special-registry or iana-ipv6-special-registry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_private</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_unspecified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is unspecified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if this is the unspecified address as defined in</span>
<span class="sd">            RFC 2373 2.5.2.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_unspecified</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_unspecified</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_loopback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is a loopback address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is a loopback address as defined in</span>
<span class="sd">            RFC 2373 2.5.3.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_loopback</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_loopback</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_BaseV4</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Base IPv4 object.</span>

<span class="sd">    The following methods are used by IPv4 objects in both single IP</span>
<span class="sd">    addresses and networks.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Equivalent to 255.255.255.255 or 32 bits of 1&#39;s.</span>
    <span class="n">_ALL_ONES</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">IPV4LENGTH</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">_DECIMAL_DIGITS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="s">&#39;0123456789&#39;</span><span class="p">)</span>

    <span class="c"># the valid octets for host and netmasks. only useful for IPv4.</span>
    <span class="n">_valid_mask_octets</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span> <span class="o">=</span> <span class="n">IPV4LENGTH</span>

    <span class="k">def</span> <span class="nf">_explode_shorthand_ip_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ip_int_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn the given IP string into an integer for comparison.</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_str: A string, the IP ip_str.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The IP ip_str as an integer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AddressValueError: if ip_str isn&#39;t a valid IPv4 Address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&#39;Address cannot be empty&#39;</span><span class="p">)</span>

        <span class="n">octets</span> <span class="o">=</span> <span class="n">ip_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&quot;Expected 4 octets in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ip_str</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_octet</span><span class="p">,</span> <span class="n">octets</span><span class="p">),</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">))</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_parse_octet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octet_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a decimal octet into an integer.</span>

<span class="sd">        Args:</span>
<span class="sd">            octet_str: A string, the number to parse.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The octet as an integer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the octet isn&#39;t strictly a decimal from [0..255].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">octet_str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Empty octet not permitted&quot;</span><span class="p">)</span>
        <span class="c"># Whitelist the characters, since int() allows a lot of bizarre stuff.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DECIMAL_DIGITS</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">octet_str</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Only decimal digits permitted in </span><span class="si">%r</span><span class="s">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">octet_str</span><span class="p">)</span>
        <span class="c"># We do the length check second, since the invalid character error</span>
        <span class="c"># is likely to be more informative for the user</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">octet_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;At most 3 characters permitted in </span><span class="si">%r</span><span class="s">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">octet_str</span><span class="p">)</span>
        <span class="c"># Convert to integer (we know digits are legal)</span>
        <span class="n">octet_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">octet_str</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="c"># Any octets that look like they *might* be written in octal,</span>
        <span class="c"># and which don&#39;t look exactly the same in both octal and</span>
        <span class="c"># decimal are rejected as ambiguous</span>
        <span class="k">if</span> <span class="n">octet_int</span> <span class="o">&gt;</span> <span class="mi">7</span> <span class="ow">and</span> <span class="n">octet_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Ambiguous (octal/decimal) value in </span><span class="si">%r</span><span class="s"> not permitted&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">octet_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">octet_int</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Octet </span><span class="si">%d</span><span class="s"> (&gt; 255) not permitted&quot;</span> <span class="o">%</span> <span class="n">octet_int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">octet_int</span>

    <span class="k">def</span> <span class="nf">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turns a 32-bit integer into dotted decimal notation.</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_int: An integer, the IP address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The IP address as a string in dotted decimal notation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ip_int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_is_valid_netmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netmask</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify that the netmask is valid.</span>

<span class="sd">        Args:</span>
<span class="sd">            netmask: A string, either a prefix or dotted decimal</span>
<span class="sd">              netmask.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the prefix represents a valid IPv4</span>
<span class="sd">            netmask.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">netmask</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_mask_octets</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">False</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c"># Found something that isn&#39;t an integer or isn&#39;t valid</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">mask</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">netmask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">netmask</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">netmask</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>

    <span class="k">def</span> <span class="nf">_is_hostmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the IP string is a hostmask (rather than a netmask).</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_str: A string, the potential hostmask.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the IP string is a hostmask.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">ip_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">bits</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_mask_octets</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_prefixlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>


<div class="viewcode-block" id="IPv4Address"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv4Address">[docs]</a><span class="k">class</span> <span class="nc">IPv4Address</span><span class="p">(</span><span class="n">_BaseV4</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Represent and manipulate single IPv4 Addresses.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            address: A string or integer representing the IP</span>

<span class="sd">              Additionally, an integer can be passed, so</span>
<span class="sd">              IPv4Address(&#39;192.0.2.1&#39;) == IPv4Address(3221225985).</span>
<span class="sd">              or, more generally</span>
<span class="sd">              IPv4Address(int(IPv4Address(&#39;192.0.2.1&#39;))) ==</span>
<span class="sd">                IPv4Address(&#39;192.0.2.1&#39;)</span>

<span class="sd">        Raises:</span>
<span class="sd">            AddressValueError: If ipaddress isn&#39;t a valid IPv4 address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_BaseAddress</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="n">_BaseV4</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

        <span class="c"># Efficient constructor from integer.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_int_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">=</span> <span class="n">address</span>
            <span class="k">return</span>

        <span class="c"># Constructing from a packed address</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_packed_address</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Assume input argument to be string or any object representation</span>
        <span class="c"># which converts into a formatted IP string.</span>
        <span class="n">addr_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_string</span><span class="p">(</span><span class="n">addr_str</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">packed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The binary representation of this address.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">v4_int_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_reserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is otherwise IETF reserved.</span>

<span class="sd">         Returns:</span>
<span class="sd">             A boolean, True if the address is within the</span>
<span class="sd">             reserved IPv4 Network range.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reserved_network</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;240.0.0.0/4&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">reserved_network</span>

    <span class="nd">@property</span>
    <span class="nd">@functools.lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">is_private</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if this address is allocated for private networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per</span>
<span class="sd">            iana-ipv4-special-registry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;0.0.0.0/8&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;10.0.0.0/8&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;127.0.0.0/8&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;169.254.0.0/16&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;172.16.0.0/12&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;192.0.0.0/29&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;192.0.0.170/31&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;192.0.2.0/24&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;192.168.0.0/16&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;198.18.0.0/15&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;198.51.100.0/24&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;203.0.113.0/24&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;240.0.0.0/4&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;255.255.255.255/32&#39;</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_multicast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for multicast use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is multicast.</span>
<span class="sd">            See RFC 3171 for details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">multicast_network</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;224.0.0.0/4&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">multicast_network</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_unspecified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is unspecified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if this is the unspecified address as defined in</span>
<span class="sd">            RFC 5735 3.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unspecified_address</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">unspecified_address</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_loopback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is a loopback address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is a loopback per RFC 3330.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loopback_network</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;127.0.0.0/8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">loopback_network</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_link_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for link-local.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is link-local per RFC 3927.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linklocal_network</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;169.254.0.0/16&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">linklocal_network</span>

</div>
<div class="viewcode-block" id="IPv4Interface"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv4Interface">[docs]</a><span class="k">class</span> <span class="nc">IPv4Interface</span><span class="p">(</span><span class="n">IPv4Address</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">IPv4Address</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
            <span class="k">return</span>

        <span class="n">addr</span> <span class="o">=</span> <span class="n">_split_optional_netmask</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">IPv4Address</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_prefixlen</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">netmask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">hostmask</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">address_equal</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address_equal</span> <span class="ow">or</span> <span class="n">address_equal</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">address_equal</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">network</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c"># An interface with an associated network is NOT the</span>
            <span class="c"># same as an unassociated address. That&#39;s why the hash</span>
            <span class="c"># takes the extra info into account.</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">address_less</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="o">.</span><span class="n">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">address_less</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">network</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c"># We *do* allow addresses and interfaces to be sorted. The</span>
            <span class="c"># unassociated address is considered less than all interfaces.</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_prefixlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_netmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_hostmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">hostmask</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IPv4Network"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv4Network">[docs]</a><span class="k">class</span> <span class="nc">IPv4Network</span><span class="p">(</span><span class="n">_BaseV4</span><span class="p">,</span> <span class="n">_BaseNetwork</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;This class represents and manipulates 32-bit IPv4 network + addresses..</span>

<span class="sd">    Attributes: [examples for IPv4Network(&#39;192.0.2.0/27&#39;)]</span>
<span class="sd">        .network_address: IPv4Address(&#39;192.0.2.0&#39;)</span>
<span class="sd">        .hostmask: IPv4Address(&#39;0.0.0.31&#39;)</span>
<span class="sd">        .broadcast_address: IPv4Address(&#39;192.0.2.32&#39;)</span>
<span class="sd">        .netmask: IPv4Address(&#39;255.255.255.224&#39;)</span>
<span class="sd">        .prefixlen: 27</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Class to use when creating address objects</span>
    <span class="n">_address_class</span> <span class="o">=</span> <span class="n">IPv4Address</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Instantiate a new IPv4 network object.</span>

<span class="sd">        Args:</span>
<span class="sd">            address: A string or integer representing the IP [&amp; network].</span>
<span class="sd">              &#39;192.0.2.0/24&#39;</span>
<span class="sd">              &#39;192.0.2.0/255.255.255.0&#39;</span>
<span class="sd">              &#39;192.0.0.2/0.0.0.255&#39;</span>
<span class="sd">              are all functionally the same in IPv4. Similarly,</span>
<span class="sd">              &#39;192.0.2.1&#39;</span>
<span class="sd">              &#39;192.0.2.1/255.255.255.255&#39;</span>
<span class="sd">              &#39;192.0.2.1/32&#39;</span>
<span class="sd">              are also functionally equivalent. That is to say, failing to</span>
<span class="sd">              provide a subnetmask will create an object with a mask of /32.</span>

<span class="sd">              If the mask (portion after the / in the argument) is given in</span>
<span class="sd">              dotted quad form, it is treated as a netmask if it starts with a</span>
<span class="sd">              non-zero field (e.g. /255.0.0.0 == /8) and as a hostmask if it</span>
<span class="sd">              starts with a zero field (e.g. 0.255.255.255 == /8), with the</span>
<span class="sd">              single exception of an all-zero mask which is treated as a</span>
<span class="sd">              netmask == /0. If no mask is given, a default of /32 is used.</span>

<span class="sd">              Additionally, an integer can be passed, so</span>
<span class="sd">              IPv4Network(&#39;192.0.2.1&#39;) == IPv4Network(3221225985)</span>
<span class="sd">              or, more generally</span>
<span class="sd">              IPv4Interface(int(IPv4Interface(&#39;192.0.2.1&#39;))) ==</span>
<span class="sd">                IPv4Interface(&#39;192.0.2.1&#39;)</span>

<span class="sd">        Raises:</span>
<span class="sd">            AddressValueError: If ipaddress isn&#39;t a valid IPv4 address.</span>
<span class="sd">            NetmaskValueError: If the netmask isn&#39;t valid for</span>
<span class="sd">              an IPv4 address.</span>
<span class="sd">            ValueError: If strict is True and a network address is not</span>
<span class="sd">              supplied.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_BaseV4</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="n">_BaseNetwork</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

        <span class="c"># Constructing from a packed address</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">)</span>
            <span class="c">#fixme: address/network test here</span>
            <span class="k">return</span>

        <span class="c"># Efficient constructor from integer.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">)</span>
            <span class="c">#fixme: address/network test here.</span>
            <span class="k">return</span>

        <span class="c"># Assume input argument to be string or any object representation</span>
        <span class="c"># which converts into a formatted IP prefix string.</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">_split_optional_netmask</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_string</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Check for a netmask in prefix length form</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_from_prefix_string</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="n">NetmaskValueError</span><span class="p">:</span>
                <span class="c"># Check for a netmask or hostmask in dotted-quad form.</span>
                <span class="c"># This may raise NetmaskValueError.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_from_ip_string</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_prefix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">IPv4Address</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">))</span> <span class="o">!=</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> has host bits set&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">&amp;</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__iter__</span>

    <span class="nd">@property</span>
    <span class="nd">@functools.lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">is_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if this address is allocated for public networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is not reserved per</span>
<span class="sd">            iana-ipv4-special-registry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;100.64.0.0/10&#39;</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span> <span class="ow">in</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s">&#39;100.64.0.0/10&#39;</span><span class="p">))</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_private</span><span class="p">)</span>


</div>
<span class="k">class</span> <span class="nc">_BaseV6</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Base IPv6 object.</span>

<span class="sd">    The following methods are used by IPv6 objects in both single IP</span>
<span class="sd">    addresses and networks.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALL_ONES</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">IPV6LENGTH</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">_HEXTET_COUNT</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">_HEX_DIGITS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="s">&#39;0123456789ABCDEFabcdef&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span> <span class="o">=</span> <span class="n">IPV6LENGTH</span>

    <span class="k">def</span> <span class="nf">_ip_int_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn an IPv6 ip_str into an integer.</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_str: A string, the IPv6 ip_str.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An int, the IPv6 address</span>

<span class="sd">        Raises:</span>
<span class="sd">            AddressValueError: if ip_str isn&#39;t a valid IPv6 Address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&#39;Address cannot be empty&#39;</span><span class="p">)</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="n">ip_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>

        <span class="c"># An IPv6 address needs at least 2 colons (3 parts).</span>
        <span class="n">_min_parts</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_min_parts</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;At least </span><span class="si">%d</span><span class="s"> parts expected in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_min_parts</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># If the address has an IPv4-style suffix, convert it to hexadecimal.</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ipv4_int</span> <span class="o">=</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span><span class="o">.</span><span class="n">_ip</span>
            <span class="k">except</span> <span class="n">AddressValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">))</span> <span class="kn">from</span> <span class="bp">None</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">ipv4_int</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">))</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ipv4_int</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">))</span>

        <span class="c"># An IPv6 address can&#39;t have more than 8 colons (9 parts).</span>
        <span class="c"># The extra colon comes from using the &quot;::&quot; notation for a single</span>
        <span class="c"># leading or trailing zero part.</span>
        <span class="n">_max_parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HEXTET_COUNT</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_max_parts</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;At most </span><span class="si">%d</span><span class="s"> colons permitted in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_max_parts</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># Disregarding the endpoints, find &#39;::&#39; with nothing in between.</span>
        <span class="c"># This indicates that a run of zeroes has been skipped.</span>
        <span class="n">skip_index</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">skip_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># Can&#39;t have more than one &#39;::&#39;</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;At most one &#39;::&#39; permitted in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ip_str</span>
                    <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">skip_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c"># parts_hi is the number of parts to copy from above/before the &#39;::&#39;</span>
        <span class="c"># parts_lo is the number of parts to copy from below/after the &#39;::&#39;</span>
        <span class="k">if</span> <span class="n">skip_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># If we found a &#39;::&#39;, then check if it also covers the endpoints.</span>
            <span class="n">parts_hi</span> <span class="o">=</span> <span class="n">skip_index</span>
            <span class="n">parts_lo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">-</span> <span class="n">skip_index</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">parts_hi</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">parts_hi</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Leading &#39;:&#39; only permitted as part of &#39;::&#39; in </span><span class="si">%r</span><span class="s">&quot;</span>
                    <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">ip_str</span><span class="p">)</span>  <span class="c"># ^: requires ^::</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">parts_lo</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">parts_lo</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Trailing &#39;:&#39; only permitted as part of &#39;::&#39; in </span><span class="si">%r</span><span class="s">&quot;</span>
                    <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">ip_str</span><span class="p">)</span>  <span class="c"># :$ requires ::$</span>
            <span class="n">parts_skipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HEXTET_COUNT</span> <span class="o">-</span> <span class="p">(</span><span class="n">parts_hi</span> <span class="o">+</span> <span class="n">parts_lo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parts_skipped</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Expected at most </span><span class="si">%d</span><span class="s"> other parts with &#39;::&#39; in </span><span class="si">%r</span><span class="s">&quot;</span>
                <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_HEXTET_COUNT</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Otherwise, allocate the entire address to parts_hi.  The</span>
            <span class="c"># endpoints could still be empty, but _parse_hextet() will check</span>
            <span class="c"># for that.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HEXTET_COUNT</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Exactly </span><span class="si">%d</span><span class="s"> parts expected without &#39;::&#39; in </span><span class="si">%r</span><span class="s">&quot;</span>
                <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_HEXTET_COUNT</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Leading &#39;:&#39; only permitted as part of &#39;::&#39; in </span><span class="si">%r</span><span class="s">&quot;</span>
                <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">ip_str</span><span class="p">)</span>  <span class="c"># ^: requires ^::</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Trailing &#39;:&#39; only permitted as part of &#39;::&#39; in </span><span class="si">%r</span><span class="s">&quot;</span>
                <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">ip_str</span><span class="p">)</span>  <span class="c"># :$ requires ::$</span>
            <span class="n">parts_hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="n">parts_lo</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">parts_skipped</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Now, parse the hextets into a 128-bit integer.</span>
            <span class="n">ip_int</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parts_hi</span><span class="p">):</span>
                <span class="n">ip_int</span> <span class="o">&lt;&lt;=</span> <span class="mi">16</span>
                <span class="n">ip_int</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_hextet</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ip_int</span> <span class="o">&lt;&lt;=</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">parts_skipped</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">parts_lo</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">ip_int</span> <span class="o">&lt;&lt;=</span> <span class="mi">16</span>
                <span class="n">ip_int</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_hextet</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">ip_int</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AddressValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ip_str</span><span class="p">))</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_parse_hextet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hextet_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an IPv6 hextet string into an integer.</span>

<span class="sd">        Args:</span>
<span class="sd">            hextet_str: A string, the number to parse.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The hextet as an integer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the input isn&#39;t strictly a hex number from</span>
<span class="sd">              [0..FFFF].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Whitelist the characters, since int() allows a lot of bizarre stuff.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HEX_DIGITS</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">hextet_str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Only hex digits permitted in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">hextet_str</span><span class="p">)</span>
        <span class="c"># We do the length check second, since the invalid character error</span>
        <span class="c"># is likely to be more informative for the user</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hextet_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;At most 4 characters permitted in </span><span class="si">%r</span><span class="s">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">hextet_str</span><span class="p">)</span>
        <span class="c"># Length check means we can skip checking the integer value</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">hextet_str</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compress_hextets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hextets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compresses a list of hextets.</span>

<span class="sd">        Compresses a list of strings, replacing the longest continuous</span>
<span class="sd">        sequence of &quot;0&quot; in the list with &quot;&quot; and adding empty strings at</span>
<span class="sd">        the beginning or at the end of the string such that subsequently</span>
<span class="sd">        calling &quot;:&quot;.join(hextets) will produce the compressed version of</span>
<span class="sd">        the IPv6 address.</span>

<span class="sd">        Args:</span>
<span class="sd">            hextets: A list of strings, the hextets to compress.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of strings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_doublecolon_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">best_doublecolon_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">doublecolon_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">doublecolon_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">hextet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hextets</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">hextet</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">doublecolon_len</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">doublecolon_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c"># Start of a sequence of zeros.</span>
                    <span class="n">doublecolon_start</span> <span class="o">=</span> <span class="n">index</span>
                <span class="k">if</span> <span class="n">doublecolon_len</span> <span class="o">&gt;</span> <span class="n">best_doublecolon_len</span><span class="p">:</span>
                    <span class="c"># This is the longest sequence of zeros so far.</span>
                    <span class="n">best_doublecolon_len</span> <span class="o">=</span> <span class="n">doublecolon_len</span>
                    <span class="n">best_doublecolon_start</span> <span class="o">=</span> <span class="n">doublecolon_start</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">doublecolon_len</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">doublecolon_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">best_doublecolon_len</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">best_doublecolon_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">best_doublecolon_start</span> <span class="o">+</span>
                                    <span class="n">best_doublecolon_len</span><span class="p">)</span>
            <span class="c"># For zeros at the end of the address.</span>
            <span class="k">if</span> <span class="n">best_doublecolon_end</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">hextets</span><span class="p">):</span>
                <span class="n">hextets</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
            <span class="n">hextets</span><span class="p">[</span><span class="n">best_doublecolon_start</span><span class="p">:</span><span class="n">best_doublecolon_end</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
            <span class="c"># For zeros at the beginning of the address.</span>
            <span class="k">if</span> <span class="n">best_doublecolon_start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">hextets</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">hextets</span>

        <span class="k">return</span> <span class="n">hextets</span>

    <span class="k">def</span> <span class="nf">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_int</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turns a 128-bit integer into hexadecimal notation.</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_int: An integer, the IP address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A string, the hexadecimal representation of the address.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: The address is bigger than 128 bits of all ones.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ip_int</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ip_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ip_int</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;IPv6 address is too large&#39;</span><span class="p">)</span>

        <span class="n">hex_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%032x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ip_int</span>
        <span class="n">hextets</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">hex_str</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

        <span class="n">hextets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compress_hextets</span><span class="p">(</span><span class="n">hextets</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hextets</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_explode_shorthand_ip_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Expand a shortened IPv6 address.</span>

<span class="sd">        Args:</span>
<span class="sd">            ip_str: A string, the IPv6 address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A string, the expanded IPv6 address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IPv6Network</span><span class="p">):</span>
            <span class="n">ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IPv6Interface</span><span class="p">):</span>
            <span class="n">ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">ip_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_string</span><span class="p">(</span><span class="n">ip_str</span><span class="p">)</span>
        <span class="n">hex_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%032x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ip_int</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">hex_str</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">_BaseNetwork</span><span class="p">,</span> <span class="n">IPv6Interface</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_prefixlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>


<div class="viewcode-block" id="IPv6Address"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv6Address">[docs]</a><span class="k">class</span> <span class="nc">IPv6Address</span><span class="p">(</span><span class="n">_BaseV6</span><span class="p">,</span> <span class="n">_BaseAddress</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Represent and manipulate single IPv6 Addresses.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate a new IPv6 address object.</span>

<span class="sd">        Args:</span>
<span class="sd">            address: A string or integer representing the IP</span>

<span class="sd">              Additionally, an integer can be passed, so</span>
<span class="sd">              IPv6Address(&#39;2001:db8::&#39;) ==</span>
<span class="sd">                IPv6Address(42540766411282592856903984951653826560)</span>
<span class="sd">              or, more generally</span>
<span class="sd">              IPv6Address(int(IPv6Address(&#39;2001:db8::&#39;))) ==</span>
<span class="sd">                IPv6Address(&#39;2001:db8::&#39;)</span>

<span class="sd">        Raises:</span>
<span class="sd">            AddressValueError: If address isn&#39;t a valid IPv6 address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_BaseAddress</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="n">_BaseV6</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

        <span class="c"># Efficient constructor from integer.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_int_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">=</span> <span class="n">address</span>
            <span class="k">return</span>

        <span class="c"># Constructing from a packed address</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_packed_address</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Assume input argument to be string or any object representation</span>
        <span class="c"># which converts into a formatted IP string.</span>
        <span class="n">addr_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_string</span><span class="p">(</span><span class="n">addr_str</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">packed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The binary representation of this address.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">v6_int_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_multicast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for multicast use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is a multicast address.</span>
<span class="sd">            See RFC 2373 2.7 for details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">multicast_network</span> <span class="o">=</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;ff00::/8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">multicast_network</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_reserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is otherwise IETF reserved.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is within one of the</span>
<span class="sd">            reserved IPv6 Network ranges.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reserved_networks</span> <span class="o">=</span> <span class="p">[</span><span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;::/8&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;100::/8&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;200::/7&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;400::/6&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;800::/5&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;1000::/4&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;4000::/3&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;6000::/3&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;8000::/3&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;A000::/3&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;C000::/3&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;E000::/4&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;F000::/5&#39;</span><span class="p">),</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;F800::/6&#39;</span><span class="p">),</span>
                             <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;FE00::/9&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reserved_networks</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_link_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for link-local.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per RFC 4291.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linklocal_network</span> <span class="o">=</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;fe80::/10&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">linklocal_network</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_site_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for site-local.</span>

<span class="sd">        Note that the site-local address space has been deprecated by RFC 3879.</span>
<span class="sd">        Use is_private to test if this address is in the space of unique local</span>
<span class="sd">        addresses as defined by RFC 4193.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per RFC 3513 2.5.6.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sitelocal_network</span> <span class="o">=</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;fec0::/10&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">sitelocal_network</span>

    <span class="nd">@property</span>
    <span class="nd">@functools.lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">is_private</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if this address is allocated for private networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per</span>
<span class="sd">            iana-ipv6-special-registry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;::1/128&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;::/128&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;::ffff:0:0/96&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;100::/64&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;2001::/23&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;2001:2::/48&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;2001:db8::/32&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;2001:10::/28&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;fc00::/7&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span> <span class="ow">in</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="s">&#39;fe80::/10&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if this address is allocated for public networks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, true if the address is not reserved per</span>
<span class="sd">            iana-ipv6-special-registry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_private</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_unspecified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is unspecified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if this is the unspecified address as defined in</span>
<span class="sd">            RFC 2373 2.5.2.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_loopback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is a loopback address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is a loopback address as defined in</span>
<span class="sd">            RFC 2373 2.5.3.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ipv4_mapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the IPv4 mapped address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If the IPv6 address is a v4 mapped address, return the</span>
<span class="sd">            IPv4 mapped address. Return None otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0xFFFF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">teredo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tuple of embedded teredo IPs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of the (server, client) IPs or None if the address</span>
<span class="sd">            doesn&#39;t appear to be a teredo address (doesn&#39;t start with</span>
<span class="sd">            2001::/32)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&gt;&gt;</span> <span class="mi">96</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x20010000</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">IPv4Address</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&gt;&gt;</span> <span class="mi">64</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">),</span>
                <span class="n">IPv4Address</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sixtofour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the IPv4 6to4 embedded address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The IPv4 6to4-embedded address if present or None if the</span>
<span class="sd">            address doesn&#39;t appear to contain a 6to4 embedded address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&gt;&gt;</span> <span class="mi">112</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x2002</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">IPv4Address</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">&gt;&gt;</span> <span class="mi">80</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IPv6Interface"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv6Interface">[docs]</a><span class="k">class</span> <span class="nc">IPv6Interface</span><span class="p">(</span><span class="n">IPv6Address</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">IPv6Address</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
            <span class="k">return</span>

        <span class="n">addr</span> <span class="o">=</span> <span class="n">_split_optional_netmask</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">IPv6Address</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">IPv6Network</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">netmask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_prefixlen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">hostmask</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">address_equal</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address_equal</span> <span class="ow">or</span> <span class="n">address_equal</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">address_equal</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">network</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c"># An interface with an associated network is NOT the</span>
            <span class="c"># same as an unassociated address. That&#39;s why the hash</span>
            <span class="c"># takes the extra info into account.</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">address_less</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="o">.</span><span class="n">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">address_less</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">network</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c"># We *do* allow addresses and interfaces to be sorted. The</span>
            <span class="c"># unassociated address is considered less than all interfaces.</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_prefixlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_netmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_hostmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_string_from_ip_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">hostmask</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_unspecified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">is_unspecified</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_loopback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ip</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">is_loopback</span>

</div>
<div class="viewcode-block" id="IPv6Network"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv6Network">[docs]</a><span class="k">class</span> <span class="nc">IPv6Network</span><span class="p">(</span><span class="n">_BaseV6</span><span class="p">,</span> <span class="n">_BaseNetwork</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;This class represents and manipulates 128-bit IPv6 networks.</span>

<span class="sd">    Attributes: [examples for IPv6(&#39;2001:db8::1000/124&#39;)]</span>
<span class="sd">        .network_address: IPv6Address(&#39;2001:db8::1000&#39;)</span>
<span class="sd">        .hostmask: IPv6Address(&#39;::f&#39;)</span>
<span class="sd">        .broadcast_address: IPv6Address(&#39;2001:db8::100f&#39;)</span>
<span class="sd">        .netmask: IPv6Address(&#39;ffff:ffff:ffff:ffff:ffff:ffff:ffff:fff0&#39;)</span>
<span class="sd">        .prefixlen: 124</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Class to use when creating address objects</span>
    <span class="n">_address_class</span> <span class="o">=</span> <span class="n">IPv6Address</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate a new IPv6 Network object.</span>

<span class="sd">        Args:</span>
<span class="sd">            address: A string or integer representing the IPv6 network or the</span>
<span class="sd">              IP and prefix/netmask.</span>
<span class="sd">              &#39;2001:db8::/128&#39;</span>
<span class="sd">              &#39;2001:db8:0000:0000:0000:0000:0000:0000/128&#39;</span>
<span class="sd">              &#39;2001:db8::&#39;</span>
<span class="sd">              are all functionally the same in IPv6.  That is to say,</span>
<span class="sd">              failing to provide a subnetmask will create an object with</span>
<span class="sd">              a mask of /128.</span>

<span class="sd">              Additionally, an integer can be passed, so</span>
<span class="sd">              IPv6Network(&#39;2001:db8::&#39;) ==</span>
<span class="sd">                IPv6Network(42540766411282592856903984951653826560)</span>
<span class="sd">              or, more generally</span>
<span class="sd">              IPv6Network(int(IPv6Network(&#39;2001:db8::&#39;))) ==</span>
<span class="sd">                IPv6Network(&#39;2001:db8::&#39;)</span>

<span class="sd">            strict: A boolean. If true, ensure that we have been passed</span>
<span class="sd">              A true network address, eg, 2001:db8::1000/124 and not an</span>
<span class="sd">              IP address on a network, eg, 2001:db8::1/124.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AddressValueError: If address isn&#39;t a valid IPv6 address.</span>
<span class="sd">            NetmaskValueError: If the netmask isn&#39;t valid for</span>
<span class="sd">              an IPv6 address.</span>
<span class="sd">            ValueError: If strict was True and a network address was not</span>
<span class="sd">              supplied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_BaseV6</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="n">_BaseNetwork</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

        <span class="c"># Efficient constructor from integer.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Constructing from a packed address</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ALL_ONES</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Assume input argument to be string or any object representation</span>
        <span class="c"># which converts into a formatted IP prefix string.</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">_split_optional_netmask</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_string</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># This may raise NetmaskValueError</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix_from_prefix_string</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">netmask</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ip_int_from_prefix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">IPv6Address</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">))</span> <span class="o">!=</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> has host bits set&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_address</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span> <span class="o">&amp;</span>
                                           <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netmask</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefixlen</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_prefixlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__iter__</span>

<div class="viewcode-block" id="IPv6Network.hosts"><a class="viewcode-back" href="../ipaddress.html#ipaddress.IPv6Network.hosts">[docs]</a>    <span class="k">def</span> <span class="nf">hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate Iterator over usable hosts in a network.</span>

<span class="sd">          This is like __iter__ except it doesn&#39;t return the</span>
<span class="sd">          Subnet-Router anycast address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="p">)</span>
        <span class="n">broadcast</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">network</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">broadcast</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address_class</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_site_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the address is reserved for site-local.</span>

<span class="sd">        Note that the site-local address space has been deprecated by RFC 3879.</span>
<span class="sd">        Use is_private to test if this address is in the space of unique local</span>
<span class="sd">        addresses as defined by RFC 4193.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A boolean, True if the address is reserved per RFC 3513 2.5.6.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_address</span><span class="o">.</span><span class="n">is_site_local</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_address</span><span class="o">.</span><span class="n">is_site_local</span><span class="p">)</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>