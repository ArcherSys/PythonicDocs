

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cgi &mdash; ArcherBashPYDocs 1.0.0. documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ArcherBashPYDocs 1.0.0. documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> ArcherBashPYDocs</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="simple">
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ArcherBashPYDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>cgi</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for cgi</h1><div class="highlight"><pre>
<span class="c">#! /usr/local/bin/python</span>

<span class="c"># NOTE: the above &quot;/usr/local/bin/python&quot; is NOT a mistake.  It is</span>
<span class="c"># intentionally NOT &quot;/usr/bin/env python&quot;.  On many systems</span>
<span class="c"># (e.g. Solaris), /usr/local/bin is not in $PATH as passed to CGI</span>
<span class="c"># scripts, and /usr/local/bin is the default directory where Python is</span>
<span class="c"># installed, so /usr/bin/env would be unable to find python.  Granted,</span>
<span class="c"># binary installations by Linux vendors often install Python in</span>
<span class="c"># /usr/bin.  So let those vendors patch cgi.py to match their choice</span>
<span class="c"># of installation.</span>

<span class="sd">&quot;&quot;&quot;Support module for CGI (Common Gateway Interface) scripts.</span>

<span class="sd">This module defines a number of utilities for use by CGI scripts</span>
<span class="sd">written in Python.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># History</span>
<span class="c"># -------</span>
<span class="c">#</span>
<span class="c"># Michael McLay started this module.  Steve Majewski changed the</span>
<span class="c"># interface to SvFormContentDict and FormContentDict.  The multipart</span>
<span class="c"># parsing was inspired by code submitted by Andreas Paepcke.  Guido van</span>
<span class="c"># Rossum rewrote, reformatted and documented the module and is currently</span>
<span class="c"># responsible for its maintenance.</span>
<span class="c">#</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;2.6&quot;</span>


<span class="c"># Imports</span>
<span class="c"># =======</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">,</span> <span class="n">TextIOWrapper</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Mapping</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">from</span> <span class="nn">email.parser</span> <span class="kn">import</span> <span class="n">FeedParser</span>
<span class="kn">from</span> <span class="nn">email.message</span> <span class="kn">import</span> <span class="n">Message</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;MiniFieldStorage&quot;</span><span class="p">,</span> <span class="s">&quot;FieldStorage&quot;</span><span class="p">,</span>
           <span class="s">&quot;parse&quot;</span><span class="p">,</span> <span class="s">&quot;parse_qs&quot;</span><span class="p">,</span> <span class="s">&quot;parse_qsl&quot;</span><span class="p">,</span> <span class="s">&quot;parse_multipart&quot;</span><span class="p">,</span>
           <span class="s">&quot;parse_header&quot;</span><span class="p">,</span> <span class="s">&quot;print_exception&quot;</span><span class="p">,</span> <span class="s">&quot;print_environ&quot;</span><span class="p">,</span>
           <span class="s">&quot;print_form&quot;</span><span class="p">,</span> <span class="s">&quot;print_directory&quot;</span><span class="p">,</span> <span class="s">&quot;print_arguments&quot;</span><span class="p">,</span>
           <span class="s">&quot;print_environ_usage&quot;</span><span class="p">,</span> <span class="s">&quot;escape&quot;</span><span class="p">]</span>

<span class="c"># Logging support</span>
<span class="c"># ===============</span>

<span class="n">logfile</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>            <span class="c"># Filename to log to, if not empty</span>
<span class="n">logfp</span> <span class="o">=</span> <span class="bp">None</span>            <span class="c"># File object to log to, if not None</span>

<span class="k">def</span> <span class="nf">initlog</span><span class="p">(</span><span class="o">*</span><span class="n">allargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write a log message, if there is a log file.</span>

<span class="sd">    Even though this function is called initlog(), you should always</span>
<span class="sd">    use log(); log is a variable that is set either to initlog</span>
<span class="sd">    (initially), to dolog (once the log file has been opened), or to</span>
<span class="sd">    nolog (when logging is disabled).</span>

<span class="sd">    The first argument is a format string; the remaining arguments (if</span>
<span class="sd">    any) are arguments to the % operator, so e.g.</span>
<span class="sd">        log(&quot;%s: %s&quot;, &quot;a&quot;, &quot;b&quot;)</span>
<span class="sd">    will write &quot;a: b&quot; to the log file, followed by a newline.</span>

<span class="sd">    If the global logfp is not None, it should be a file object to</span>
<span class="sd">    which log data is written.</span>

<span class="sd">    If the global logfp is None, the global logfile may be a string</span>
<span class="sd">    giving a filename to open, in append mode.  This file should be</span>
<span class="sd">    world writable!!!  If the file can&#39;t be opened, logging is</span>
<span class="sd">    silently disabled (since there is no safe place where we could</span>
<span class="sd">    send an error message).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">log</span><span class="p">,</span> <span class="n">logfile</span><span class="p">,</span> <span class="n">logfp</span>
    <span class="k">if</span> <span class="n">logfile</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logfp</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logfp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logfp</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">nolog</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">dolog</span>
    <span class="n">log</span><span class="p">(</span><span class="o">*</span><span class="n">allargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dolog</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write a log message to the log file.  See initlog() for docs.&quot;&quot;&quot;</span>
    <span class="n">logfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">%</span><span class="n">args</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">nolog</span><span class="p">(</span><span class="o">*</span><span class="n">allargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dummy function, assigned to log when logging is disabled.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">closelog</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Close the log file.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">log</span><span class="p">,</span> <span class="n">logfile</span><span class="p">,</span> <span class="n">logfp</span>
    <span class="n">logfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">logfp</span><span class="p">:</span>
        <span class="n">logfp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">logfp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">initlog</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">initlog</span>           <span class="c"># The current logging function</span>


<span class="c"># Parsing functions</span>
<span class="c"># =================</span>

<span class="c"># Maximum input we will accept when REQUEST_METHOD is POST</span>
<span class="c"># 0 ==&gt; unlimited input</span>
<span class="n">maxlen</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="parse"><a class="viewcode-back" href="../cgi.html#cgi.parse">[docs]</a><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a query in the environment or from a file (default stdin)</span>

<span class="sd">        Arguments, all optional:</span>

<span class="sd">        fp              : file pointer; default: sys.stdin.buffer</span>

<span class="sd">        environ         : environment dictionary; default: os.environ</span>

<span class="sd">        keep_blank_values: flag indicating whether blank values in</span>
<span class="sd">            percent-encoded forms should be treated as blank strings.</span>
<span class="sd">            A true value indicates that blanks should be retained as</span>
<span class="sd">            blank strings.  The default false value indicates that</span>
<span class="sd">            blank values are to be ignored and treated as if they were</span>
<span class="sd">            not included.</span>

<span class="sd">        strict_parsing: flag indicating what to do with parsing errors.</span>
<span class="sd">            If false (the default), errors are silently ignored.</span>
<span class="sd">            If true, errors raise a ValueError exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>

    <span class="c"># field keys and values (except for files) are returned as strings</span>
    <span class="c"># an encoding is required to decode the bytes read from self.fp</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="s">&#39;encoding&#39;</span><span class="p">):</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">encoding</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;latin-1&#39;</span>

    <span class="c"># fp.read() must return bytes</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">TextIOWrapper</span><span class="p">):</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">buffer</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;REQUEST_METHOD&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;GET&#39;</span>       <span class="c"># For testing stand-alone</span>
    <span class="k">if</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s">&#39;multipart/form-data&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parse_multipart</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">pdict</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">:</span>
            <span class="n">clength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;CONTENT_LENGTH&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">and</span> <span class="n">clength</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Maximum content length exceeded&#39;</span><span class="p">)</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">clength</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>                     <span class="c"># Unknown content-type</span>
        <span class="k">if</span> <span class="s">&#39;QUERY_STRING&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">qs</span><span class="p">:</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span> <span class="o">+</span> <span class="s">&#39;&amp;&#39;</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span> <span class="o">+</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">qs</span><span class="p">:</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span> <span class="o">+</span> <span class="s">&#39;&amp;&#39;</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qs</span>    <span class="c"># XXX Shouldn&#39;t, really</span>
    <span class="k">elif</span> <span class="s">&#39;QUERY_STRING&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qs</span>    <span class="c"># XXX Shouldn&#39;t, really</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="p">,</span>
                                 <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>


<span class="c"># parse query string function called from urlparse,</span>
<span class="c"># this is done in order to maintain backward compatiblity.</span>
</div>
<div class="viewcode-block" id="parse_qs"><a class="viewcode-back" href="../cgi.html#cgi.parse_qs">[docs]</a><span class="k">def</span> <span class="nf">parse_qs</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a query given as a string argument.&quot;&quot;&quot;</span>
    <span class="n">warn</span><span class="p">(</span><span class="s">&quot;cgi.parse_qs is deprecated, use urllib.parse.parse_qs instead&quot;</span><span class="p">,</span>
         <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="parse_qsl"><a class="viewcode-back" href="../cgi.html#cgi.parse_qsl">[docs]</a><span class="k">def</span> <span class="nf">parse_qsl</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a query given as a string argument.&quot;&quot;&quot;</span>
    <span class="n">warn</span><span class="p">(</span><span class="s">&quot;cgi.parse_qsl is deprecated, use urllib.parse.parse_qsl instead&quot;</span><span class="p">,</span>
         <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qsl</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="parse_multipart"><a class="viewcode-back" href="../cgi.html#cgi.parse_multipart">[docs]</a><span class="k">def</span> <span class="nf">parse_multipart</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">pdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse multipart input.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    fp   : input file</span>
<span class="sd">    pdict: dictionary containing other parameters of content-type header</span>

<span class="sd">    Returns a dictionary just like parse_qs(): keys are the field names, each</span>
<span class="sd">    value is a list of values for that field.  This is easy to use but not</span>
<span class="sd">    much good if you are expecting megabytes to be uploaded -- in that case,</span>
<span class="sd">    use the FieldStorage class instead which is much more flexible.  Note</span>
<span class="sd">    that content-type is the raw, unparsed contents of the content-type</span>
<span class="sd">    header.</span>

<span class="sd">    XXX This does not parse nested multipart parts -- use FieldStorage for</span>
<span class="sd">    that.</span>

<span class="sd">    XXX This should really be subsumed by FieldStorage altogether -- no</span>
<span class="sd">    point in having two implementations of the same parsing algorithm.</span>
<span class="sd">    Also, FieldStorage protects itself better against certain DoS attacks</span>
<span class="sd">    by limiting the size of the data read in one chunk.  The API here</span>
<span class="sd">    does not support that kind of protection.  This also affects parse()</span>
<span class="sd">    since it can call parse_multipart().</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">http.client</span>

    <span class="n">boundary</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="s">&#39;boundary&#39;</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">:</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;boundary&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_boundary</span><span class="p">(</span><span class="n">boundary</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Invalid boundary in multipart form: </span><span class="si">%r</span><span class="s">&#39;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">boundary</span><span class="p">,))</span>

    <span class="n">nextpart</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="n">boundary</span>
    <span class="n">lastpart</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="n">boundary</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;--&quot;</span>
    <span class="n">partdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">terminator</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>

    <span class="k">while</span> <span class="n">terminator</span> <span class="o">!=</span> <span class="n">lastpart</span><span class="p">:</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">terminator</span><span class="p">:</span>
            <span class="c"># At start of next part.  Read headers first.</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">parse_headers</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="n">clength</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-length&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clength</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">clength</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">and</span> <span class="nb">bytes</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Maximum content length exceeded&#39;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
        <span class="c"># Read lines until end of part.</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">terminator</span> <span class="o">=</span> <span class="n">lastpart</span> <span class="c"># End outer loop</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;--&quot;</span><span class="p">):</span>
                <span class="n">terminator</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">terminator</span> <span class="ow">in</span> <span class="p">(</span><span class="n">nextpart</span><span class="p">,</span> <span class="n">lastpart</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c"># Done with part.</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">bytes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="c"># Strip final line terminator</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-disposition&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s">&#39;form-data&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">partdict</span><span class="p">:</span>
            <span class="n">partdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">partdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">partdict</span>

</div>
<span class="k">def</span> <span class="nf">_parseparam</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">s</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;;&#39;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&quot;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">end</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>

<div class="viewcode-block" id="parse_header"><a class="viewcode-back" href="../cgi.html#cgi.parse_header">[docs]</a><span class="k">def</span> <span class="nf">parse_header</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a Content-type like header.</span>

<span class="sd">    Return the main content-type and a dictionary of options.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">_parseparam</span><span class="p">(</span><span class="s">&#39;;&#39;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">parts</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="n">pdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&quot;&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">pdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="n">pdict</span>


<span class="c"># Classes for field storage</span>
<span class="c"># =========================</span>
</div>
<div class="viewcode-block" id="MiniFieldStorage"><a class="viewcode-back" href="../cgi.html#cgi.MiniFieldStorage">[docs]</a><span class="k">class</span> <span class="nc">MiniFieldStorage</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Like FieldStorage, for use when no file uploads are possible.&quot;&quot;&quot;</span>

    <span class="c"># Dummy attributes</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">type_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">disposition</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">disposition_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor from field name and value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c"># self.file = StringIO(value)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return printable representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;MiniFieldStorage(</span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FieldStorage"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage">[docs]</a><span class="k">class</span> <span class="nc">FieldStorage</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Store a sequence of fields, reading multipart/form-data.</span>

<span class="sd">    This class provides naming, typing, files stored on disk, and</span>
<span class="sd">    more.  At the top level, it is accessible like a dictionary, whose</span>
<span class="sd">    keys are the field names.  (Note: None can occur as a field name.)</span>
<span class="sd">    The items are either a Python list (if there&#39;s multiple values) or</span>
<span class="sd">    another FieldStorage or MiniFieldStorage object.  If it&#39;s a single</span>
<span class="sd">    object, it has the following attributes:</span>

<span class="sd">    name: the field name, if specified; otherwise None</span>

<span class="sd">    filename: the filename, if specified; otherwise None; this is the</span>
<span class="sd">        client side filename, *not* the file name on which it is</span>
<span class="sd">        stored (that&#39;s a temporary file you don&#39;t deal with)</span>

<span class="sd">    value: the value as a *string*; for file uploads, this</span>
<span class="sd">        transparently reads the file every time you request the value</span>
<span class="sd">        and returns *bytes*</span>

<span class="sd">    file: the file(-like) object from which you can read the data *as</span>
<span class="sd">        bytes* ; None if the data is stored a simple string</span>

<span class="sd">    type: the content-type, or None if not specified</span>

<span class="sd">    type_options: dictionary of options specified on the content-type</span>
<span class="sd">        line</span>

<span class="sd">    disposition: content-disposition, or None if not specified</span>

<span class="sd">    disposition_options: dictionary of corresponding options</span>

<span class="sd">    headers: a dictionary(-like) object (sometimes email.message.Message or a</span>
<span class="sd">        subclass thereof) containing *all* headers</span>

<span class="sd">    The class is subclassable, mostly for the purpose of overriding</span>
<span class="sd">    the make_file() method, which is called internally to come up with</span>
<span class="sd">    a file open for reading and writing.  This makes it possible to</span>
<span class="sd">    override the default choice of storing all files in a temporary</span>
<span class="sd">    directory and unlinking them as soon as they have been opened.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">outerboundary</span><span class="o">=</span><span class="n">b</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">environ</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.  Read multipart/* until last part.</span>

<span class="sd">        Arguments, all optional:</span>

<span class="sd">        fp              : file pointer; default: sys.stdin.buffer</span>
<span class="sd">            (not used when the request method is GET)</span>
<span class="sd">            Can be :</span>
<span class="sd">            1. a TextIOWrapper object</span>
<span class="sd">            2. an object whose read() and readline() methods return bytes</span>

<span class="sd">        headers         : header dictionary-like object; default:</span>
<span class="sd">            taken from environ as per CGI spec</span>

<span class="sd">        outerboundary   : terminating multipart boundary</span>
<span class="sd">            (for internal use only)</span>

<span class="sd">        environ         : environment dictionary; default: os.environ</span>

<span class="sd">        keep_blank_values: flag indicating whether blank values in</span>
<span class="sd">            percent-encoded forms should be treated as blank strings.</span>
<span class="sd">            A true value indicates that blanks should be retained as</span>
<span class="sd">            blank strings.  The default false value indicates that</span>
<span class="sd">            blank values are to be ignored and treated as if they were</span>
<span class="sd">            not included.</span>

<span class="sd">        strict_parsing: flag indicating what to do with parsing errors.</span>
<span class="sd">            If false (the default), errors are silently ignored.</span>
<span class="sd">            If true, errors raise a ValueError exception.</span>

<span class="sd">        limit : used internally to read parts of multipart/form-data forms,</span>
<span class="sd">            to exit from the reading loop when reached. It is the difference</span>
<span class="sd">            between the form content-length and the number of bytes already</span>
<span class="sd">            read</span>

<span class="sd">        encoding, errors : the encoding and error handler used to decode the</span>
<span class="sd">            binary stream to strings. Must be the same as the charset defined</span>
<span class="sd">            for the page sending the form (content-type : meta http-equiv or</span>
<span class="sd">            header)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;GET&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_blank_values</span> <span class="o">=</span> <span class="n">keep_blank_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_parsing</span> <span class="o">=</span> <span class="n">strict_parsing</span>
        <span class="k">if</span> <span class="s">&#39;REQUEST_METHOD&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qs_on_post</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;GET&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;HEAD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;QUERY_STRING&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
                <span class="n">qs</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">qs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qs</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">getpreferredencoding</span><span class="p">(),</span> <span class="s">&#39;surrogateescape&#39;</span><span class="p">)</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;content-type&#39;</span><span class="p">:</span>
                           <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
                <span class="c"># Set default content-type for POST to what&#39;s traditional</span>
                <span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;application/x-www-form-urlencoded&quot;</span>
            <span class="k">if</span> <span class="s">&#39;CONTENT_TYPE&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
                <span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;QUERY_STRING&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qs_on_post</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;CONTENT_LENGTH&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
                <span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;CONTENT_LENGTH&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="p">(</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">Message</span><span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;headers must be mapping or an instance of &quot;</span>
                                <span class="s">&quot;email.message.Message&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="k">if</span> <span class="n">fp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">buffer</span>
        <span class="c"># self.fp.read() must return bytes</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">TextIOWrapper</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">buffer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;read&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;readline&#39;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;fp must be file pointer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outerboundary</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;outerboundary must be bytes, not </span><span class="si">%s</span><span class="s">&#39;</span>
                            <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">outerboundary</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerboundary</span> <span class="o">=</span> <span class="n">outerboundary</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="c"># Process content-disposition header</span>
        <span class="n">cdisp</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s">&#39;content-disposition&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">cdisp</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-disposition&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disposition</span> <span class="o">=</span> <span class="n">cdisp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disposition_options</span> <span class="o">=</span> <span class="n">pdict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_binary_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

        <span class="c"># Process content-type header</span>
        <span class="c">#</span>
        <span class="c"># Honor any existing content-type header.  But if there is no</span>
        <span class="c"># content-type header, use some sensible defaults.  Assume</span>
        <span class="c"># outerboundary is &quot;&quot; at the outer level, but something non-false</span>
        <span class="c"># inside a multi-part.  The default for an inner part is text/plain,</span>
        <span class="c"># but for an outer part it should be urlencoded.  This should catch</span>
        <span class="c"># bogus clients which erroneously forget to include a content-type</span>
        <span class="c"># header.</span>
        <span class="c">#</span>
        <span class="c"># See below for what we do if there does exist a content-type header,</span>
        <span class="c"># but it happens to be something we don&#39;t understand.</span>
        <span class="k">if</span> <span class="s">&#39;content-type&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerboundary</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">!=</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
            <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="s">&quot;text/plain&quot;</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="s">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ctype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_options</span> <span class="o">=</span> <span class="n">pdict</span>
        <span class="k">if</span> <span class="s">&#39;boundary&#39;</span> <span class="ow">in</span> <span class="n">pdict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">innerboundary</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;boundary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">innerboundary</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>

        <span class="n">clen</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="s">&#39;content-length&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;content-length&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">and</span> <span class="n">clen</span> <span class="o">&gt;</span> <span class="n">maxlen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Maximum content length exceeded&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">clen</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">clen</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">clen</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_urlencoded</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ctype</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;multipart/&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_multi</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_single</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a printable representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;FieldStorage(</span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s">&#39;value&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary style indexing.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;not indexable&quot;</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span> <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">found</span>

<div class="viewcode-block" id="FieldStorage.getvalue"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.getvalue">[docs]</a>    <span class="k">def</span> <span class="nf">getvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary style get() method, including &#39;value&#39; lookup.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
</div>
<div class="viewcode-block" id="FieldStorage.getfirst"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.getfirst">[docs]</a>    <span class="k">def</span> <span class="nf">getfirst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the first value received.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
</div>
<div class="viewcode-block" id="FieldStorage.getlist"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.getlist">[docs]</a>    <span class="k">def</span> <span class="nf">getlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return list of received values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="FieldStorage.keys"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary style keys() method.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;not indexable&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary style __contains__ method.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;not indexable&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">key</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary style len(x) support.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Cannot be converted to bool.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

<div class="viewcode-block" id="FieldStorage.read_urlencoded"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_urlencoded">[docs]</a>    <span class="k">def</span> <span class="nf">read_urlencoded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read data in query string format.&quot;&quot;&quot;</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> should return bytes, got </span><span class="si">%s</span><span class="s">&quot;</span> \
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs_on_post</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">+=</span> <span class="s">&#39;&amp;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs_on_post</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qsl</span><span class="p">(</span>
            <span class="n">qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_blank_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_parsing</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MiniFieldStorage</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_lines</span><span class="p">()</span>
</div>
    <span class="n">FieldStorageClass</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="FieldStorage.read_multi"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_multi">[docs]</a>    <span class="k">def</span> <span class="nf">read_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span> <span class="n">strict_parsing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read a part that is itself multipart.&quot;&quot;&quot;</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">innerboundary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_boundary</span><span class="p">(</span><span class="n">ib</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Invalid boundary in multipart form: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ib</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs_on_post</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qsl</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qs_on_post</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_blank_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_parsing</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MiniFieldStorage</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FieldStorageClass</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="c"># bytes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_line</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> should return bytes, got </span><span class="si">%s</span><span class="s">&quot;</span> \
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span>
        <span class="c"># first line holds boundary ; ignore it, or check that</span>
        <span class="c"># b&quot;--&quot; + ib == first_line.strip() ?</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">FeedParser</span><span class="p">()</span>
            <span class="n">hdr_text</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">hdr_text</span> <span class="o">+=</span> <span class="n">data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hdr_text</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="c"># parser takes strings, not bytes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdr_text</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">hdr_text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">))</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="p">,</span>
                         <span class="n">strict_parsing</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">bytes_read</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">done</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_lines</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="FieldStorage.read_single"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_single">[docs]</a>    <span class="k">def</span> <span class="nf">read_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read an atomic part.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_binary</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip_lines</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_lines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div>
    <span class="n">bufsize</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="mi">1024</span>            <span class="c"># I/O buffering size for copy to file</span>

<div class="viewcode-block" id="FieldStorage.read_binary"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_binary">[docs]</a>    <span class="k">def</span> <span class="nf">read_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read binary data.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_file</span><span class="p">()</span>
        <span class="n">todo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">if</span> <span class="n">todo</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">todo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">todo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bufsize</span><span class="p">))</span> <span class="c"># bytes</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> should return bytes, got </span><span class="si">%s</span><span class="s">&quot;</span>
                                     <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">break</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">todo</span> <span class="o">=</span> <span class="n">todo</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FieldStorage.read_lines"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_lines">[docs]</a>    <span class="k">def</span> <span class="nf">read_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read lines until EOF or outerboundary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span> <span class="c"># store data as bytes for files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__file</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span> <span class="c"># as strings for other fields</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerboundary</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_lines_to_outerboundary</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_lines_to_eof</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;line is always bytes, not string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_file</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_file</span><span class="p">:</span>
            <span class="c"># keep bytes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># decode to string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">))</span>

<div class="viewcode-block" id="FieldStorage.read_lines_to_eof"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_lines_to_eof">[docs]</a>    <span class="k">def</span> <span class="nf">read_lines_to_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read lines until EOF.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span> <span class="c"># bytes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FieldStorage.read_lines_to_outerboundary"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.read_lines_to_outerboundary">[docs]</a>    <span class="k">def</span> <span class="nf">read_lines_to_outerboundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: read lines until outerboundary.</span>
<span class="sd">        Data is read as bytes: boundaries and line ends must be converted</span>
<span class="sd">        to bytes for comparisons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">next_boundary</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerboundary</span>
        <span class="n">last_boundary</span> <span class="o">=</span> <span class="n">next_boundary</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;--&quot;</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
        <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">_read</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_read</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span> <span class="c"># bytes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">delim</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">delim</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">delim</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;--&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_line_lfend</span><span class="p">:</span>
                <span class="n">strippedline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">strippedline</span> <span class="o">==</span> <span class="n">next_boundary</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">strippedline</span> <span class="o">==</span> <span class="n">last_boundary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="n">odelim</span> <span class="o">=</span> <span class="n">delim</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="n">delim</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="n">delim</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">):</span>
                <span class="c"># We may interrupt \r\n sequences if they span the 2**16</span>
                <span class="c"># byte boundary</span>
                <span class="n">delim</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delim</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>
                <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write</span><span class="p">(</span><span class="n">odelim</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FieldStorage.skip_lines"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.skip_lines">[docs]</a>    <span class="k">def</span> <span class="nf">skip_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal: skip lines until outer boundary if defined.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerboundary</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">next_boundary</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerboundary</span>
        <span class="n">last_boundary</span> <span class="o">=</span> <span class="n">next_boundary</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;--&quot;</span>
        <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;--&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_line_lfend</span><span class="p">:</span>
                <span class="n">strippedline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">strippedline</span> <span class="o">==</span> <span class="n">next_boundary</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">strippedline</span> <span class="o">==</span> <span class="n">last_boundary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="n">last_line_lfend</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FieldStorage.make_file"><a class="viewcode-back" href="../cgi.html#cgi.FieldStorage.make_file">[docs]</a>    <span class="k">def</span> <span class="nf">make_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overridable: return a readable &amp; writable file.</span>

<span class="sd">        The file will be used as follows:</span>
<span class="sd">        - data is written to it</span>
<span class="sd">        - seek(0)</span>
<span class="sd">        - data is read from it</span>

<span class="sd">        The file is opened in binary mode for files, in text mode</span>
<span class="sd">        for other fields</span>

<span class="sd">        This version opens a temporary file for reading and writing,</span>
<span class="sd">        and immediately deletes (unlinks) it.  The trick (on Unix!) is</span>
<span class="sd">        that the file can still be used, but it can&#39;t be opened by</span>
<span class="sd">        another process, and it will automatically be deleted when it</span>
<span class="sd">        is closed or when the current process terminates.</span>

<span class="sd">        If you want a more permanent file, you derive a class which</span>
<span class="sd">        overrides this method.  If you want a visible temporary file</span>
<span class="sd">        that is nevertheless automatically deleted when the script</span>
<span class="sd">        terminates, try defining a __del__ method in a derived class</span>
<span class="sd">        which unlinks the temporary files you have created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="s">&quot;wb+&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="s">&quot;w+&quot;</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>


<span class="c"># Test/debug code</span>
<span class="c"># ===============</span>
</div></div>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">environ</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Robust test CGI script, usable as main program.</span>

<span class="sd">    Write minimal HTTP headers and dump all information provided to</span>
<span class="sd">    the script in HTML form.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Content-type: text/html&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">FieldStorage</span><span class="p">()</span>   <span class="c"># Replace with other classes to test those</span>
        <span class="n">print_directory</span><span class="p">()</span>
        <span class="n">print_arguments</span><span class="p">()</span>
        <span class="n">print_form</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="n">print_environ</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">print_environ_usage</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
            <span class="k">exec</span><span class="p">(</span><span class="s">&quot;testing print_exception() -- &lt;I&gt;italics?&lt;/I&gt;&quot;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">):</span>
            <span class="n">f</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H3&gt;What follows is a test, not an actual exception:&lt;/H3&gt;&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">print_exception</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H1&gt;Second try with a small maxlen...&lt;/H1&gt;&quot;</span><span class="p">)</span>

    <span class="k">global</span> <span class="n">maxlen</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">FieldStorage</span><span class="p">()</span>   <span class="c"># Replace with other classes to test those</span>
        <span class="n">print_directory</span><span class="p">()</span>
        <span class="n">print_arguments</span><span class="p">()</span>
        <span class="n">print_form</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="n">print_environ</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">print_exception</span><span class="p">()</span>

<div class="viewcode-block" id="print_exception"><a class="viewcode-back" href="../cgi.html#cgi.print_exception">[docs]</a><span class="k">def</span> <span class="nf">print_exception</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">traceback</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H3&gt;Traceback (most recent call last):&lt;/H3&gt;&quot;</span><span class="p">)</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="o">+</span> \
           <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception_only</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;PRE&gt;</span><span class="si">%s</span><span class="s">&lt;B&gt;</span><span class="si">%s</span><span class="s">&lt;/B&gt;&lt;/PRE&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">))</span>
    <span class="k">del</span> <span class="n">tb</span>
</div>
<div class="viewcode-block" id="print_environ"><a class="viewcode-back" href="../cgi.html#cgi.print_environ">[docs]</a><span class="k">def</span> <span class="nf">print_environ</span><span class="p">(</span><span class="n">environ</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the shell environment as HTML.&quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H3&gt;Shell Environment:&lt;/H3&gt;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;DL&gt;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;DT&gt;&quot;</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s">&quot;&lt;DD&gt;&quot;</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;/DL&gt;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="print_form"><a class="viewcode-back" href="../cgi.html#cgi.print_form">[docs]</a><span class="k">def</span> <span class="nf">print_form</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dump the contents of a form as HTML.&quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H3&gt;Form Contents:&lt;/H3&gt;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;P&gt;No form fields.&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;DL&gt;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;DT&gt;&quot;</span> <span class="o">+</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;i&gt;&quot;</span> <span class="o">+</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span> <span class="o">+</span> <span class="s">&quot;&lt;/i&gt;&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;DD&gt;&quot;</span> <span class="o">+</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;/DL&gt;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="print_directory"><a class="viewcode-back" href="../cgi.html#cgi.print_directory">[docs]</a><span class="k">def</span> <span class="nf">print_directory</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Dump the current directory as HTML.&quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H3&gt;Current Working Directory:&lt;/H3&gt;&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;OSError:&quot;</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">pwd</span><span class="p">))</span>
    <span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="print_arguments"><a class="viewcode-back" href="../cgi.html#cgi.print_arguments">[docs]</a><span class="k">def</span> <span class="nf">print_arguments</span><span class="p">():</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;H3&gt;Command Line Arguments:&lt;/H3&gt;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="print_environ_usage"><a class="viewcode-back" href="../cgi.html#cgi.print_environ_usage">[docs]</a><span class="k">def</span> <span class="nf">print_environ_usage</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Dump a list of environment variables used by CGI as HTML.&quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;H3&gt;These environment variables could have been set:&lt;/H3&gt;</span>
<span class="s">&lt;UL&gt;</span>
<span class="s">&lt;LI&gt;AUTH_TYPE</span>
<span class="s">&lt;LI&gt;CONTENT_LENGTH</span>
<span class="s">&lt;LI&gt;CONTENT_TYPE</span>
<span class="s">&lt;LI&gt;DATE_GMT</span>
<span class="s">&lt;LI&gt;DATE_LOCAL</span>
<span class="s">&lt;LI&gt;DOCUMENT_NAME</span>
<span class="s">&lt;LI&gt;DOCUMENT_ROOT</span>
<span class="s">&lt;LI&gt;DOCUMENT_URI</span>
<span class="s">&lt;LI&gt;GATEWAY_INTERFACE</span>
<span class="s">&lt;LI&gt;LAST_MODIFIED</span>
<span class="s">&lt;LI&gt;PATH</span>
<span class="s">&lt;LI&gt;PATH_INFO</span>
<span class="s">&lt;LI&gt;PATH_TRANSLATED</span>
<span class="s">&lt;LI&gt;QUERY_STRING</span>
<span class="s">&lt;LI&gt;REMOTE_ADDR</span>
<span class="s">&lt;LI&gt;REMOTE_HOST</span>
<span class="s">&lt;LI&gt;REMOTE_IDENT</span>
<span class="s">&lt;LI&gt;REMOTE_USER</span>
<span class="s">&lt;LI&gt;REQUEST_METHOD</span>
<span class="s">&lt;LI&gt;SCRIPT_NAME</span>
<span class="s">&lt;LI&gt;SERVER_NAME</span>
<span class="s">&lt;LI&gt;SERVER_PORT</span>
<span class="s">&lt;LI&gt;SERVER_PROTOCOL</span>
<span class="s">&lt;LI&gt;SERVER_ROOT</span>
<span class="s">&lt;LI&gt;SERVER_SOFTWARE</span>
<span class="s">&lt;/UL&gt;</span>
<span class="s">In addition, HTTP headers sent by the server may be passed in the</span>
<span class="s">environment as well.  Here are some common variable names:</span>
<span class="s">&lt;UL&gt;</span>
<span class="s">&lt;LI&gt;HTTP_ACCEPT</span>
<span class="s">&lt;LI&gt;HTTP_CONNECTION</span>
<span class="s">&lt;LI&gt;HTTP_HOST</span>
<span class="s">&lt;LI&gt;HTTP_PRAGMA</span>
<span class="s">&lt;LI&gt;HTTP_REFERER</span>
<span class="s">&lt;LI&gt;HTTP_USER_AGENT</span>
<span class="s">&lt;/UL&gt;</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>


<span class="c"># Utilities</span>
<span class="c"># =========</span>
</div>
<div class="viewcode-block" id="escape"><a class="viewcode-back" href="../cgi.html#cgi.escape">[docs]</a><span class="k">def</span> <span class="nf">escape</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated API.&quot;&quot;&quot;</span>
    <span class="n">warn</span><span class="p">(</span><span class="s">&quot;cgi.escape is deprecated, use html.escape instead&quot;</span><span class="p">,</span>
         <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;amp;&quot;</span><span class="p">)</span> <span class="c"># Must be done first!</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;lt;&quot;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;gt;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">quote</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;&amp;quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

</div>
<span class="k">def</span> <span class="nf">valid_boundary</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">_vb_pattern</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;^[ -~]{0,200}[!-~]$&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_vb_pattern</span> <span class="o">=</span> <span class="s">&quot;^[ -~]{0,200}[!-~]$&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_vb_pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="c"># Invoke mainline</span>
<span class="c"># ===============</span>

<span class="c"># Call test() when this file is run as a script (not imported as a module)</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Weldon Henson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0.',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>